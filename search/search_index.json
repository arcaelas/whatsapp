{"config":{"lang":["en","es"],"separator":"[\\s\\-\\.]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"@arcaelas/whatsapp","text":"<p>TypeScript library for WhatsApp automation Based on Baileys | Full typing | Flexible persistence engine | Easy to use</p>"},{"location":"#features","title":"Features","text":"<ul> <li>Simplified connection - QR or pairing code in a single call</li> <li>Typed events - Full TypeScript with autocomplete</li> <li>Flexible persistence - FileEngine by default, or implement your own Engine</li> <li>Intuitive classes - Chat, Contact, Message with static methods</li> <li>Multiple message types - text, image, video, audio, location, poll</li> <li>Group management - List members, archive, mute, pin</li> <li>Poll support - Create polls with multiple options</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":"<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\n\n// Create instance\nconst wa = new WhatsApp({\n  phone: \"5491112345678\", // Optional: for pairing code\n});\n\n// Listen to events\nwa.event.on(\"open\", () =&gt; console.log(\"Connected!\"));\nwa.event.on(\"close\", () =&gt; console.log(\"Disconnected\"));\nwa.event.on(\"error\", (err) =&gt; console.error(\"Error:\", err.message));\n\n// Connect\nawait wa.pair(async (data) =&gt; {\n  if (Buffer.isBuffer(data)) {\n    // QR code as PNG image\n    require(\"fs\").writeFileSync(\"qr.png\", data);\n    console.log(\"Scan the QR in qr.png\");\n  } else {\n    // Pairing code (8 digits)\n    console.log(\"Code:\", data);\n  }\n});\n\n// Listen to messages\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return; // Ignore own messages\n\n  // Check type\n  if (msg.type === \"text\") {\n    const text = (await msg.content()).toString();\n    console.log(`Message: ${text}`);\n\n    // Reply\n    if (text.toLowerCase() === \"hello\") {\n      await wa.Message.text(msg.cid, \"Hello! How are you?\");\n    }\n  }\n});\n</code></pre>"},{"location":"#message-types","title":"Message Types","text":"<p>The library supports multiple message types:</p> Type <code>msg.type</code> Description Text <code>\"text\"</code> Plain text message Image <code>\"image\"</code> Image with optional caption Video <code>\"video\"</code> Video with optional caption Audio <code>\"audio\"</code> Voice note or audio Location <code>\"location\"</code> Geographic coordinates Poll <code>\"poll\"</code> Poll with options <pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n\n  if (msg.type === \"image\") {\n    const buffer = await msg.content();\n    console.log(`Image received: ${buffer.length} bytes`);\n    if (msg.caption) {\n      console.log(`Caption: ${msg.caption}`);\n    }\n  }\n\n  if (msg.type === \"poll\") {\n    const buffer = await msg.content();\n    const poll = JSON.parse(buffer.toString());\n    console.log(`Poll: ${poll.content}`);\n    poll.options.forEach((opt: { content: string }, i: number) =&gt; {\n      console.log(`  ${i + 1}. ${opt.content}`);\n    });\n  }\n});\n</code></pre>"},{"location":"#persistence-engine","title":"Persistence Engine","text":"<p>By default <code>FileEngine</code> is used. You can implement your own engine:</p> FileEngine (default)Custom engine <pre><code>import { WhatsApp, FileEngine } from \"@arcaelas/whatsapp\";\n\nconst wa = new WhatsApp({\n  engine: new FileEngine(\".baileys/my-bot\"),\n});\n</code></pre> <pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\nimport type { Engine } from \"@arcaelas/whatsapp\";\n\n// Implement the Engine interface\nclass RedisEngine implements Engine {\n  async get(key: string): Promise&lt;string | null&gt; { /* ... */ }\n  async set(key: string, value: string | null): Promise&lt;void&gt; { /* ... */ }\n  async list(prefix: string, offset?: number, limit?: number): Promise&lt;string[]&gt; { /* ... */ }\n}\n\nconst wa = new WhatsApp({\n  engine: new RedisEngine(),\n});\n</code></pre>"},{"location":"#next-step","title":"Next Step","text":"<ul> <li> <p> Installation</p> <p>Detailed instructions for installing the library</p> <p> View guide</p> </li> <li> <p> Getting Started</p> <p>Step by step tutorial to create your first bot</p> <p> Start</p> </li> <li> <p> API References</p> <p>Complete documentation of all classes</p> <p> View API</p> </li> <li> <p> Examples</p> <p>Practical ready-to-use examples</p> <p> View examples</p> </li> </ul> <p>Developed by Arcaelas Insiders</p>"},{"location":"baileys-payloads/","title":"Baileys Event Payloads Reference","text":"<p>Documentaci\u00f3n completa de payloads capturados de Baileys v6.7.18 para todos los tipos de mensaje: - Texto - Mensajes de texto simple y extendido - Im\u00e1genes - Con caption, thumbnails y media keys - Videos - Con streaming sidecar y duraci\u00f3n - Audios - Notas de voz (PTT) y archivos de audio - Ubicaciones - Est\u00e1ticas y en vivo - Encuestas - Creaci\u00f3n y votos (cifrados E2E)</p>"},{"location":"baileys-payloads/#1-mensaje-de-texto-nuevo","title":"1. Mensaje de Texto (nuevo)","text":"<p>Evento: <code>messages.upsert</code> con <code>type: \"notify\"</code></p> <pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC07DE0D18FA8254897A26C90B2FFD98\"\n  },\n  \"messageTimestamp\": 1767366759,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"broadcast\": false,\n  \"message\": {\n    \"extendedTextMessage\": {\n      \"text\": \"Mensaje\",\n      \"previewType\": \"NONE\",\n      \"contextInfo\": {\n        \"expiration\": 7776000,\n        \"ephemeralSettingTimestamp\": \"1752995285\",\n        \"disappearingMode\": {\n          \"initiator\": \"INITIATED_BY_ME\",\n          \"trigger\": \"ACCOUNT_SETTING\",\n          \"initiatedByMe\": true\n        }\n      },\n      \"inviteLinkGroupTypeV2\": \"DEFAULT\"\n    },\n    \"messageContextInfo\": {\n      \"deviceListMetadata\": {\n        \"senderKeyHash\": \"2tnQy4q7mzjMfw==\",\n        \"senderTimestamp\": \"1767289397\",\n        \"recipientKeyHash\": \"fbnE50/78FcqHw==\",\n        \"recipientTimestamp\": \"1767366507\"\n      },\n      \"deviceListMetadataVersion\": 2,\n      \"messageSecret\": \"wZda2AFu1tzmVVGYpMDBdevK4OmwFvyH1tJ30BnmSfA=\"\n    }\n  }\n}\n</code></pre> <p>Campos clave: - <code>key.remoteJid</code> - ID del chat (formato <code>@lid</code> o <code>@s.whatsapp.net</code>) - <code>key.fromMe</code> - Si el mensaje fue enviado por nosotros - <code>key.id</code> - ID \u00fanico del mensaje - <code>pushName</code> - Nombre del remitente - <code>message.extendedTextMessage.text</code> - Contenido del texto</p>"},{"location":"baileys-payloads/#2-edicion-de-mensaje","title":"2. Edici\u00f3n de Mensaje","text":""},{"location":"baileys-payloads/#21-via-messagesupsert-protocolmessage","title":"2.1 Via <code>messages.upsert</code> (protocolMessage)","text":"<pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC28854886802F1895A337C83F0EC211\"\n  },\n  \"messageTimestamp\": 1767366766,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"protocolMessage\": {\n      \"key\": {\n        \"remoteJid\": \"9698623357112@lid\",\n        \"fromMe\": true,\n        \"id\": \"AC07DE0D18FA8254897A26C90B2FFD98\"\n      },\n      \"type\": \"MESSAGE_EDIT\",\n      \"editedMessage\": {\n        \"extendedTextMessage\": {\n          \"text\": \"Editado.\",\n          \"previewType\": \"NONE\",\n          \"contextInfo\": { ... }\n        }\n      },\n      \"timestampMs\": \"1767366766505\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#22-via-messagesupdate","title":"2.2 Via <code>messages.update</code>","text":"<pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC07DE0D18FA8254897A26C90B2FFD98\"\n  },\n  \"update\": {\n    \"message\": {\n      \"editedMessage\": {\n        \"message\": {\n          \"extendedTextMessage\": {\n            \"text\": \"Editado.\",\n            \"previewType\": \"NONE\",\n            \"contextInfo\": { ... }\n          }\n        }\n      }\n    },\n    \"messageTimestamp\": 1767366766\n  }\n}\n</code></pre> <p>Campos clave: - <code>protocolMessage.type</code> = <code>\"MESSAGE_EDIT\"</code> (o <code>14</code> como n\u00famero) - <code>protocolMessage.key.id</code> - ID del mensaje objetivo a editar - <code>protocolMessage.editedMessage</code> - Nuevo contenido del mensaje</p>"},{"location":"baileys-payloads/#3-reaccion","title":"3. Reacci\u00f3n","text":""},{"location":"baileys-payloads/#31-via-messagesupsert-reactionmessage","title":"3.1 Via <code>messages.upsert</code> (reactionMessage)","text":"<pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC4FAE3156F6766A5C19DE9896A728D1\"\n  },\n  \"messageTimestamp\": 1767366771,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"reactionMessage\": {\n      \"key\": {\n        \"remoteJid\": \"140913951141911@lid\",\n        \"fromMe\": false,\n        \"id\": \"AC07DE0D18FA8254897A26C90B2FFD98\"\n      },\n      \"text\": \"\u2764\ufe0f\",\n      \"senderTimestampMs\": \"1767366770998\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#32-via-messagesreaction","title":"3.2 Via <code>messages.reaction</code>","text":"<pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC07DE0D18FA8254897A26C90B2FFD98\"\n  },\n  \"reaction\": {\n    \"key\": {\n      \"remoteJid\": \"140913951141911@lid\",\n      \"fromMe\": false,\n      \"id\": \"AC4FAE3156F6766A5C19DE9896A728D1\"\n    },\n    \"text\": \"\u2764\ufe0f\",\n    \"senderTimestampMs\": { \"low\": 2135212342, \"high\": 411, \"unsigned\": false }\n  }\n}\n</code></pre> <p>Campos clave: - <code>reactionMessage.key.id</code> - ID del mensaje al que se reacciona - <code>reactionMessage.text</code> - Emoji de la reacci\u00f3n (vac\u00edo = quitar reacci\u00f3n)</p>"},{"location":"baileys-payloads/#4-eliminacion-revoke","title":"4. Eliminaci\u00f3n (REVOKE)","text":""},{"location":"baileys-payloads/#41-via-messagesupsert-protocolmessage","title":"4.1 Via <code>messages.upsert</code> (protocolMessage)","text":"<pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC654D7AA789E560FBD9E3EBD8200198\"\n  },\n  \"messageTimestamp\": 1767366775,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"protocolMessage\": {\n      \"key\": {\n        \"remoteJid\": \"9698623357112@lid\",\n        \"fromMe\": true,\n        \"id\": \"AC07DE0D18FA8254897A26C90B2FFD98\"\n      },\n      \"type\": \"REVOKE\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#42-via-messagesupdate","title":"4.2 Via <code>messages.update</code>","text":"<pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC07DE0D18FA8254897A26C90B2FFD98\"\n  },\n  \"update\": {\n    \"message\": null,\n    \"messageStubType\": 1,\n    \"key\": {\n      \"remoteJid\": \"140913951141911@lid\",\n      \"fromMe\": false,\n      \"id\": \"AC654D7AA789E560FBD9E3EBD8200198\"\n    }\n  }\n}\n</code></pre> <p>Campos clave: - <code>protocolMessage.type</code> = <code>\"REVOKE\"</code> (o <code>0</code> como n\u00famero) - <code>protocolMessage.key.id</code> - ID del mensaje a eliminar - En <code>messages.update</code>: <code>message: null</code> y <code>messageStubType: 1</code></p>"},{"location":"baileys-payloads/#5-mensaje-reenviado","title":"5. Mensaje Reenviado","text":"<p>Evento: <code>messages.upsert</code> con <code>type: \"notify\"</code></p> <pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"ACFDDB4A1F65398F52D238A78F4E761A\"\n  },\n  \"messageTimestamp\": 1767366784,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"extendedTextMessage\": {\n      \"text\": \"se volvi\u00f3 a caer :(\",\n      \"previewType\": \"NONE\",\n      \"contextInfo\": {\n        \"forwardingScore\": 1,\n        \"isForwarded\": true,\n        \"expiration\": 7776000,\n        \"ephemeralSettingTimestamp\": \"1752995285\",\n        \"disappearingMode\": { ... }\n      },\n      \"inviteLinkGroupTypeV2\": \"DEFAULT\"\n    }\n  }\n}\n</code></pre> <p>Campos clave: - <code>contextInfo.isForwarded</code> = <code>true</code> - Indica que es reenviado - <code>contextInfo.forwardingScore</code> - Cantidad de veces reenviado (1+)</p>"},{"location":"baileys-payloads/#resumen-de-tipos-de-protocolmessage","title":"Resumen de Tipos de protocolMessage","text":"Tipo Valor Num\u00e9rico Descripci\u00f3n <code>REVOKE</code> 0 Eliminar mensaje <code>EPHEMERAL_SETTING</code> 3 Cambio de mensajes temporales <code>EPHEMERAL_SYNC_RESPONSE</code> 6 Respuesta de sincronizaci\u00f3n <code>HISTORY_SYNC_NOTIFICATION</code> 7 Sincronizaci\u00f3n de historial <code>MESSAGE_EDIT</code> 14 Editar mensaje"},{"location":"baileys-payloads/#imagenes","title":"Im\u00e1genes","text":""},{"location":"baileys-payloads/#1-imagen-nueva","title":"1. Imagen Nueva","text":"<p>Evento: <code>messages.upsert</code> con <code>type: \"notify\"</code></p> <pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC9BE0D81D965A3C240B6ACAA891C6FD\"\n  },\n  \"messageTimestamp\": 1767366982,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"imageMessage\": {\n      \"url\": \"https://mmg.whatsapp.net/o1/v/t24/...\",\n      \"mimetype\": \"image/jpeg\",\n      \"caption\": \"Aqu\u00ed est\u00e1 el caption.\",\n      \"fileSha256\": \"AtQ/iIo7NRdmRP+aADjHBvsydhdvvL/hmnkX6e4OMUw=\",\n      \"fileLength\": \"41161\",\n      \"height\": 340,\n      \"width\": 1146,\n      \"mediaKey\": \"5j575mYpMIn/DWBitep/eVIkdTiES9QJ82C7CxHRH2Y=\",\n      \"fileEncSha256\": \"xOZ8uqbEUswSlBv+nUb7lyIrwl/TlhqVb9bAmyg5sw8=\",\n      \"directPath\": \"/o1/v/t24/f2/m233/...\",\n      \"mediaKeyTimestamp\": \"1767361850\",\n      \"jpegThumbnail\": \"/9j/4AAQSkZJRgABAQAAAQABAAD/...\",\n      \"contextInfo\": {\n        \"expiration\": 7776000,\n        \"disappearingMode\": { ... },\n        \"pairedMediaType\": \"NOT_PAIRED_MEDIA\"\n      }\n    }\n  }\n}\n</code></pre> <p>Campos clave: - <code>imageMessage.url</code> - URL para descargar (temporal) - <code>imageMessage.mediaKey</code> - Clave para descifrar el archivo - <code>imageMessage.directPath</code> - Path directo en CDN - <code>imageMessage.caption</code> - Texto del caption - <code>imageMessage.jpegThumbnail</code> - Miniatura en base64 - <code>imageMessage.mimetype</code> - Tipo MIME - <code>imageMessage.fileLength</code> - Tama\u00f1o en bytes</p>"},{"location":"baileys-payloads/#2-edicion-de-caption-imagen","title":"2. Edici\u00f3n de Caption (Imagen)","text":""},{"location":"baileys-payloads/#via-messagesupsert-protocolmessage","title":"Via <code>messages.upsert</code> (protocolMessage)","text":"<pre><code>{\n  \"message\": {\n    \"protocolMessage\": {\n      \"key\": {\n        \"remoteJid\": \"9698623357112@lid\",\n        \"fromMe\": true,\n        \"id\": \"AC9BE0D81D965A3C240B6ACAA891C6FD\"\n      },\n      \"type\": \"MESSAGE_EDIT\",\n      \"editedMessage\": {\n        \"imageMessage\": {\n          \"caption\": \"Aqu\u00ed est\u00e1 el caption editado.\",\n          \"contextInfo\": { ... }\n        }\n      },\n      \"timestampMs\": \"1767366991341\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#via-messagesupdate","title":"Via <code>messages.update</code>","text":"<pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC9BE0D81D965A3C240B6ACAA891C6FD\"\n  },\n  \"update\": {\n    \"message\": {\n      \"editedMessage\": {\n        \"message\": {\n          \"imageMessage\": {\n            \"caption\": \"Aqu\u00ed est\u00e1 el caption editado.\",\n            \"contextInfo\": { ... }\n          }\n        }\n      }\n    },\n    \"messageTimestamp\": 1767366991\n  }\n}\n</code></pre> <p>Nota: Solo se edita el <code>caption</code>, la imagen permanece igual.</p>"},{"location":"baileys-payloads/#3-reaccion-a-imagen","title":"3. Reacci\u00f3n a Imagen","text":"<p>Mismo formato que texto - usa <code>reactionMessage</code>:</p> <pre><code>{\n  \"message\": {\n    \"reactionMessage\": {\n      \"key\": {\n        \"remoteJid\": \"140913951141911@lid\",\n        \"fromMe\": false,\n        \"id\": \"AC9BE0D81D965A3C240B6ACAA891C6FD\"\n      },\n      \"text\": \"\ud83d\ude02\",\n      \"senderTimestampMs\": \"1767366995121\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#4-eliminacion-de-imagen","title":"4. Eliminaci\u00f3n de Imagen","text":"<p>Mismo formato que texto - usa <code>protocolMessage.type: \"REVOKE\"</code>:</p> <pre><code>{\n  \"message\": {\n    \"protocolMessage\": {\n      \"key\": {\n        \"remoteJid\": \"9698623357112@lid\",\n        \"fromMe\": true,\n        \"id\": \"AC9BE0D81D965A3C240B6ACAA891C6FD\"\n      },\n      \"type\": \"REVOKE\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#5-imagen-reenviada","title":"5. Imagen Reenviada","text":"<pre><code>{\n  \"message\": {\n    \"imageMessage\": {\n      \"url\": \"https://mmg.whatsapp.net/...\",\n      \"mimetype\": \"image/jpeg\",\n      \"fileSha256\": \"...\",\n      \"fileLength\": \"41548\",\n      \"height\": 2048,\n      \"width\": 1536,\n      \"mediaKey\": \"...\",\n      \"jpegThumbnail\": \"...\",\n      \"contextInfo\": {\n        \"forwardingScore\": 1,\n        \"isForwarded\": true,\n        \"expiration\": 7776000,\n        \"pairedMediaType\": \"NOT_PAIRED_MEDIA\"\n      },\n      \"scansSidecar\": \"...\",\n      \"scanLengths\": [5323, 21968, 6636, 7621],\n      \"midQualityFileSha256\": \"...\"\n    }\n  }\n}\n</code></pre> <p>Campos clave: - <code>contextInfo.isForwarded</code> = <code>true</code> - <code>contextInfo.forwardingScore</code> = cantidad de reenv\u00edos - <code>scansSidecar</code> y <code>scanLengths</code> - datos de escaneo de calidad</p>"},{"location":"baileys-payloads/#videos","title":"Videos","text":""},{"location":"baileys-payloads/#1-video-nuevo","title":"1. Video Nuevo","text":"<p>Evento: <code>messages.upsert</code> con <code>type: \"notify\"</code></p> <pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC8D9EBFC03C073E18073726AF79DD53\"\n  },\n  \"messageTimestamp\": 1767367249,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"videoMessage\": {\n      \"url\": \"https://mmg.whatsapp.net/v/t62.7161-24/...\",\n      \"mimetype\": \"video/mp4\",\n      \"fileSha256\": \"UXexcGRALCBhv9oeaJLKmszTizTUxU6bEa5AdhY2syc=\",\n      \"fileLength\": \"3927238\",\n      \"seconds\": 14,\n      \"mediaKey\": \"QMIVrONUp2pdFyJWtHmGyQmtqdmfEBpAJjMrdWjtCGo=\",\n      \"caption\": \"Video de 0:14 y 5.4MB\",\n      \"height\": 1280,\n      \"width\": 720,\n      \"fileEncSha256\": \"w+1YcO3NgNgWrHs/Gz9x0jD3jw1Bi7HSNknsFB8iT6s=\",\n      \"directPath\": \"/v/t62.7161-24/...\",\n      \"mediaKeyTimestamp\": \"1767364373\",\n      \"jpegThumbnail\": \"/9j/4AAQSkZJRgABAQAAAQABAAD/...\",\n      \"contextInfo\": {\n        \"expiration\": 7776000,\n        \"pairedMediaType\": \"SD_VIDEO_PARENT\",\n        \"statusSourceType\": \"VIDEO\"\n      },\n      \"streamingSidecar\": \"b5UxJyraDyJip4GcDCh9SoifW+eArgvRDj5sk2zE...\",\n      \"externalShareFullVideoDurationInSeconds\": 0\n    }\n  }\n}\n</code></pre> <p>Campos clave (adicionales a imagen): - <code>videoMessage.seconds</code> - Duraci\u00f3n en segundos - <code>videoMessage.streamingSidecar</code> - Datos para streaming progresivo - <code>contextInfo.pairedMediaType</code> = <code>\"SD_VIDEO_PARENT\"</code> - Video SD con posible HD - <code>contextInfo.statusSourceType</code> = <code>\"VIDEO\"</code></p>"},{"location":"baileys-payloads/#2-edicion-de-caption-video","title":"2. Edici\u00f3n de Caption (Video)","text":""},{"location":"baileys-payloads/#via-messagesupdate_1","title":"Via <code>messages.update</code>","text":"<pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC8D9EBFC03C073E18073726AF79DD53\"\n  },\n  \"update\": {\n    \"message\": {\n      \"editedMessage\": {\n        \"message\": {\n          \"videoMessage\": {\n            \"caption\": \"Video de 0:14 y 5.4MB editado.\",\n            \"contextInfo\": { ... }\n          }\n        }\n      }\n    },\n    \"messageTimestamp\": 1767367259\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#3-reaccion-a-video","title":"3. Reacci\u00f3n a Video","text":"<p>Mismo formato: <code>reactionMessage.text: \"\u2764\ufe0f\"</code></p>"},{"location":"baileys-payloads/#4-eliminacion-de-video","title":"4. Eliminaci\u00f3n de Video","text":"<p>Mismo formato: <code>protocolMessage.type: \"REVOKE\"</code></p> <pre><code>{\n  \"message\": {\n    \"protocolMessage\": {\n      \"key\": {\n        \"remoteJid\": \"9698623357112@lid\",\n        \"fromMe\": true,\n        \"id\": \"AC8D9EBFC03C073E18073726AF79DD53\"\n      },\n      \"type\": \"REVOKE\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#5-video-reenviado","title":"5. Video Reenviado","text":"<pre><code>{\n  \"message\": {\n    \"videoMessage\": {\n      \"url\": \"https://mmg.whatsapp.net/v/t62.7161-24/...\",\n      \"mimetype\": \"video/mp4\",\n      \"fileSha256\": \"ldamPu0rHgc2YP6RTLIzPDPwtdmxeLWe1MU7xgsWffk=\",\n      \"fileLength\": \"1918799\",\n      \"seconds\": 12,\n      \"mediaKey\": \"mIbYpoPeMVLGk7k/AkgMFmJbs5B1YdJb1pslgPQwGvM=\",\n      \"height\": 832,\n      \"width\": 464,\n      \"jpegThumbnail\": \"...\",\n      \"contextInfo\": {\n        \"forwardingScore\": 1,\n        \"isForwarded\": true,\n        \"expiration\": 7776000,\n        \"pairedMediaType\": \"NOT_PAIRED_MEDIA\"\n      },\n      \"streamingSidecar\": \"...\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#audios","title":"Audios","text":""},{"location":"baileys-payloads/#1-nota-de-voz-ptt","title":"1. Nota de Voz (PTT)","text":"<p>Evento: <code>messages.upsert</code> con <code>type: \"notify\"</code> o <code>\"append\"</code></p> <pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC59EFFAD3590A7D97ECCB92690E904A\"\n  },\n  \"messageTimestamp\": 1767367534,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"audioMessage\": {\n      \"url\": \"https://mmg.whatsapp.net/v/t62.7117-24/...\",\n      \"mimetype\": \"audio/ogg; codecs=opus\",\n      \"fileSha256\": \"EFYFoGCyrMKEZbpeXKdsnfQjcHF2oPF0dYxffk9di+s=\",\n      \"fileLength\": \"10460\",\n      \"seconds\": 4,\n      \"ptt\": true,\n      \"mediaKey\": \"8VKH8PT8AhNkt9SGanQwpInAEX4/VJDRmUYofxRPqgE=\",\n      \"fileEncSha256\": \"3cNnNkhHEUEwWQIRKWbEXQ/xO0WQzEAyd5N/cF6et8c=\",\n      \"directPath\": \"/v/t62.7117-24/...\",\n      \"mediaKeyTimestamp\": \"1767367534\",\n      \"contextInfo\": {\n        \"expiration\": 7776000,\n        \"disappearingMode\": { ... }\n      },\n      \"waveform\": \"AAAAEhITFhgQDAsQESooPk8/Kzw/PTsrJ0tJJBwkLCcrKhgfJigbDzA3UExAQjgyQEM/LT04Mzg5PykWJSESAA==\"\n    }\n  }\n}\n</code></pre> <p>Campos clave: - <code>audioMessage.ptt</code> = <code>true</code> - Push-to-Talk (nota de voz) - <code>audioMessage.seconds</code> - Duraci\u00f3n en segundos - <code>audioMessage.waveform</code> - Forma de onda en base64 para visualizaci\u00f3n - <code>audioMessage.mimetype</code> = <code>\"audio/ogg; codecs=opus\"</code> - Formato t\u00edpico</p>"},{"location":"baileys-payloads/#2-audio-archivo-no-ptt","title":"2. Audio Archivo (No PTT)","text":"<pre><code>{\n  \"message\": {\n    \"audioMessage\": {\n      \"url\": \"https://mmg.whatsapp.net/v/t62.7117-24/...\",\n      \"mimetype\": \"audio/ogg; codecs=opus\",\n      \"fileSha256\": \"frtdS0Pc++S6ywrX5MBURUFoEoaoqiyPeGMBl7pgbSw=\",\n      \"fileLength\": \"90552\",\n      \"seconds\": 38,\n      \"ptt\": false,\n      \"mediaKey\": \"f/2PVHe8caGXqpP7zVBxm8h88vyNXqTK2izyHmc+IKs=\",\n      \"directPath\": \"/v/t62.7117-24/...\",\n      \"contextInfo\": {\n        \"forwardingScore\": 1,\n        \"isForwarded\": true,\n        \"expiration\": 7776000\n      },\n      \"waveform\": \"AFRSSh8GAABYUDkOQlk6NgAtDkY8KzUdTThNKAQlP1NKMkNJWAAzLABOVDFDOkAFUTNONy4wNyBFEwULAFMOAA==\"\n    }\n  }\n}\n</code></pre> <p>Diferencia clave: - <code>audioMessage.ptt</code> = <code>false</code> - Archivo de audio (no nota de voz) - Sin visualizaci\u00f3n especial de \"grabando\"</p>"},{"location":"baileys-payloads/#3-reaccion-a-audio","title":"3. Reacci\u00f3n a Audio","text":"<p>Mismo formato: <code>reactionMessage.text: \"\ud83d\ude02\"</code></p>"},{"location":"baileys-payloads/#4-eliminacion-de-audio","title":"4. Eliminaci\u00f3n de Audio","text":"<p>Mismo formato: <code>protocolMessage.type: \"REVOKE\"</code></p>"},{"location":"baileys-payloads/#5-audio-reenviado","title":"5. Audio Reenviado","text":"<p>El campo <code>contextInfo.isForwarded: true</code> indica reenv\u00edo (ver ejemplo en Audio Archivo arriba).</p>"},{"location":"baileys-payloads/#ubicaciones","title":"Ubicaciones","text":""},{"location":"baileys-payloads/#1-ubicacion-actual","title":"1. Ubicaci\u00f3n Actual","text":"<p>Evento: <code>messages.upsert</code> con <code>type: \"notify\"</code></p> <pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC11AAC400F14FC9E2AA671EEA6C8EB2\"\n  },\n  \"messageTimestamp\": 1767367923,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"locationMessage\": {\n      \"degreesLatitude\": 8.2570825,\n      \"degreesLongitude\": -62.797469,\n      \"contextInfo\": {\n        \"expiration\": 7776000,\n        \"ephemeralSettingTimestamp\": \"1752995285\",\n        \"disappearingMode\": {\n          \"initiator\": \"INITIATED_BY_ME\",\n          \"trigger\": \"ACCOUNT_SETTING\",\n          \"initiatedByMe\": true\n        }\n      }\n    },\n    \"messageContextInfo\": {\n      \"deviceListMetadata\": { ... },\n      \"deviceListMetadataVersion\": 2,\n      \"messageSecret\": \"...\"\n    }\n  }\n}\n</code></pre> <p>Campos clave: - <code>locationMessage.degreesLatitude</code> - Latitud en grados decimales - <code>locationMessage.degreesLongitude</code> - Longitud en grados decimales</p>"},{"location":"baileys-payloads/#2-ubicacion-en-vivo","title":"2. Ubicaci\u00f3n en Vivo","text":"<pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC4E61B2CA235B020F9A1BE28017DF4C\"\n  },\n  \"messageTimestamp\": 1767367935,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"liveLocationMessage\": {\n      \"degreesLatitude\": 8.2570838,\n      \"degreesLongitude\": -62.7974644,\n      \"caption\": \"Caption aqui\",\n      \"sequenceNumber\": \"1767367934423001\",\n      \"contextInfo\": {\n        \"expiration\": 7776000,\n        \"disappearingMode\": { ... }\n      }\n    }\n  }\n}\n</code></pre> <p>Campos clave adicionales: - <code>liveLocationMessage.caption</code> - Texto descriptivo opcional - <code>liveLocationMessage.sequenceNumber</code> - N\u00famero de secuencia para actualizaciones</p>"},{"location":"baileys-payloads/#3-reaccion-a-ubicacion","title":"3. Reacci\u00f3n a Ubicaci\u00f3n","text":"<p>Mismo formato: <code>reactionMessage.text: \"\u2764\ufe0f\"</code></p>"},{"location":"baileys-payloads/#4-eliminacion-de-ubicacion","title":"4. Eliminaci\u00f3n de Ubicaci\u00f3n","text":"<p>Mismo formato: <code>protocolMessage.type: \"REVOKE\"</code></p> <pre><code>{\n  \"message\": {\n    \"protocolMessage\": {\n      \"key\": {\n        \"remoteJid\": \"9698623357112@lid\",\n        \"fromMe\": true,\n        \"id\": \"AC11AAC400F14FC9E2AA671EEA6C8EB2\"\n      },\n      \"type\": \"REVOKE\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#encuestas-polls","title":"Encuestas (Polls)","text":""},{"location":"baileys-payloads/#1-crear-encuesta","title":"1. Crear Encuesta","text":"<p>Evento: <code>messages.upsert</code> con <code>type: \"notify\"</code></p> <pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC1AD49BBFFC4B9257052FB9FC788060\"\n  },\n  \"messageTimestamp\": 1767367967,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"messageContextInfo\": {\n      \"deviceListMetadata\": { ... },\n      \"deviceListMetadataVersion\": 2,\n      \"messageSecret\": \"PRdzIZUGahJ6JTwa2mFOsasy1jjVGzQbaoaR6NAWZBE=\"\n    },\n    \"pollCreationMessageV3\": {\n      \"name\": \"Encuesta\",\n      \"options\": [\n        { \"optionName\": \"Opci\u00f3n a\" },\n        { \"optionName\": \"Opci\u00f3n B\" }\n      ],\n      \"selectableOptionsCount\": 0,\n      \"contextInfo\": {\n        \"expiration\": 7776000,\n        \"disappearingMode\": { ... }\n      }\n    }\n  }\n}\n</code></pre> <p>Campos clave: - <code>pollCreationMessageV3.name</code> - Pregunta de la encuesta - <code>pollCreationMessageV3.options</code> - Array de opciones - <code>pollCreationMessageV3.options[].optionName</code> - Texto de cada opci\u00f3n - <code>pollCreationMessageV3.selectableOptionsCount</code> - Cantidad de opciones seleccionables (0 = todas)</p> <p>Nota: Tambi\u00e9n existe <code>pollCreationMessage</code> y <code>pollCreationMessageV2</code> (versiones anteriores).</p>"},{"location":"baileys-payloads/#2-votar-en-encuesta","title":"2. Votar en Encuesta","text":"<p>Evento: <code>messages.upsert</code> con <code>type: \"notify\"</code></p> <pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC6710CD95104D348CC3DE9AF8AF642E\"\n  },\n  \"messageTimestamp\": 1767367970,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"messageContextInfo\": {\n      \"deviceListMetadata\": { ... },\n      \"deviceListMetadataVersion\": 2\n    },\n    \"pollUpdateMessage\": {\n      \"pollCreationMessageKey\": {\n        \"remoteJid\": \"140913951141911@lid\",\n        \"fromMe\": false,\n        \"id\": \"AC1AD49BBFFC4B9257052FB9FC788060\"\n      },\n      \"vote\": {\n        \"encPayload\": \"mMqBgjeF/JOksgWLasDRH2iU3cOVjTxjcNyHW8/hWNnRCj9neeO7oJ5Twj1UpfQh4GY=\",\n        \"encIv\": \"JfP8NerkiAgbbM1R\"\n      },\n      \"senderTimestampMs\": \"1767367970421\"\n    }\n  }\n}\n</code></pre> <p>Campos clave: - <code>pollUpdateMessage.pollCreationMessageKey</code> - Referencia a la encuesta original - <code>pollUpdateMessage.vote.encPayload</code> - Voto encriptado (end-to-end) - <code>pollUpdateMessage.vote.encIv</code> - IV para descifrar el voto</p> <p>Nota: Los votos est\u00e1n cifrados E2E. Se necesita <code>messageSecret</code> de la encuesta original para descifrarlos.</p>"},{"location":"baileys-payloads/#3-reaccion-a-encuesta","title":"3. Reacci\u00f3n a Encuesta","text":"<p>Mismo formato: <code>reactionMessage.text: \"\ud83d\ude02\"</code></p> <pre><code>{\n  \"message\": {\n    \"reactionMessage\": {\n      \"key\": {\n        \"remoteJid\": \"140913951141911@lid\",\n        \"fromMe\": false,\n        \"id\": \"AC1AD49BBFFC4B9257052FB9FC788060\"\n      },\n      \"text\": \"\ud83d\ude02\",\n      \"senderTimestampMs\": \"1767367973345\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#4-eliminacion-de-encuesta","title":"4. Eliminaci\u00f3n de Encuesta","text":"<p>Mismo formato: <code>protocolMessage.type: \"REVOKE\"</code></p> <pre><code>{\n  \"message\": {\n    \"protocolMessage\": {\n      \"key\": {\n        \"remoteJid\": \"9698623357112@lid\",\n        \"fromMe\": true,\n        \"id\": \"AC1AD49BBFFC4B9257052FB9FC788060\"\n      },\n      \"type\": \"REVOKE\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#formatos-de-remotejid","title":"Formatos de remoteJid","text":"Formato Descripci\u00f3n <code>NUMERO@s.whatsapp.net</code> Chat individual (formato antiguo) <code>NUMERO@lid</code> Chat individual (formato nuevo) <code>NUMERO-TIMESTAMP@g.us</code> Grupo <code>status@broadcast</code> Estados/Historias"},{"location":"baileys-payloads/#eventos-de-chat","title":"Eventos de Chat","text":""},{"location":"baileys-payloads/#1-chat-fijado-pin","title":"1. Chat Fijado (Pin)","text":"<p>Evento: <code>chats.update</code></p>"},{"location":"baileys-payloads/#fijar-chat","title":"Fijar chat","text":"<pre><code>[\n  {\n    \"id\": \"140913951141911@lid\",\n    \"pinned\": 1767371367857,\n    \"archived\": false\n  }\n]\n</code></pre>"},{"location":"baileys-payloads/#desfijar-chat","title":"Desfijar chat","text":"<pre><code>[\n  {\n    \"id\": \"140913951141911@lid\",\n    \"pinned\": null\n  }\n]\n</code></pre> <p>Campos clave: - <code>pinned</code> - Timestamp cuando se fij\u00f3 (n\u00famero) o <code>null</code> para desfijar</p>"},{"location":"baileys-payloads/#2-chat-archivado","title":"2. Chat Archivado","text":"<p>Evento: <code>chats.update</code></p>"},{"location":"baileys-payloads/#archivar-chat","title":"Archivar chat","text":"<pre><code>[\n  {\n    \"id\": \"140913951141911@lid\",\n    \"pinned\": null,\n    \"archived\": true\n  }\n]\n</code></pre>"},{"location":"baileys-payloads/#desarchivar-chat","title":"Desarchivar chat","text":"<pre><code>[\n  {\n    \"id\": \"140913951141911@lid\",\n    \"archived\": false\n  }\n]\n</code></pre> <p>Campos clave: - <code>archived</code> - <code>true</code> para archivar, <code>false</code> para desarchivar</p>"},{"location":"baileys-payloads/#3-chat-silenciado-mute","title":"3. Chat Silenciado (Mute)","text":"<p>Evento: <code>chats.update</code></p>"},{"location":"baileys-payloads/#silenciar-chat","title":"Silenciar chat","text":"<pre><code>[\n  {\n    \"id\": \"140913951141911@lid\",\n    \"muteEndTime\": 1767400562932\n  }\n]\n</code></pre>"},{"location":"baileys-payloads/#quitar-silencio","title":"Quitar silencio","text":"<pre><code>[\n  {\n    \"id\": \"140913951141911@lid\",\n    \"muteEndTime\": null\n  }\n]\n</code></pre> <p>Campos clave: - <code>muteEndTime</code> - Timestamp cuando expira el silencio (n\u00famero) o <code>null</code> para quitar silencio</p>"},{"location":"baileys-payloads/#4-chat-eliminado","title":"4. Chat Eliminado","text":"<p>Evento: <code>chats.delete</code></p> <pre><code>[\n  \"140913951141911@lid\"\n]\n</code></pre> <p>Nota: Es un array de IDs de chats eliminados.</p>"},{"location":"baileys-payloads/#5-mensaje-leido","title":"5. Mensaje Le\u00eddo","text":"<p>Evento: <code>messages.update</code></p> <pre><code>[\n  {\n    \"key\": {\n      \"remoteJid\": \"140913951141911@lid\",\n      \"id\": \"AC08701FBF0EEADEB4250A56C0B91BFB\",\n      \"fromMe\": false\n    },\n    \"update\": {\n      \"status\": 4\n    }\n  }\n]\n</code></pre> <p>Valores de status: | Status | Descripci\u00f3n | |--------|-------------| | 1 | PENDING | | 2 | SERVER_ACK | | 3 | DELIVERY_ACK (entregado) | | 4 | READ (le\u00eddo) | | 5 | PLAYED (reproducido - para audio/video) |</p>"},{"location":"baileys-payloads/#6-presencia-escribiendoen-linea","title":"6. Presencia (Escribiendo/En l\u00ednea)","text":"<p>Evento: <code>presence.update</code></p> <pre><code>{\n  \"id\": \"140913951141911@lid\",\n  \"presences\": {\n    \"140913951141911@lid\": {\n      \"lastKnownPresence\": \"composing\"\n    }\n  }\n}\n</code></pre> <p>Valores de lastKnownPresence: | Valor | Descripci\u00f3n | |-------|-------------| | <code>composing</code> | Escribiendo | | <code>recording</code> | Grabando audio | | <code>paused</code> | Dej\u00f3 de escribir | | <code>available</code> | En l\u00ednea | | <code>unavailable</code> | Desconectado |</p>"},{"location":"engine/","title":"Engine","text":"<p>Documentaci\u00f3n del sistema de persistencia para <code>@arcaelas/whatsapp</code>.</p>"},{"location":"engine/#interface","title":"Interface","text":"<p>Un Engine debe implementar la siguiente interface:</p> <pre><code>interface Engine {\n    /**\n     * @description Obtiene un valor por su key.\n     * @param key Ruta del documento.\n     * @returns Texto JSON o null si no existe.\n     */\n    get(key: string): Promise&lt;string | null&gt;;\n\n    /**\n     * @description Guarda o elimina un valor.\n     * @param key Ruta del documento.\n     * @param value Texto a guardar o null para eliminar.\n     */\n    set(key: string, value: string | null): Promise&lt;void&gt;;\n\n    /**\n     * @description Lista keys bajo un prefijo, ordenados por m\u00e1s reciente.\n     * @param prefix Prefijo de b\u00fasqueda.\n     * @param offset Inicio de paginaci\u00f3n (default: 0).\n     * @param limit Cantidad m\u00e1xima (default: 50).\n     * @returns Array de keys.\n     */\n    list(prefix: string, offset?: number, limit?: number): Promise&lt;string[]&gt;;\n}\n</code></pre>"},{"location":"engine/#contratos","title":"Contratos","text":"M\u00e9todo Comportamiento Esperado <code>get(key)</code> Retorna <code>string</code> si existe, <code>null</code> si no existe <code>set(key, value)</code> Si <code>value</code> es <code>null</code>, elimina la key <code>set(key, value)</code> Si <code>value</code> es <code>string</code>, crea/actualiza <code>list(prefix)</code> Retorna keys que comienzan con <code>prefix</code> <code>list(prefix)</code> Orden descendente por fecha de modificaci\u00f3n"},{"location":"engine/#namespaces","title":"Namespaces","text":"<p>El sistema usa 4 namespaces principales:</p> Namespace Descripci\u00f3n Ejemplo Key <code>session</code> Credenciales y estado de conexi\u00f3n <code>session/creds</code> <code>contact</code> Informaci\u00f3n de contactos <code>contact/{jid}/index</code> <code>chat</code> Conversaciones y metadata <code>chat/{jid}/index</code> <code>message</code> Mensajes dentro de chats <code>chat/{cid}/message/{id}/index</code>"},{"location":"engine/#estructura-de-keys","title":"Estructura de Keys","text":""},{"location":"engine/#session","title":"Session","text":"<p>Estado de autenticaci\u00f3n y conexi\u00f3n.</p> <pre><code>session/creds              \u2192 Credenciales de autenticaci\u00f3n\nsession/app-state-sync-key-{id}  \u2192 Keys de sincronizaci\u00f3n\nsession/app-state-sync-version-{name}  \u2192 Versiones de estado\nsession/sender-key-{jid}   \u2192 Keys de cifrado por contacto\nsession/sender-key-memory-{jid}  \u2192 Memoria de keys\nsession/pre-key-{id}       \u2192 Pre-keys\nsession/session-{jid}      \u2192 Sesiones de cifrado\n</code></pre> <p>Formato: JSON serializado con <code>BufferJSON</code> para manejar binarios.</p>"},{"location":"engine/#contact","title":"Contact","text":"<p>Informaci\u00f3n de contactos.</p> <pre><code>contact/{jid}/index        \u2192 JSON con datos del contacto\n</code></pre> <p>Ejemplo: <pre><code>{\n    \"id\": \"584144709840@s.whatsapp.net\",\n    \"name\": \"Juan P\u00e9rez\",\n    \"photo\": \"https://pps.whatsapp.net/...\",\n    \"phone\": \"584144709840\",\n    \"content\": \"Disponible 24/7\",\n    \"raw\": { /* objeto raw completo */ }\n}\n</code></pre></p>"},{"location":"engine/#chat","title":"Chat","text":"<p>Conversaciones y sus \u00edndices de mensajes.</p> <pre><code>chat/{jid}/index           \u2192 JSON con datos del chat\nchat/{jid}/messages        \u2192 \u00cdndice de mensajes (ver Relaciones)\n</code></pre> <p>Ejemplo <code>chat/{jid}/index</code>: <pre><code>{\n    \"id\": \"120363123456789@g.us\",\n    \"type\": \"group\",\n    \"name\": \"Equipo Dev\",\n    \"content\": \"Descripci\u00f3n del grupo\",\n    \"pined\": true,\n    \"archived\": false,\n    \"muted\": false,\n    \"readed\": true,\n    \"readonly\": false,\n    \"labels\": [\"trabajo\"],\n    \"raw\": { /* objeto raw completo */ }\n}\n</code></pre></p>"},{"location":"engine/#message","title":"Message","text":"<p>Mensajes separados en metadata, contenido y raw.</p> <pre><code>chat/{cid}/message/{id}/index    \u2192 JSON con metadata\nchat/{cid}/message/{id}/content  \u2192 Buffer base64 (media)\nchat/{cid}/message/{id}/raw      \u2192 JSON raw completo\n</code></pre> <p>Ejemplo <code>chat/{cid}/message/{id}/index</code>: <pre><code>{\n    \"id\": \"AC07DE0D18FA8254897A26C90B2FFD98\",\n    \"cid\": \"584144709840@s.whatsapp.net\",\n    \"mid\": null,\n    \"me\": false,\n    \"type\": \"text\",\n    \"author\": \"584144709840@s.whatsapp.net\",\n    \"status\": 4,\n    \"starred\": false,\n    \"forwarded\": false,\n    \"created_at\": 1767366759000,\n    \"deleted_at\": null,\n    \"mime\": \"text/plain\",\n    \"caption\": \"\"\n}\n</code></pre></p>"},{"location":"engine/#relaciones","title":"Relaciones","text":""},{"location":"engine/#problema","title":"Problema","text":"<p>En bases de datos relacionales, la relaci\u00f3n <code>Message \u2192 Chat</code> es simple: <pre><code>SELECT * FROM messages WHERE cid = ?;\n</code></pre></p> <p>En key-value stores, listar mensajes requiere escanear todas las keys: <pre><code>SCAN chat/{cid}/message/*/index\n</code></pre></p> <p>Esto es ineficiente para: - Paginaci\u00f3n ordenada por fecha - Contar mensajes sin cargarlos - Obtener \u00faltimos N mensajes</p>"},{"location":"engine/#solucion-indice-de-mensajes","title":"Soluci\u00f3n: \u00cdndice de Mensajes","text":"<p>Cada chat mantiene un \u00edndice de sus mensajes:</p> <pre><code>chat/{cid}/messages\n</code></pre> <p>Formato: Texto plano con una l\u00ednea por mensaje: <pre><code>{TIMESTAMP} {MESSAGE_ID}\n{TIMESTAMP} {MESSAGE_ID}\n...\n</code></pre></p> <p>Ejemplo: <pre><code>1767366759000 AC07DE0D18FA8254897A26C90B2FFD98\n1767366758000 BC18EF1D29GB9365908B37D01C3GGE09\n1767366757000 CC29FG2E30HC0476019C48E12D4HHF10\n</code></pre></p>"},{"location":"engine/#operaciones","title":"Operaciones","text":"<p>Estas operaciones est\u00e1n implementadas como m\u00e9todos est\u00e1ticos de la clase <code>Chat</code>:</p> <p>Agregar mensaje (<code>Chat.add_message</code>): <pre><code>await wa.Chat.add_message(cid, mid, timestamp);\n</code></pre></p> <p>Listar mensajes (paginado) (<code>Chat.list_messages</code>): <pre><code>const ids = await wa.Chat.list_messages(cid, offset, limit);\n</code></pre></p> <p>Eliminar mensaje del \u00edndice (<code>Chat.remove_message</code>): <pre><code>await wa.Chat.remove_message(cid, mid);\n</code></pre></p> <p>Contar mensajes (<code>Chat.count_messages</code>): <pre><code>const count = await wa.Chat.count_messages(cid);\n</code></pre></p>"},{"location":"engine/#ventajas","title":"Ventajas","text":"Aspecto Sin \u00cdndice Con \u00cdndice Listar mensajes SCAN + parse JSON Split l\u00edneas Paginar Cargar todos Slice directo Contar Cargar todos Count l\u00edneas Ordenar Sort en memoria Ya ordenado \u00daltimo mensaje Cargar todos Primera l\u00ednea"},{"location":"engine/#cascade-delete","title":"Cascade Delete","text":"<p>Al eliminar una entidad, eliminar todas sus dependencias.</p>"},{"location":"engine/#eliminar-contacto","title":"Eliminar Contacto","text":"<pre><code>// Solo elimina el \u00edndice del contacto\nawait wa.engine.set(`contact/${jid}/index`, null);\n</code></pre>"},{"location":"engine/#eliminar-chat","title":"Eliminar Chat","text":"<p>Usa el m\u00e9todo <code>Chat.cascade_delete()</code> que elimina el chat y todos sus mensajes:</p> <pre><code>await wa.Chat.cascade_delete(cid);\n</code></pre> <p>Internamente ejecuta: 1. Lee <code>chat/{cid}/messages</code> para obtener IDs 2. Elimina <code>chat/{cid}/message/{mid}/index</code>, <code>/content</code>, <code>/raw</code> para cada mensaje 3. Elimina <code>chat/{cid}/messages</code> 4. Elimina <code>chat/{cid}/index</code></p>"},{"location":"engine/#eliminar-mensaje","title":"Eliminar Mensaje","text":"<p>Usa el m\u00e9todo <code>Message.remove()</code> que elimina del \u00edndice y storage:</p> <pre><code>await wa.Message.remove(cid, mid);\n</code></pre>"},{"location":"engine/#implementacion-de-engines","title":"Implementaci\u00f3n de Engines","text":""},{"location":"engine/#fileengine","title":"FileEngine","text":"<p>Almacena cada key como archivo en el filesystem.</p> <pre><code>.baileys/{session}/\n\u251c\u2500\u2500 session/\n\u2502   \u2514\u2500\u2500 creds\n\u251c\u2500\u2500 contact/\n\u2502   \u2514\u2500\u2500 584144709840_at_s.whatsapp.net/\n\u2502       \u2514\u2500\u2500 index\n\u2514\u2500\u2500 chat/\n    \u2514\u2500\u2500 584144709840_at_s.whatsapp.net/\n        \u251c\u2500\u2500 index\n        \u251c\u2500\u2500 messages\n        \u2514\u2500\u2500 message/\n            \u2514\u2500\u2500 AC07DE.../\n                \u251c\u2500\u2500 index\n                \u251c\u2500\u2500 content\n                \u2514\u2500\u2500 raw\n</code></pre> <p>Consideraciones: - Sanitizar <code>@</code> \u2192 <code>_at_</code> para paths v\u00e1lidos - Crear directorios recursivamente - Ordenar por <code>mtime</code> del filesystem</p>"},{"location":"engine/#redisengine","title":"RedisEngine","text":"<p>Usa Redis como backend.</p> <pre><code>wa:{session}:session/creds\nwa:{session}:contact/{jid}/index\nwa:{session}:chat/{jid}/index\nwa:{session}:chat/{jid}/messages\nwa:{session}:chat/{cid}/message/{id}/index\n</code></pre> <p>Consideraciones: - Prefijo por sesi\u00f3n para multi-tenant - SCAN para listar keys - No hay orden nativo, depende del \u00edndice de mensajes</p>"},{"location":"engine/#postgresql-engine-ejemplo","title":"PostgreSQL Engine (Ejemplo)","text":"<pre><code>class PostgresEngine implements Engine {\n    constructor(private readonly _pool: Pool, private readonly _session: string) {}\n\n    async get(key: string): Promise&lt;string | null&gt; {\n        const { rows } = await this._pool.query(\n            'SELECT value FROM kv_store WHERE session = $1 AND key = $2',\n            [this._session, key]\n        );\n        return rows[0]?.value ?? null;\n    }\n\n    async set(key: string, value: string | null): Promise&lt;void&gt; {\n        if (value) {\n            await this._pool.query(\n                `INSERT INTO kv_store (session, key, value, updated_at)\n                 VALUES ($1, $2, $3, NOW())\n                 ON CONFLICT (session, key) DO UPDATE SET value = $3, updated_at = NOW()`,\n                [this._session, key, value]\n            );\n        } else {\n            await this._pool.query(\n                'DELETE FROM kv_store WHERE session = $1 AND key = $2',\n                [this._session, key]\n            );\n        }\n    }\n\n    async list(prefix: string, offset = 0, limit = 50): Promise&lt;string[]&gt; {\n        const { rows } = await this._pool.query(\n            `SELECT key FROM kv_store\n             WHERE session = $1 AND key LIKE $2\n             ORDER BY updated_at DESC\n             LIMIT $3 OFFSET $4`,\n            [this._session, prefix + '%', limit, offset]\n        );\n        return rows.map(r =&gt; r.key);\n    }\n}\n</code></pre> <p>Tabla requerida: <pre><code>CREATE TABLE kv_store (\n    session VARCHAR(100) NOT NULL,\n    key VARCHAR(500) NOT NULL,\n    value TEXT,\n    updated_at TIMESTAMP DEFAULT NOW(),\n    PRIMARY KEY (session, key)\n);\n\nCREATE INDEX idx_kv_prefix ON kv_store (session, key varchar_pattern_ops);\nCREATE INDEX idx_kv_updated ON kv_store (session, updated_at DESC);\n</code></pre></p>"},{"location":"engine/#resumen-de-keys","title":"Resumen de Keys","text":"Key Pattern Tipo Descripci\u00f3n <code>session/*</code> JSON Credenciales y estado <code>contact/{jid}/index</code> JSON Datos del contacto <code>chat/{jid}/index</code> JSON Datos del chat <code>chat/{jid}/messages</code> TXT \u00cdndice <code>{TS} {ID}\\n</code> <code>chat/{cid}/message/{id}/index</code> JSON Metadata del mensaje <code>chat/{cid}/message/{id}/content</code> Base64 Contenido binario <code>chat/{cid}/message/{id}/raw</code> JSON Objeto raw completo"},{"location":"engine/#optimizaciones","title":"Optimizaciones","text":""},{"location":"engine/#batch-operations","title":"Batch Operations","text":"<p>Para operaciones masivas, considerar m\u00e9todos batch:</p> <pre><code>interface EngineBatch extends Engine {\n    set_batch(entries: Array&lt;[key: string, value: string | null]&gt;): Promise&lt;void&gt;;\n}\n</code></pre>"},{"location":"engine/#ttl-time-to-live","title":"TTL (Time-To-Live)","text":"<p>Para mensajes ef\u00edmeros:</p> <pre><code>interface EngineTTL extends Engine {\n    set_ttl(key: string, value: string, ttl_seconds: number): Promise&lt;void&gt;;\n}\n</code></pre>"},{"location":"engine/#prefix-delete","title":"Prefix Delete","text":"<p>Para cascade delete eficiente:</p> <pre><code>interface EnginePrefix extends Engine {\n    delete_prefix(prefix: string): Promise&lt;number&gt;;\n}\n</code></pre> <p>Implementaci\u00f3n Redis: <pre><code>async delete_prefix(prefix: string): Promise&lt;number&gt; {\n    let count = 0;\n    let cursor = '0';\n    do {\n        const [next, keys] = await this._client.scan(cursor, 'MATCH', `${this._prefix}:${prefix}*`);\n        cursor = next;\n        if (keys.length) {\n            await this._client.del(...keys);\n            count += keys.length;\n        }\n    } while (cursor !== '0');\n    return count;\n}\n</code></pre></p>"},{"location":"getting-started/","title":"Getting Started","text":"<p>This tutorial will guide you step by step to create your first WhatsApp bot.</p>"},{"location":"getting-started/#1-create-the-project","title":"1. Create the project","text":"<pre><code>mkdir my-whatsapp-bot\ncd my-whatsapp-bot\nnpm init -y\nnpm install @arcaelas/whatsapp typescript tsx\n</code></pre>"},{"location":"getting-started/#2-basic-structure","title":"2. Basic structure","text":"<p>Create the main file:</p> index.ts<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\n\nasync function main() {\n  // Create WhatsApp instance\n  const wa = new WhatsApp();\n\n  // Listen to events before connecting\n  wa.event.on(\"open\", () =&gt; console.log(\"Connected!\"));\n  wa.event.on(\"close\", () =&gt; console.log(\"Disconnected\"));\n  wa.event.on(\"error\", (err) =&gt; console.error(\"Error:\", err.message));\n\n  // Connect showing QR in console\n  console.log(\"Waiting for QR...\");\n  await wa.pair(async (data) =&gt; {\n    if (Buffer.isBuffer(data)) {\n      // Save QR as image\n      const fs = await import(\"fs\");\n      fs.writeFileSync(\"qr.png\", data);\n      console.log(\"QR saved to qr.png - Scan with your phone\");\n    } else {\n      // 8 digit code (if using phone)\n      console.log(\"Pairing code:\", data);\n    }\n  });\n\n  console.log(\"Bot started!\");\n}\n\nmain().catch(console.error);\n</code></pre>"},{"location":"getting-started/#3-run","title":"3. Run","text":"<pre><code>npx tsx index.ts\n</code></pre> <ol> <li>The <code>qr.png</code> file will appear</li> <li>Open it and scan with WhatsApp &gt; Linked devices</li> <li>The bot will connect automatically</li> </ol> <p>Done!</p> <p>Once connected, the session is saved in <code>.baileys/default/</code> and you won't need to scan again.</p>"},{"location":"getting-started/#4-listen-to-messages","title":"4. Listen to messages","text":"<p>Add a listener for incoming messages:</p> index.ts<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\n\nasync function main() {\n  const wa = new WhatsApp();\n\n  // Listen to new messages\n  wa.event.on(\"message:created\", async (msg) =&gt; {\n    // Ignore own messages\n    if (msg.me) return;\n\n    // Only process text\n    if (msg.type !== \"text\") return;\n\n    // Get content as text\n    const content = (await msg.content()).toString();\n    console.log(`[${msg.type}] ${msg.cid}: ${content}`);\n\n    const text = content.toLowerCase();\n\n    if (text === \"hello\") {\n      await wa.Message.text(msg.cid, \"Hello! I'm a bot. Type 'help' to see commands.\");\n    }\n\n    if (text === \"help\") {\n      await wa.Message.text(\n        msg.cid,\n        \"Available commands:\\n\" +\n        \"- hello: Greeting\\n\" +\n        \"- time: Current time\\n\" +\n        \"- ping: Response test\"\n      );\n    }\n\n    if (text === \"time\") {\n      await wa.Message.text(msg.cid, `It's ${new Date().toLocaleTimeString()}`);\n    }\n\n    if (text === \"ping\") {\n      await wa.Message.text(msg.cid, \"pong!\");\n    }\n  });\n\n  // Connect\n  await wa.pair(async (data) =&gt; {\n    if (Buffer.isBuffer(data)) {\n      require(\"fs\").writeFileSync(\"qr.png\", data);\n      console.log(\"Scan qr.png\");\n    }\n  });\n\n  console.log(\"Bot ready!\");\n}\n\nmain().catch(console.error);\n</code></pre>"},{"location":"getting-started/#5-connection-with-pairing-code","title":"5. Connection with pairing code","text":"<p>If you prefer not to scan QR, use the phone number:</p> <pre><code>const wa = new WhatsApp({\n  phone: \"5491112345678\", // Without + or spaces\n});\n\nawait wa.pair(async (data) =&gt; {\n  if (typeof data === \"string\") {\n    console.log(\"Enter this code on your phone:\", data);\n    // Go to WhatsApp &gt; Linked devices &gt; Link a device\n    // Select \"Link with phone number\"\n  }\n});\n</code></pre>"},{"location":"getting-started/#6-handle-different-message-types","title":"6. Handle different message types","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n\n  const buffer = await msg.content();\n\n  // Text message\n  if (msg.type === \"text\") {\n    const text = buffer.toString();\n    console.log(\"Text:\", text);\n  }\n\n  // Image\n  if (msg.type === \"image\") {\n    console.log(`Image: ${buffer.length} bytes`);\n    if (msg.caption) {\n      console.log(`Caption: ${msg.caption}`);\n    }\n    // Save image\n    require(\"fs\").writeFileSync(\"image.jpg\", buffer);\n  }\n\n  // Video\n  if (msg.type === \"video\") {\n    console.log(`Video: ${buffer.length} bytes`);\n  }\n\n  // Audio (voice note)\n  if (msg.type === \"audio\") {\n    console.log(`Audio: ${buffer.length} bytes`);\n  }\n\n  // Location\n  if (msg.type === \"location\") {\n    const coords = JSON.parse(buffer.toString());\n    console.log(`Location: ${coords.lat}, ${coords.lng}`);\n  }\n\n  // Poll\n  if (msg.type === \"poll\") {\n    const poll = JSON.parse(buffer.toString());\n    console.log(`Poll: ${poll.content}`);\n    poll.options.forEach((opt: { content: string }, i: number) =&gt; {\n      console.log(`  ${i + 1}. ${opt.content}`);\n    });\n  }\n});\n</code></pre>"},{"location":"getting-started/#7-send-messages","title":"7. Send messages","text":"<pre><code>const cid = \"5491198765432@s.whatsapp.net\";\n\n// Text\nawait wa.Message.text(cid, \"Hello!\");\n\n// Text quoting message\nawait wa.Message.text(cid, \"Reply\", \"MESSAGE_ID_TO_QUOTE\");\n\n// Image with caption\nconst img = require(\"fs\").readFileSync(\"photo.jpg\");\nawait wa.Message.image(cid, img, \"Check out this photo!\");\n\n// Video\nconst vid = require(\"fs\").readFileSync(\"video.mp4\");\nawait wa.Message.video(cid, vid, \"Interesting video\");\n\n// Audio (voice note)\nconst aud = require(\"fs\").readFileSync(\"audio.ogg\");\nawait wa.Message.audio(cid, aud);\n\n// Location\nawait wa.Message.location(cid, {\n  lat: -34.6037,\n  lng: -58.3816\n});\n\n// Poll\nawait wa.Message.poll(cid, {\n  content: \"Which do you prefer?\",\n  options: [\n    { content: \"Option A\" },\n    { content: \"Option B\" },\n    { content: \"Option C\" }\n  ]\n});\n</code></pre>"},{"location":"getting-started/#8-react-to-messages","title":"8. React to messages","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n  if (msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString().toLowerCase();\n\n  // React with emoji\n  if (text.includes(\"thanks\")) {\n    await wa.Message.react(msg.cid, msg.id, \"\u2764\ufe0f\");\n  }\n\n  if (text.includes(\"haha\")) {\n    await wa.Message.react(msg.cid, msg.id, \"\ud83d\ude02\");\n  }\n\n  // Remove reaction\n  // await wa.Message.react(msg.cid, msg.id, \"\");\n});\n</code></pre>"},{"location":"getting-started/#9-mark-chat-as-read","title":"9. Mark chat as read","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  // Mark chat as read\n  await wa.Chat.seen(msg.cid);\n});\n</code></pre>"},{"location":"getting-started/#next-step","title":"Next step","text":"<p>Now that you have a basic bot running, explore the detailed documentation:</p> <ul> <li>WhatsApp Reference - Configuration and events</li> <li>Chat Reference - Conversation management</li> <li>Message Reference - Message types</li> <li>Advanced examples - Recommended patterns</li> </ul>"},{"location":"installation/","title":"Installation","text":""},{"location":"installation/#requirements","title":"Requirements","text":"<ul> <li>Node.js 18 or higher</li> <li>npm, yarn or pnpm</li> <li>Active WhatsApp account</li> </ul>"},{"location":"installation/#package-installation","title":"Package installation","text":"npmyarnpnpm <pre><code>npm install @arcaelas/whatsapp\n</code></pre> <pre><code>yarn add @arcaelas/whatsapp\n</code></pre> <pre><code>pnpm add @arcaelas/whatsapp\n</code></pre>"},{"location":"installation/#typescript-configuration","title":"TypeScript configuration","text":"<p>The library is written in TypeScript and provides complete types. Make sure you have a compatible configuration:</p> tsconfig.json<pre><code>{\n  \"compilerOptions\": {\n    \"target\": \"ES2022\",\n    \"module\": \"commonjs\",\n    \"moduleResolution\": \"node\",\n    \"esModuleInterop\": true,\n    \"strict\": true,\n    \"skipLibCheck\": true\n  }\n}\n</code></pre>"},{"location":"installation/#file-structure","title":"File structure","text":"<p>When using <code>FileEngine</code> (default), the library creates the following structure:</p> <pre><code>.baileys/\n  default/                    # or the name you specify\n    session/\n      {key}/index             # Session data (creds, keys, etc.)\n    contact/\n      {jid}/index             # Contact data\n    chat/\n      {jid}/\n        index                 # Chat data\n        message/\n          index               # Index \"MID TIMESTAMP\" per line\n          {mid}/\n            index             # Message metadata (JSON)\n            content           # Binary content (media)\n</code></pre> <p>ID normalization</p> <p>The <code>@</code> characters in JIDs are replaced with <code>_at_</code> in directory names. Example: <code>5491112345678@s.whatsapp.net</code> \u2192 <code>5491112345678_at_s.whatsapp.net</code></p> <p>Tip</p> <p>Add <code>.baileys/</code> to your <code>.gitignore</code> to avoid uploading credentials to the repository.</p>"},{"location":"installation/#verify-installation","title":"Verify installation","text":"<p>Create a test file:</p> test.ts<pre><code>import { WhatsApp, FileEngine } from \"@arcaelas/whatsapp\";\n\nconst wa = new WhatsApp({\n  engine: new FileEngine(\".baileys/test\"),\n});\n\nconsole.log(\"Installation successful!\");\nconsole.log(\"Available classes:\", {\n  Chat: wa.Chat,\n  Contact: wa.Contact,\n  Message: wa.Message,\n});\n</code></pre> <p>Run:</p> <pre><code>npx tsx test.ts\n</code></pre> <p>If you see the success message, the installation is complete.</p>"},{"location":"installation/#common-issues","title":"Common issues","text":""},{"location":"installation/#error-cannot-find-module-baileys","title":"Error: Cannot find module 'baileys'","text":"<p>Make sure baileys is installed as a dependency:</p> <pre><code>npm install baileys\n</code></pre>"},{"location":"installation/#error-libffiso7-not-found-linux","title":"Error: libffi.so.7 not found (Linux)","text":"<p>Install system dependencies:</p> <pre><code># Debian/Ubuntu\nsudo apt-get install libffi-dev\n\n# CentOS/RHEL\nsudo yum install libffi-devel\n</code></pre>"},{"location":"installation/#error-enoent-baileysdefault","title":"Error: ENOENT .baileys/default","text":"<p>The directory is created automatically on first connection. If it persists, check write permissions.</p>"},{"location":"installation/#next-step","title":"Next step","text":"<p> Getting started</p>"},{"location":"schema/","title":"Schemas de Datos","text":"<p>Schemas estandarizados para almacenamiento en <code>@arcaelas/whatsapp</code>.</p> <p>Principios: - Minimal: Solo campos esenciales - Flat: Sin anidaci\u00f3n innecesaria - Typed: Tipos expl\u00edcitos - Temporal: Timestamps en milisegundos UTC - Nullable: <code>null</code> para ausencia, nunca <code>undefined</code></p>"},{"location":"schema/#raw-schemas","title":"Raw Schemas","text":"<p>Las clases trabajan con objetos \"raw\" que contienen todas las propiedades del protocolo. Los getters/setters exponen una API simplificada.</p>"},{"location":"schema/#contact-raw","title":"Contact Raw","text":"<p>Propiedades del objeto raw de contacto.</p> Propiedad Tipo Descripci\u00f3n <code>id</code> <code>string</code> JID \u00fanico del contacto <code>lid</code> <code>string \\| null</code> ID alternativo en formato LID <code>name</code> <code>string \\| null</code> Nombre guardado en la agenda del usuario <code>notify</code> <code>string \\| null</code> Nombre que el contacto configur\u00f3 en su perfil (pushName) <code>verifiedName</code> <code>string \\| null</code> Nombre de cuenta business verificada <code>imgUrl</code> <code>string \\| null</code> URL de la foto de perfil (puede expirar o ser <code>\"changed\"</code>) <code>status</code> <code>string \\| null</code> Bio/estado del perfil del contacto"},{"location":"schema/#ejemplo-raw","title":"Ejemplo Raw","text":"<pre><code>{\n    \"id\": \"584144709840@s.whatsapp.net\",\n    \"lid\": \"140913951141911@lid\",\n    \"name\": \"Juan P\u00e9rez\",\n    \"notify\": \"Juanito\",\n    \"verifiedName\": null,\n    \"imgUrl\": \"https://pps.whatsapp.net/v/t61.24694-24/...\",\n    \"status\": \"Disponible 24/7\"\n}\n</code></pre>"},{"location":"schema/#chat-raw","title":"Chat Raw","text":"<p>Propiedades del objeto raw de conversaci\u00f3n.</p>"},{"location":"schema/#propiedades-principales","title":"Propiedades Principales","text":"Propiedad Tipo Descripci\u00f3n <code>id</code> <code>string</code> JID \u00fanico del chat <code>name</code> <code>string \\| null</code> Nombre del chat o grupo <code>displayName</code> <code>string \\| null</code> Nombre alternativo para mostrar <code>description</code> <code>string \\| null</code> Descripci\u00f3n del grupo <code>unreadCount</code> <code>number \\| null</code> Cantidad de mensajes no le\u00eddos <code>readOnly</code> <code>boolean \\| null</code> Si el chat es de solo lectura <code>archived</code> <code>boolean \\| null</code> Si el chat est\u00e1 archivado <code>pinned</code> <code>number \\| null</code> Timestamp cuando se fij\u00f3 el chat <code>muteEndTime</code> <code>number \\| null</code> Timestamp cuando expira el silencio <code>markedAsUnread</code> <code>boolean \\| null</code> Si fue marcado manualmente como no le\u00eddo <code>notSpam</code> <code>boolean \\| null</code> Si fue marcado como no spam"},{"location":"schema/#propiedades-temporales","title":"Propiedades Temporales","text":"Propiedad Tipo Descripci\u00f3n <code>lastMsgTimestamp</code> <code>number \\| null</code> Timestamp del \u00faltimo mensaje recibido <code>conversationTimestamp</code> <code>number \\| null</code> Timestamp de la \u00faltima actividad <code>ephemeralExpiration</code> <code>number \\| null</code> Duraci\u00f3n de mensajes temporales (segundos) <code>ephemeralSettingTimestamp</code> <code>number \\| null</code> Cuando se configur\u00f3 mensajes temporales <code>createdAt</code> <code>number \\| null</code> Timestamp de creaci\u00f3n del chat/grupo"},{"location":"schema/#propiedades-de-grupo","title":"Propiedades de Grupo","text":"Propiedad Tipo Descripci\u00f3n <code>participant</code> <code>GroupParticipant[] \\| null</code> Lista de participantes del grupo <code>createdBy</code> <code>string \\| null</code> JID del creador del grupo <code>isParentGroup</code> <code>boolean \\| null</code> Si es grupo padre (comunidad) <code>parentGroupId</code> <code>string \\| null</code> JID del grupo padre <code>isDefaultSubgroup</code> <code>boolean \\| null</code> Si es subgrupo por defecto <code>locked</code> <code>boolean \\| null</code> Si el grupo est\u00e1 bloqueado <code>suspended</code> <code>boolean \\| null</code> Si el chat est\u00e1 suspendido <code>terminated</code> <code>boolean \\| null</code> Si el chat fue terminado <code>support</code> <code>boolean \\| null</code> Si es chat de soporte <code>commentsCount</code> <code>number \\| null</code> Cantidad de comentarios"},{"location":"schema/#propiedades-de-identidad","title":"Propiedades de Identidad","text":"Propiedad Tipo Descripci\u00f3n <code>newJid</code> <code>string \\| null</code> Nuevo JID (si migr\u00f3) <code>oldJid</code> <code>string \\| null</code> JID anterior (si migr\u00f3) <code>lidJid</code> <code>string \\| null</code> JID en formato LID <code>pnJid</code> <code>string \\| null</code> JID de n\u00famero de tel\u00e9fono <code>username</code> <code>string \\| null</code> Username del chat <code>pHash</code> <code>string \\| null</code> Hash de participantes"},{"location":"schema/#propiedades-de-configuracion","title":"Propiedades de Configuraci\u00f3n","text":"Propiedad Tipo Descripci\u00f3n <code>wallpaper</code> <code>WallpaperSettings \\| null</code> Configuraci\u00f3n de fondo de pantalla <code>mediaVisibility</code> <code>MediaVisibility \\| null</code> Visibilidad de media en galer\u00eda <code>disappearingMode</code> <code>DisappearingMode \\| null</code> Modo de mensajes temporales <code>shareOwnPn</code> <code>boolean \\| null</code> Si comparte n\u00famero propio <code>limitSharing</code> <code>boolean \\| null</code> Si limita compartir"},{"location":"schema/#propiedades-internas","title":"Propiedades Internas","text":"Propiedad Tipo Descripci\u00f3n <code>messages</code> <code>HistorySyncMsg[] \\| null</code> Mensajes de sincronizaci\u00f3n <code>tcToken</code> <code>Uint8Array \\| null</code> Token de t\u00e9rminos y condiciones <code>tcTokenTimestamp</code> <code>number \\| null</code> Timestamp del token TC <code>tcTokenSenderTimestamp</code> <code>number \\| null</code> Timestamp del remitente TC <code>contactPrimaryIdentityKey</code> <code>Uint8Array \\| null</code> Clave de identidad del contacto <code>endOfHistoryTransfer</code> <code>boolean \\| null</code> Si termin\u00f3 transferencia de historial <code>endOfHistoryTransferType</code> <code>EndOfHistoryTransferType \\| null</code> Tipo de fin de transferencia <code>pnhDuplicateLidThread</code> <code>boolean \\| null</code> Si es hilo duplicado PNH/LID <code>lidOriginType</code> <code>string \\| null</code> Tipo de origen LID <code>accountLid</code> <code>string \\| null</code> LID de la cuenta <code>capiCreatedGroup</code> <code>boolean \\| null</code> Si fue creado por CAPI <code>systemMessageToInsert</code> <code>PrivacySystemMessage \\| null</code> Mensaje de sistema a insertar"},{"location":"schema/#ejemplo-raw_1","title":"Ejemplo Raw","text":"<pre><code>{\n    \"id\": \"120363123456789@g.us\",\n    \"name\": \"Equipo de Desarrollo\",\n    \"displayName\": null,\n    \"description\": \"Grupo para coordinaci\u00f3n del proyecto\",\n    \"unreadCount\": 5,\n    \"readOnly\": false,\n    \"archived\": false,\n    \"pinned\": 1767371367857,\n    \"muteEndTime\": null,\n    \"markedAsUnread\": false,\n    \"notSpam\": true,\n    \"lastMsgTimestamp\": 1767366759,\n    \"conversationTimestamp\": 1767366759,\n    \"ephemeralExpiration\": 604800,\n    \"ephemeralSettingTimestamp\": 1752995285,\n    \"createdAt\": 1700000000,\n    \"createdBy\": \"584144709840@s.whatsapp.net\",\n    \"participant\": [\n        { \"id\": \"584144709840@s.whatsapp.net\", \"admin\": \"superadmin\" },\n        { \"id\": \"584121234567@s.whatsapp.net\", \"admin\": null }\n    ],\n    \"isParentGroup\": false,\n    \"parentGroupId\": null,\n    \"locked\": false,\n    \"suspended\": false,\n    \"terminated\": false\n}\n</code></pre>"},{"location":"schema/#message-raw","title":"Message Raw","text":"<p>Propiedades del objeto raw de mensaje.</p>"},{"location":"schema/#messagekey-key","title":"MessageKey (key)","text":"Propiedad Tipo Descripci\u00f3n <code>key.remoteJid</code> <code>string \\| null</code> JID del chat <code>key.fromMe</code> <code>boolean \\| null</code> Si el mensaje es propio <code>key.id</code> <code>string \\| null</code> ID \u00fanico del mensaje <code>key.participant</code> <code>string \\| null</code> JID del remitente (en grupos)"},{"location":"schema/#propiedades-principales_1","title":"Propiedades Principales","text":"Propiedad Tipo Descripci\u00f3n <code>message</code> <code>Message \\| null</code> Contenido del mensaje (ver Message Content) <code>messageTimestamp</code> <code>number \\| null</code> Timestamp de creaci\u00f3n <code>status</code> <code>MessageStatus \\| null</code> Estado de entrega (0-5) <code>pushName</code> <code>string \\| null</code> Nombre del remitente <code>broadcast</code> <code>boolean \\| null</code> Si es mensaje de broadcast <code>starred</code> <code>boolean \\| null</code> Si est\u00e1 destacado <code>duration</code> <code>number \\| null</code> Duraci\u00f3n en segundos (audio/video) <code>labels</code> <code>string[] \\| null</code> Etiquetas del mensaje"},{"location":"schema/#estados-de-mensaje-status","title":"Estados de Mensaje (status)","text":"Valor Constante Descripci\u00f3n <code>0</code> <code>ERROR</code> Error al enviar <code>1</code> <code>PENDING</code> Pendiente de env\u00edo <code>2</code> <code>SERVER_ACK</code> Confirmado por servidor <code>3</code> <code>DELIVERED</code> Entregado al destinatario <code>4</code> <code>READ</code> Le\u00eddo por el destinatario <code>5</code> <code>PLAYED</code> Reproducido (audio/video)"},{"location":"schema/#propiedades-de-media","title":"Propiedades de Media","text":"Propiedad Tipo Descripci\u00f3n <code>mediaCiphertextSha256</code> <code>Uint8Array \\| null</code> Hash SHA256 del media cifrado <code>mediaData</code> <code>MediaData \\| null</code> Datos del media <code>quotedStickerData</code> <code>MediaData \\| null</code> Datos del sticker citado"},{"location":"schema/#propiedades-temporales_1","title":"Propiedades Temporales","text":"Propiedad Tipo Descripci\u00f3n <code>ephemeralStartTimestamp</code> <code>number \\| null</code> Inicio del temporizador de expiraci\u00f3n <code>ephemeralDuration</code> <code>number \\| null</code> Duraci\u00f3n hasta expiraci\u00f3n (segundos) <code>ephemeralOffToOn</code> <code>boolean \\| null</code> Si cambi\u00f3 de off a on <code>ephemeralOutOfSync</code> <code>boolean \\| null</code> Si est\u00e1 desincronizado <code>revokeMessageTimestamp</code> <code>number \\| null</code> Timestamp de revocaci\u00f3n"},{"location":"schema/#propiedades-de-reacciones-y-encuestas","title":"Propiedades de Reacciones y Encuestas","text":"Propiedad Tipo Descripci\u00f3n <code>reactions</code> <code>Reaction[] \\| null</code> Reacciones al mensaje <code>pollUpdates</code> <code>PollUpdate[] \\| null</code> Actualizaciones de encuesta <code>pollAdditionalMetadata</code> <code>PollAdditionalMetadata \\| null</code> Metadata adicional de encuesta <code>messageSecret</code> <code>Uint8Array \\| null</code> Secreto para descifrar votos"},{"location":"schema/#propiedades-de-recibos","title":"Propiedades de Recibos","text":"Propiedad Tipo Descripci\u00f3n <code>userReceipt</code> <code>UserReceipt[] \\| null</code> Recibos de lectura por usuario <code>messageC2STimestamp</code> <code>number \\| null</code> Timestamp cliente-a-servidor"},{"location":"schema/#propiedades-de-stub-mensajes-de-sistema","title":"Propiedades de Stub (Mensajes de Sistema)","text":"Propiedad Tipo Descripci\u00f3n <code>messageStubType</code> <code>StubType \\| null</code> Tipo de mensaje de sistema <code>messageStubParameters</code> <code>string[] \\| null</code> Par\u00e1metros del stub"},{"location":"schema/#propiedades-de-business","title":"Propiedades de Business","text":"Propiedad Tipo Descripci\u00f3n <code>bizPrivacyStatus</code> <code>BizPrivacyStatus \\| null</code> Estado de privacidad business <code>verifiedBizName</code> <code>string \\| null</code> Nombre de negocio verificado"},{"location":"schema/#propiedades-de-estadohistoria","title":"Propiedades de Estado/Historia","text":"Propiedad Tipo Descripci\u00f3n <code>statusPsa</code> <code>StatusPSA \\| null</code> PSA de estado <code>statusAlreadyViewed</code> <code>boolean \\| null</code> Si el estado ya fue visto <code>isMentionedInStatus</code> <code>boolean \\| null</code> Si fui mencionado en estado <code>statusMentions</code> <code>string[] \\| null</code> JIDs mencionados en estado <code>statusMentionMessageInfo</code> <code>StatusMentionMessage \\| null</code> Info de menci\u00f3n en estado <code>statusMentionSources</code> <code>string[] \\| null</code> Fuentes de menci\u00f3n"},{"location":"schema/#propiedades-de-pin","title":"Propiedades de Pin","text":"Propiedad Tipo Descripci\u00f3n <code>pinInChat</code> <code>PinInChat \\| null</code> Informaci\u00f3n de mensaje fijado <code>keepInChat</code> <code>KeepInChat \\| null</code> Mantener en chat"},{"location":"schema/#propiedades-de-botai","title":"Propiedades de Bot/AI","text":"Propiedad Tipo Descripci\u00f3n <code>is1PBizBotMessage</code> <code>boolean \\| null</code> Si es mensaje de bot 1P business <code>botMessageInvokerJid</code> <code>string \\| null</code> JID que invoc\u00f3 al bot <code>botTargetId</code> <code>string \\| null</code> ID objetivo del bot <code>isSupportAiMessage</code> <code>boolean \\| null</code> Si es mensaje de AI de soporte <code>supportAiCitations</code> <code>Citation[] \\| null</code> Citas del AI <code>agentId</code> <code>string \\| null</code> ID del agente"},{"location":"schema/#propiedades-internas_1","title":"Propiedades Internas","text":"Propiedad Tipo Descripci\u00f3n <code>ignore</code> <code>boolean \\| null</code> Si debe ignorarse <code>multicast</code> <code>boolean \\| null</code> Si es multicast <code>urlText</code> <code>boolean \\| null</code> Si contiene URL de texto <code>urlNumber</code> <code>boolean \\| null</code> Si contiene URL de n\u00famero <code>clearMedia</code> <code>boolean \\| null</code> Si debe limpiar media <code>photoChange</code> <code>PhotoChange \\| null</code> Cambio de foto <code>futureproofData</code> <code>Uint8Array \\| null</code> Datos para compatibilidad futura <code>isGroupHistoryMessage</code> <code>boolean \\| null</code> Si es mensaje de historial de grupo <code>originalSelfAuthorUserJidString</code> <code>string \\| null</code> JID original del autor <code>premiumMessageInfo</code> <code>PremiumMessageInfo \\| null</code> Info de mensaje premium <code>commentMetadata</code> <code>CommentMetadata \\| null</code> Metadata de comentario <code>eventResponses</code> <code>EventResponse[] \\| null</code> Respuestas a evento <code>eventAdditionalMetadata</code> <code>EventAdditionalMetadata \\| null</code> Metadata adicional de evento <code>reportingTokenInfo</code> <code>ReportingTokenInfo \\| null</code> Info de token de reporte <code>newsletterServerId</code> <code>number \\| null</code> ID de servidor de newsletter <code>targetMessageId</code> <code>MessageKey \\| null</code> ID del mensaje objetivo <code>messageAddOns</code> <code>MessageAddOn[] \\| null</code> Add-ons del mensaje <code>paymentInfo</code> <code>PaymentInfo \\| null</code> Informaci\u00f3n de pago <code>quotedPaymentInfo</code> <code>PaymentInfo \\| null</code> Info de pago citado <code>finalLiveLocation</code> <code>LiveLocationMessage \\| null</code> Ubicaci\u00f3n en vivo final"},{"location":"schema/#ejemplo-raw_2","title":"Ejemplo Raw","text":"<pre><code>{\n    \"key\": {\n        \"remoteJid\": \"584144709840@s.whatsapp.net\",\n        \"fromMe\": false,\n        \"id\": \"AC07DE0D18FA8254897A26C90B2FFD98\",\n        \"participant\": null\n    },\n    \"message\": {\n        \"extendedTextMessage\": {\n            \"text\": \"Hola mundo\",\n            \"contextInfo\": {\n                \"stanzaId\": \"AC9BE0D81D965A3C240B6ACAA891C6FD\",\n                \"participant\": \"584121234567@s.whatsapp.net\",\n                \"isForwarded\": false,\n                \"forwardingScore\": 0,\n                \"expiration\": 604800\n            }\n        }\n    },\n    \"messageTimestamp\": 1767366759,\n    \"status\": 4,\n    \"pushName\": \"Juan P\u00e9rez\",\n    \"broadcast\": false,\n    \"starred\": false,\n    \"duration\": null,\n    \"labels\": [],\n    \"ephemeralStartTimestamp\": 1767366759,\n    \"ephemeralDuration\": 604800,\n    \"reactions\": [\n        { \"text\": \"\u2764\ufe0f\", \"groupingKey\": \"\u2764\ufe0f\", \"senderTimestampMs\": 1767366800000 }\n    ],\n    \"userReceipt\": [\n        { \"userJid\": \"584144709840@s.whatsapp.net\", \"readTimestamp\": 1767366800 }\n    ]\n}\n</code></pre>"},{"location":"schema/#message-content","title":"Message Content","text":"<p>Tipos de contenido dentro de <code>message</code>.</p>"},{"location":"schema/#texto","title":"Texto","text":"Propiedad Tipo Descripci\u00f3n <code>conversation</code> <code>string</code> Texto simple <code>extendedTextMessage.text</code> <code>string</code> Texto con metadata <code>extendedTextMessage.contextInfo</code> <code>ContextInfo</code> Informaci\u00f3n de contexto"},{"location":"schema/#media","title":"Media","text":"Propiedad Tipo Descripci\u00f3n <code>imageMessage</code> <code>ImageMessage</code> Mensaje de imagen <code>videoMessage</code> <code>VideoMessage</code> Mensaje de video <code>audioMessage</code> <code>AudioMessage</code> Mensaje de audio <code>documentMessage</code> <code>DocumentMessage</code> Mensaje de documento <code>stickerMessage</code> <code>StickerMessage</code> Mensaje de sticker"},{"location":"schema/#media-properties-comun","title":"Media Properties (com\u00fan)","text":"Propiedad Tipo Descripci\u00f3n <code>url</code> <code>string</code> URL de descarga (temporal) <code>directPath</code> <code>string</code> Path directo en CDN <code>mediaKey</code> <code>Uint8Array</code> Clave para descifrar <code>mimetype</code> <code>string</code> Tipo MIME <code>fileLength</code> <code>number</code> Tama\u00f1o en bytes <code>fileSha256</code> <code>Uint8Array</code> Hash SHA256 del archivo <code>fileEncSha256</code> <code>Uint8Array</code> Hash SHA256 cifrado <code>mediaKeyTimestamp</code> <code>number</code> Timestamp de la clave <code>jpegThumbnail</code> <code>Uint8Array</code> Miniatura JPEG en base64 <code>caption</code> <code>string</code> Caption del media <code>width</code> <code>number</code> Ancho en pixels <code>height</code> <code>number</code> Alto en pixels <code>seconds</code> <code>number</code> Duraci\u00f3n (audio/video) <code>ptt</code> <code>boolean</code> Push-to-talk (nota de voz) <code>waveform</code> <code>Uint8Array</code> Forma de onda (audio) <code>streamingSidecar</code> <code>Uint8Array</code> Datos de streaming"},{"location":"schema/#ubicacion","title":"Ubicaci\u00f3n","text":"Propiedad Tipo Descripci\u00f3n <code>locationMessage.degreesLatitude</code> <code>number</code> Latitud <code>locationMessage.degreesLongitude</code> <code>number</code> Longitud <code>liveLocationMessage.degreesLatitude</code> <code>number</code> Latitud en vivo <code>liveLocationMessage.degreesLongitude</code> <code>number</code> Longitud en vivo <code>liveLocationMessage.sequenceNumber</code> <code>number</code> N\u00famero de secuencia <code>liveLocationMessage.caption</code> <code>string</code> Caption de ubicaci\u00f3n"},{"location":"schema/#encuesta","title":"Encuesta","text":"Propiedad Tipo Descripci\u00f3n <code>pollCreationMessage.name</code> <code>string</code> Pregunta de la encuesta <code>pollCreationMessage.options</code> <code>Option[]</code> Opciones de respuesta <code>pollCreationMessage.selectableOptionsCount</code> <code>number</code> Cantidad seleccionable <code>pollUpdateMessage.pollCreationMessageKey</code> <code>MessageKey</code> Referencia a la encuesta <code>pollUpdateMessage.vote</code> <code>PollEncValue</code> Voto cifrado"},{"location":"schema/#reaccion","title":"Reacci\u00f3n","text":"Propiedad Tipo Descripci\u00f3n <code>reactionMessage.key</code> <code>MessageKey</code> Mensaje al que reacciona <code>reactionMessage.text</code> <code>string</code> Emoji de reacci\u00f3n <code>reactionMessage.senderTimestampMs</code> <code>number</code> Timestamp del remitente"},{"location":"schema/#protocolo","title":"Protocolo","text":"Propiedad Tipo Descripci\u00f3n <code>protocolMessage.type</code> <code>ProtocolMessageType</code> Tipo de protocolo <code>protocolMessage.key</code> <code>MessageKey</code> Mensaje objetivo <code>protocolMessage.editedMessage</code> <code>Message</code> Mensaje editado <code>protocolMessage.timestampMs</code> <code>number</code> Timestamp de la acci\u00f3n"},{"location":"schema/#protocolmessage-types","title":"ProtocolMessage Types","text":"Valor Constante Descripci\u00f3n <code>0</code> <code>REVOKE</code> Eliminar mensaje <code>3</code> <code>EPHEMERAL_SETTING</code> Configurar mensajes temporales <code>6</code> <code>EPHEMERAL_SYNC_RESPONSE</code> Respuesta de sincronizaci\u00f3n <code>7</code> <code>HISTORY_SYNC_NOTIFICATION</code> Notificaci\u00f3n de historial <code>14</code> <code>MESSAGE_EDIT</code> Editar mensaje"},{"location":"schema/#contextinfo","title":"ContextInfo","text":"Propiedad Tipo Descripci\u00f3n <code>stanzaId</code> <code>string</code> ID del mensaje citado <code>participant</code> <code>string</code> Autor del mensaje citado <code>quotedMessage</code> <code>Message</code> Contenido del mensaje citado <code>isForwarded</code> <code>boolean</code> Si fue reenviado <code>forwardingScore</code> <code>number</code> Veces reenviado <code>expiration</code> <code>number</code> Segundos hasta expiraci\u00f3n <code>ephemeralSettingTimestamp</code> <code>number</code> Timestamp de configuraci\u00f3n <code>mentionedJid</code> <code>string[]</code> JIDs mencionados"},{"location":"schema/#api-schemas","title":"API Schemas","text":"<p>Schemas simplificados expuestos por las clases.</p>"},{"location":"schema/#contact","title":"Contact","text":"Propiedad Tipo Raw Source Descripci\u00f3n <code>id</code> <code>string</code> <code>id</code> JID \u00fanico del contacto <code>name</code> <code>string</code> <code>name \\|\\| notify \\|\\| \"\"</code> Nombre del contacto <code>photo</code> <code>string \\| null</code> <code>imgUrl</code> URL de foto de perfil <code>phone</code> <code>string</code> <code>id.split(\"@\")[0]</code> N\u00famero telef\u00f3nico <code>content</code> <code>string</code> <code>status \\|\\| \"\"</code> Bio del contacto"},{"location":"schema/#storage-key","title":"Storage Key","text":"<pre><code>contact/{id}/index\n</code></pre>"},{"location":"schema/#chat","title":"Chat","text":"Propiedad Tipo Raw Source Descripci\u00f3n <code>id</code> <code>string</code> <code>id</code> JID \u00fanico del chat <code>type</code> <code>\"contact\" \\| \"group\"</code> Derivado de <code>id</code> Tipo de chat <code>name</code> <code>string</code> <code>name \\|\\| displayName</code> Nombre del chat <code>content</code> <code>string</code> <code>description \\|\\| \"\"</code> Descripci\u00f3n <code>pined</code> <code>boolean</code> <code>pinned !== null</code> Si est\u00e1 fijado <code>archived</code> <code>boolean</code> <code>archived</code> Si est\u00e1 archivado <code>muted</code> <code>number \\| false</code> <code>muteEndTime \\|\\| false</code> Silencio <code>readed</code> <code>boolean</code> <code>unreadCount === 0 &amp;&amp; !markedAsUnread</code> Si est\u00e1 le\u00eddo <code>readonly</code> <code>boolean</code> <code>readOnly</code> Si es solo lectura <code>labels</code> <code>string[]</code> Labels del chat Etiquetas"},{"location":"schema/#storage-key_1","title":"Storage Key","text":"<pre><code>chat/{id}/index\n</code></pre>"},{"location":"schema/#message","title":"Message","text":"Propiedad Tipo Raw Source Descripci\u00f3n <code>id</code> <code>string</code> <code>key.id</code> ID \u00fanico <code>cid</code> <code>string</code> <code>key.remoteJid</code> ID del chat <code>mid</code> <code>string \\| null</code> <code>contextInfo.stanzaId</code> Mensaje padre <code>me</code> <code>boolean</code> <code>key.fromMe</code> Si soy el autor <code>type</code> <code>MessageType</code> Derivado de <code>message</code> Tipo de mensaje <code>author</code> <code>string</code> <code>key.participant \\|\\| key.remoteJid</code> Autor <code>status</code> <code>MessageStatus</code> <code>status</code> Estado de entrega <code>starred</code> <code>boolean</code> <code>starred</code> Destacado <code>forwarded</code> <code>boolean</code> <code>contextInfo.isForwarded</code> Reenviado <code>created_at</code> <code>number</code> <code>messageTimestamp * 1000</code> Creaci\u00f3n (ms) <code>deleted_at</code> <code>number \\| null</code> <code>ephemeralStartTimestamp + ephemeralDuration</code> Expiraci\u00f3n <code>mime</code> <code>string</code> Derivado de <code>message</code> Tipo MIME <code>content</code> <code>Buffer</code> Descargado/extra\u00eddo Contenido binario <code>caption</code> <code>string</code> <code>*.caption \\|\\| \"\"</code> Caption"},{"location":"schema/#storage","title":"Storage","text":"Key Contenido <code>chat/{cid}/message/{id}/index</code> JSON con metadata (sin content) <code>chat/{cid}/message/{id}/content</code> Buffer base64 <code>chat/{cid}/message/{id}/raw</code> Raw completo (para forward, re-descarga)"},{"location":"schema/#resumen-de-campos","title":"Resumen de Campos","text":"Entidad API Fields Raw Fields Contact 5 7 Chat 10 40+ Message 14 50+"},{"location":"schema/#storage-guidelines","title":"Storage Guidelines","text":"<p>Estrategias de almacenamiento para diferentes backends.</p>"},{"location":"schema/#clasificacion-de-campos","title":"Clasificaci\u00f3n de Campos","text":""},{"location":"schema/#campos-primarios-columnasindices","title":"Campos Primarios (Columnas/\u00cdndices)","text":"<p>Campos escalares que: - Se usan en filtros/b\u00fasquedas - Son identificadores o foreign keys - Determinan ordenamiento</p> Entidad Campos Primarios Contact <code>id</code> Chat <code>id</code>, <code>archived</code>, <code>pined</code>, <code>muted</code> Message <code>id</code>, <code>cid</code>, <code>me</code>, <code>author</code>, <code>status</code>, <code>created_at</code>, <code>starred</code>"},{"location":"schema/#campos-anidados-jsonrelaciones","title":"Campos Anidados (JSON/Relaciones)","text":"<p>Objetos o arrays que requieren decisi\u00f3n de almacenamiento:</p> Entidad Campo Tipo Recomendaci\u00f3n Chat <code>participant</code> <code>Array&lt;{id, admin}&gt;</code> Relaci\u00f3n separada (SQL) o JSON (NoSQL) Chat <code>wallpaper</code> <code>Object</code> JSON inline Chat <code>disappearingMode</code> <code>Object</code> JSON inline Message <code>key</code> <code>Object</code> Desnormalizar a campos Message <code>message</code> <code>Object</code> Separar en <code>/raw</code> Message <code>reactions</code> <code>Array</code> Relaci\u00f3n separada (SQL) o JSON (NoSQL) Message <code>userReceipt</code> <code>Array</code> Relaci\u00f3n separada (SQL) o JSON (NoSQL) Message <code>contextInfo</code> <code>Object</code> Extraer <code>stanzaId</code> a <code>mid</code>, resto en <code>/raw</code>"},{"location":"schema/#estrategia-nosql-key-value","title":"Estrategia NoSQL (Key-Value)","text":"<p>Para FileEngine, RedisEngine u otros key-value stores.</p>"},{"location":"schema/#estructura-de-keys","title":"Estructura de Keys","text":"<pre><code>contact/{id}/index          \u2192 JSON con todos los campos\nchat/{id}/index             \u2192 JSON con campos API + raw\nchat/{cid}/message/{id}/index   \u2192 JSON metadata (sin content)\nchat/{cid}/message/{id}/content \u2192 Buffer base64\nchat/{cid}/message/{id}/raw     \u2192 JSON raw completo\n</code></pre>"},{"location":"schema/#ventajas","title":"Ventajas","text":"<ul> <li>Simplicidad: Todo es JSON, sin migraciones</li> <li>Atomicidad: Un registro = una key</li> <li>Flexibilidad: Agregar campos sin alterar estructura</li> </ul>"},{"location":"schema/#consideraciones","title":"Consideraciones","text":"<p>Listados y Filtros: <pre><code># Listar contactos\nSCAN contact/*/index\n\n# Listar mensajes de un chat\nSCAN chat/{cid}/message/*/index\n\n# Filtrar mensajes starred\nRequiere iterar y filtrar en memoria\n</code></pre></p> <p>Limpieza (Cascade Delete): <pre><code># Eliminar chat y todos sus mensajes\n1. SCAN chat/{cid}/message/*\n2. DEL cada key encontrada\n3. DEL chat/{cid}/index\n</code></pre></p> <p>Datos Hu\u00e9rfanos: - Al eliminar chat: eliminar todas las keys con prefijo <code>chat/{cid}/</code> - Al eliminar contacto: solo <code>contact/{id}/index</code> (no hay dependencias)</p>"},{"location":"schema/#formato-de-almacenamiento","title":"Formato de Almacenamiento","text":"<pre><code>// contact/{id}/index\n{\n    \"id\": \"584144709840@s.whatsapp.net\",\n    \"name\": \"Juan P\u00e9rez\",\n    \"photo\": \"https://...\",\n    \"phone\": \"584144709840\",\n    \"content\": \"Disponible\"\n}\n\n// chat/{id}/index\n{\n    \"id\": \"120363123456789@g.us\",\n    \"type\": \"group\",\n    \"name\": \"Equipo Dev\",\n    \"content\": \"Descripci\u00f3n del grupo\",\n    \"pined\": true,\n    \"archived\": false,\n    \"muted\": false,\n    \"readed\": true,\n    \"readonly\": false,\n    \"labels\": [\"trabajo\"],\n    \"raw\": { /* objeto raw completo */ }\n}\n\n// chat/{cid}/message/{id}/index\n{\n    \"id\": \"AC07DE0D18FA8254897A26C90B2FFD98\",\n    \"cid\": \"584144709840@s.whatsapp.net\",\n    \"mid\": null,\n    \"me\": false,\n    \"type\": \"text\",\n    \"author\": \"584144709840@s.whatsapp.net\",\n    \"status\": 4,\n    \"starred\": false,\n    \"forwarded\": false,\n    \"created_at\": 1767366759000,\n    \"deleted_at\": null,\n    \"mime\": \"text/plain\",\n    \"caption\": \"\"\n}\n</code></pre>"},{"location":"schema/#estrategia-sql-relacional","title":"Estrategia SQL (Relacional)","text":"<p>Para PostgreSQL, MySQL, SQLite.</p>"},{"location":"schema/#esquema-de-tablas","title":"Esquema de Tablas","text":"<pre><code>-- Contactos\nCREATE TABLE contacts (\n    id VARCHAR(50) PRIMARY KEY,\n    name VARCHAR(255),\n    photo TEXT,\n    phone VARCHAR(20),\n    content TEXT,\n    raw JSONB\n);\n\n-- Chats\nCREATE TABLE chats (\n    id VARCHAR(50) PRIMARY KEY,\n    type VARCHAR(10) NOT NULL CHECK (type IN ('contact', 'group')),\n    name VARCHAR(255),\n    content TEXT,\n    pined BOOLEAN DEFAULT FALSE,\n    archived BOOLEAN DEFAULT FALSE,\n    muted BIGINT,  -- timestamp o NULL\n    readed BOOLEAN DEFAULT TRUE,\n    readonly BOOLEAN DEFAULT FALSE,\n    raw JSONB\n);\n\n-- Labels de chat (relaci\u00f3n N:M)\nCREATE TABLE chat_labels (\n    chat_id VARCHAR(50) REFERENCES chats(id) ON DELETE CASCADE,\n    label VARCHAR(100),\n    PRIMARY KEY (chat_id, label)\n);\n\n-- Participantes de grupo\nCREATE TABLE chat_participants (\n    chat_id VARCHAR(50) REFERENCES chats(id) ON DELETE CASCADE,\n    contact_id VARCHAR(50),\n    admin VARCHAR(20),  -- NULL, 'admin', 'superadmin'\n    PRIMARY KEY (chat_id, contact_id)\n);\n\n-- Mensajes\nCREATE TABLE messages (\n    id VARCHAR(50),\n    cid VARCHAR(50) REFERENCES chats(id) ON DELETE CASCADE,\n    mid VARCHAR(50),  -- mensaje padre (reply)\n    me BOOLEAN NOT NULL,\n    type VARCHAR(20) NOT NULL,\n    author VARCHAR(50) NOT NULL,\n    status SMALLINT DEFAULT 1,\n    starred BOOLEAN DEFAULT FALSE,\n    forwarded BOOLEAN DEFAULT FALSE,\n    created_at BIGINT NOT NULL,\n    deleted_at BIGINT,\n    mime VARCHAR(100),\n    caption TEXT,\n    PRIMARY KEY (cid, id)\n);\n\n-- Contenido de mensajes (separado para eficiencia)\nCREATE TABLE message_contents (\n    cid VARCHAR(50),\n    message_id VARCHAR(50),\n    content BYTEA,\n    raw JSONB,\n    PRIMARY KEY (cid, message_id),\n    FOREIGN KEY (cid, message_id) REFERENCES messages(cid, id) ON DELETE CASCADE\n);\n\n-- Reacciones\nCREATE TABLE message_reactions (\n    cid VARCHAR(50),\n    message_id VARCHAR(50),\n    reactor_id VARCHAR(50),\n    emoji VARCHAR(10),\n    timestamp BIGINT,\n    PRIMARY KEY (cid, message_id, reactor_id),\n    FOREIGN KEY (cid, message_id) REFERENCES messages(cid, id) ON DELETE CASCADE\n);\n</code></pre>"},{"location":"schema/#indices-recomendados","title":"\u00cdndices Recomendados","text":"<pre><code>-- B\u00fasquedas frecuentes\nCREATE INDEX idx_messages_chat ON messages(cid);\nCREATE INDEX idx_messages_created ON messages(cid, created_at DESC);\nCREATE INDEX idx_messages_author ON messages(author);\nCREATE INDEX idx_messages_starred ON messages(cid, starred) WHERE starred = TRUE;\n\n-- Filtros de chat\nCREATE INDEX idx_chats_archived ON chats(archived) WHERE archived = TRUE;\nCREATE INDEX idx_chats_pined ON chats(pined) WHERE pined = TRUE;\n</code></pre>"},{"location":"schema/#ventajas_1","title":"Ventajas","text":"<ul> <li>Integridad: Foreign keys garantizan consistencia</li> <li>Cascade Delete: <code>ON DELETE CASCADE</code> limpia autom\u00e1ticamente</li> <li>Filtros Eficientes: \u00cdndices en campos de b\u00fasqueda</li> <li>Joins: Relacionar datos sin m\u00faltiples queries</li> </ul>"},{"location":"schema/#consultas-comunes","title":"Consultas Comunes","text":"<pre><code>-- Mensajes de un chat ordenados\nSELECT * FROM messages WHERE cid = ? ORDER BY created_at DESC LIMIT 50;\n\n-- Mensajes starred del usuario\nSELECT * FROM messages WHERE me = TRUE AND starred = TRUE;\n\n-- Chats con mensajes no le\u00eddos\nSELECT * FROM chats WHERE readed = FALSE ORDER BY pined DESC;\n\n-- Eliminar chat (cascade elimina mensajes, reacciones, etc.)\nDELETE FROM chats WHERE id = ?;\n</code></pre>"},{"location":"schema/#comparativa","title":"Comparativa","text":"Aspecto NoSQL (Key-Value) SQL (Relacional) Setup M\u00ednimo Requiere migraciones Filtros En memoria \u00cdndices nativos Joins N queries 1 query Cascade Delete Manual Autom\u00e1tico Flexibilidad Schema Alta Requiere ALTER Datos Hu\u00e9rfanos Posibles Imposibles Escalabilidad Horizontal Vertical"},{"location":"schema/#recomendaciones-por-caso-de-uso","title":"Recomendaciones por Caso de Uso","text":""},{"location":"schema/#bot-simple-prototipo","title":"Bot Simple / Prototipo","text":"<ul> <li>Backend: FileEngine (JSON files)</li> <li>Raz\u00f3n: Zero setup, f\u00e1cil debugging</li> </ul>"},{"location":"schema/#bot-en-produccion-100k-mensajes","title":"Bot en Producci\u00f3n (&lt; 100k mensajes)","text":"<ul> <li>Backend: SQLite + FileEngine (content)</li> <li>Raz\u00f3n: Balance entre performance y simplicidad</li> </ul>"},{"location":"schema/#bot-en-produccion-100k-mensajes_1","title":"Bot en Producci\u00f3n (&gt; 100k mensajes)","text":"<ul> <li>Backend: PostgreSQL + Redis (cache)</li> <li>Raz\u00f3n: \u00cdndices, cascade delete, queries complejas</li> </ul>"},{"location":"schema/#multi-tenant-saas","title":"Multi-tenant / SaaS","text":"<ul> <li>Backend: PostgreSQL con partitioning por <code>cid</code></li> <li>Raz\u00f3n: Aislamiento de datos, limpieza por tenant</li> </ul>"},{"location":"schema/#prevencion-de-datos-huerfanos","title":"Prevenci\u00f3n de Datos Hu\u00e9rfanos","text":""},{"location":"schema/#principio","title":"Principio","text":"<p>Al eliminar una entidad padre, SIEMPRE eliminar sus dependencias.</p>"},{"location":"schema/#cascada-de-eliminacion","title":"Cascada de Eliminaci\u00f3n","text":"<pre><code>Eliminar Contact:\n\u2514\u2500\u2500 contact/{id}/index\n\nEliminar Chat:\n\u251c\u2500\u2500 chat/{id}/index\n\u251c\u2500\u2500 chat/{id}/message/*/index\n\u251c\u2500\u2500 chat/{id}/message/*/content\n\u251c\u2500\u2500 chat/{id}/message/*/raw\n\u2514\u2500\u2500 (SQL) chat_labels, chat_participants, messages, message_contents, message_reactions\n\nEliminar Message:\n\u251c\u2500\u2500 chat/{cid}/message/{id}/index\n\u251c\u2500\u2500 chat/{cid}/message/{id}/content\n\u251c\u2500\u2500 chat/{cid}/message/{id}/raw\n\u2514\u2500\u2500 (SQL) message_contents, message_reactions\n</code></pre>"},{"location":"schema/#implementacion","title":"Implementaci\u00f3n","text":"<p>El cascade delete est\u00e1 implementado en <code>Chat.cascade_delete()</code>:</p> <pre><code>// Eliminar chat y todo su contenido\nawait Chat.cascade_delete(chat_id);\n\n// Internamente ejecuta:\n// 1. Lee chat/{cid}/messages para obtener IDs\n// 2. Elimina chat/{cid}/message/{mid}/index, /content, /raw para cada mensaje\n// 3. Elimina chat/{cid}/messages\n// 4. Elimina chat/{cid}/index\n</code></pre>"},{"location":"examples/basic-bot/","title":"Basic Bot","text":"<p>Simple bot that responds to text messages.</p>"},{"location":"examples/basic-bot/#complete-code","title":"Complete code","text":"bot.ts<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\n\nasync function main() {\n  const wa = new WhatsApp();\n\n  // Connection events\n  wa.event.on(\"open\", () =&gt; console.log(\"[INFO] Connected\"));\n  wa.event.on(\"close\", () =&gt; console.log(\"[WARN] Disconnected\"));\n  wa.event.on(\"error\", (e) =&gt; console.error(\"[ERROR]\", e.message));\n\n  // Handle messages\n  wa.event.on(\"message:created\", async (msg) =&gt; {\n    // Ignore own messages\n    if (msg.me) return;\n\n    // Only text\n    if (msg.type !== \"text\") return;\n\n    const text = (await msg.content()).toString().toLowerCase();\n\n    // Respond to greetings\n    if (text === \"hello\" || text === \"hi\") {\n      await wa.Message.text(msg.cid, \"Hello! How can I help you?\");\n      return;\n    }\n\n    // Commands\n    if (text === \"ping\") {\n      await wa.Message.text(msg.cid, \"pong!\");\n      return;\n    }\n\n    if (text === \"time\") {\n      const now = new Date().toLocaleString();\n      await wa.Message.text(msg.cid, `Current time: ${now}`);\n      return;\n    }\n\n    if (text === \"help\") {\n      await wa.Message.text(\n        msg.cid,\n        \"*Available commands:*\\n\\n\" +\n        \"- hello/hi: Greeting\\n\" +\n        \"- ping: Connectivity test\\n\" +\n        \"- time: Current time\\n\" +\n        \"- help: This message\"\n      );\n      return;\n    }\n  });\n\n  // Connect\n  console.log(\"[INFO] Starting bot...\");\n  await wa.pair(async (data) =&gt; {\n    if (Buffer.isBuffer(data)) {\n      require(\"fs\").writeFileSync(\"qr.png\", data);\n      console.log(\"[INFO] QR saved to qr.png\");\n    } else {\n      console.log(\"[INFO] Code:\", data);\n    }\n  });\n\n  console.log(\"[INFO] Bot ready!\");\n\n  // Keep process alive\n  process.on(\"SIGINT\", () =&gt; {\n    console.log(\"[INFO] Closing...\");\n    process.exit(0);\n  });\n}\n\nmain().catch((e) =&gt; {\n  console.error(\"[FATAL]\", e);\n  process.exit(1);\n});\n</code></pre>"},{"location":"examples/basic-bot/#run","title":"Run","text":"<pre><code>npx tsx bot.ts\n</code></pre>"},{"location":"examples/basic-bot/#usage","title":"Usage","text":"<p>Send these messages to the connected WhatsApp:</p> <pre><code>hello     \u2192 Hello! How can I help you?\nping      \u2192 pong!\ntime      \u2192 Current time: 1/1/2025, 2:30:00 PM\nhelp      \u2192 Available commands list\n</code></pre>"},{"location":"examples/basic-bot/#notes","title":"Notes","text":"<p>Prefixes</p> <p>Consider adding a prefix (<code>!</code>, <code>/</code>, <code>.</code>) to commands to avoid conflicts with normal messages.</p> <p>Rate limits</p> <p>WhatsApp has rate limits. Avoid sending too many messages in a short period.</p>"},{"location":"examples/command-bot/","title":"Command Bot","text":"<p>Bot with structured and modular command system.</p>"},{"location":"examples/command-bot/#project-structure","title":"Project structure","text":"<pre><code>my-bot/\n  src/\n    commands/\n      index.ts\n      ping.ts\n      help.ts\n      time.ts\n    index.ts\n  package.json\n  tsconfig.json\n</code></pre>"},{"location":"examples/command-bot/#code","title":"Code","text":""},{"location":"examples/command-bot/#srccommandsindexts","title":"src/commands/index.ts","text":"<pre><code>import type { WhatsApp } from \"@arcaelas/whatsapp\";\n\n// Message type (inferred from wa.Message)\ntype Message = InstanceType&lt;WhatsApp[\"Message\"]&gt;;\n\nexport interface CommandContext {\n  wa: WhatsApp;\n  msg: Message;\n  cid: string;\n  args: string[];\n  text: string;\n}\n\nexport interface Command {\n  name: string;\n  description: string;\n  aliases?: string[];\n  execute: (ctx: CommandContext) =&gt; Promise&lt;void&gt;;\n}\n\n// Command registry\nexport const commands = new Map&lt;string, Command&gt;();\n\n// Helper to register command\nexport function register_command(cmd: Command) {\n  commands.set(cmd.name, cmd);\n  cmd.aliases?.forEach(alias =&gt; commands.set(alias, cmd));\n}\n\n// Import and register commands\nimport \"./ping\";\nimport \"./help\";\nimport \"./time\";\n</code></pre>"},{"location":"examples/command-bot/#srccommandspingts","title":"src/commands/ping.ts","text":"<pre><code>import { register_command } from \"./index\";\n\nregister_command({\n  name: \"ping\",\n  description: \"Check bot latency\",\n  aliases: [\"p\"],\n  async execute({ wa, cid }) {\n    const start = Date.now();\n    await wa.Message.text(cid, \"pong!\");\n    console.log(`Latency: ${Date.now() - start}ms`);\n  },\n});\n</code></pre>"},{"location":"examples/command-bot/#srccommandshelpts","title":"src/commands/help.ts","text":"<pre><code>import { commands, register_command } from \"./index\";\n\nregister_command({\n  name: \"help\",\n  description: \"Show command list\",\n  aliases: [\"h\", \"?\"],\n  async execute({ wa, cid }) {\n    const unique_commands = new Map&lt;string, string&gt;();\n\n    commands.forEach((cmd) =&gt; {\n      if (!unique_commands.has(cmd.name)) {\n        unique_commands.set(cmd.name, cmd.description);\n      }\n    });\n\n    let message = \"*Available commands:*\\n\\n\";\n    unique_commands.forEach((desc, name) =&gt; {\n      message += `!${name} - ${desc}\\n`;\n    });\n\n    await wa.Message.text(cid, message);\n  },\n});\n</code></pre>"},{"location":"examples/command-bot/#srccommandstimets","title":"src/commands/time.ts","text":"<pre><code>import { register_command } from \"./index\";\n\nregister_command({\n  name: \"time\",\n  description: \"Show current time\",\n  aliases: [\"t\"],\n  async execute({ wa, cid }) {\n    const now = new Date();\n    const time = now.toLocaleTimeString(\"en-US\", {\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n      second: \"2-digit\",\n    });\n    const date = now.toLocaleDateString(\"en-US\", {\n      weekday: \"long\",\n      day: \"numeric\",\n      month: \"long\",\n      year: \"numeric\",\n    });\n\n    await wa.Message.text(cid, `${time}\\n${date}`);\n  },\n});\n</code></pre>"},{"location":"examples/command-bot/#srcindexts","title":"src/index.ts","text":"<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\nimport { commands, CommandContext } from \"./commands\";\n\nconst PREFIX = \"!\";\n\nasync function main() {\n  const wa = new WhatsApp();\n\n  wa.event.on(\"open\", () =&gt; console.log(\"Bot connected\"));\n  wa.event.on(\"error\", (e) =&gt; console.error(\"Error:\", e.message));\n\n  wa.event.on(\"message:created\", async (msg) =&gt; {\n    // Ignore own messages\n    if (msg.me) return;\n\n    // Only text\n    if (msg.type !== \"text\") return;\n\n    const text = (await msg.content()).toString();\n\n    // Check prefix\n    if (!text.startsWith(PREFIX)) return;\n\n    // Parse command and arguments\n    const [command_name, ...args] = text.slice(PREFIX.length).split(\" \");\n    const cmd = commands.get(command_name.toLowerCase());\n\n    if (!cmd) {\n      await wa.Message.text(msg.cid, `Command not found. Type ${PREFIX}help`);\n      return;\n    }\n\n    // Execute command\n    const ctx: CommandContext = {\n      wa,\n      msg,\n      cid: msg.cid,\n      args,\n      text: text.slice(PREFIX.length + command_name.length + 1),\n    };\n\n    try {\n      await cmd.execute(ctx);\n    } catch (error) {\n      console.error(`Error in command ${cmd.name}:`, error);\n      await wa.Message.text(msg.cid, \"An error occurred while executing the command\");\n    }\n  });\n\n  // Connect\n  await wa.pair(async (data) =&gt; {\n    if (Buffer.isBuffer(data)) {\n      require(\"fs\").writeFileSync(\"qr.png\", data);\n      console.log(\"Scan qr.png\");\n    }\n  });\n\n  console.log(\"Bot ready!\");\n}\n\nmain().catch(console.error);\n</code></pre>"},{"location":"examples/command-bot/#adding-new-commands","title":"Adding new commands","text":""},{"location":"examples/command-bot/#command-with-arguments","title":"Command with arguments","text":"src/commands/say.ts<pre><code>import { register_command } from \"./index\";\n\nregister_command({\n  name: \"say\",\n  description: \"Repeat a message\",\n  aliases: [\"echo\"],\n  async execute({ wa, cid, text }) {\n    if (!text.trim()) {\n      await wa.Message.text(cid, \"Usage: !say &lt;message&gt;\");\n      return;\n    }\n    await wa.Message.text(cid, text);\n  },\n});\n</code></pre>"},{"location":"examples/command-bot/#command-with-validation","title":"Command with validation","text":"src/commands/dice.ts<pre><code>import { register_command } from \"./index\";\n\nregister_command({\n  name: \"dice\",\n  description: \"Roll a dice\",\n  aliases: [\"roll\"],\n  async execute({ wa, cid, args }) {\n    const sides = parseInt(args[0]) || 6;\n\n    if (sides &lt; 2 || sides &gt; 100) {\n      await wa.Message.text(cid, \"Dice must have between 2 and 100 sides\");\n      return;\n    }\n\n    const result = Math.floor(Math.random() * sides) + 1;\n    await wa.Message.text(cid, `${sides}-sided dice: ${result}`);\n  },\n});\n</code></pre>"},{"location":"examples/command-bot/#groups-only-command","title":"Groups only command","text":"src/commands/group.ts<pre><code>import { register_command } from \"./index\";\n\nregister_command({\n  name: \"group\",\n  description: \"Group information\",\n  aliases: [\"g\"],\n  async execute({ wa, cid }) {\n    // Only in groups\n    if (!cid.endsWith(\"@g.us\")) {\n      await wa.Message.text(cid, \"This command only works in groups\");\n      return;\n    }\n\n    const chat = await wa.Chat.get(cid);\n    if (!chat) return;\n\n    const members = await wa.Chat.members(cid, 0, 1000);\n\n    await wa.Message.text(\n      cid,\n      `*${chat.name}*\\n\\n` +\n      `Members: ${members.length}`\n    );\n  },\n});\n</code></pre>"},{"location":"examples/command-bot/#run","title":"Run","text":"<pre><code>npx tsx src/index.ts\n</code></pre>"},{"location":"examples/command-bot/#usage","title":"Usage","text":"<pre><code>!ping          \u2192 pong!\n!help          \u2192 Command list\n!time          \u2192 2:30:45 PM - Monday, January 1, 2025\n!say Hello     \u2192 Hello\n!dice 20       \u2192 20-sided dice: 15\n!group         \u2192 Group information\n</code></pre>"},{"location":"examples/groups/","title":"Group Management","text":"<p>Examples of working with WhatsApp groups.</p>"},{"location":"examples/groups/#get-group-information","title":"Get group information","text":"<pre><code>const chat = await wa.Chat.get(\"123456789@g.us\");\n\nif (chat &amp;&amp; chat.type === \"group\") {\n  console.log(`Name: ${chat.name}`);\n  console.log(`ID: ${chat.id}`);\n\n  // Members\n  const members = await wa.Chat.members(chat.id, 0, 1000);\n  console.log(`Members: ${members.length}`);\n\n  for (const member of members) {\n    console.log(`  - ${member.name} (${member.phone})`);\n  }\n}\n</code></pre>"},{"location":"examples/groups/#detect-groups-in-events","title":"Detect groups in events","text":"<pre><code>wa.event.on(\"chat:created\", (chat) =&gt; {\n  if (chat.type === \"group\") {\n    console.log(`Group created: ${chat.name}`);\n  }\n});\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  // Check if message is from a group\n  const is_group = msg.cid.endsWith(\"@g.us\");\n\n  if (is_group) {\n    console.log(`Message in group: ${msg.cid}`);\n  }\n});\n</code></pre>"},{"location":"examples/groups/#send-messages-to-groups","title":"Send messages to groups","text":"<pre><code>// Send text to a group\nawait wa.Message.text(\"123456789@g.us\", \"Hello group!\");\n\n// Send image to a group\nimport * as fs from \"fs\";\nconst img = fs.readFileSync(\"photo.jpg\");\nawait wa.Message.image(\"123456789@g.us\", img, \"Photo for the group\");\n\n// Create poll in group\nawait wa.Message.poll(\"123456789@g.us\", {\n  content: \"Where should we meet?\",\n  options: [\n    { content: \"At my place\" },\n    { content: \"At the park\" },\n    { content: \"Downtown\" }\n  ]\n});\n</code></pre>"},{"location":"examples/groups/#reply-in-groups","title":"Reply in groups","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n\n  // Only process group messages\n  if (!msg.cid.endsWith(\"@g.us\")) return;\n\n  if (msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString().toLowerCase();\n\n  // Reply\n  if (text.includes(\"hello\")) {\n    await wa.Message.text(msg.cid, \"Hello! Welcome to the group\");\n  }\n});\n</code></pre>"},{"location":"examples/groups/#get-group-members","title":"Get group members","text":"<pre><code>const group_id = \"123456789@g.us\";\nconst members = await wa.Chat.members(group_id, 0, 1000);\n\nconsole.log(`Group has ${members.length} members:`);\nfor (const member of members) {\n  console.log(`  - ${member.name}: ${member.phone}`);\n}\n</code></pre>"},{"location":"examples/groups/#export-members-to-json","title":"Export members to JSON","text":"<pre><code>import * as fs from \"fs\";\n\nasync function export_group_members(wa: WhatsApp, group_id: string) {\n  const chat = await wa.Chat.get(group_id);\n  if (!chat || chat.type !== \"group\") {\n    throw new Error(\"Group not found\");\n  }\n\n  const members = await wa.Chat.members(group_id, 0, 10000);\n\n  const data = {\n    group: {\n      id: chat.id,\n      name: chat.name,\n    },\n    exported_at: new Date().toISOString(),\n    members: members.map(m =&gt; ({\n      id: m.id,\n      phone: m.phone,\n      name: m.name,\n    })),\n  };\n\n  const filename = `group_${chat.name.replace(/[^a-z0-9]/gi, \"_\")}.json`;\n  fs.writeFileSync(filename, JSON.stringify(data, null, 2));\n\n  console.log(`Exported ${members.length} members to ${filename}`);\n}\n</code></pre>"},{"location":"examples/groups/#command-bot-for-groups","title":"Command bot for groups","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"text\") return;\n\n  // Only in groups\n  if (!msg.cid.endsWith(\"@g.us\")) return;\n\n  const text = (await msg.content()).toString();\n  if (!text.startsWith(\"!\")) return;\n\n  const [cmd] = text.slice(1).split(\" \");\n\n  switch (cmd.toLowerCase()) {\n    case \"info\":\n      const chat = await wa.Chat.get(msg.cid);\n      if (chat) {\n        const members = await wa.Chat.members(msg.cid, 0, 1000);\n        await wa.Message.text(\n          msg.cid,\n          `*${chat.name}*\\n\\n` +\n          `ID: ${chat.id}\\n` +\n          `Members: ${members.length}`\n        );\n      }\n      break;\n\n    case \"members\":\n      const group_members = await wa.Chat.members(msg.cid, 0, 50);\n      const list = group_members.map(m =&gt; `- ${m.name}`).join(\"\\n\");\n      await wa.Message.text(msg.cid, `*Members:*\\n${list}`);\n      break;\n  }\n});\n</code></pre>"},{"location":"examples/groups/#notes","title":"Notes","text":"<p>Group JID</p> <p>Groups have JID format <code>{id}@g.us</code></p> <p>Differentiation</p> <p>Use <code>chat.type === \"group\"</code> or <code>cid.endsWith(\"@g.us\")</code> to detect groups</p>"},{"location":"examples/media/","title":"Media Sending","text":"<p>Examples of sending and receiving multimedia files.</p>"},{"location":"examples/media/#send-image","title":"Send image","text":"<pre><code>import * as fs from \"fs\";\n\n// From local file\nconst img = fs.readFileSync(\"photo.jpg\");\nawait wa.Message.image(\"5491112345678@s.whatsapp.net\", img, \"Check out this photo!\");\n\n// From URL (download first)\nconst response = await fetch(\"https://example.com/image.jpg\");\nconst buffer = Buffer.from(await response.arrayBuffer());\nawait wa.Message.image(\"5491112345678@s.whatsapp.net\", buffer, \"Image from internet\");\n</code></pre>"},{"location":"examples/media/#send-video","title":"Send video","text":"<pre><code>import * as fs from \"fs\";\n\n// From local file\nconst video = fs.readFileSync(\"video.mp4\");\nawait wa.Message.video(\"5491112345678@s.whatsapp.net\", video, \"Interesting video\");\n\n// Note: WhatsApp compresses videos automatically\n// For better quality, use short videos (&lt;3 min) and 720p\n</code></pre>"},{"location":"examples/media/#send-audio","title":"Send audio","text":"<pre><code>import * as fs from \"fs\";\n\n// Voice note (PTT - Push to Talk) - default\nconst audio = fs.readFileSync(\"audio.ogg\");\nawait wa.Message.audio(\"5491112345678@s.whatsapp.net\", audio);\n\n// Regular audio (without PTT)\nawait wa.Message.audio(\"5491112345678@s.whatsapp.net\", audio, false);\n\n// Supported formats: OGG with Opus codec (preferred), MP3, AAC\n// WhatsApp automatically converts to OGG/Opus\n</code></pre>"},{"location":"examples/media/#send-location","title":"Send location","text":"<pre><code>// Static location\nawait wa.Message.location(\"5491112345678@s.whatsapp.net\", {\n  lat: -34.6037,\n  lng: -58.3816\n});\n</code></pre>"},{"location":"examples/media/#receive-and-save-media","title":"Receive and save media","text":"<pre><code>import * as fs from \"fs\";\nimport * as path from \"path\";\n\nconst MEDIA_DIR = \"./media\";\nfs.mkdirSync(MEDIA_DIR, { recursive: true });\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n\n  const timestamp = Date.now();\n  const buffer = await msg.content();\n\n  if (buffer.length === 0) return;\n\n  // Image\n  if (msg.type === \"image\") {\n    const ext = msg.mime.split(\"/\")[1] || \"jpg\";\n    const filename = `${timestamp}.${ext}`;\n    fs.writeFileSync(path.join(MEDIA_DIR, filename), buffer);\n    console.log(`Image saved: ${filename} (${buffer.length} bytes)`);\n    if (msg.caption) {\n      console.log(`Caption: ${msg.caption}`);\n    }\n  }\n\n  // Video\n  if (msg.type === \"video\") {\n    const filename = `${timestamp}.mp4`;\n    fs.writeFileSync(path.join(MEDIA_DIR, filename), buffer);\n    console.log(`Video saved: ${filename} (${buffer.length} bytes)`);\n  }\n\n  // Audio\n  if (msg.type === \"audio\") {\n    const filename = `${timestamp}.ogg`;\n    fs.writeFileSync(path.join(MEDIA_DIR, filename), buffer);\n    console.log(`Audio saved: ${filename} (${buffer.length} bytes)`);\n  }\n});\n</code></pre>"},{"location":"examples/media/#forward-media","title":"Forward media","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString();\n\n  // Command to forward media\n  if (text.startsWith(\"!forward \")) {\n    const target_phone = text.slice(9).trim();\n    const target_jid = `${target_phone}@s.whatsapp.net`;\n\n    // Get previous message (the one we want to forward)\n    const prev_msg = await wa.Message.get(msg.cid, \"PREVIOUS_MESSAGE_ID\");\n\n    if (prev_msg &amp;&amp; [\"image\", \"video\", \"audio\"].includes(prev_msg.type)) {\n      await wa.Message.forward(msg.cid, prev_msg.id, target_jid);\n      await wa.Message.text(msg.cid, \"Media forwarded!\");\n    }\n  }\n});\n</code></pre>"},{"location":"examples/media/#process-images","title":"Process images","text":"<pre><code>import sharp from \"sharp\"; // npm install sharp\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"image\") return;\n\n  const buffer = await msg.content();\n  if (buffer.length === 0) return;\n\n  // Get metadata\n  const metadata = await sharp(buffer).metadata();\n  console.log(`Image: ${metadata.width}x${metadata.height}, ${metadata.format}`);\n\n  // Resize\n  const thumbnail = await sharp(buffer)\n    .resize(100, 100, { fit: \"cover\" })\n    .jpeg({ quality: 80 })\n    .toBuffer();\n\n  // Send thumbnail as reply\n  await wa.Message.image(msg.cid, thumbnail, \"Generated thumbnail\");\n});\n</code></pre>"},{"location":"examples/media/#transcribe-audio","title":"Transcribe audio","text":"<pre><code>// Example with OpenAI Whisper API\nimport OpenAI from \"openai\";\nimport * as fs from \"fs\";\nimport * as path from \"path\";\n\nconst openai = new OpenAI();\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"audio\") return;\n\n  const buffer = await msg.content();\n  if (buffer.length === 0) return;\n\n  // Save temporarily\n  const temp_file = path.join(\"/tmp\", `${Date.now()}.ogg`);\n  fs.writeFileSync(temp_file, buffer);\n\n  try {\n    // Transcribe\n    const transcription = await openai.audio.transcriptions.create({\n      file: fs.createReadStream(temp_file),\n      model: \"whisper-1\",\n      language: \"en\",\n    });\n\n    await wa.Message.text(msg.cid, `Transcription:\\n${transcription.text}`);\n  } catch (error) {\n    console.error(\"Error transcribing:\", error);\n  } finally {\n    fs.unlinkSync(temp_file);\n  }\n});\n</code></pre>"},{"location":"examples/media/#limits-and-recommendations","title":"Limits and recommendations","text":"Type Limit Recommendation Image 16 MB &lt; 5 MB, JPEG/PNG Video 64 MB &lt; 16 MB, MP4 H.264 Audio 16 MB &lt; 5 MB, OGG Opus <p>Compression</p> <p>WhatsApp automatically compresses media. For better quality, use optimized formats.</p> <p>Timeout</p> <p>Media download may take time. Consider using timeouts and retries.</p>"},{"location":"examples/polls/","title":"Polls","text":"<p>Examples of creating and handling polls.</p>"},{"location":"examples/polls/#create-poll","title":"Create poll","text":"<pre><code>// Simple poll\nawait wa.Message.poll(\"123456789@g.us\", {\n  content: \"What's your favorite color?\",\n  options: [\n    { content: \"Red\" },\n    { content: \"Blue\" },\n    { content: \"Green\" },\n    { content: \"Yellow\" }\n  ]\n});\n</code></pre>"},{"location":"examples/polls/#read-poll-data","title":"Read poll data","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.type !== \"poll\") return;\n\n  // Poll content is JSON\n  const buffer = await msg.content();\n  const poll = JSON.parse(buffer.toString()) as {\n    content: string;\n    options: Array&lt;{ content: string }&gt;;\n  };\n\n  console.log(`Poll: ${poll.content}`);\n  console.log(\"Options:\");\n  poll.options.forEach((opt, i) =&gt; {\n    console.log(`  ${i + 1}. ${opt.content}`);\n  });\n});\n</code></pre>"},{"location":"examples/polls/#poll-bot","title":"Poll bot","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString();\n\n  // Command: !poll Question | Option1 | Option2 | ...\n  if (text.startsWith(\"!poll \")) {\n    const content = text.slice(6);\n    const parts = content.split(\"|\").map(s =&gt; s.trim());\n\n    if (parts.length &lt; 3) {\n      await wa.Message.text(\n        msg.cid,\n        \"Usage: !poll Question | Option1 | Option2 | ...\\n\\n\" +\n        \"Example:\\n\" +\n        \"!poll What should we eat? | Pizza | Sushi | Burger\"\n      );\n      return;\n    }\n\n    const [question, ...options] = parts;\n\n    if (options.length &gt; 12) {\n      await wa.Message.text(msg.cid, \"Maximum 12 options allowed\");\n      return;\n    }\n\n    await wa.Message.poll(msg.cid, {\n      content: question,\n      options: options.map(opt =&gt; ({ content: opt }))\n    });\n\n    await wa.Message.text(msg.cid, `Poll created: \"${question}\"`);\n  }\n});\n</code></pre>"},{"location":"examples/polls/#timed-poll","title":"Timed poll","text":"<pre><code>async function create_timed_poll(\n  wa: WhatsApp,\n  chat_id: string,\n  question: string,\n  options: string[],\n  duration_minutes: number\n) {\n  // Create poll\n  const poll_msg = await wa.Message.poll(chat_id, {\n    content: question,\n    options: options.map(opt =&gt; ({ content: opt }))\n  });\n\n  if (!poll_msg) return;\n\n  await wa.Message.text(chat_id, `Poll active for ${duration_minutes} minutes`);\n\n  // Wait duration\n  await new Promise(r =&gt; setTimeout(r, duration_minutes * 60 * 1000));\n\n  // Announce end\n  await wa.Message.text(chat_id, `*Poll ended!*\\n\\nCheck results in the poll.`);\n}\n\n// Usage\nawait create_timed_poll(\n  wa,\n  \"123456789@g.us\",\n  \"What movie should we watch?\",\n  [\"Action\", \"Comedy\", \"Horror\", \"Drama\"],\n  5 // 5 minutes\n);\n</code></pre>"},{"location":"examples/polls/#important-notes","title":"Important notes","text":"<p>Option limit</p> <p>WhatsApp allows maximum 12 options per poll.</p> <p>Vote visibility</p> <p>Votes on WhatsApp are anonymous. You can only see total count, not who voted.</p> <p>Polls in groups</p> <p>Polls work best in groups where there are more participants.</p>"},{"location":"examples/s3-bot/","title":"Custom Engine Bot","text":"<p>Production bot using a custom engine for storage.</p>"},{"location":"examples/s3-bot/#description","title":"Description","text":"<p>This example shows how to create a bot that uses a custom engine (Redis, PostgreSQL, S3, etc.) instead of the default FileEngine.</p>"},{"location":"examples/s3-bot/#example-redis-engine","title":"Example: Redis Engine","text":""},{"location":"examples/s3-bot/#create-the-engine","title":"Create the engine","text":"RedisEngine.ts<pre><code>import type { Engine } from \"@arcaelas/whatsapp\";\nimport { createClient } from \"redis\";\n\nexport class RedisEngine implements Engine {\n  private client: ReturnType&lt;typeof createClient&gt;;\n\n  constructor(url: string) {\n    this.client = createClient({ url });\n  }\n\n  async connect() {\n    await this.client.connect();\n  }\n\n  async get(key: string): Promise&lt;string | null&gt; {\n    return await this.client.get(key);\n  }\n\n  async set(key: string, value: string | null): Promise&lt;void&gt; {\n    if (value === null) {\n      await this.client.del(key);\n    } else {\n      await this.client.set(key, value);\n    }\n  }\n\n  async list(prefix: string, offset = 0, limit = 50): Promise&lt;string[]&gt; {\n    const keys = await this.client.keys(`${prefix}*`);\n    return keys.slice(offset, offset + limit);\n  }\n}\n</code></pre>"},{"location":"examples/s3-bot/#use-the-engine","title":"Use the engine","text":"bot.ts<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\nimport { RedisEngine } from \"./RedisEngine\";\nimport \"dotenv/config\";\n\nasync function main() {\n  // Create Redis engine\n  const engine = new RedisEngine(process.env.REDIS_URL || \"redis://localhost:6379\");\n  await engine.connect();\n\n  // Create instance with custom engine\n  const wa = new WhatsApp({ engine });\n\n  // Logging\n  wa.event.on(\"open\", () =&gt; console.log(\"[INFO] Connected\"));\n  wa.event.on(\"close\", () =&gt; console.log(\"[WARN] Disconnected\"));\n  wa.event.on(\"error\", (e) =&gt; console.error(\"[ERROR]\", e.message));\n\n  // Messages\n  wa.event.on(\"message:created\", async (msg) =&gt; {\n    if (msg.me || msg.type !== \"text\") return;\n\n    const text = (await msg.content()).toString();\n    const prefix = process.env.BOT_PREFIX || \"!\";\n\n    if (!text.startsWith(prefix)) return;\n\n    const [cmd] = text.slice(prefix.length).split(\" \");\n\n    switch (cmd.toLowerCase()) {\n      case \"ping\":\n        await wa.Message.text(msg.cid, \"pong!\");\n        break;\n\n      case \"status\":\n        await wa.Message.text(\n          msg.cid,\n          `*Bot Status*\\n\\n` +\n          `Engine: Redis\\n` +\n          `Uptime: ${Math.floor(process.uptime() / 60)} minutes`\n        );\n        break;\n\n      case \"help\":\n        await wa.Message.text(\n          msg.cid,\n          `Commands:\\n` +\n          `${prefix}ping - Test\\n` +\n          `${prefix}status - Bot status\\n` +\n          `${prefix}help - This message`\n        );\n        break;\n    }\n  });\n\n  // Connect\n  console.log(\"[INFO] Starting bot...\");\n  await wa.pair(async (data) =&gt; {\n    if (Buffer.isBuffer(data)) {\n      require(\"fs\").writeFileSync(\"/tmp/qr.png\", data);\n      console.log(\"[INFO] QR saved to /tmp/qr.png\");\n    } else {\n      console.log(\"[INFO] Code:\", data);\n    }\n  });\n\n  console.log(\"[INFO] Bot ready!\");\n\n  // Keep process alive\n  process.on(\"SIGINT\", () =&gt; {\n    console.log(\"[INFO] Closing...\");\n    process.exit(0);\n  });\n}\n\nmain().catch((e) =&gt; {\n  console.error(\"[FATAL]\", e);\n  process.exit(1);\n});\n</code></pre>"},{"location":"examples/s3-bot/#docker","title":"Docker","text":"Dockerfile<pre><code>FROM node:20-alpine\n\nWORKDIR /app\n\nCOPY package*.json ./\nRUN npm ci --only=production\n\nCOPY . .\n\nCMD [\"node\", \"--import\", \"tsx\", \"bot.ts\"]\n</code></pre> docker-compose.yml<pre><code>version: \"3.8\"\n\nservices:\n  redis:\n    image: redis:7-alpine\n    restart: unless-stopped\n\n  bot:\n    build: .\n    restart: unless-stopped\n    depends_on:\n      - redis\n    environment:\n      - REDIS_URL=redis://redis:6379\n      - BOT_PREFIX=!\n    volumes:\n      - /tmp:/tmp  # For temporary QR\n</code></pre>"},{"location":"examples/s3-bot/#health-check","title":"Health check","text":"<pre><code>import { createServer } from \"http\";\n\n// Add after initializing the bot\nconst server = createServer((req, res) =&gt; {\n  if (req.url === \"/health\") {\n    res.writeHead(200, { \"Content-Type\": \"application/json\" });\n    res.end(JSON.stringify({\n      status: \"ok\",\n      connected: wa.socket !== null,\n      uptime: process.uptime(),\n    }));\n  } else {\n    res.writeHead(404);\n    res.end();\n  }\n});\n\nserver.listen(3000, () =&gt; {\n  console.log(\"[INFO] Health check at http://localhost:3000/health\");\n});\n</code></pre>"},{"location":"examples/s3-bot/#environment-variables","title":"Environment variables","text":".env<pre><code>REDIS_URL=redis://localhost:6379\nBOT_PREFIX=!\n</code></pre>"},{"location":"examples/s3-bot/#other-engines","title":"Other engines","text":"<p>Check the Engines documentation for examples of PostgreSQL, MongoDB, and others.</p>"},{"location":"references/chat/","title":"Chat","text":"<p>Class for chat management.</p>"},{"location":"references/chat/#import","title":"Import","text":"<p>The Chat class is accessed through the WhatsApp instance:</p> <pre><code>const wa = new WhatsApp();\n// wa.Chat is available after instantiation\n</code></pre>"},{"location":"references/chat/#properties","title":"Properties","text":"<p>Each Chat instance has the following properties:</p> Property Type Description <code>id</code> <code>string</code> Chat ID (JID) <code>name</code> <code>string</code> Chat name <code>type</code> <code>\"contact\" \\| \"group\"</code> Chat type <code>content</code> <code>string</code> Chat/group description <code>pined</code> <code>boolean</code> Pinned chat <code>archived</code> <code>boolean</code> Archived chat <code>muted</code> <code>number \\| false</code> Mute end timestamp or <code>false</code> if unmuted <code>readed</code> <code>boolean</code> If chat is read <code>readonly</code> <code>boolean</code> If chat is read-only"},{"location":"references/chat/#static-methods","title":"Static methods","text":""},{"location":"references/chat/#get","title":"get()","text":"<p>Gets a specific chat.</p> <pre><code>const chat = await wa.Chat.get(cid: string): Promise&lt;Chat | null&gt;\n</code></pre> <p>Example:</p> <pre><code>const chat = await wa.Chat.get(\"5491112345678@s.whatsapp.net\");\nif (chat) {\n  console.log(`Name: ${chat.name}`);\n  console.log(`Type: ${chat.type}`);\n}\n</code></pre>"},{"location":"references/chat/#paginate","title":"paginate()","text":"<p>Gets chats with pagination.</p> <pre><code>const chats = await wa.Chat.paginate(offset?: number, limit?: number): Promise&lt;Chat[]&gt;\n</code></pre> <p>Parameters:</p> Parameter Type Default Description <code>offset</code> <code>number</code> <code>0</code> Starting position <code>limit</code> <code>number</code> <code>50</code> Maximum chats <p>Example:</p> <pre><code>const chats = await wa.Chat.paginate(0, 100);\nfor (const chat of chats) {\n  console.log(`${chat.name} (${chat.type})`);\n}\n</code></pre>"},{"location":"references/chat/#pin","title":"pin()","text":"<p>Pins or unpins a chat.</p> <pre><code>const success = await wa.Chat.pin(cid: string, value: boolean): Promise&lt;boolean&gt;\n</code></pre> <p>Parameters:</p> Parameter Type Description <code>cid</code> <code>string</code> Chat ID <code>value</code> <code>boolean</code> <code>true</code> to pin, <code>false</code> to unpin <p>Example:</p> <pre><code>// Pin\nawait wa.Chat.pin(\"5491112345678@s.whatsapp.net\", true);\n\n// Unpin\nawait wa.Chat.pin(\"5491112345678@s.whatsapp.net\", false);\n</code></pre>"},{"location":"references/chat/#archive","title":"archive()","text":"<p>Archives or unarchives a chat.</p> <pre><code>const success = await wa.Chat.archive(cid: string, value: boolean): Promise&lt;boolean&gt;\n</code></pre> <p>Example:</p> <pre><code>// Archive\nawait wa.Chat.archive(\"5491112345678@s.whatsapp.net\", true);\n\n// Unarchive\nawait wa.Chat.archive(\"5491112345678@s.whatsapp.net\", false);\n</code></pre>"},{"location":"references/chat/#mute","title":"mute()","text":"<p>Mutes or unmutes a chat.</p> <pre><code>const success = await wa.Chat.mute(cid: string, duration: number | null): Promise&lt;boolean&gt;\n</code></pre> <p>Parameters:</p> Parameter Type Description <code>cid</code> <code>string</code> Chat ID <code>duration</code> <code>number \\| null</code> Duration in milliseconds or <code>null</code> to unmute <p>Example:</p> <pre><code>// Mute for 8 hours\nawait wa.Chat.mute(\"5491112345678@s.whatsapp.net\", 8 * 60 * 60 * 1000);\n\n// Unmute\nawait wa.Chat.mute(\"5491112345678@s.whatsapp.net\", null);\n</code></pre>"},{"location":"references/chat/#seen","title":"seen()","text":"<p>Marks a chat as read.</p> <pre><code>const success = await wa.Chat.seen(cid: string): Promise&lt;boolean&gt;\n</code></pre> <p>Example:</p> <pre><code>await wa.Chat.seen(\"5491112345678@s.whatsapp.net\");\n</code></pre>"},{"location":"references/chat/#remove","title":"remove()","text":"<p>Deletes a chat (with cascade delete of all messages).</p> <pre><code>const success = await wa.Chat.remove(cid: string): Promise&lt;boolean&gt;\n</code></pre>"},{"location":"references/chat/#cascade_delete","title":"cascade_delete()","text":"<p>Deletes all chat data from storage without notifying WhatsApp.</p> <pre><code>await wa.Chat.cascade_delete(cid: string): Promise&lt;void&gt;\n</code></pre> <p>Note: This only removes local storage data. Use <code>remove()</code> to also notify WhatsApp.</p>"},{"location":"references/chat/#add_message","title":"add_message()","text":"<p>Adds a message to the chat's message index.</p> <pre><code>await wa.Chat.add_message(cid: string, mid: string, timestamp: number): Promise&lt;void&gt;\n</code></pre>"},{"location":"references/chat/#remove_message","title":"remove_message()","text":"<p>Removes a message from the chat's message index.</p> <pre><code>await wa.Chat.remove_message(cid: string, mid: string): Promise&lt;void&gt;\n</code></pre>"},{"location":"references/chat/#list_messages","title":"list_messages()","text":"<p>Lists message IDs from the chat (paginated).</p> <pre><code>const ids = await wa.Chat.list_messages(cid: string, offset?: number, limit?: number): Promise&lt;string[]&gt;\n</code></pre>"},{"location":"references/chat/#count_messages","title":"count_messages()","text":"<p>Counts messages in a chat.</p> <pre><code>const count = await wa.Chat.count_messages(cid: string): Promise&lt;number&gt;\n</code></pre>"},{"location":"references/chat/#members","title":"members()","text":"<p>Gets members of a group.</p> <pre><code>const members = await wa.Chat.members(\n  cid: string,\n  offset?: number,\n  limit?: number\n): Promise&lt;Contact[]&gt;\n</code></pre> <p>Parameters:</p> Parameter Type Default Description <code>cid</code> <code>string</code> - Group ID <code>offset</code> <code>number</code> <code>0</code> Starting position <code>limit</code> <code>number</code> <code>50</code> Maximum members <p>Example:</p> <pre><code>const members = await wa.Chat.members(\"123456789@g.us\", 0, 100);\nconsole.log(`Members: ${members.length}`);\nfor (const member of members) {\n  console.log(`  - ${member.name}: ${member.phone}`);\n}\n</code></pre>"},{"location":"references/chat/#instance-methods","title":"Instance methods","text":""},{"location":"references/chat/#messages","title":"messages()","text":"<p>Gets messages from this chat with pagination.</p> <pre><code>const messages = await chat.messages(offset?: number, limit?: number): Promise&lt;Message[]&gt;\n</code></pre> <p>Parameters:</p> Parameter Type Default Description <code>offset</code> <code>number</code> <code>0</code> Starting position <code>limit</code> <code>number</code> <code>50</code> Maximum messages <p>Example:</p> <pre><code>const chat = await wa.Chat.get(\"5491112345678@s.whatsapp.net\");\nif (chat) {\n  const messages = await chat.messages(0, 100);\n  for (const msg of messages) {\n    console.log(`${msg.type}: ${msg.caption}`);\n  }\n}\n</code></pre>"},{"location":"references/chat/#chat-types","title":"Chat types","text":""},{"location":"references/chat/#individual-chat","title":"Individual chat","text":"<p>JID format: <code>{phone}@s.whatsapp.net</code></p> <pre><code>const chat = await wa.Chat.get(\"5491112345678@s.whatsapp.net\");\nif (chat?.type === \"contact\") {\n  console.log(\"Individual chat\");\n}\n</code></pre>"},{"location":"references/chat/#group","title":"Group","text":"<p>JID format: <code>{id}@g.us</code></p> <pre><code>const chat = await wa.Chat.get(\"123456789@g.us\");\nif (chat?.type === \"group\") {\n  console.log(\"Group:\", chat.name);\n  const members = await wa.Chat.members(chat.id, 0, 1000);\n  console.log(`Members: ${members.length}`);\n}\n</code></pre>"},{"location":"references/chat/#complete-example","title":"Complete example","text":"<pre><code>// List all archived chats\nwa.event.on(\"chat:created\", async (chat) =&gt; {\n  console.log(`New chat: ${chat.name} (${chat.type})`);\n\n  if (chat.type === \"group\") {\n    const members = await wa.Chat.members(chat.id, 0, 100);\n    console.log(`Group with ${members.length} members`);\n  }\n});\n\n// Auto mark as read\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (!msg.me) {\n    await wa.Chat.seen(msg.cid);\n  }\n});\n\n// Archive old chats\nasync function archive_old_chats() {\n  // Get chat from storage and archive if needed\n  const chat = await wa.Chat.get(\"5491112345678@s.whatsapp.net\");\n  if (chat &amp;&amp; !chat.archived) {\n    await wa.Chat.archive(chat.id, true);\n    console.log(`Archived: ${chat.name}`);\n  }\n}\n</code></pre>"},{"location":"references/contact/","title":"Contact","text":"<p>Class for contact management.</p>"},{"location":"references/contact/#import","title":"Import","text":"<p>The Contact class is accessed through the WhatsApp instance:</p> <pre><code>const wa = new WhatsApp();\n// wa.Contact is available after instantiation\n</code></pre>"},{"location":"references/contact/#properties","title":"Properties","text":"<p>Each Contact instance has the following properties:</p> Property Type Description <code>id</code> <code>string</code> Contact ID (JID) <code>me</code> <code>boolean</code> <code>true</code> if it's the connected account <code>name</code> <code>string</code> Contact name <code>phone</code> <code>string</code> Phone number <code>photo</code> <code>string \\| undefined</code> Profile photo URL"},{"location":"references/contact/#instance-methods","title":"Instance methods","text":""},{"location":"references/contact/#rename","title":"rename()","text":"<p>Renames a contact locally.</p> <pre><code>await contact.rename(name: string): Promise&lt;void&gt;\n</code></pre> <p>Example:</p> <pre><code>const contact = await wa.Contact.get(\"5491112345678@s.whatsapp.net\");\nif (contact) {\n  await contact.rename(\"John Work\");\n}\n</code></pre>"},{"location":"references/contact/#chat","title":"chat()","text":"<p>Gets the chat associated with this contact.</p> <pre><code>const chat = await contact.chat(): Promise&lt;Chat | null&gt;\n</code></pre> <p>Example:</p> <pre><code>const contact = await wa.Contact.get(\"5491112345678@s.whatsapp.net\");\nif (contact) {\n  const chat = await contact.chat();\n  if (chat) {\n    console.log(`Chat with ${contact.name}: ${chat.id}`);\n  }\n}\n</code></pre>"},{"location":"references/contact/#static-methods","title":"Static methods","text":""},{"location":"references/contact/#get","title":"get()","text":"<p>Gets a specific contact.</p> <pre><code>const contact = await wa.Contact.get(jid: string): Promise&lt;Contact | null&gt;\n</code></pre> <p>Example:</p> <pre><code>const contact = await wa.Contact.get(\"5491112345678@s.whatsapp.net\");\nif (contact) {\n  console.log(`Name: ${contact.name}`);\n  console.log(`Phone: ${contact.phone}`);\n  console.log(`Photo: ${contact.photo || \"No photo\"}`);\n}\n</code></pre>"},{"location":"references/contact/#rename_1","title":"rename()","text":"<p>Renames a contact by JID.</p> <pre><code>await wa.Contact.rename(jid: string, name: string): Promise&lt;void&gt;\n</code></pre> <p>Example:</p> <pre><code>await wa.Contact.rename(\"5491112345678@s.whatsapp.net\", \"John Work\");\n</code></pre>"},{"location":"references/contact/#paginate","title":"paginate()","text":"<p>Lists contacts with pagination.</p> <pre><code>const contacts = await wa.Contact.paginate(\n  offset?: number,\n  limit?: number\n): Promise&lt;Contact[]&gt;\n</code></pre> <p>Parameters:</p> Parameter Type Default Description <code>offset</code> <code>number</code> <code>0</code> Starting position <code>limit</code> <code>number</code> <code>50</code> Maximum contacts <p>Example:</p> <pre><code>// Get first 100 contacts\nconst contacts = await wa.Contact.paginate(0, 100);\nconsole.log(`Total contacts: ${contacts.length}`);\n\nfor (const contact of contacts) {\n  console.log(`- ${contact.name}: ${contact.phone}`);\n}\n\n// Paginate\nlet page = 0;\nconst page_size = 50;\nlet all_contacts: Contact[] = [];\n\nwhile (true) {\n  const batch = await wa.Contact.paginate(page * page_size, page_size);\n  if (batch.length === 0) break;\n  all_contacts = [...all_contacts, ...batch];\n  page++;\n}\n</code></pre>"},{"location":"references/contact/#jid-formats","title":"JID formats","text":"<p>WhatsApp uses different JID formats:</p> Format Description Example <code>{phone}@s.whatsapp.net</code> Individual user <code>5491112345678@s.whatsapp.net</code> <code>{id}@g.us</code> Group <code>123456789@g.us</code> <code>{phone}@lid</code> Linked device <code>5491112345678@lid</code>"},{"location":"references/contact/#complete-example","title":"Complete example","text":"<pre><code>// Handle new contacts\nwa.event.on(\"contact:created\", (contact) =&gt; {\n  console.log(`New contact: ${contact.name} (${contact.phone})`);\n});\n\n// Handle contact updates\nwa.event.on(\"contact:updated\", (contact) =&gt; {\n  console.log(`Contact updated: ${contact.name}`);\n});\n\n// Search and rename contact\nasync function organize_contacts() {\n  const contacts = await wa.Contact.paginate(0, 1000);\n\n  for (const contact of contacts) {\n    // Add prefix to contacts without custom name\n    if (contact.name === contact.phone) {\n      await contact.rename(`Contact ${contact.phone}`);\n    }\n  }\n}\n\n// Get contact info when receiving message\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n\n  // Extract phone from JID\n  const phone = msg.cid.split(\"@\")[0];\n  const contact = await wa.Contact.get(msg.cid);\n\n  if (contact) {\n    console.log(`Message from: ${contact.name}`);\n  } else {\n    console.log(`Message from: ${phone} (unknown)`);\n  }\n});\n</code></pre>"},{"location":"references/engines/","title":"Engines","text":"<p>Persistence engines for session, contacts, chats and messages.</p>"},{"location":"references/engines/#engine-interface","title":"Engine interface","text":"<p>All engines must implement the <code>Engine</code> interface:</p> <pre><code>interface Engine {\n  get(key: string): Promise&lt;string | null&gt;;\n  set(key: string, value: string | null): Promise&lt;void&gt;;\n  list(prefix: string, offset?: number, limit?: number): Promise&lt;string[]&gt;;\n}\n</code></pre>"},{"location":"references/engines/#methods","title":"Methods","text":"Method Description <code>get(key)</code> Gets the value for a key. Returns <code>null</code> if not found. <code>set(key, value)</code> Sets a value. If <code>value</code> is <code>null</code>, deletes the key. <code>list(prefix, offset, limit)</code> Lists keys that start with <code>prefix</code>."},{"location":"references/engines/#fileengine","title":"FileEngine","text":"<p>File system based engine. Default.</p>"},{"location":"references/engines/#import","title":"Import","text":"<pre><code>import { FileEngine } from \"@arcaelas/whatsapp\";\n</code></pre>"},{"location":"references/engines/#constructor","title":"Constructor","text":"<pre><code>new FileEngine(base_path?: string)\n</code></pre> Parameter Type Default Description <code>base_path</code> <code>string</code> <code>\".baileys/default\"</code> Base directory"},{"location":"references/engines/#example","title":"Example","text":"<pre><code>import { WhatsApp, FileEngine } from \"@arcaelas/whatsapp\";\n\nconst wa = new WhatsApp({\n  engine: new FileEngine(\".baileys/my-bot\"),\n});\n</code></pre>"},{"location":"references/engines/#file-structure","title":"File structure","text":"<pre><code>.baileys/my-bot/\n  session/\n    creds/index           # Credentials\n    keys/index            # Encryption keys\n  contact/\n    5491112345678_at_s.whatsapp.net/index\n  chat/\n    5491112345678_at_s.whatsapp.net/\n      index               # Chat metadata\n      message/\n        index             # Message index\n        {mid}/\n          index           # Message metadata\n          content         # Binary content\n</code></pre>"},{"location":"references/engines/#custom-engine","title":"Custom Engine","text":"<p>You can implement your own engine for any storage:</p>"},{"location":"references/engines/#redis-example","title":"Redis example","text":"<pre><code>import type { Engine } from \"@arcaelas/whatsapp\";\nimport { createClient } from \"redis\";\n\nexport class RedisEngine implements Engine {\n  private client: ReturnType&lt;typeof createClient&gt;;\n\n  constructor(url: string) {\n    this.client = createClient({ url });\n  }\n\n  async connect() {\n    await this.client.connect();\n  }\n\n  async get(key: string): Promise&lt;string | null&gt; {\n    return await this.client.get(key);\n  }\n\n  async set(key: string, value: string | null): Promise&lt;void&gt; {\n    if (value === null) {\n      await this.client.del(key);\n    } else {\n      await this.client.set(key, value);\n    }\n  }\n\n  async list(prefix: string, offset = 0, limit = 50): Promise&lt;string[]&gt; {\n    const keys = await this.client.keys(`${prefix}*`);\n    return keys.slice(offset, offset + limit);\n  }\n}\n\n// Usage\nconst engine = new RedisEngine(\"redis://localhost:6379\");\nawait engine.connect();\n\nconst wa = new WhatsApp({ engine });\n</code></pre>"},{"location":"references/engines/#postgresql-example","title":"PostgreSQL example","text":"<pre><code>import type { Engine } from \"@arcaelas/whatsapp\";\nimport { Pool } from \"pg\";\n\nexport class PostgresEngine implements Engine {\n  private pool: Pool;\n\n  constructor(connection_string: string) {\n    this.pool = new Pool({ connectionString: connection_string });\n  }\n\n  async init() {\n    await this.pool.query(`\n      CREATE TABLE IF NOT EXISTS whatsapp_store (\n        key TEXT PRIMARY KEY,\n        value TEXT NOT NULL,\n        updated_at TIMESTAMP DEFAULT NOW()\n      )\n    `);\n  }\n\n  async get(key: string): Promise&lt;string | null&gt; {\n    const result = await this.pool.query(\n      \"SELECT value FROM whatsapp_store WHERE key = $1\",\n      [key]\n    );\n    return result.rows[0]?.value ?? null;\n  }\n\n  async set(key: string, value: string | null): Promise&lt;void&gt; {\n    if (value === null) {\n      await this.pool.query(\n        \"DELETE FROM whatsapp_store WHERE key = $1\",\n        [key]\n      );\n    } else {\n      await this.pool.query(\n        `INSERT INTO whatsapp_store (key, value, updated_at)\n         VALUES ($1, $2, NOW())\n         ON CONFLICT (key) DO UPDATE SET value = $2, updated_at = NOW()`,\n        [key, value]\n      );\n    }\n  }\n\n  async list(prefix: string, offset = 0, limit = 50): Promise&lt;string[]&gt; {\n    const result = await this.pool.query(\n      `SELECT key FROM whatsapp_store\n       WHERE key LIKE $1\n       ORDER BY key\n       OFFSET $2 LIMIT $3`,\n      [`${prefix}%`, offset, limit]\n    );\n    return result.rows.map(row =&gt; row.key);\n  }\n}\n\n// Usage\nconst engine = new PostgresEngine(process.env.DATABASE_URL!);\nawait engine.init();\n\nconst wa = new WhatsApp({ engine });\n</code></pre>"},{"location":"references/engines/#memory-example-for-testing","title":"Memory example (for testing)","text":"<pre><code>import type { Engine } from \"@arcaelas/whatsapp\";\n\nexport class MemoryEngine implements Engine {\n  private store = new Map&lt;string, string&gt;();\n\n  async get(key: string): Promise&lt;string | null&gt; {\n    return this.store.get(key) ?? null;\n  }\n\n  async set(key: string, value: string | null): Promise&lt;void&gt; {\n    if (value === null) {\n      this.store.delete(key);\n    } else {\n      this.store.set(key, value);\n    }\n  }\n\n  async list(prefix: string, offset = 0, limit = 50): Promise&lt;string[]&gt; {\n    const keys = Array.from(this.store.keys())\n      .filter(k =&gt; k.startsWith(prefix));\n    return keys.slice(offset, offset + limit);\n  }\n\n  clear() {\n    this.store.clear();\n  }\n}\n\n// Usage\nconst wa = new WhatsApp({\n  engine: new MemoryEngine(),\n});\n</code></pre>"},{"location":"references/engines/#implementation-considerations","title":"Implementation considerations","text":""},{"location":"references/engines/#key-structure","title":"Key structure","text":"<p>The library uses a hierarchical key structure:</p> <pre><code>session/{type}/index          # Session data\ncontact/{jid}/index           # Contact data\nchat/{jid}/index              # Chat metadata\nchat/{jid}/message/index      # Message index\nchat/{jid}/message/{mid}/index    # Message metadata\nchat/{jid}/message/{mid}/content  # Binary content\n</code></pre>"},{"location":"references/engines/#jid-normalization","title":"JID normalization","text":"<p>JIDs contain <code>@</code> which may be problematic for some storage systems. FileEngine replaces <code>@</code> with <code>_at_</code>:</p> <pre><code>// 5491112345678@s.whatsapp.net \u2192 5491112345678_at_s.whatsapp.net\n</code></pre> <p>Your engine can handle JIDs as-is if your storage supports it.</p>"},{"location":"references/engines/#binary-content","title":"Binary content","text":"<p>Messages may have binary content (images, videos, audio). The <code>content</code> key stores raw binary encoded as base64 string.</p>"},{"location":"references/engines/#atomicity","title":"Atomicity","text":"<p>For production systems, consider implementing atomic operations, especially for <code>set()</code> which may be called multiple times during message processing.</p>"},{"location":"references/events/","title":"Events","text":"<p>Complete list of events emitted by WhatsApp.</p>"},{"location":"references/events/#event-handling","title":"Event handling","text":"<p>Events are accessed through <code>wa.event</code>:</p> <pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\n\nconst wa = new WhatsApp();\n\n// Subscribe to event\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  console.log(\"New message:\", msg.id);\n});\n\n// Subscribe once\nwa.event.once(\"open\", () =&gt; {\n  console.log(\"First connection!\");\n});\n\n// Remove listener\nconst handler = (msg: Message) =&gt; console.log(msg);\nwa.event.on(\"message:created\", handler);\nwa.event.off(\"message:created\", handler);\n</code></pre>"},{"location":"references/events/#connection-events","title":"Connection events","text":""},{"location":"references/events/#open","title":"open","text":"<p>Emitted when connection is established.</p> <pre><code>wa.event.on(\"open\", () =&gt; {\n  console.log(\"Connected to WhatsApp\");\n});\n</code></pre> <p>Payload: <code>void</code></p>"},{"location":"references/events/#close","title":"close","text":"<p>Emitted when connection is closed.</p> <pre><code>wa.event.on(\"close\", () =&gt; {\n  console.log(\"Disconnected from WhatsApp\");\n});\n</code></pre> <p>Payload: <code>void</code></p>"},{"location":"references/events/#error","title":"error","text":"<p>Emitted on connection error.</p> <pre><code>wa.event.on(\"error\", (error) =&gt; {\n  console.error(\"Connection error:\", error.message);\n});\n</code></pre> <p>Payload: <code>Error</code></p>"},{"location":"references/events/#contact-events","title":"Contact events","text":""},{"location":"references/events/#contactcreated","title":"contact:created","text":"<p>Emitted when a new contact is added.</p> <pre><code>wa.event.on(\"contact:created\", (contact) =&gt; {\n  console.log(`New contact: ${contact.name}`);\n  console.log(`Phone: ${contact.phone}`);\n});\n</code></pre> <p>Payload: <code>Contact</code></p>"},{"location":"references/events/#contactupdated","title":"contact:updated","text":"<p>Emitted when a contact is updated.</p> <pre><code>wa.event.on(\"contact:updated\", (contact) =&gt; {\n  console.log(`Contact updated: ${contact.name}`);\n});\n</code></pre> <p>Payload: <code>Contact</code></p>"},{"location":"references/events/#contactdeleted","title":"contact:deleted","text":"<p>Emitted when a contact is deleted.</p> <pre><code>wa.event.on(\"contact:deleted\", (contact) =&gt; {\n  console.log(`Contact deleted: ${contact.id}`);\n});\n</code></pre> <p>Payload: <code>Contact</code></p>"},{"location":"references/events/#chat-events","title":"Chat events","text":""},{"location":"references/events/#chatcreated","title":"chat:created","text":"<p>Emitted when a new chat is created.</p> <pre><code>wa.event.on(\"chat:created\", (chat) =&gt; {\n  console.log(`New chat: ${chat.name}`);\n  console.log(`Type: ${chat.type}`);\n\n  if (chat.type === \"group\") {\n    console.log(\"New group!\");\n  }\n});\n</code></pre> <p>Payload: <code>Chat</code></p>"},{"location":"references/events/#chatupdated","title":"chat:updated","text":"<p>Emitted when a chat is updated.</p> <pre><code>wa.event.on(\"chat:updated\", (chat) =&gt; {\n  console.log(`Chat updated: ${chat.name}`);\n\n  if (chat.archived) {\n    console.log(\"Chat was archived\");\n  }\n\n  if (chat.muted &gt; 0) {\n    console.log(`Muted until: ${new Date(chat.muted)}`);\n  }\n});\n</code></pre> <p>Payload: <code>Chat</code></p>"},{"location":"references/events/#chatdeleted","title":"chat:deleted","text":"<p>Emitted when a chat is deleted.</p> <pre><code>wa.event.on(\"chat:deleted\", (cid) =&gt; {\n  console.log(`Chat deleted: ${cid}`);\n});\n</code></pre> <p>Payload: <code>string</code> (chat ID)</p>"},{"location":"references/events/#message-events","title":"Message events","text":""},{"location":"references/events/#messagecreated","title":"message:created","text":"<p>Emitted when a new message is received or sent.</p> <pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  // Ignore own messages\n  if (msg.me) return;\n\n  console.log(`New message: ${msg.type}`);\n  console.log(`From: ${msg.cid}`);\n  console.log(`ID: ${msg.id}`);\n\n  if (msg.type === \"text\") {\n    const text = (await msg.content()).toString();\n    console.log(`Text: ${text}`);\n  }\n});\n</code></pre> <p>Payload: <code>Message</code></p>"},{"location":"references/events/#messageupdated","title":"message:updated","text":"<p>Emitted when a message is updated (status change, edited, etc.).</p> <pre><code>wa.event.on(\"message:updated\", (msg) =&gt; {\n  console.log(`Message updated: ${msg.id}`);\n  console.log(`New status: ${msg.status}`);\n\n  if (msg.edited) {\n    console.log(\"Message was edited\");\n  }\n});\n</code></pre> <p>Payload: <code>Message</code></p>"},{"location":"references/events/#messagedeleted","title":"message:deleted","text":"<p>Emitted when a message is deleted.</p> <pre><code>wa.event.on(\"message:deleted\", (cid, mid) =&gt; {\n  console.log(`Message deleted: ${mid}`);\n  console.log(`From chat: ${cid}`);\n});\n</code></pre> <p>Payload: <code>[cid: string, mid: string]</code></p>"},{"location":"references/events/#messagereacted","title":"message:reacted","text":"<p>Emitted when a message receives a reaction.</p> <pre><code>wa.event.on(\"message:reacted\", (cid, mid, emoji) =&gt; {\n  console.log(`Reaction ${emoji} on message ${mid} in chat ${cid}`);\n});\n</code></pre> <p>Payload: <code>[cid: string, mid: string, emoji: string]</code></p>"},{"location":"references/events/#whatsappeventmap-interface","title":"WhatsAppEventMap interface","text":"<pre><code>interface WhatsAppEventMap {\n  open: [];\n  close: [];\n  error: [error: Error];\n  \"contact:created\": [contact: Contact];\n  \"contact:updated\": [contact: Contact];\n  \"contact:deleted\": [contact: Contact];\n  \"chat:created\": [chat: Chat];\n  \"chat:updated\": [chat: Chat];\n  \"chat:deleted\": [cid: string];\n  \"message:created\": [message: Message];\n  \"message:updated\": [message: Message];\n  \"message:deleted\": [cid: string, mid: string];\n  \"message:reacted\": [cid: string, mid: string, emoji: string];\n}\n</code></pre>"},{"location":"references/events/#complete-example","title":"Complete example","text":"<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\n\nasync function main() {\n  const wa = new WhatsApp();\n\n  // Connection events\n  wa.event.on(\"open\", () =&gt; {\n    console.log(\"[CONNECTED]\");\n  });\n\n  wa.event.on(\"close\", () =&gt; {\n    console.log(\"[DISCONNECTED]\");\n  });\n\n  wa.event.on(\"error\", (error) =&gt; {\n    console.error(\"[ERROR]\", error.message);\n  });\n\n  // Contact events\n  wa.event.on(\"contact:created\", (contact) =&gt; {\n    console.log(`[CONTACT+] ${contact.name}`);\n  });\n\n  wa.event.on(\"contact:updated\", (contact) =&gt; {\n    console.log(`[CONTACT~] ${contact.name}`);\n  });\n\n  // Chat events\n  wa.event.on(\"chat:created\", async (chat) =&gt; {\n    console.log(`[CHAT+] ${chat.name} (${chat.type})`);\n\n    if (chat.type === \"group\") {\n      const members = await wa.Chat.members(chat.id, 0, 100);\n      console.log(`  Members: ${members.length}`);\n    }\n  });\n\n  wa.event.on(\"chat:updated\", (chat) =&gt; {\n    const flags = [];\n    if (chat.pined) flags.push(\"pinned\");\n    if (chat.archived) flags.push(\"archived\");\n    if (chat.muted &gt; 0) flags.push(\"muted\");\n\n    console.log(`[CHAT~] ${chat.name} [${flags.join(\", \")}]`);\n  });\n\n  // Message events\n  wa.event.on(\"message:created\", async (msg) =&gt; {\n    const direction = msg.me ? \"\u2192\" : \"\u2190\";\n    console.log(`[MSG${direction}] ${msg.type} in ${msg.cid}`);\n\n    if (!msg.me &amp;&amp; msg.type === \"text\") {\n      const text = (await msg.content()).toString();\n\n      if (text.toLowerCase() === \"ping\") {\n        await wa.Message.text(msg.cid, \"pong!\");\n      }\n    }\n  });\n\n  wa.event.on(\"message:updated\", (msg) =&gt; {\n    const status_names = [\"PENDING\", \"SENT\", \"RECEIVED\", \"READ\", \"PLAYED\"];\n    console.log(`[MSG~] ${msg.id} \u2192 ${status_names[msg.status]}`);\n  });\n\n  // Connect\n  await wa.pair(async (data) =&gt; {\n    if (Buffer.isBuffer(data)) {\n      require(\"fs\").writeFileSync(\"qr.png\", data);\n      console.log(\"Scan qr.png\");\n    }\n  });\n\n  console.log(\"Bot ready - listening to events...\");\n}\n\nmain().catch(console.error);\n</code></pre>"},{"location":"references/message/","title":"Message","text":"<p>Class for message handling and sending.</p>"},{"location":"references/message/#import","title":"Import","text":"<p>The Message class is accessed through the WhatsApp instance:</p> <pre><code>const wa = new WhatsApp();\n// wa.Message is available after instantiation\n</code></pre>"},{"location":"references/message/#properties","title":"Properties","text":"<p>Each Message instance has the following properties:</p> Property Type Description <code>id</code> <code>string</code> Unique message ID <code>cid</code> <code>string</code> Chat ID (JID) <code>mid</code> <code>string \\| null</code> Parent message ID (for replies) <code>me</code> <code>boolean</code> <code>true</code> if sent by the connected account <code>author</code> <code>string</code> Message author JID <code>type</code> <code>MessageType</code> Message type <code>mime</code> <code>string</code> MIME type for media <code>caption</code> <code>string</code> Caption/text content <code>status</code> <code>MESSAGE_STATUS</code> Message status <code>starred</code> <code>boolean</code> Starred message <code>forwarded</code> <code>boolean</code> Forwarded message <code>edited</code> <code>boolean</code> Edited message <code>created_at</code> <code>number</code> Creation timestamp (ms) <code>deleted_at</code> <code>number \\| null</code> Expiration timestamp (ms) for ephemeral messages"},{"location":"references/message/#messagetype","title":"MessageType","text":"<pre><code>type MessageType = \"text\" | \"image\" | \"video\" | \"audio\" | \"location\" | \"poll\";\n</code></pre>"},{"location":"references/message/#message_status","title":"MESSAGE_STATUS","text":"<pre><code>enum MESSAGE_STATUS {\n  ERROR = 0,\n  PENDING = 1,\n  SERVER_ACK = 2,\n  DELIVERED = 3,\n  READ = 4,\n  PLAYED = 5\n}\n</code></pre>"},{"location":"references/message/#instance-methods","title":"Instance methods","text":""},{"location":"references/message/#content","title":"content()","text":"<p>Gets the message content as Buffer.</p> <pre><code>const buffer = await msg.content(): Promise&lt;Buffer&gt;\n</code></pre> <p>Returns: <code>Promise&lt;Buffer&gt;</code> - Message content</p> <p>Example:</p> <pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  const buffer = await msg.content();\n\n  if (msg.type === \"text\") {\n    console.log(\"Text:\", buffer.toString());\n  }\n\n  if (msg.type === \"image\") {\n    require(\"fs\").writeFileSync(\"image.jpg\", buffer);\n  }\n});\n</code></pre>"},{"location":"references/message/#static-methods","title":"Static methods","text":""},{"location":"references/message/#get","title":"get()","text":"<p>Gets a specific message.</p> <pre><code>const msg = await wa.Message.get(cid: string, mid: string): Promise&lt;Message | null&gt;\n</code></pre> <p>Parameters:</p> Parameter Type Description <code>cid</code> <code>string</code> Chat ID <code>mid</code> <code>string</code> Message ID"},{"location":"references/message/#text","title":"text()","text":"<p>Sends a text message.</p> <pre><code>const msg = await wa.Message.text(\n  cid: string,\n  text: string\n): Promise&lt;Message | null&gt;\n</code></pre> <p>Parameters:</p> Parameter Type Description <code>cid</code> <code>string</code> Chat ID <code>text</code> <code>string</code> Message text <p>Example:</p> <pre><code>await wa.Message.text(\"5491112345678@s.whatsapp.net\", \"Hello!\");\n</code></pre>"},{"location":"references/message/#image","title":"image()","text":"<p>Sends an image.</p> <pre><code>const msg = await wa.Message.image(\n  cid: string,\n  buffer: Buffer,\n  caption?: string\n): Promise&lt;Message | null&gt;\n</code></pre> <p>Example:</p> <pre><code>const img = require(\"fs\").readFileSync(\"photo.jpg\");\nawait wa.Message.image(\"5491112345678@s.whatsapp.net\", img, \"Check this out!\");\n</code></pre>"},{"location":"references/message/#video","title":"video()","text":"<p>Sends a video.</p> <pre><code>const msg = await wa.Message.video(\n  cid: string,\n  buffer: Buffer,\n  caption?: string\n): Promise&lt;Message | null&gt;\n</code></pre> <p>Example:</p> <pre><code>const vid = require(\"fs\").readFileSync(\"video.mp4\");\nawait wa.Message.video(\"5491112345678@s.whatsapp.net\", vid, \"Interesting video\");\n</code></pre>"},{"location":"references/message/#audio","title":"audio()","text":"<p>Sends an audio (voice note).</p> <pre><code>const msg = await wa.Message.audio(\n  cid: string,\n  buffer: Buffer,\n  ptt?: boolean\n): Promise&lt;Message | null&gt;\n</code></pre> <p>Parameters:</p> Parameter Type Default Description <code>cid</code> <code>string</code> - Chat ID <code>buffer</code> <code>Buffer</code> - Audio data <code>ptt</code> <code>boolean</code> <code>true</code> Push-to-talk (voice note) <p>Example:</p> <pre><code>const audio = require(\"fs\").readFileSync(\"audio.ogg\");\nawait wa.Message.audio(\"5491112345678@s.whatsapp.net\", audio);\n\n// Normal audio (not voice note)\nawait wa.Message.audio(\"5491112345678@s.whatsapp.net\", audio, false);\n</code></pre>"},{"location":"references/message/#location","title":"location()","text":"<p>Sends a location.</p> <pre><code>const msg = await wa.Message.location(\n  cid: string,\n  coords: { lat: number; lng: number }\n): Promise&lt;Message | null&gt;\n</code></pre> <p>Example:</p> <pre><code>await wa.Message.location(\"5491112345678@s.whatsapp.net\", {\n  lat: -34.6037,\n  lng: -58.3816\n});\n</code></pre>"},{"location":"references/message/#poll","title":"poll()","text":"<p>Creates a poll.</p> <pre><code>const msg = await wa.Message.poll(\n  cid: string,\n  poll: PollOptions\n): Promise&lt;Message | null&gt;\n</code></pre> <p>PollOptions:</p> <pre><code>interface PollOptions {\n  content: string;\n  options: Array&lt;{ content: string }&gt;;\n}\n</code></pre> <p>Example:</p> <pre><code>await wa.Message.poll(\"123456789@g.us\", {\n  content: \"What should we eat?\",\n  options: [\n    { content: \"Pizza\" },\n    { content: \"Sushi\" },\n    { content: \"Burger\" }\n  ]\n});\n</code></pre>"},{"location":"references/message/#react","title":"react()","text":"<p>Reacts to a message.</p> <pre><code>const success = await wa.Message.react(\n  cid: string,\n  mid: string,\n  emoji: string\n): Promise&lt;boolean&gt;\n</code></pre> <p>Example:</p> <pre><code>// Add reaction\nawait wa.Message.react(msg.cid, msg.id, \"\ud83d\udc4d\");\n\n// Remove reaction\nawait wa.Message.react(msg.cid, msg.id, \"\");\n</code></pre>"},{"location":"references/message/#remove","title":"remove()","text":"<p>Deletes a message.</p> <pre><code>const success = await wa.Message.remove(cid: string, mid: string): Promise&lt;boolean&gt;\n</code></pre>"},{"location":"references/message/#forward","title":"forward()","text":"<p>Forwards a message to another chat.</p> <pre><code>const success = await wa.Message.forward(\n  cid: string,\n  mid: string,\n  to_cid: string\n): Promise&lt;boolean&gt;\n</code></pre> <p>Parameters:</p> Parameter Type Description <code>cid</code> <code>string</code> Original chat ID <code>mid</code> <code>string</code> Message ID to forward <code>to_cid</code> <code>string</code> Destination chat ID"},{"location":"references/message/#edit","title":"edit()","text":"<p>Edits a text message.</p> <pre><code>const success = await wa.Message.edit(\n  cid: string,\n  mid: string,\n  text: string\n): Promise&lt;boolean&gt;\n</code></pre> <p>Limitation</p> <p>You can only edit your own messages.</p>"},{"location":"references/message/#watch","title":"watch()","text":"<p>Observes changes on a specific message.</p> <pre><code>const unsubscribe = wa.Message.watch(\n  cid: string,\n  mid: string,\n  handler: (msg: Message) =&gt; void\n): () =&gt; void\n</code></pre> <p>Parameters:</p> Parameter Type Description <code>cid</code> <code>string</code> Chat ID <code>mid</code> <code>string</code> Message ID <code>handler</code> <code>(msg: Message) =&gt; void</code> Callback called when message changes <p>Returns: <code>() =&gt; void</code> - Unsubscribe function</p> <p>Example:</p> <pre><code>const unsubscribe = wa.Message.watch(msg.cid, msg.id, (updated) =&gt; {\n  console.log(`Message status: ${updated.status}`);\n});\n\n// Stop watching\nunsubscribe();\n</code></pre>"},{"location":"references/message/#notify","title":"notify()","text":"<p>Notifies watchers of a message update (internal use).</p> <pre><code>wa.Message.notify(cid: string, mid: string): void\n</code></pre>"},{"location":"references/message/#complete-example","title":"Complete example","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n\n  // Handle text\n  if (msg.type === \"text\") {\n    const text = (await msg.content()).toString();\n    console.log(`Text: ${text}`);\n\n    if (text === \"!ping\") {\n      await wa.Message.text(msg.cid, \"pong!\");\n    }\n  }\n\n  // Handle images\n  if (msg.type === \"image\") {\n    const buffer = await msg.content();\n    console.log(`Image: ${buffer.length} bytes`);\n\n    // Reply with reaction\n    await wa.Message.react(msg.cid, msg.id, \"\ud83d\udc4d\");\n  }\n\n  // Handle polls\n  if (msg.type === \"poll\") {\n    const buffer = await msg.content();\n    const poll = JSON.parse(buffer.toString());\n    console.log(`Poll: ${poll.content}`);\n  }\n});\n</code></pre>"},{"location":"references/whatsapp/","title":"WhatsApp","text":"<p>Main class for WhatsApp connection and management.</p>"},{"location":"references/whatsapp/#import","title":"Import","text":"<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\n</code></pre>"},{"location":"references/whatsapp/#constructor","title":"Constructor","text":"<pre><code>const wa = new WhatsApp(options?: WhatsAppOptions);\n</code></pre>"},{"location":"references/whatsapp/#options","title":"Options","text":"Property Type Default Description <code>engine</code> <code>Engine</code> <code>FileEngine(\".baileys/default\")</code> Persistence engine <code>phone</code> <code>string</code> <code>undefined</code> Phone number for pairing code"},{"location":"references/whatsapp/#examples","title":"Examples","text":"<pre><code>// Default (FileEngine)\nconst wa = new WhatsApp();\n\n// Custom path\nimport { FileEngine } from \"@arcaelas/whatsapp\";\nconst wa = new WhatsApp({\n  engine: new FileEngine(\".baileys/my-bot\"),\n});\n\n// With phone for pairing code\nconst wa = new WhatsApp({\n  phone: \"5491112345678\",\n});\n</code></pre>"},{"location":"references/whatsapp/#properties","title":"Properties","text":""},{"location":"references/whatsapp/#engine","title":"engine","text":"<pre><code>wa.engine: Engine\n</code></pre> <p>The persistence engine used.</p>"},{"location":"references/whatsapp/#socket","title":"socket","text":"<pre><code>wa.socket: WASocket | null\n</code></pre> <p>The Baileys socket. <code>null</code> before connecting.</p>"},{"location":"references/whatsapp/#event","title":"event","text":"<pre><code>wa.event: TypedEventEmitter&lt;WhatsAppEventMap&gt;\n</code></pre> <p>Typed event emitter for all WhatsApp events.</p>"},{"location":"references/whatsapp/#chat","title":"Chat","text":"<pre><code>wa.Chat: typeof Chat\n</code></pre> <p>Chat class bound to this instance.</p>"},{"location":"references/whatsapp/#contact","title":"Contact","text":"<pre><code>wa.Contact: typeof Contact\n</code></pre> <p>Contact class bound to this instance.</p>"},{"location":"references/whatsapp/#message","title":"Message","text":"<pre><code>wa.Message: typeof Message\n</code></pre> <p>Message class bound to this instance.</p>"},{"location":"references/whatsapp/#methods","title":"Methods","text":""},{"location":"references/whatsapp/#pair","title":"pair()","text":"<p>Connects to WhatsApp and calls the callback with QR or pairing code.</p> <pre><code>await wa.pair(callback: (data: Buffer | string) =&gt; void | Promise&lt;void&gt;): Promise&lt;void&gt;\n</code></pre> <p>Parameters:</p> Parameter Type Description <code>callback</code> <code>(data: Buffer \\| string) =&gt; void</code> Called with QR (Buffer) or code (string) <p>Example:</p> <pre><code>await wa.pair(async (data) =&gt; {\n  if (Buffer.isBuffer(data)) {\n    // QR as PNG image\n    require(\"fs\").writeFileSync(\"qr.png\", data);\n    console.log(\"Scan QR code\");\n  } else {\n    // 8 digit pairing code\n    console.log(\"Enter code:\", data);\n  }\n});\n</code></pre>"},{"location":"references/whatsapp/#events","title":"Events","text":"<p>Events are accessed through <code>wa.event</code>:</p> <pre><code>wa.event.on(\"event_name\", (payload) =&gt; {\n  // handle event\n});\n</code></pre>"},{"location":"references/whatsapp/#connection-events","title":"Connection events","text":"Event Payload Description <code>open</code> <code>void</code> Connection established <code>close</code> <code>void</code> Connection closed <code>error</code> <code>Error</code> Connection error"},{"location":"references/whatsapp/#data-events","title":"Data events","text":"Event Payload Description <code>contact:created</code> <code>Contact</code> New contact <code>contact:updated</code> <code>Contact</code> Contact updated <code>contact:deleted</code> <code>Contact</code> Contact deleted <code>chat:created</code> <code>Chat</code> New chat <code>chat:updated</code> <code>Chat</code> Chat updated <code>chat:deleted</code> <code>string</code> Chat deleted (cid) <code>message:created</code> <code>Message</code> New message <code>message:updated</code> <code>Message</code> Message updated <code>message:deleted</code> <code>[string, string]</code> Message deleted (cid, mid) <code>message:reacted</code> <code>[string, string, string]</code> Reaction (cid, mid, emoji)"},{"location":"references/whatsapp/#examples_1","title":"Examples","text":"<pre><code>// Connection\nwa.event.on(\"open\", () =&gt; {\n  console.log(\"Connected to WhatsApp\");\n});\n\nwa.event.on(\"close\", () =&gt; {\n  console.log(\"Disconnected\");\n});\n\nwa.event.on(\"error\", (error) =&gt; {\n  console.error(\"Error:\", error.message);\n});\n\n// Messages\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n  console.log(`New message: ${msg.type}`);\n});\n\n// Chats\nwa.event.on(\"chat:updated\", (chat) =&gt; {\n  console.log(`Chat updated: ${chat.name}`);\n});\n</code></pre>"},{"location":"references/whatsapp/#complete-example","title":"Complete example","text":"<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\n\nasync function main() {\n  const wa = new WhatsApp();\n\n  // Events\n  wa.event.on(\"open\", () =&gt; console.log(\"Connected\"));\n  wa.event.on(\"close\", () =&gt; console.log(\"Disconnected\"));\n  wa.event.on(\"error\", (e) =&gt; console.error(\"Error:\", e.message));\n\n  // Messages\n  wa.event.on(\"message:created\", async (msg) =&gt; {\n    if (msg.me || msg.type !== \"text\") return;\n\n    const text = (await msg.content()).toString();\n\n    if (text.toLowerCase() === \"ping\") {\n      await wa.Message.text(msg.cid, \"pong!\");\n    }\n  });\n\n  // Connect\n  await wa.pair(async (data) =&gt; {\n    if (Buffer.isBuffer(data)) {\n      require(\"fs\").writeFileSync(\"qr.png\", data);\n      console.log(\"Scan qr.png\");\n    } else {\n      console.log(\"Code:\", data);\n    }\n  });\n\n  console.log(\"Bot ready!\");\n}\n\nmain().catch(console.error);\n</code></pre>"},{"location":"es/","title":"@arcaelas/whatsapp","text":"<p>Libreria TypeScript para automatizacion de WhatsApp Basada en Baileys | Tipado completo | Engine de persistencia flexible | Facil de usar</p>"},{"location":"es/#caracteristicas","title":"Caracteristicas","text":"<ul> <li>Conexion simplificada - QR o codigo de emparejamiento en una sola llamada</li> <li>Eventos tipados - TypeScript completo con autocompletado</li> <li>Persistencia flexible - FileEngine por defecto, o implementa tu propio Engine</li> <li>Clases intuitivas - Chat, Contact, Message con metodos estaticos</li> <li>Multiples tipos de mensaje - text, image, video, audio, location, poll</li> <li>Gestion de grupos - Listar miembros, archivar, silenciar, fijar</li> <li>Soporte de encuestas - Crear encuestas con multiples opciones</li> </ul>"},{"location":"es/#inicio-rapido","title":"Inicio Rapido","text":"<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\n\n// Crear instancia\nconst wa = new WhatsApp({\n  phone: \"5491112345678\", // Opcional: para codigo de emparejamiento\n});\n\n// Escuchar eventos\nwa.event.on(\"open\", () =&gt; console.log(\"Conectado!\"));\nwa.event.on(\"close\", () =&gt; console.log(\"Desconectado\"));\nwa.event.on(\"error\", (err) =&gt; console.error(\"Error:\", err.message));\n\n// Conectar\nawait wa.pair(async (data) =&gt; {\n  if (Buffer.isBuffer(data)) {\n    // QR code como imagen PNG\n    require(\"fs\").writeFileSync(\"qr.png\", data);\n    console.log(\"Escanea el QR en qr.png\");\n  } else {\n    // Codigo de emparejamiento (8 digitos)\n    console.log(\"Codigo:\", data);\n  }\n});\n\n// Escuchar mensajes\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return; // Ignorar mensajes propios\n\n  // Verificar tipo\n  if (msg.type === \"text\") {\n    const text = (await msg.content()).toString();\n    console.log(`Mensaje: ${text}`);\n\n    // Responder\n    if (text.toLowerCase() === \"hola\") {\n      await wa.Message.text(msg.cid, \"Hola! Como estas?\");\n    }\n  }\n});\n</code></pre>"},{"location":"es/#tipos-de-mensaje","title":"Tipos de Mensaje","text":"<p>La libreria soporta multiples tipos de mensaje:</p> Tipo <code>msg.type</code> Descripcion Texto <code>\"text\"</code> Mensaje de texto plano Imagen <code>\"image\"</code> Imagen con caption opcional Video <code>\"video\"</code> Video con caption opcional Audio <code>\"audio\"</code> Nota de voz o audio Ubicacion <code>\"location\"</code> Coordenadas geograficas Encuesta <code>\"poll\"</code> Encuesta con opciones <pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n\n  if (msg.type === \"image\") {\n    const buffer = await msg.content();\n    console.log(`Imagen recibida: ${buffer.length} bytes`);\n    if (msg.caption) {\n      console.log(`Caption: ${msg.caption}`);\n    }\n  }\n\n  if (msg.type === \"poll\") {\n    const buffer = await msg.content();\n    const poll = JSON.parse(buffer.toString());\n    console.log(`Encuesta: ${poll.content}`);\n    poll.options.forEach((opt: { content: string }, i: number) =&gt; {\n      console.log(`  ${i + 1}. ${opt.content}`);\n    });\n  }\n});\n</code></pre>"},{"location":"es/#engine-de-persistencia","title":"Engine de Persistencia","text":"<p>Por defecto se usa <code>FileEngine</code>. Puedes implementar tu propio engine:</p> FileEngine (default)Engine personalizado <pre><code>import { WhatsApp, FileEngine } from \"@arcaelas/whatsapp\";\n\nconst wa = new WhatsApp({\n  engine: new FileEngine(\".baileys/mi-bot\"),\n});\n</code></pre> <pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\nimport type { Engine } from \"@arcaelas/whatsapp\";\n\n// Implementa la interfaz Engine\nclass RedisEngine implements Engine {\n  async get(key: string): Promise&lt;string | null&gt; { /* ... */ }\n  async set(key: string, value: string | null): Promise&lt;void&gt; { /* ... */ }\n  async list(prefix: string, offset?: number, limit?: number): Promise&lt;string[]&gt; { /* ... */ }\n}\n\nconst wa = new WhatsApp({\n  engine: new RedisEngine(),\n});\n</code></pre>"},{"location":"es/#siguiente-paso","title":"Siguiente Paso","text":"<ul> <li> <p> Instalacion</p> <p>Instrucciones detalladas para instalar la libreria</p> <p> Ver guia</p> </li> <li> <p> Primeros Pasos</p> <p>Tutorial paso a paso para crear tu primer bot</p> <p> Comenzar</p> </li> <li> <p> Referencias API</p> <p>Documentacion completa de todas las clases</p> <p> Ver API</p> </li> <li> <p> Ejemplos</p> <p>Ejemplos practicos listos para usar</p> <p> Ver ejemplos</p> </li> </ul> <p>Desarrollado por Arcaelas Insiders</p>"},{"location":"es/getting-started/","title":"Primeros Pasos","text":"<p>Este tutorial te guiara paso a paso para crear tu primer bot de WhatsApp.</p>"},{"location":"es/getting-started/#1-crear-el-proyecto","title":"1. Crear el proyecto","text":"<pre><code>mkdir mi-bot-whatsapp\ncd mi-bot-whatsapp\nnpm init -y\nnpm install @arcaelas/whatsapp typescript tsx\n</code></pre>"},{"location":"es/getting-started/#2-estructura-basica","title":"2. Estructura basica","text":"<p>Crea el archivo principal:</p> index.ts<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\n\nasync function main() {\n  // Crear instancia de WhatsApp\n  const wa = new WhatsApp();\n\n  // Escuchar eventos antes de conectar\n  wa.event.on(\"open\", () =&gt; console.log(\"Conectado!\"));\n  wa.event.on(\"close\", () =&gt; console.log(\"Desconectado\"));\n  wa.event.on(\"error\", (err) =&gt; console.error(\"Error:\", err.message));\n\n  // Conectar mostrando QR en consola\n  console.log(\"Esperando QR...\");\n  await wa.pair(async (data) =&gt; {\n    if (Buffer.isBuffer(data)) {\n      // Guardar QR como imagen\n      const fs = await import(\"fs\");\n      fs.writeFileSync(\"qr.png\", data);\n      console.log(\"QR guardado en qr.png - Escanea con tu telefono\");\n    } else {\n      // Codigo de 8 digitos (si usas phone)\n      console.log(\"Codigo de emparejamiento:\", data);\n    }\n  });\n\n  console.log(\"Bot iniciado!\");\n}\n\nmain().catch(console.error);\n</code></pre>"},{"location":"es/getting-started/#3-ejecutar","title":"3. Ejecutar","text":"<pre><code>npx tsx index.ts\n</code></pre> <ol> <li>Aparecera el archivo <code>qr.png</code></li> <li>Abrelo y escanea con WhatsApp &gt; Dispositivos vinculados</li> <li>El bot se conectara automaticamente</li> </ol> <p>Listo!</p> <p>Una vez conectado, la sesion se guarda en <code>.baileys/default/</code> y no necesitaras escanear de nuevo.</p>"},{"location":"es/getting-started/#4-escuchar-mensajes","title":"4. Escuchar mensajes","text":"<p>Agrega un listener para mensajes entrantes:</p> index.ts<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\n\nasync function main() {\n  const wa = new WhatsApp();\n\n  // Escuchar nuevos mensajes\n  wa.event.on(\"message:created\", async (msg) =&gt; {\n    // Ignorar mensajes propios\n    if (msg.me) return;\n\n    // Solo procesar texto\n    if (msg.type !== \"text\") return;\n\n    // Obtener contenido como texto\n    const content = (await msg.content()).toString();\n    console.log(`[${msg.type}] ${msg.cid}: ${content}`);\n\n    const text = content.toLowerCase();\n\n    if (text === \"hola\") {\n      await wa.Message.text(msg.cid, \"Hola! Soy un bot. Escribe 'ayuda' para ver comandos.\");\n    }\n\n    if (text === \"ayuda\") {\n      await wa.Message.text(\n        msg.cid,\n        \"Comandos disponibles:\\n\" +\n        \"- hola: Saludo\\n\" +\n        \"- hora: Hora actual\\n\" +\n        \"- ping: Test de respuesta\"\n      );\n    }\n\n    if (text === \"hora\") {\n      await wa.Message.text(msg.cid, `Son las ${new Date().toLocaleTimeString()}`);\n    }\n\n    if (text === \"ping\") {\n      await wa.Message.text(msg.cid, \"pong!\");\n    }\n  });\n\n  // Conectar\n  await wa.pair(async (data) =&gt; {\n    if (Buffer.isBuffer(data)) {\n      require(\"fs\").writeFileSync(\"qr.png\", data);\n      console.log(\"Escanea qr.png\");\n    }\n  });\n\n  console.log(\"Bot listo!\");\n}\n\nmain().catch(console.error);\n</code></pre>"},{"location":"es/getting-started/#5-conexion-con-codigo-de-emparejamiento","title":"5. Conexion con codigo de emparejamiento","text":"<p>Si prefieres no escanear QR, usa el numero de telefono:</p> <pre><code>const wa = new WhatsApp({\n  phone: \"5491112345678\", // Sin + ni espacios\n});\n\nawait wa.pair(async (data) =&gt; {\n  if (typeof data === \"string\") {\n    console.log(\"Ingresa este codigo en tu telefono:\", data);\n    // Ir a WhatsApp &gt; Dispositivos vinculados &gt; Vincular dispositivo\n    // Seleccionar \"Vincular con numero de telefono\"\n  }\n});\n</code></pre>"},{"location":"es/getting-started/#6-manejar-diferentes-tipos-de-mensaje","title":"6. Manejar diferentes tipos de mensaje","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n\n  const buffer = await msg.content();\n\n  // Mensaje de texto\n  if (msg.type === \"text\") {\n    const text = buffer.toString();\n    console.log(\"Texto:\", text);\n  }\n\n  // Imagen\n  if (msg.type === \"image\") {\n    console.log(`Imagen: ${buffer.length} bytes`);\n    if (msg.caption) {\n      console.log(`Caption: ${msg.caption}`);\n    }\n    // Guardar imagen\n    require(\"fs\").writeFileSync(\"imagen.jpg\", buffer);\n  }\n\n  // Video\n  if (msg.type === \"video\") {\n    console.log(`Video: ${buffer.length} bytes`);\n  }\n\n  // Audio (nota de voz)\n  if (msg.type === \"audio\") {\n    console.log(`Audio: ${buffer.length} bytes`);\n  }\n\n  // Ubicacion\n  if (msg.type === \"location\") {\n    const coords = JSON.parse(buffer.toString());\n    console.log(`Ubicacion: ${coords.lat}, ${coords.lng}`);\n  }\n\n  // Encuesta\n  if (msg.type === \"poll\") {\n    const poll = JSON.parse(buffer.toString());\n    console.log(`Encuesta: ${poll.content}`);\n    poll.options.forEach((opt: { content: string }, i: number) =&gt; {\n      console.log(`  ${i + 1}. ${opt.content}`);\n    });\n  }\n});\n</code></pre>"},{"location":"es/getting-started/#7-enviar-mensajes","title":"7. Enviar mensajes","text":"<pre><code>const cid = \"5491198765432@s.whatsapp.net\";\n\n// Texto\nawait wa.Message.text(cid, \"Hola!\");\n\n// Texto citando mensaje\nawait wa.Message.text(cid, \"Respuesta\", \"MESSAGE_ID_TO_QUOTE\");\n\n// Imagen con caption\nconst img = require(\"fs\").readFileSync(\"foto.jpg\");\nawait wa.Message.image(cid, img, \"Mira esta foto!\");\n\n// Video\nconst vid = require(\"fs\").readFileSync(\"video.mp4\");\nawait wa.Message.video(cid, vid, \"Video interesante\");\n\n// Audio (nota de voz)\nconst aud = require(\"fs\").readFileSync(\"audio.ogg\");\nawait wa.Message.audio(cid, aud);\n\n// Ubicacion\nawait wa.Message.location(cid, {\n  lat: -34.6037,\n  lng: -58.3816\n});\n\n// Encuesta\nawait wa.Message.poll(cid, {\n  content: \"Cual prefieres?\",\n  options: [\n    { content: \"Opcion A\" },\n    { content: \"Opcion B\" },\n    { content: \"Opcion C\" }\n  ]\n});\n</code></pre>"},{"location":"es/getting-started/#8-reaccionar-a-mensajes","title":"8. Reaccionar a mensajes","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n  if (msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString().toLowerCase();\n\n  // Reaccionar con emoji\n  if (text.includes(\"gracias\")) {\n    await wa.Message.react(msg.cid, msg.id, \"\u2764\ufe0f\");\n  }\n\n  if (text.includes(\"jaja\")) {\n    await wa.Message.react(msg.cid, msg.id, \"\ud83d\ude02\");\n  }\n\n  // Quitar reaccion\n  // await wa.Message.react(msg.cid, msg.id, \"\");\n});\n</code></pre>"},{"location":"es/getting-started/#9-marcar-chat-como-leido","title":"9. Marcar chat como leido","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  // Marcar chat como leido\n  await wa.Chat.seen(msg.cid);\n});\n</code></pre>"},{"location":"es/getting-started/#siguiente-paso","title":"Siguiente paso","text":"<p>Ahora que tienes un bot basico funcionando, explora la documentacion detallada:</p> <ul> <li>Referencia de WhatsApp - Configuracion y eventos</li> <li>Referencia de Chat - Gestion de conversaciones</li> <li>Referencia de Message - Tipos de mensaje</li> <li>Ejemplos avanzados - Patrones recomendados</li> </ul>"},{"location":"es/installation/","title":"Instalacion","text":""},{"location":"es/installation/#requisitos","title":"Requisitos","text":"<ul> <li>Node.js 18 o superior</li> <li>npm, yarn o pnpm</li> <li>Cuenta de WhatsApp activa</li> </ul>"},{"location":"es/installation/#instalacion-del-paquete","title":"Instalacion del paquete","text":"npmyarnpnpm <pre><code>npm install @arcaelas/whatsapp\n</code></pre> <pre><code>yarn add @arcaelas/whatsapp\n</code></pre> <pre><code>pnpm add @arcaelas/whatsapp\n</code></pre>"},{"location":"es/installation/#configuracion-de-typescript","title":"Configuracion de TypeScript","text":"<p>La libreria esta escrita en TypeScript y proporciona tipos completos. Asegurate de tener una configuracion compatible:</p> tsconfig.json<pre><code>{\n  \"compilerOptions\": {\n    \"target\": \"ES2022\",\n    \"module\": \"commonjs\",\n    \"moduleResolution\": \"node\",\n    \"esModuleInterop\": true,\n    \"strict\": true,\n    \"skipLibCheck\": true\n  }\n}\n</code></pre>"},{"location":"es/installation/#estructura-de-archivos","title":"Estructura de archivos","text":"<p>Cuando uses <code>FileEngine</code> (default), la libreria crea la siguiente estructura:</p> <pre><code>.baileys/\n  default/                    # o el nombre que especifiques\n    session/\n      {key}/index             # Datos de sesion (creds, keys, etc.)\n    contact/\n      {jid}/index             # Datos de contacto\n    chat/\n      {jid}/\n        index                 # Datos del chat\n        message/\n          index               # Indice \"MID TIMESTAMP\" por linea\n          {mid}/\n            index             # Metadata del mensaje (JSON)\n            content           # Contenido binario (media)\n</code></pre> <p>Normalizacion de IDs</p> <p>Los caracteres <code>@</code> en JIDs se reemplazan por <code>_at_</code> en los nombres de directorios. Ejemplo: <code>5491112345678@s.whatsapp.net</code> \u2192 <code>5491112345678_at_s.whatsapp.net</code></p> <p>Consejo</p> <p>Agrega <code>.baileys/</code> a tu <code>.gitignore</code> para no subir credenciales al repositorio.</p>"},{"location":"es/installation/#verificar-instalacion","title":"Verificar instalacion","text":"<p>Crea un archivo de prueba:</p> test.ts<pre><code>import { WhatsApp, FileEngine } from \"@arcaelas/whatsapp\";\n\nconst wa = new WhatsApp({\n  engine: new FileEngine(\".baileys/test\"),\n});\n\nconsole.log(\"Instalacion correcta!\");\nconsole.log(\"Clases disponibles:\", {\n  Chat: wa.Chat,\n  Contact: wa.Contact,\n  Message: wa.Message,\n});\n</code></pre> <p>Ejecuta:</p> <pre><code>npx tsx test.ts\n</code></pre> <p>Si ves el mensaje de exito, la instalacion esta completa.</p>"},{"location":"es/installation/#problemas-comunes","title":"Problemas comunes","text":""},{"location":"es/installation/#error-cannot-find-module-baileys","title":"Error: Cannot find module 'baileys'","text":"<p>Asegurate de que baileys este instalado como dependencia:</p> <pre><code>npm install baileys\n</code></pre>"},{"location":"es/installation/#error-libffiso7-not-found-linux","title":"Error: libffi.so.7 not found (Linux)","text":"<p>Instala las dependencias del sistema:</p> <pre><code># Debian/Ubuntu\nsudo apt-get install libffi-dev\n\n# CentOS/RHEL\nsudo yum install libffi-devel\n</code></pre>"},{"location":"es/installation/#error-enoent-baileysdefault","title":"Error: ENOENT .baileys/default","text":"<p>El directorio se crea automaticamente en la primera conexion. Si persiste, verifica permisos de escritura.</p>"},{"location":"es/installation/#siguiente-paso","title":"Siguiente paso","text":"<p> Primeros pasos</p>"},{"location":"es/examples/basic-bot/","title":"Bot Basico","text":"<p>Ejemplo de un bot simple que responde a mensajes.</p>"},{"location":"es/examples/basic-bot/#codigo-completo","title":"Codigo completo","text":"bot.ts<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\n\nasync function main() {\n  const wa = new WhatsApp();\n\n  // Eventos de conexion\n  wa.event.on(\"open\", () =&gt; console.log(\"Bot conectado!\"));\n  wa.event.on(\"close\", () =&gt; console.log(\"Bot desconectado\"));\n  wa.event.on(\"error\", (err) =&gt; console.error(\"Error:\", err.message));\n\n  // Escuchar mensajes\n  wa.event.on(\"message:created\", async (msg) =&gt; {\n    // Ignorar mensajes propios\n    if (msg.me) return;\n\n    // Solo procesar texto\n    if (msg.type !== \"text\") return;\n\n    const text = (await msg.content()).toString().toLowerCase();\n\n    // Respuestas simples\n    if (text === \"hola\") {\n      await wa.Message.text(msg.cid, \"Hola! Soy un bot. Escribe 'ayuda' para ver opciones.\");\n    }\n\n    if (text === \"ayuda\") {\n      await wa.Message.text(\n        msg.cid,\n        \"Comandos disponibles:\\n\" +\n        \"- hola: Saludo\\n\" +\n        \"- hora: Hora actual\\n\" +\n        \"- fecha: Fecha actual\\n\" +\n        \"- ping: Test de respuesta\"\n      );\n    }\n\n    if (text === \"hora\") {\n      await wa.Message.text(msg.cid, `Son las ${new Date().toLocaleTimeString(\"es-AR\")}`);\n    }\n\n    if (text === \"fecha\") {\n      await wa.Message.text(msg.cid, `Hoy es ${new Date().toLocaleDateString(\"es-AR\", {\n        weekday: \"long\",\n        year: \"numeric\",\n        month: \"long\",\n        day: \"numeric\"\n      })}`);\n    }\n\n    if (text === \"ping\") {\n      const start = Date.now();\n      await wa.Message.text(msg.cid, \"pong!\");\n      console.log(`Latencia: ${Date.now() - start}ms`);\n    }\n  });\n\n  // Conectar\n  console.log(\"Iniciando bot...\");\n  await wa.pair(async (data) =&gt; {\n    if (Buffer.isBuffer(data)) {\n      require(\"fs\").writeFileSync(\"qr.png\", data);\n      console.log(\"Escanea el QR en qr.png\");\n    } else {\n      console.log(\"Codigo de emparejamiento:\", data);\n    }\n  });\n\n  console.log(\"Bot listo para recibir mensajes!\");\n}\n\nmain().catch(console.error);\n</code></pre>"},{"location":"es/examples/basic-bot/#ejecutar","title":"Ejecutar","text":"<pre><code>npx tsx bot.ts\n</code></pre> <ol> <li>Escanea el QR que aparece en <code>qr.png</code></li> <li>Envia \"hola\" al bot desde otro telefono</li> <li>El bot respondera automaticamente</li> </ol>"},{"location":"es/examples/basic-bot/#mejoras-opcionales","title":"Mejoras opcionales","text":""},{"location":"es/examples/basic-bot/#agregar-reacciones","title":"Agregar reacciones","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString().toLowerCase();\n\n  // Reaccionar segun contenido\n  if (text.includes(\"gracias\")) {\n    await wa.Message.react(msg.cid, msg.id, \"\u2764\ufe0f\");\n  } else if (text.includes(\"jaja\")) {\n    await wa.Message.react(msg.cid, msg.id, \"\ud83d\ude02\");\n  }\n});\n</code></pre>"},{"location":"es/examples/basic-bot/#responder-con-cita","title":"Responder con cita","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString().toLowerCase();\n\n  if (text === \"eco\") {\n    // Responder citando el mensaje original\n    await wa.Message.text(msg.cid, \"Esto es un eco!\");\n  }\n});\n</code></pre>"},{"location":"es/examples/command-bot/","title":"Bot de Comandos","text":"<p>Bot con sistema de comandos estructurado y modular.</p>"},{"location":"es/examples/command-bot/#estructura-del-proyecto","title":"Estructura del proyecto","text":"<pre><code>mi-bot/\n  src/\n    commands/\n      index.ts\n      ping.ts\n      ayuda.ts\n      hora.ts\n    index.ts\n  package.json\n  tsconfig.json\n</code></pre>"},{"location":"es/examples/command-bot/#codigo","title":"Codigo","text":""},{"location":"es/examples/command-bot/#srccommandsindexts","title":"src/commands/index.ts","text":"<pre><code>import type { WhatsApp } from \"@arcaelas/whatsapp\";\n\n// Tipo para mensaje (inferido de wa.Message)\ntype Message = InstanceType&lt;WhatsApp[\"Message\"]&gt;;\n\nexport interface CommandContext {\n  wa: WhatsApp;\n  msg: Message;\n  cid: string;\n  args: string[];\n  text: string;\n}\n\nexport interface Command {\n  name: string;\n  description: string;\n  aliases?: string[];\n  execute: (ctx: CommandContext) =&gt; Promise&lt;void&gt;;\n}\n\n// Registro de comandos\nexport const commands = new Map&lt;string, Command&gt;();\n\n// Helper para registrar comando\nexport function register_command(cmd: Command) {\n  commands.set(cmd.name, cmd);\n  cmd.aliases?.forEach(alias =&gt; commands.set(alias, cmd));\n}\n\n// Importar y registrar comandos\nimport \"./ping\";\nimport \"./ayuda\";\nimport \"./hora\";\n</code></pre>"},{"location":"es/examples/command-bot/#srccommandspingts","title":"src/commands/ping.ts","text":"<pre><code>import { register_command } from \"./index\";\n\nregister_command({\n  name: \"ping\",\n  description: \"Verificar latencia del bot\",\n  aliases: [\"p\"],\n  async execute({ wa, cid }) {\n    const start = Date.now();\n    await wa.Message.text(cid, \"pong!\");\n    console.log(`Latencia: ${Date.now() - start}ms`);\n  },\n});\n</code></pre>"},{"location":"es/examples/command-bot/#srccommandsayudats","title":"src/commands/ayuda.ts","text":"<pre><code>import { commands, register_command } from \"./index\";\n\nregister_command({\n  name: \"ayuda\",\n  description: \"Mostrar lista de comandos\",\n  aliases: [\"help\", \"h\", \"?\"],\n  async execute({ wa, cid }) {\n    const unique_commands = new Map&lt;string, string&gt;();\n\n    commands.forEach((cmd) =&gt; {\n      if (!unique_commands.has(cmd.name)) {\n        unique_commands.set(cmd.name, cmd.description);\n      }\n    });\n\n    let message = \"*Comandos disponibles:*\\n\\n\";\n    unique_commands.forEach((desc, name) =&gt; {\n      message += `!${name} - ${desc}\\n`;\n    });\n\n    await wa.Message.text(cid, message);\n  },\n});\n</code></pre>"},{"location":"es/examples/command-bot/#srccommandshorats","title":"src/commands/hora.ts","text":"<pre><code>import { register_command } from \"./index\";\n\nregister_command({\n  name: \"hora\",\n  description: \"Mostrar hora actual\",\n  aliases: [\"time\", \"t\"],\n  async execute({ wa, cid }) {\n    const now = new Date();\n    const time = now.toLocaleTimeString(\"es-AR\", {\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n      second: \"2-digit\",\n    });\n    const date = now.toLocaleDateString(\"es-AR\", {\n      weekday: \"long\",\n      day: \"numeric\",\n      month: \"long\",\n      year: \"numeric\",\n    });\n\n    await wa.Message.text(cid, `${time}\\n${date}`);\n  },\n});\n</code></pre>"},{"location":"es/examples/command-bot/#srcindexts","title":"src/index.ts","text":"<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\nimport { commands, CommandContext } from \"./commands\";\n\nconst PREFIX = \"!\";\n\nasync function main() {\n  const wa = new WhatsApp();\n\n  wa.event.on(\"open\", () =&gt; console.log(\"Bot conectado\"));\n  wa.event.on(\"error\", (e) =&gt; console.error(\"Error:\", e.message));\n\n  wa.event.on(\"message:created\", async (msg) =&gt; {\n    // Ignorar mensajes propios\n    if (msg.me) return;\n\n    // Solo texto\n    if (msg.type !== \"text\") return;\n\n    const text = (await msg.content()).toString();\n\n    // Verificar prefijo\n    if (!text.startsWith(PREFIX)) return;\n\n    // Parsear comando y argumentos\n    const [command_name, ...args] = text.slice(PREFIX.length).split(\" \");\n    const cmd = commands.get(command_name.toLowerCase());\n\n    if (!cmd) {\n      await wa.Message.text(msg.cid, `Comando no encontrado. Escribe ${PREFIX}ayuda`);\n      return;\n    }\n\n    // Ejecutar comando\n    const ctx: CommandContext = {\n      wa,\n      msg,\n      cid: msg.cid,\n      args,\n      text: text.slice(PREFIX.length + command_name.length + 1),\n    };\n\n    try {\n      await cmd.execute(ctx);\n    } catch (error) {\n      console.error(`Error en comando ${cmd.name}:`, error);\n      await wa.Message.text(msg.cid, \"Ocurrio un error ejecutando el comando\");\n    }\n  });\n\n  // Conectar\n  await wa.pair(async (data) =&gt; {\n    if (Buffer.isBuffer(data)) {\n      require(\"fs\").writeFileSync(\"qr.png\", data);\n      console.log(\"Escanea qr.png\");\n    }\n  });\n\n  console.log(\"Bot listo!\");\n}\n\nmain().catch(console.error);\n</code></pre>"},{"location":"es/examples/command-bot/#agregar-nuevos-comandos","title":"Agregar nuevos comandos","text":""},{"location":"es/examples/command-bot/#comando-con-argumentos","title":"Comando con argumentos","text":"src/commands/decir.ts<pre><code>import { register_command } from \"./index\";\n\nregister_command({\n  name: \"decir\",\n  description: \"Repetir un mensaje\",\n  aliases: [\"echo\", \"say\"],\n  async execute({ wa, cid, text }) {\n    if (!text.trim()) {\n      await wa.Message.text(cid, \"Uso: !decir &lt;mensaje&gt;\");\n      return;\n    }\n    await wa.Message.text(cid, text);\n  },\n});\n</code></pre>"},{"location":"es/examples/command-bot/#comando-con-validacion","title":"Comando con validacion","text":"src/commands/dado.ts<pre><code>import { register_command } from \"./index\";\n\nregister_command({\n  name: \"dado\",\n  description: \"Lanzar un dado\",\n  aliases: [\"dice\", \"roll\"],\n  async execute({ wa, cid, args }) {\n    const sides = parseInt(args[0]) || 6;\n\n    if (sides &lt; 2 || sides &gt; 100) {\n      await wa.Message.text(cid, \"El dado debe tener entre 2 y 100 caras\");\n      return;\n    }\n\n    const result = Math.floor(Math.random() * sides) + 1;\n    await wa.Message.text(cid, `Dado de ${sides} caras: ${result}`);\n  },\n});\n</code></pre>"},{"location":"es/examples/command-bot/#comando-solo-para-grupos","title":"Comando solo para grupos","text":"src/commands/grupo.ts<pre><code>import { register_command } from \"./index\";\n\nregister_command({\n  name: \"grupo\",\n  description: \"Informacion del grupo\",\n  aliases: [\"group\", \"g\"],\n  async execute({ wa, cid }) {\n    // Solo en grupos\n    if (!cid.endsWith(\"@g.us\")) {\n      await wa.Message.text(cid, \"Este comando solo funciona en grupos\");\n      return;\n    }\n\n    const chat = await wa.Chat.get(cid);\n    if (!chat) return;\n\n    const members = await wa.Chat.members(cid, 0, 1000);\n\n    await wa.Message.text(\n      cid,\n      `*${chat.name}*\\n\\n` +\n      `Miembros: ${members.length}`\n    );\n  },\n});\n</code></pre>"},{"location":"es/examples/command-bot/#ejecutar","title":"Ejecutar","text":"<pre><code>npx tsx src/index.ts\n</code></pre>"},{"location":"es/examples/command-bot/#uso","title":"Uso","text":"<pre><code>!ping          -&gt; pong!\n!ayuda         -&gt; Lista de comandos\n!hora          -&gt; 14:30:45 - lunes, 1 de enero de 2025\n!decir Hola    -&gt; Hola\n!dado 20       -&gt; Dado de 20 caras: 15\n!grupo         -&gt; Informacion del grupo\n</code></pre>"},{"location":"es/examples/groups/","title":"Gestion de Grupos","text":"<p>Ejemplos de trabajo con grupos de WhatsApp.</p>"},{"location":"es/examples/groups/#obtener-informacion-de-grupo","title":"Obtener informacion de grupo","text":"<pre><code>const chat = await wa.Chat.get(\"123456789@g.us\");\n\nif (chat &amp;&amp; chat.type === \"group\") {\n  console.log(`Nombre: ${chat.name}`);\n  console.log(`ID: ${chat.id}`);\n\n  // Miembros\n  const members = await wa.Chat.members(chat.id, 0, 1000);\n  console.log(`Miembros: ${members.length}`);\n\n  for (const member of members) {\n    console.log(`  - ${member.name} (${member.phone})`);\n  }\n}\n</code></pre>"},{"location":"es/examples/groups/#detectar-grupos-en-eventos","title":"Detectar grupos en eventos","text":"<pre><code>wa.event.on(\"chat:created\", (chat) =&gt; {\n  if (chat.type === \"group\") {\n    console.log(`Grupo creado: ${chat.name}`);\n  }\n});\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  // Verificar si el mensaje es de un grupo\n  const is_group = msg.cid.endsWith(\"@g.us\");\n\n  if (is_group) {\n    console.log(`Mensaje en grupo: ${msg.cid}`);\n  }\n});\n</code></pre>"},{"location":"es/examples/groups/#enviar-mensajes-a-grupos","title":"Enviar mensajes a grupos","text":"<pre><code>// Enviar texto a un grupo\nawait wa.Message.text(\"123456789@g.us\", \"Hola grupo!\");\n\n// Enviar imagen a un grupo\nimport * as fs from \"fs\";\nconst img = fs.readFileSync(\"foto.jpg\");\nawait wa.Message.image(\"123456789@g.us\", img, \"Foto para el grupo\");\n\n// Crear encuesta en grupo\nawait wa.Message.poll(\"123456789@g.us\", {\n  content: \"Donde nos juntamos?\",\n  options: [\n    { content: \"En mi casa\" },\n    { content: \"En el parque\" },\n    { content: \"En el centro\" }\n  ]\n});\n</code></pre>"},{"location":"es/examples/groups/#responder-en-grupos","title":"Responder en grupos","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n\n  // Solo procesar mensajes de grupos\n  if (!msg.cid.endsWith(\"@g.us\")) return;\n\n  if (msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString().toLowerCase();\n\n  // Responder\n  if (text.includes(\"hola\")) {\n    await wa.Message.text(msg.cid, \"Hola! Bienvenido al grupo\");\n  }\n});\n</code></pre>"},{"location":"es/examples/groups/#obtener-miembros-de-un-grupo","title":"Obtener miembros de un grupo","text":"<pre><code>const group_id = \"123456789@g.us\";\nconst members = await wa.Chat.members(group_id, 0, 1000);\n\nconsole.log(`Grupo tiene ${members.length} miembros:`);\nfor (const member of members) {\n  console.log(`  - ${member.name}: ${member.phone}`);\n}\n</code></pre>"},{"location":"es/examples/groups/#exportar-miembros-a-json","title":"Exportar miembros a JSON","text":"<pre><code>import * as fs from \"fs\";\n\nasync function export_group_members(wa: WhatsApp, group_id: string) {\n  const chat = await wa.Chat.get(group_id);\n  if (!chat || chat.type !== \"group\") {\n    throw new Error(\"Grupo no encontrado\");\n  }\n\n  const members = await wa.Chat.members(group_id, 0, 10000);\n\n  const data = {\n    group: {\n      id: chat.id,\n      name: chat.name,\n    },\n    exported_at: new Date().toISOString(),\n    members: members.map(m =&gt; ({\n      id: m.id,\n      phone: m.phone,\n      name: m.name,\n    })),\n  };\n\n  const filename = `grupo_${chat.name.replace(/[^a-z0-9]/gi, \"_\")}.json`;\n  fs.writeFileSync(filename, JSON.stringify(data, null, 2));\n\n  console.log(`Exportados ${members.length} miembros a ${filename}`);\n}\n</code></pre>"},{"location":"es/examples/groups/#bot-de-comandos-para-grupos","title":"Bot de comandos para grupos","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"text\") return;\n\n  // Solo en grupos\n  if (!msg.cid.endsWith(\"@g.us\")) return;\n\n  const text = (await msg.content()).toString();\n  if (!text.startsWith(\"!\")) return;\n\n  const [cmd] = text.slice(1).split(\" \");\n\n  switch (cmd.toLowerCase()) {\n    case \"info\":\n      const chat = await wa.Chat.get(msg.cid);\n      if (chat) {\n        const members = await wa.Chat.members(msg.cid, 0, 1000);\n        await wa.Message.text(\n          msg.cid,\n          `*${chat.name}*\\n\\n` +\n          `ID: ${chat.id}\\n` +\n          `Miembros: ${members.length}`\n        );\n      }\n      break;\n\n    case \"miembros\":\n      const group_members = await wa.Chat.members(msg.cid, 0, 50);\n      const list = group_members.map(m =&gt; `- ${m.name}`).join(\"\\n\");\n      await wa.Message.text(msg.cid, `*Miembros:*\\n${list}`);\n      break;\n  }\n});\n</code></pre>"},{"location":"es/examples/groups/#notas","title":"Notas","text":"<p>JID de grupo</p> <p>Los grupos tienen JID con formato <code>{id}@g.us</code></p> <p>Diferenciacion</p> <p>Usa <code>chat.type === \"group\"</code> o <code>cid.endsWith(\"@g.us\")</code> para detectar grupos</p>"},{"location":"es/examples/media/","title":"Envio de Media","text":"<p>Ejemplos de envio y recepcion de archivos multimedia.</p>"},{"location":"es/examples/media/#enviar-imagen","title":"Enviar imagen","text":"<pre><code>import * as fs from \"fs\";\n\n// Desde archivo local\nconst img = fs.readFileSync(\"foto.jpg\");\nawait wa.Message.image(\"5491112345678@s.whatsapp.net\", img, \"Mira esta foto!\");\n\n// Desde URL (descargar primero)\nconst response = await fetch(\"https://example.com/image.jpg\");\nconst buffer = Buffer.from(await response.arrayBuffer());\nawait wa.Message.image(\"5491112345678@s.whatsapp.net\", buffer, \"Imagen de internet\");\n</code></pre>"},{"location":"es/examples/media/#enviar-video","title":"Enviar video","text":"<pre><code>import * as fs from \"fs\";\n\n// Desde archivo local\nconst video = fs.readFileSync(\"video.mp4\");\nawait wa.Message.video(\"5491112345678@s.whatsapp.net\", video, \"Video interesante\");\n\n// Nota: WhatsApp comprime los videos automaticamente\n// Para mejor calidad, usa videos cortos (&lt;3 min) y 720p\n</code></pre>"},{"location":"es/examples/media/#enviar-audio","title":"Enviar audio","text":"<pre><code>import * as fs from \"fs\";\n\n// Nota de voz (PTT - Push to Talk) - default\nconst audio = fs.readFileSync(\"audio.ogg\");\nawait wa.Message.audio(\"5491112345678@s.whatsapp.net\", audio);\n\n// Audio normal (sin PTT)\nawait wa.Message.audio(\"5491112345678@s.whatsapp.net\", audio, false);\n\n// Formatos soportados: OGG con codec Opus (preferido), MP3, AAC\n// WhatsApp convierte automaticamente a OGG/Opus\n</code></pre>"},{"location":"es/examples/media/#enviar-ubicacion","title":"Enviar ubicacion","text":"<pre><code>// Ubicacion estatica\nawait wa.Message.location(\"5491112345678@s.whatsapp.net\", {\n  lat: -34.6037,\n  lng: -58.3816\n});\n</code></pre>"},{"location":"es/examples/media/#recibir-y-guardar-media","title":"Recibir y guardar media","text":"<pre><code>import * as fs from \"fs\";\nimport * as path from \"path\";\n\nconst MEDIA_DIR = \"./medios\";\nfs.mkdirSync(MEDIA_DIR, { recursive: true });\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n\n  const timestamp = Date.now();\n  const buffer = await msg.content();\n\n  if (buffer.length === 0) return;\n\n  // Imagen\n  if (msg.type === \"image\") {\n    const ext = msg.mime.split(\"/\")[1] || \"jpg\";\n    const filename = `${timestamp}.${ext}`;\n    fs.writeFileSync(path.join(MEDIA_DIR, filename), buffer);\n    console.log(`Imagen guardada: ${filename} (${buffer.length} bytes)`);\n    if (msg.caption) {\n      console.log(`Caption: ${msg.caption}`);\n    }\n  }\n\n  // Video\n  if (msg.type === \"video\") {\n    const filename = `${timestamp}.mp4`;\n    fs.writeFileSync(path.join(MEDIA_DIR, filename), buffer);\n    console.log(`Video guardado: ${filename} (${buffer.length} bytes)`);\n  }\n\n  // Audio\n  if (msg.type === \"audio\") {\n    const filename = `${timestamp}.ogg`;\n    fs.writeFileSync(path.join(MEDIA_DIR, filename), buffer);\n    console.log(`Audio guardado: ${filename} (${buffer.length} bytes)`);\n  }\n});\n</code></pre>"},{"location":"es/examples/media/#reenviar-media","title":"Reenviar media","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString();\n\n  // Comando para reenviar al ultimo mensaje\n  if (text.startsWith(\"!reenviar \")) {\n    const target_phone = text.slice(10).trim();\n    const target_jid = `${target_phone}@s.whatsapp.net`;\n\n    // Obtener mensaje anterior (el que queremos reenviar)\n    const prev_msg = await wa.Message.get(msg.cid, \"PREVIOUS_MESSAGE_ID\");\n\n    if (prev_msg &amp;&amp; [\"image\", \"video\", \"audio\"].includes(prev_msg.type)) {\n      await wa.Message.forward(msg.cid, prev_msg.id, target_jid);\n      await wa.Message.text(msg.cid, \"Media reenviada!\");\n    }\n  }\n});\n</code></pre>"},{"location":"es/examples/media/#procesar-imagenes","title":"Procesar imagenes","text":"<pre><code>import sharp from \"sharp\"; // npm install sharp\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"image\") return;\n\n  const buffer = await msg.content();\n  if (buffer.length === 0) return;\n\n  // Obtener metadata\n  const metadata = await sharp(buffer).metadata();\n  console.log(`Imagen: ${metadata.width}x${metadata.height}, ${metadata.format}`);\n\n  // Redimensionar\n  const thumbnail = await sharp(buffer)\n    .resize(100, 100, { fit: \"cover\" })\n    .jpeg({ quality: 80 })\n    .toBuffer();\n\n  // Enviar thumbnail como respuesta\n  await wa.Message.image(msg.cid, thumbnail, \"Thumbnail generado\");\n});\n</code></pre>"},{"location":"es/examples/media/#transcribir-audio","title":"Transcribir audio","text":"<pre><code>// Ejemplo con Whisper API de OpenAI\nimport OpenAI from \"openai\";\nimport * as fs from \"fs\";\nimport * as path from \"path\";\n\nconst openai = new OpenAI();\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"audio\") return;\n\n  const buffer = await msg.content();\n  if (buffer.length === 0) return;\n\n  // Guardar temporalmente\n  const temp_file = path.join(\"/tmp\", `${Date.now()}.ogg`);\n  fs.writeFileSync(temp_file, buffer);\n\n  try {\n    // Transcribir\n    const transcription = await openai.audio.transcriptions.create({\n      file: fs.createReadStream(temp_file),\n      model: \"whisper-1\",\n      language: \"es\",\n    });\n\n    await wa.Message.text(msg.cid, `Transcripcion:\\n${transcription.text}`);\n  } catch (error) {\n    console.error(\"Error transcribiendo:\", error);\n  } finally {\n    fs.unlinkSync(temp_file);\n  }\n});\n</code></pre>"},{"location":"es/examples/media/#limites-y-recomendaciones","title":"Limites y recomendaciones","text":"Tipo Limite Recomendacion Imagen 16 MB &lt; 5 MB, JPEG/PNG Video 64 MB &lt; 16 MB, MP4 H.264 Audio 16 MB &lt; 5 MB, OGG Opus <p>Compresion</p> <p>WhatsApp comprime automaticamente los medios. Para mejor calidad, usa formatos optimizados.</p> <p>Timeout</p> <p>La descarga de media puede tardar. Considera usar timeouts y reintentos.</p>"},{"location":"es/examples/polls/","title":"Encuestas","text":"<p>Ejemplos de creacion y manejo de encuestas.</p>"},{"location":"es/examples/polls/#crear-encuesta","title":"Crear encuesta","text":"<pre><code>// Encuesta simple\nawait wa.Message.poll(\"123456789@g.us\", {\n  content: \"Cual es tu color favorito?\",\n  options: [\n    { content: \"Rojo\" },\n    { content: \"Azul\" },\n    { content: \"Verde\" },\n    { content: \"Amarillo\" }\n  ]\n});\n</code></pre>"},{"location":"es/examples/polls/#leer-datos-de-encuesta","title":"Leer datos de encuesta","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.type !== \"poll\") return;\n\n  // El contenido de una encuesta es JSON\n  const buffer = await msg.content();\n  const poll = JSON.parse(buffer.toString()) as {\n    content: string;\n    options: Array&lt;{ content: string }&gt;;\n  };\n\n  console.log(`Encuesta: ${poll.content}`);\n  console.log(\"Opciones:\");\n  poll.options.forEach((opt, i) =&gt; {\n    console.log(`  ${i + 1}. ${opt.content}`);\n  });\n});\n</code></pre>"},{"location":"es/examples/polls/#bot-de-encuestas","title":"Bot de encuestas","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString();\n\n  // Comando: !encuesta Pregunta | Opcion1 | Opcion2 | ...\n  if (text.startsWith(\"!encuesta \")) {\n    const content = text.slice(10);\n    const parts = content.split(\"|\").map(s =&gt; s.trim());\n\n    if (parts.length &lt; 3) {\n      await wa.Message.text(\n        msg.cid,\n        \"Uso: !encuesta Pregunta | Opcion1 | Opcion2 | ...\\n\\n\" +\n        \"Ejemplo:\\n\" +\n        \"!encuesta Que comemos hoy? | Pizza | Sushi | Hamburguesa\"\n      );\n      return;\n    }\n\n    const [question, ...options] = parts;\n\n    if (options.length &gt; 12) {\n      await wa.Message.text(msg.cid, \"Maximo 12 opciones permitidas\");\n      return;\n    }\n\n    await wa.Message.poll(msg.cid, {\n      content: question,\n      options: options.map(opt =&gt; ({ content: opt }))\n    });\n\n    await wa.Message.text(msg.cid, `Encuesta creada: \"${question}\"`);\n  }\n});\n</code></pre>"},{"location":"es/examples/polls/#encuesta-con-temporizador","title":"Encuesta con temporizador","text":"<pre><code>async function create_timed_poll(\n  wa: WhatsApp,\n  chat_id: string,\n  question: string,\n  options: string[],\n  duration_minutes: number\n) {\n  // Crear encuesta\n  const poll_msg = await wa.Message.poll(chat_id, {\n    content: question,\n    options: options.map(opt =&gt; ({ content: opt }))\n  });\n\n  if (!poll_msg) return;\n\n  await wa.Message.text(chat_id, `Encuesta activa por ${duration_minutes} minutos`);\n\n  // Esperar duracion\n  await new Promise(r =&gt; setTimeout(r, duration_minutes * 60 * 1000));\n\n  // Anunciar que termino\n  await wa.Message.text(chat_id, `*Encuesta finalizada!*\\n\\nVer resultados en la encuesta.`);\n}\n\n// Uso\nawait create_timed_poll(\n  wa,\n  \"123456789@g.us\",\n  \"Que pelicula vemos?\",\n  [\"Accion\", \"Comedia\", \"Terror\", \"Drama\"],\n  5 // 5 minutos\n);\n</code></pre>"},{"location":"es/examples/polls/#notas-importantes","title":"Notas importantes","text":"<p>Limite de opciones</p> <p>WhatsApp permite maximo 12 opciones por encuesta.</p> <p>Visibilidad de votos</p> <p>Los votos en WhatsApp son anonimos. Solo puedes ver el conteo total, no quien voto.</p> <p>Encuestas en grupos</p> <p>Las encuestas funcionan mejor en grupos donde hay mas participantes.</p>"},{"location":"es/examples/s3-bot/","title":"Bot con Engine Personalizado","text":"<p>Bot de produccion usando un engine personalizado para almacenamiento.</p>"},{"location":"es/examples/s3-bot/#descripcion","title":"Descripcion","text":"<p>Este ejemplo muestra como crear un bot que usa un engine personalizado (Redis, PostgreSQL, S3, etc.) en lugar del FileEngine por defecto.</p>"},{"location":"es/examples/s3-bot/#ejemplo-redis-engine","title":"Ejemplo: Redis Engine","text":""},{"location":"es/examples/s3-bot/#crear-el-engine","title":"Crear el engine","text":"RedisEngine.ts<pre><code>import type { Engine } from \"@arcaelas/whatsapp\";\nimport { createClient } from \"redis\";\n\nexport class RedisEngine implements Engine {\n  private client: ReturnType&lt;typeof createClient&gt;;\n\n  constructor(url: string) {\n    this.client = createClient({ url });\n  }\n\n  async connect() {\n    await this.client.connect();\n  }\n\n  async get(key: string): Promise&lt;string | null&gt; {\n    return await this.client.get(key);\n  }\n\n  async set(key: string, value: string | null): Promise&lt;void&gt; {\n    if (value === null) {\n      await this.client.del(key);\n    } else {\n      await this.client.set(key, value);\n    }\n  }\n\n  async list(prefix: string, offset = 0, limit = 50): Promise&lt;string[]&gt; {\n    const keys = await this.client.keys(`${prefix}*`);\n    return keys.slice(offset, offset + limit);\n  }\n}\n</code></pre>"},{"location":"es/examples/s3-bot/#usar-el-engine","title":"Usar el engine","text":"bot.ts<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\nimport { RedisEngine } from \"./RedisEngine\";\nimport \"dotenv/config\";\n\nasync function main() {\n  // Crear engine Redis\n  const engine = new RedisEngine(process.env.REDIS_URL || \"redis://localhost:6379\");\n  await engine.connect();\n\n  // Crear instancia con engine personalizado\n  const wa = new WhatsApp({ engine });\n\n  // Logging\n  wa.event.on(\"open\", () =&gt; console.log(\"[INFO] Conectado\"));\n  wa.event.on(\"close\", () =&gt; console.log(\"[WARN] Desconectado\"));\n  wa.event.on(\"error\", (e) =&gt; console.error(\"[ERROR]\", e.message));\n\n  // Mensajes\n  wa.event.on(\"message:created\", async (msg) =&gt; {\n    if (msg.me || msg.type !== \"text\") return;\n\n    const text = (await msg.content()).toString();\n    const prefix = process.env.BOT_PREFIX || \"!\";\n\n    if (!text.startsWith(prefix)) return;\n\n    const [cmd] = text.slice(prefix.length).split(\" \");\n\n    switch (cmd.toLowerCase()) {\n      case \"ping\":\n        await wa.Message.text(msg.cid, \"pong!\");\n        break;\n\n      case \"status\":\n        await wa.Message.text(\n          msg.cid,\n          `*Estado del Bot*\\n\\n` +\n          `Engine: Redis\\n` +\n          `Uptime: ${Math.floor(process.uptime() / 60)} minutos`\n        );\n        break;\n\n      case \"ayuda\":\n        await wa.Message.text(\n          msg.cid,\n          `Comandos:\\n` +\n          `${prefix}ping - Test\\n` +\n          `${prefix}status - Estado del bot\\n` +\n          `${prefix}ayuda - Este mensaje`\n        );\n        break;\n    }\n  });\n\n  // Conectar\n  console.log(\"[INFO] Iniciando bot...\");\n  await wa.pair(async (data) =&gt; {\n    if (Buffer.isBuffer(data)) {\n      require(\"fs\").writeFileSync(\"/tmp/qr.png\", data);\n      console.log(\"[INFO] QR guardado en /tmp/qr.png\");\n    } else {\n      console.log(\"[INFO] Codigo:\", data);\n    }\n  });\n\n  console.log(\"[INFO] Bot listo!\");\n\n  // Mantener proceso vivo\n  process.on(\"SIGINT\", () =&gt; {\n    console.log(\"[INFO] Cerrando...\");\n    process.exit(0);\n  });\n}\n\nmain().catch((e) =&gt; {\n  console.error(\"[FATAL]\", e);\n  process.exit(1);\n});\n</code></pre>"},{"location":"es/examples/s3-bot/#docker","title":"Docker","text":"Dockerfile<pre><code>FROM node:20-alpine\n\nWORKDIR /app\n\nCOPY package*.json ./\nRUN npm ci --only=production\n\nCOPY . .\n\nCMD [\"node\", \"--import\", \"tsx\", \"bot.ts\"]\n</code></pre> docker-compose.yml<pre><code>version: \"3.8\"\n\nservices:\n  redis:\n    image: redis:7-alpine\n    restart: unless-stopped\n\n  bot:\n    build: .\n    restart: unless-stopped\n    depends_on:\n      - redis\n    environment:\n      - REDIS_URL=redis://redis:6379\n      - BOT_PREFIX=!\n    volumes:\n      - /tmp:/tmp  # Para el QR temporal\n</code></pre>"},{"location":"es/examples/s3-bot/#health-check","title":"Health check","text":"<pre><code>import { createServer } from \"http\";\n\n// Agregar despues de inicializar el bot\nconst server = createServer((req, res) =&gt; {\n  if (req.url === \"/health\") {\n    res.writeHead(200, { \"Content-Type\": \"application/json\" });\n    res.end(JSON.stringify({\n      status: \"ok\",\n      connected: wa.socket !== null,\n      uptime: process.uptime(),\n    }));\n  } else {\n    res.writeHead(404);\n    res.end();\n  }\n});\n\nserver.listen(3000, () =&gt; {\n  console.log(\"[INFO] Health check en http://localhost:3000/health\");\n});\n</code></pre>"},{"location":"es/examples/s3-bot/#variables-de-entorno","title":"Variables de entorno","text":".env<pre><code>REDIS_URL=redis://localhost:6379\nBOT_PREFIX=!\n</code></pre>"},{"location":"es/examples/s3-bot/#otros-engines","title":"Otros engines","text":"<p>Consulta la documentacion de Engines para ver ejemplos de PostgreSQL, MongoDB, y otros.</p>"},{"location":"es/references/chat/","title":"Chat","text":"<p>Clase para gestionar conversaciones de WhatsApp (contactos individuales y grupos).</p>"},{"location":"es/references/chat/#importacion","title":"Importacion","text":"<p>La clase se accede desde la instancia de WhatsApp:</p> <pre><code>const wa = new WhatsApp();\nwa.Chat // Clase Chat enlazada\n</code></pre>"},{"location":"es/references/chat/#propiedades","title":"Propiedades","text":"Propiedad Tipo Descripcion <code>id</code> <code>string</code> JID del chat (ej: <code>123@s.whatsapp.net</code> o <code>123@g.us</code>) <code>name</code> <code>string</code> Nombre del chat o grupo <code>type</code> <code>'contact' \\| 'group'</code> Tipo de chat <code>content</code> <code>string</code> Descripcion del chat/grupo <code>pined</code> <code>boolean</code> <code>true</code> si el chat esta fijado <code>archived</code> <code>boolean</code> <code>true</code> si el chat esta archivado <code>muted</code> <code>number \\| false</code> Timestamp de expiracion del silencio o <code>false</code> <code>readed</code> <code>boolean</code> <code>true</code> si el chat esta leido <code>readonly</code> <code>boolean</code> <code>true</code> si el chat es solo lectura"},{"location":"es/references/chat/#metodos-estaticos","title":"Metodos estaticos","text":""},{"location":"es/references/chat/#chatgetcid","title":"<code>Chat.get(cid)</code>","text":"<p>Obtiene un chat por su ID. Si no existe pero el contacto si, crea el chat automaticamente.</p> <pre><code>// Chat individual\nconst chat = await wa.Chat.get(\"5491112345678@s.whatsapp.net\");\n\n// Grupo\nconst group = await wa.Chat.get(\"123456789@g.us\");\n\nif (chat) {\n  console.log(`Chat: ${chat.name} (${chat.type})`);\n}\n</code></pre>"},{"location":"es/references/chat/#chatpincid-value","title":"<code>Chat.pin(cid, value)</code>","text":"<p>Fija o desfija un chat.</p> <pre><code>// Fijar\nawait wa.Chat.pin(\"5491112345678@s.whatsapp.net\", true);\n\n// Desfijar\nawait wa.Chat.pin(\"5491112345678@s.whatsapp.net\", false);\n</code></pre>"},{"location":"es/references/chat/#chatarchivecid-value","title":"<code>Chat.archive(cid, value)</code>","text":"<p>Archiva o desarchiva un chat.</p> <pre><code>// Archivar\nawait wa.Chat.archive(\"5491112345678@s.whatsapp.net\", true);\n\n// Desarchivar\nawait wa.Chat.archive(\"5491112345678@s.whatsapp.net\", false);\n</code></pre>"},{"location":"es/references/chat/#chatmutecid-duration","title":"<code>Chat.mute(cid, duration)</code>","text":"<p>Silencia o desilencia un chat.</p> Parametro Tipo Descripcion <code>cid</code> <code>string</code> ID del chat <code>duration</code> <code>number \\| null</code> Duracion en milisegundos o <code>null</code> para desilenciar <pre><code>// Silenciar por 8 horas\nawait wa.Chat.mute(\n  \"5491112345678@s.whatsapp.net\",\n  8 * 60 * 60 * 1000\n);\n\n// Silenciar por 1 semana\nawait wa.Chat.mute(\n  \"5491112345678@s.whatsapp.net\",\n  7 * 24 * 60 * 60 * 1000\n);\n\n// Desilenciar\nawait wa.Chat.mute(\"5491112345678@s.whatsapp.net\", null);\n</code></pre>"},{"location":"es/references/chat/#chatseencid","title":"<code>Chat.seen(cid)</code>","text":"<p>Marca el ultimo mensaje del chat como leido.</p> <pre><code>await wa.Chat.seen(\"5491112345678@s.whatsapp.net\");\n</code></pre>"},{"location":"es/references/chat/#chatremovecid","title":"<code>Chat.remove(cid)</code>","text":"<p>Elimina un chat. Si es grupo, sale del grupo antes de eliminar.</p> <pre><code>await wa.Chat.remove(\"5491112345678@s.whatsapp.net\");\n</code></pre>"},{"location":"es/references/chat/#chatmemberscid-offset-limit","title":"<code>Chat.members(cid, offset, limit)</code>","text":"<p>Obtiene los miembros del chat.</p> <ul> <li>En chats individuales: retorna el contacto</li> <li>En grupos: retorna los participantes del grupo</li> </ul> <pre><code>// Miembros de un grupo\nconst members = await wa.Chat.members(\"123456789@g.us\", 0, 50);\nfor (const member of members) {\n  console.log(`${member.name} (${member.phone})`);\n}\n\n// Miembro de chat individual (retorna el contacto)\nconst contacts = await wa.Chat.members(\"5491112345678@s.whatsapp.net\", 0, 1);\n</code></pre>"},{"location":"es/references/chat/#chatpaginateoffset-limit","title":"<code>Chat.paginate(offset?, limit?)</code>","text":"<p>Obtiene chats con paginacion.</p> <pre><code>const chats = await wa.Chat.paginate(0, 100);\nfor (const chat of chats) {\n  console.log(`${chat.name} (${chat.type})`);\n}\n</code></pre>"},{"location":"es/references/chat/#chatcascade_deletecid","title":"<code>Chat.cascade_delete(cid)</code>","text":"<p>Elimina todos los datos del chat del storage sin notificar a WhatsApp.</p> <pre><code>await wa.Chat.cascade_delete(\"5491112345678@s.whatsapp.net\");\n</code></pre>"},{"location":"es/references/chat/#chatadd_messagecid-mid-timestamp","title":"<code>Chat.add_message(cid, mid, timestamp)</code>","text":"<p>Agrega un mensaje al indice del chat.</p> <pre><code>await wa.Chat.add_message(cid, mid, timestamp);\n</code></pre>"},{"location":"es/references/chat/#chatremove_messagecid-mid","title":"<code>Chat.remove_message(cid, mid)</code>","text":"<p>Elimina un mensaje del indice del chat.</p> <pre><code>await wa.Chat.remove_message(cid, mid);\n</code></pre>"},{"location":"es/references/chat/#chatlist_messagescid-offset-limit","title":"<code>Chat.list_messages(cid, offset?, limit?)</code>","text":"<p>Lista IDs de mensajes del chat (paginado).</p> <pre><code>const ids = await wa.Chat.list_messages(cid, 0, 50);\n</code></pre>"},{"location":"es/references/chat/#chatcount_messagescid","title":"<code>Chat.count_messages(cid)</code>","text":"<p>Cuenta mensajes de un chat.</p> <pre><code>const count = await wa.Chat.count_messages(cid);\n</code></pre>"},{"location":"es/references/chat/#eventos-de-chat","title":"Eventos de Chat","text":"<p>Los eventos se escuchan a traves de <code>wa.event</code>:</p>"},{"location":"es/references/chat/#chatcreated","title":"<code>chat:created</code>","text":"<p>Emitido cuando se crea un nuevo chat.</p> <pre><code>wa.event.on(\"chat:created\", (chat) =&gt; {\n  console.log(`Nuevo chat: ${chat.name} (${chat.type})`);\n});\n</code></pre>"},{"location":"es/references/chat/#chatupdated","title":"<code>chat:updated</code>","text":"<p>Emitido cuando se actualiza un chat existente.</p> <pre><code>wa.event.on(\"chat:updated\", (chat) =&gt; {\n  console.log(`Chat actualizado: ${chat.name}`);\n});\n</code></pre>"},{"location":"es/references/chat/#chatpined","title":"<code>chat:pined</code>","text":"<p>Emitido cuando se fija o desfija un chat.</p> <pre><code>wa.event.on(\"chat:pined\", (cid, pined) =&gt; {\n  if (pined) {\n    console.log(`Chat ${cid} fijado`);\n  } else {\n    console.log(`Chat ${cid} desfijado`);\n  }\n});\n</code></pre>"},{"location":"es/references/chat/#chatarchived","title":"<code>chat:archived</code>","text":"<p>Emitido cuando se archiva o desarchiva un chat.</p> <pre><code>wa.event.on(\"chat:archived\", (cid, archived) =&gt; {\n  console.log(`Chat ${cid}: ${archived ? \"archivado\" : \"desarchivado\"}`);\n});\n</code></pre>"},{"location":"es/references/chat/#chatmuted","title":"<code>chat:muted</code>","text":"<p>Emitido cuando se silencia o desilencia un chat.</p> <pre><code>wa.event.on(\"chat:muted\", (cid, muted) =&gt; {\n  if (muted) {\n    console.log(`Chat ${cid} silenciado hasta ${new Date(muted)}`);\n  } else {\n    console.log(`Chat ${cid} desilenciado`);\n  }\n});\n</code></pre>"},{"location":"es/references/chat/#chatdeleted","title":"<code>chat:deleted</code>","text":"<p>Emitido cuando se elimina un chat.</p> <pre><code>wa.event.on(\"chat:deleted\", (cid) =&gt; {\n  console.log(`Chat eliminado: ${cid}`);\n});\n</code></pre>"},{"location":"es/references/chat/#metodos-de-instancia","title":"Metodos de instancia","text":""},{"location":"es/references/chat/#messagesoffset-limit","title":"<code>messages(offset?, limit?)</code>","text":"<p>Obtiene los mensajes del chat con paginacion.</p> <pre><code>const chat = await wa.Chat.get(\"5491112345678@s.whatsapp.net\");\nif (chat) {\n  const messages = await chat.messages(0, 100);\n  for (const msg of messages) {\n    console.log(`${msg.type}: ${msg.caption}`);\n  }\n}\n</code></pre> Parametro Tipo Default Descripcion <code>offset</code> <code>number</code> <code>0</code> Posicion inicial <code>limit</code> <code>number</code> <code>50</code> Cantidad maxima de mensajes"},{"location":"es/references/chat/#diferenciar-contactos-de-grupos","title":"Diferenciar contactos de grupos","text":"<pre><code>wa.event.on(\"chat:created\", (chat) =&gt; {\n  if (chat.type === \"group\") {\n    console.log(`Grupo: ${chat.name}`);\n  } else {\n    console.log(`Chat individual: ${chat.name}`);\n  }\n});\n\n// O verificar por JID\nfunction is_group(cid: string): boolean {\n  return cid.endsWith(\"@g.us\");\n}\n</code></pre>"},{"location":"es/references/chat/#ejemplos","title":"Ejemplos","text":""},{"location":"es/references/chat/#listar-miembros-de-un-grupo","title":"Listar miembros de un grupo","text":"<pre><code>const group_id = \"123456789@g.us\";\nconst members = await wa.Chat.members(group_id, 0, 1000);\n\nconsole.log(`Grupo tiene ${members.length} miembros:`);\nfor (const member of members) {\n  console.log(`  - ${member.name}`);\n}\n</code></pre>"},{"location":"es/references/chat/#silenciar-grupos-nuevos-automaticamente","title":"Silenciar grupos nuevos automaticamente","text":"<pre><code>wa.event.on(\"chat:created\", async (chat) =&gt; {\n  if (chat.type === \"group\") {\n    // Silenciar por 1 a\u00f1o (efectivamente indefinido)\n    await wa.Chat.mute(chat.id, 365 * 24 * 60 * 60 * 1000);\n    console.log(`Grupo ${chat.name} silenciado automaticamente`);\n  }\n});\n</code></pre>"},{"location":"es/references/chat/#archivar-chats-inactivos","title":"Archivar chats inactivos","text":"<pre><code>// Archivar chats que no estan fijados ni silenciados\nasync function archive_inactive(wa: WhatsApp) {\n  const chat = await wa.Chat.get(\"5491112345678@s.whatsapp.net\");\n  if (chat &amp;&amp; !chat.pined &amp;&amp; !chat.archived) {\n    await wa.Chat.archive(chat.id, true);\n  }\n}\n</code></pre>"},{"location":"es/references/chat/#enviar-mensaje-a-todos-los-miembros-de-un-grupo","title":"Enviar mensaje a todos los miembros de un grupo","text":"<pre><code>async function broadcast_to_members(wa: WhatsApp, group_id: string, text: string) {\n  const members = await wa.Chat.members(group_id, 0, 1000);\n\n  for (const member of members) {\n    // Enviar mensaje individual a cada miembro\n    await wa.Message.text(member.id, text);\n    // Esperar entre mensajes para evitar ban\n    await new Promise(r =&gt; setTimeout(r, 2000));\n  }\n}\n</code></pre>"},{"location":"es/references/chat/#interfaz-ichat","title":"Interfaz IChat","text":"<pre><code>interface IChat {\n  id: string;\n  name: string;\n  type: \"contact\" | \"group\";\n  content: string;\n  pined: boolean;\n  archived: boolean;\n  muted: number | false;\n  readed: boolean;\n  readonly: boolean;\n  labels: string[];\n  raw: IChatRaw;\n}\n</code></pre>"},{"location":"es/references/chat/#notas","title":"Notas","text":"<p>JID de chats</p> <ul> <li>Chats individuales: <code>{numero}@s.whatsapp.net</code> (ej: <code>5491112345678@s.whatsapp.net</code>)</li> <li>Grupos: <code>{id}@g.us</code> (ej: <code>123456789@g.us</code>)</li> <li>Linked IDs (LID): <code>{id}@lid</code> (formato interno de WhatsApp)</li> </ul> <p>Salir de grupos</p> <p>Al llamar <code>Chat.remove()</code> en un grupo, primero se sale del grupo y luego se elimina el chat local.</p> <p>Pined timestamp</p> <p>El campo <code>pined</code> contiene el timestamp de cuando se fijo el chat. Util para ordenar chats fijados por orden de fijacion.</p>"},{"location":"es/references/contact/","title":"Contact","text":"<p>Clase para gestionar contactos de WhatsApp.</p>"},{"location":"es/references/contact/#importacion","title":"Importacion","text":"<p>La clase se accede desde la instancia de WhatsApp:</p> <pre><code>const wa = new WhatsApp();\nwa.Contact // Clase Contact enlazada\n</code></pre>"},{"location":"es/references/contact/#propiedades","title":"Propiedades","text":"Propiedad Tipo Descripcion <code>id</code> <code>string</code> JID del contacto (ej: <code>5491112345678@s.whatsapp.net</code>) <code>me</code> <code>boolean</code> <code>true</code> si es el usuario autenticado <code>name</code> <code>string</code> Nombre del contacto <code>phone</code> <code>string \\| null</code> Numero de telefono <code>photo</code> <code>string \\| null</code> URL de la foto de perfil o <code>null</code>"},{"location":"es/references/contact/#metodos-estaticos","title":"Metodos estaticos","text":""},{"location":"es/references/contact/#contactgetuid","title":"<code>Contact.get(uid)</code>","text":"<p>Obtiene un contacto por su ID o numero de telefono. Si no existe en el engine, verifica con WhatsApp (<code>onWhatsApp</code>) y lo crea automaticamente.</p> <pre><code>// Con JID completo\nconst contact = await wa.Contact.get(\"5491112345678@s.whatsapp.net\");\n\n// O solo con numero de telefono\nconst contact2 = await wa.Contact.get(\"5491112345678\");\n\nif (contact) {\n  console.log(`Nombre: ${contact.name}`);\n  console.log(`Telefono: ${contact.phone}`);\n  console.log(`Es yo: ${contact.me}`);\n}\n</code></pre>"},{"location":"es/references/contact/#contactrenameuid-name","title":"<code>Contact.rename(uid, name)</code>","text":"<p>Cambia el nombre de un contacto (solo local).</p> <pre><code>await wa.Contact.rename(\"5491112345678@s.whatsapp.net\", \"Cliente VIP\");\n</code></pre>"},{"location":"es/references/contact/#contactpaginateoffset-limit","title":"<code>Contact.paginate(offset, limit)</code>","text":"<p>Obtiene contactos paginados.</p> <pre><code>const contacts = await wa.Contact.paginate(0, 50);\nfor (const contact of contacts) {\n  console.log(`${contact.name}: ${contact.phone}`);\n}\n</code></pre>"},{"location":"es/references/contact/#metodos-de-instancia","title":"Metodos de instancia","text":""},{"location":"es/references/contact/#renamename","title":"<code>rename(name)</code>","text":"<p>Cambia el nombre del contacto (solo local).</p> <pre><code>const contact = await wa.Contact.get(\"5491112345678@s.whatsapp.net\");\nif (contact) {\n  await contact.rename(\"Mi mejor amigo\");\n  console.log(contact.name); // \"Mi mejor amigo\"\n}\n</code></pre>"},{"location":"es/references/contact/#chat","title":"<code>chat()</code>","text":"<p>Obtiene o crea el chat 1-1 con este contacto.</p> <pre><code>const contact = await wa.Contact.get(\"5491112345678@s.whatsapp.net\");\nif (contact) {\n  const chat = await contact.chat();\n  if (chat) {\n    console.log(`Chat: ${chat.name} (${chat.type})`);\n  }\n}\n</code></pre>"},{"location":"es/references/contact/#eventos-de-contact","title":"Eventos de Contact","text":"<p>Los eventos se escuchan a traves de <code>wa.event</code>:</p>"},{"location":"es/references/contact/#contactcreated","title":"<code>contact:created</code>","text":"<p>Emitido cuando se crea un nuevo contacto.</p> <pre><code>wa.event.on(\"contact:created\", (contact) =&gt; {\n  console.log(`Nuevo contacto: ${contact.name}`);\n  console.log(`  Telefono: ${contact.phone}`);\n});\n</code></pre>"},{"location":"es/references/contact/#contactupdated","title":"<code>contact:updated</code>","text":"<p>Emitido cuando se actualiza un contacto existente.</p> <pre><code>wa.event.on(\"contact:updated\", (contact) =&gt; {\n  console.log(`Contacto actualizado: ${contact.name}`);\n});\n</code></pre>"},{"location":"es/references/contact/#ejemplos","title":"Ejemplos","text":""},{"location":"es/references/contact/#listar-todos-los-contactos","title":"Listar todos los contactos","text":"<pre><code>let offset = 0;\nconst limit = 50;\nconst all_contacts = [];\n\nwhile (true) {\n  const page = await wa.Contact.paginate(offset, limit);\n  if (page.length === 0) break;\n  all_contacts.push(...page);\n  offset += limit;\n}\n\nconsole.log(`Total de contactos: ${all_contacts.length}`);\n</code></pre>"},{"location":"es/references/contact/#buscar-contacto-por-nombre","title":"Buscar contacto por nombre","text":"<pre><code>async function find_contact_by_name(wa: WhatsApp, name: string) {\n  let offset = 0;\n  const limit = 50;\n\n  while (true) {\n    const contacts = await wa.Contact.paginate(offset, limit);\n    if (contacts.length === 0) break;\n\n    const found = contacts.find(c =&gt;\n      c.name.toLowerCase().includes(name.toLowerCase())\n    );\n\n    if (found) return found;\n    offset += limit;\n  }\n\n  return null;\n}\n\nconst contact = await find_contact_by_name(wa, \"Juan\");\nif (contact) {\n  await wa.Message.text(contact.id, \"Te encontre!\");\n}\n</code></pre>"},{"location":"es/references/contact/#mensaje-de-bienvenida-a-nuevos-contactos","title":"Mensaje de bienvenida a nuevos contactos","text":"<pre><code>wa.event.on(\"contact:created\", async (contact) =&gt; {\n  // Evitar enviarse mensaje a si mismo\n  if (contact.me) return;\n\n  await wa.Message.text(\n    contact.id,\n    \"Bienvenido! Soy un bot de asistencia. Escribe !ayuda para ver comandos.\"\n  );\n});\n</code></pre>"},{"location":"es/references/contact/#enviar-mensaje-desde-contacto","title":"Enviar mensaje desde contacto","text":"<pre><code>const contact = await wa.Contact.get(\"5491112345678@s.whatsapp.net\");\nif (contact) {\n  // Opcion 1: Usando el chat del contacto\n  const chat = await contact.chat();\n  // Enviar al chat...\n\n  // Opcion 2: Directamente con el ID del contacto\n  await wa.Message.text(contact.id, \"Hola desde tu contacto!\");\n}\n</code></pre>"},{"location":"es/references/contact/#interfaz-icontact","title":"Interfaz IContact","text":"<pre><code>interface IContact {\n  id: string;\n  me: boolean;\n  name: string;\n  phone: string | null;\n  photo: string | null;\n}\n</code></pre>"},{"location":"es/references/contact/#notas","title":"Notas","text":"<p>JID de contacto</p> <p>El JID (Jabber ID) de un contacto tiene el formato <code>{numero}@s.whatsapp.net</code>. Ejemplo: <code>5491112345678@s.whatsapp.net</code></p> <p>Nombre local</p> <p>El nombre del contacto se almacena localmente en el engine. Los cambios con <code>rename()</code> solo afectan tu instancia, no lo que otros ven.</p> <p>Verificacion de WhatsApp</p> <p><code>Contact.get()</code> verifica con WhatsApp si el numero existe. Si el numero no tiene WhatsApp, retorna <code>null</code>.</p>"},{"location":"es/references/engines/","title":"Engines de Persistencia","text":"<p>Los engines determinan donde se almacenan la sesion, contactos, chats y mensajes.</p>"},{"location":"es/references/engines/#importacion","title":"Importacion","text":"<pre><code>import { Engine, FileEngine } from \"@arcaelas/whatsapp\";\n</code></pre>"},{"location":"es/references/engines/#arquitectura","title":"Arquitectura","text":"<p>El sistema de persistencia usa un patron simple:</p> <pre><code>WhatsApp -&gt; Engine (FileEngine o custom)\n</code></pre> <p>Los engines implementan una interfaz generica de <code>get/set/list</code> para almacenamiento key-value de texto (JSON stringified).</p>"},{"location":"es/references/engines/#interface-engine","title":"Interface Engine","text":"<p>Define el contrato que deben implementar todos los engines.</p> <pre><code>interface Engine {\n  get(key: string): Promise&lt;string | null&gt;;\n  set(key: string, value: string | null): Promise&lt;void&gt;;\n  list(prefix: string, offset?: number, limit?: number): Promise&lt;string[]&gt;;\n}\n</code></pre>"},{"location":"es/references/engines/#metodos","title":"Metodos","text":""},{"location":"es/references/engines/#getkey","title":"<code>get(key)</code>","text":"<p>Obtiene un valor por su key.</p> <pre><code>const data = await engine.get(\"contact/5491112345678@s.whatsapp.net/index\");\nif (data) {\n  const contact = JSON.parse(data);\n  console.log(contact.name);\n}\n</code></pre>"},{"location":"es/references/engines/#setkey-value","title":"<code>set(key, value)</code>","text":"<p>Guarda o elimina un valor.</p> <pre><code>// Guardar\nawait engine.set(\"contact/123/index\", JSON.stringify({ name: \"John\" }));\n\n// Eliminar (pasar null)\nawait engine.set(\"contact/123/index\", null);\n</code></pre>"},{"location":"es/references/engines/#listprefix-offset-limit","title":"<code>list(prefix, offset?, limit?)</code>","text":"<p>Lista keys bajo un prefijo, ordenados por mas reciente.</p> <pre><code>// Listar contactos\nconst keys = await engine.list(\"contact/\", 0, 50);\nfor (const key of keys) {\n  const data = await engine.get(key);\n  console.log(key, data);\n}\n</code></pre>"},{"location":"es/references/engines/#estructura-de-keys","title":"Estructura de keys","text":"<p>Los keys siguen una convencion de paths:</p> Tipo Patron Ejemplo Session <code>session/{key}</code> <code>session/creds</code> Signal keys <code>session/{type}/{id}</code> <code>session/pre-key/1</code> Contact <code>contact/{jid}/index</code> <code>contact/5491112345678@s.whatsapp.net/index</code> Chat <code>chat/{jid}/index</code> <code>chat/5491112345678@s.whatsapp.net/index</code> Message <code>chat/{cid}/message/{mid}/index</code> <code>chat/123@s.whatsapp.net/message/ABC123/index</code> Content <code>chat/{cid}/message/{mid}/content</code> <code>chat/123@s.whatsapp.net/message/ABC123/content</code>"},{"location":"es/references/engines/#fileengine","title":"FileEngine","text":"<p>Engine de persistencia en sistema de archivos local. Es el engine por defecto.</p>"},{"location":"es/references/engines/#constructor","title":"Constructor","text":"<pre><code>new FileEngine(basePath?: string)\n</code></pre> Parametro Tipo Default Descripcion <code>basePath</code> <code>string</code> <code>.baileys/default</code> Directorio base"},{"location":"es/references/engines/#estructura-de-archivos","title":"Estructura de archivos","text":"<pre><code>{basePath}/\n  session/\n    creds              # Credenciales JSON\n    pre-key/\n      1                # Claves de cifrado\n    ...\n  contact/\n    5491112345678_at_s.whatsapp.net/\n      index            # Contacto JSON\n  chat/\n    5491112345678_at_s.whatsapp.net/\n      index            # Chat JSON\n      message/\n        ABC123/\n          index        # Mensaje JSON\n          content      # Contenido (base64 para media)\n</code></pre> <p>Sanitizacion de keys</p> <p>El caracter <code>@</code> se reemplaza por <code>_at_</code> en los nombres de archivos para compatibilidad con sistemas de archivos.</p>"},{"location":"es/references/engines/#ejemplo","title":"Ejemplo","text":"<pre><code>import { WhatsApp, FileEngine } from \"@arcaelas/whatsapp\";\n\n// Ruta por defecto (.baileys/default)\nconst wa1 = new WhatsApp();\n\n// Ruta personalizada\nconst wa2 = new WhatsApp({\n  engine: new FileEngine(\".baileys/mi-bot\"),\n});\n\n// Multiples instancias con diferentes sesiones\nconst wa_prod = new WhatsApp({\n  engine: new FileEngine(\".baileys/produccion\"),\n});\n\nconst wa_dev = new WhatsApp({\n  engine: new FileEngine(\".baileys/desarrollo\"),\n});\n</code></pre>"},{"location":"es/references/engines/#notas","title":"Notas","text":"<p>Backup</p> <p>Puedes hacer backup copiando el directorio completo.</p> <p>Permisos</p> <p>Asegurate de tener permisos de escritura en el directorio.</p>"},{"location":"es/references/engines/#crear-un-engine-personalizado","title":"Crear un Engine personalizado","text":"<p>Puedes crear tu propio engine para usar con Redis, MongoDB, PostgreSQL, etc.</p>"},{"location":"es/references/engines/#ejemplo-redis-engine","title":"Ejemplo: Redis Engine","text":"<pre><code>import type { Engine } from \"@arcaelas/whatsapp\";\nimport { createClient } from \"redis\";\n\nexport class RedisEngine implements Engine {\n  private client: ReturnType&lt;typeof createClient&gt;;\n\n  constructor(url: string) {\n    this.client = createClient({ url });\n  }\n\n  async connect() {\n    await this.client.connect();\n  }\n\n  async get(key: string): Promise&lt;string | null&gt; {\n    return await this.client.get(key);\n  }\n\n  async set(key: string, value: string | null): Promise&lt;void&gt; {\n    if (value === null) {\n      await this.client.del(key);\n    } else {\n      await this.client.set(key, value);\n    }\n  }\n\n  async list(prefix: string, offset = 0, limit = 50): Promise&lt;string[]&gt; {\n    const keys = await this.client.keys(`${prefix}*`);\n    return keys.slice(offset, offset + limit);\n  }\n}\n</code></pre>"},{"location":"es/references/engines/#uso","title":"Uso","text":"<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\nimport { RedisEngine } from \"./RedisEngine\";\n\nconst engine = new RedisEngine(\"redis://localhost:6379\");\nawait engine.connect();\n\nconst wa = new WhatsApp({ engine });\n</code></pre>"},{"location":"es/references/engines/#ejemplo-postgresql-engine","title":"Ejemplo: PostgreSQL Engine","text":"<pre><code>import type { Engine } from \"@arcaelas/whatsapp\";\nimport { Pool } from \"pg\";\n\nexport class PostgresEngine implements Engine {\n  private pool: Pool;\n\n  constructor(connection_string: string) {\n    this.pool = new Pool({ connectionString: connection_string });\n  }\n\n  async get(key: string): Promise&lt;string | null&gt; {\n    const result = await this.pool.query(\n      \"SELECT data FROM storage WHERE key = $1\",\n      [key]\n    );\n    return result.rows[0]?.data ?? null;\n  }\n\n  async set(key: string, value: string | null): Promise&lt;void&gt; {\n    if (value === null) {\n      await this.pool.query(\"DELETE FROM storage WHERE key = $1\", [key]);\n    } else {\n      await this.pool.query(\n        `INSERT INTO storage (key, data, updated_at)\n         VALUES ($1, $2, NOW())\n         ON CONFLICT (key) DO UPDATE SET data = $2, updated_at = NOW()`,\n        [key, value]\n      );\n    }\n  }\n\n  async list(prefix: string, offset = 0, limit = 50): Promise&lt;string[]&gt; {\n    const result = await this.pool.query(\n      `SELECT key FROM storage\n       WHERE key LIKE $1\n       ORDER BY updated_at DESC\n       OFFSET $2 LIMIT $3`,\n      [`${prefix}%`, offset, limit]\n    );\n    return result.rows.map(r =&gt; r.key);\n  }\n}\n</code></pre>"},{"location":"es/references/engines/#schema-sql","title":"Schema SQL","text":"<pre><code>CREATE TABLE storage (\n  key TEXT PRIMARY KEY,\n  data TEXT NOT NULL,\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n\nCREATE INDEX idx_storage_prefix ON storage (key text_pattern_ops);\nCREATE INDEX idx_storage_updated ON storage (updated_at DESC);\n</code></pre>"},{"location":"es/references/engines/#ejemplo-memory-engine-para-testing","title":"Ejemplo: Memory Engine (para testing)","text":"<pre><code>import type { Engine } from \"@arcaelas/whatsapp\";\n\nexport class MemoryEngine implements Engine {\n  private store = new Map&lt;string, { data: string; time: number }&gt;();\n\n  async get(key: string): Promise&lt;string | null&gt; {\n    return this.store.get(key)?.data ?? null;\n  }\n\n  async set(key: string, value: string | null): Promise&lt;void&gt; {\n    if (value === null) {\n      this.store.delete(key);\n    } else {\n      this.store.set(key, { data: value, time: Date.now() });\n    }\n  }\n\n  async list(prefix: string, offset = 0, limit = 50): Promise&lt;string[]&gt; {\n    const keys = [...this.store.entries()]\n      .filter(([k]) =&gt; k.startsWith(prefix))\n      .sort((a, b) =&gt; b[1].time - a[1].time)\n      .map(([k]) =&gt; k);\n    return keys.slice(offset, offset + limit);\n  }\n}\n</code></pre> <p>Solo para testing</p> <p>Los datos se pierden al reiniciar. Deberas escanear el QR nuevamente.</p>"},{"location":"es/references/engines/#comparacion-de-engines","title":"Comparacion de Engines","text":"Caracteristica FileEngine Redis PostgreSQL Memory Persistencia Si Si Si No Escalabilidad Baja Alta Alta N/A Latencia Baja Muy baja Media Muy baja Multi-instancia No Si Si No Ideal para Desarrollo Cache + Prod Produccion Testing"},{"location":"es/references/engines/#notas_1","title":"Notas","text":"<p>Serializacion</p> <p>Todos los valores se almacenan como texto. Usa <code>JSON.stringify()</code> para objetos y <code>BufferJSON</code> de Baileys para datos binarios.</p> <p>BufferJSON</p> <p>Baileys incluye <code>BufferJSON.replacer</code> y <code>BufferJSON.reviver</code> para serializar/deserializar Buffers como base64 en JSON.</p>"},{"location":"es/references/events/","title":"Eventos","text":"<p>Referencia completa de todos los eventos emitidos por WhatsApp.</p>"},{"location":"es/references/events/#escuchar-eventos","title":"Escuchar eventos","text":"<p>WhatsApp expone un EventEmitter tipado a traves de <code>wa.event</code>:</p> <pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\n\nconst wa = new WhatsApp();\n\n// Escuchar evento\nwa.event.on(\"message:created\", (msg) =&gt; {\n  // msg esta tipado correctamente\n});\n\n// Escuchar una sola vez\nwa.event.once(\"open\", () =&gt; {\n  console.log(\"Primera conexion exitosa\");\n});\n\n// Remover listener\nconst handler = (msg) =&gt; console.log(msg);\nwa.event.on(\"message:created\", handler);\nwa.event.off(\"message:created\", handler);\n</code></pre>"},{"location":"es/references/events/#eventos-de-conexion","title":"Eventos de conexion","text":""},{"location":"es/references/events/#open","title":"<code>open</code>","text":"<p>Emitido cuando la conexion es exitosa.</p> <pre><code>wa.event.on(\"open\", () =&gt; {\n  console.log(\"Conectado a WhatsApp\");\n  // Aqui puedes empezar a enviar mensajes\n});\n</code></pre> <p>Payload: ninguno</p>"},{"location":"es/references/events/#close","title":"<code>close</code>","text":"<p>Emitido cuando la conexion se cierra. La reconexion es automatica.</p> <pre><code>wa.event.on(\"close\", () =&gt; {\n  console.log(\"Desconectado, reconectando...\");\n});\n</code></pre> <p>Payload: ninguno</p>"},{"location":"es/references/events/#error","title":"<code>error</code>","text":"<p>Emitido cuando ocurre un error fatal que no permite reconexion.</p> <pre><code>wa.event.on(\"error\", (error) =&gt; {\n  console.error(\"Error fatal:\", error.message);\n\n  // Error comun:\n  // - \"Logged out\" - Sesion cerrada desde telefono\n});\n</code></pre> <p>Payload: <code>Error</code></p>"},{"location":"es/references/events/#eventos-de-contacto","title":"Eventos de contacto","text":""},{"location":"es/references/events/#contactcreated","title":"<code>contact:created</code>","text":"<p>Emitido cuando se crea un nuevo contacto.</p> <pre><code>wa.event.on(\"contact:created\", (contact) =&gt; {\n  console.log(`Nuevo contacto: ${contact.name}`);\n  console.log(`  ID: ${contact.id}`);\n  console.log(`  Telefono: ${contact.phone}`);\n  console.log(`  Es yo: ${contact.me}`);\n});\n</code></pre> <p>Payload: <code>Contact</code></p>"},{"location":"es/references/events/#contactupdated","title":"<code>contact:updated</code>","text":"<p>Emitido cuando se actualiza un contacto existente.</p> <pre><code>wa.event.on(\"contact:updated\", (contact) =&gt; {\n  console.log(`Contacto actualizado: ${contact.name}`);\n});\n</code></pre> <p>Payload: <code>Contact</code></p>"},{"location":"es/references/events/#eventos-de-chat","title":"Eventos de chat","text":""},{"location":"es/references/events/#chatcreated","title":"<code>chat:created</code>","text":"<p>Emitido cuando se crea un nuevo chat.</p> <pre><code>wa.event.on(\"chat:created\", (chat) =&gt; {\n  if (chat.type === \"group\") {\n    console.log(`Nuevo grupo: ${chat.name}`);\n  } else {\n    console.log(`Nuevo chat: ${chat.name}`);\n  }\n});\n</code></pre> <p>Payload: <code>Chat</code></p>"},{"location":"es/references/events/#chatupdated","title":"<code>chat:updated</code>","text":"<p>Emitido cuando se actualiza un chat existente.</p> <pre><code>wa.event.on(\"chat:updated\", (chat) =&gt; {\n  console.log(`Chat actualizado: ${chat.name}`);\n});\n</code></pre> <p>Payload: <code>Chat</code></p>"},{"location":"es/references/events/#chatpined","title":"<code>chat:pined</code>","text":"<p>Emitido cuando se fija o desfija un chat.</p> <pre><code>wa.event.on(\"chat:pined\", (cid, pined) =&gt; {\n  if (pined) {\n    console.log(`Chat ${cid} fijado en ${new Date(pined)}`);\n  } else {\n    console.log(`Chat ${cid} desfijado`);\n  }\n});\n</code></pre> <p>Payload: <code>(cid: string, pined: number | null)</code></p>"},{"location":"es/references/events/#chatarchived","title":"<code>chat:archived</code>","text":"<p>Emitido cuando se archiva o desarchiva un chat.</p> <pre><code>wa.event.on(\"chat:archived\", (cid, archived) =&gt; {\n  console.log(`Chat ${cid}: ${archived ? \"archivado\" : \"desarchivado\"}`);\n});\n</code></pre> <p>Payload: <code>(cid: string, archived: boolean)</code></p>"},{"location":"es/references/events/#chatmuted","title":"<code>chat:muted</code>","text":"<p>Emitido cuando se silencia o desilencia un chat.</p> <pre><code>wa.event.on(\"chat:muted\", (cid, muted) =&gt; {\n  if (muted) {\n    console.log(`Chat ${cid} silenciado hasta ${new Date(muted)}`);\n  } else {\n    console.log(`Chat ${cid} desilenciado`);\n  }\n});\n</code></pre> <p>Payload: <code>(cid: string, muted: number | null)</code></p>"},{"location":"es/references/events/#chatdeleted","title":"<code>chat:deleted</code>","text":"<p>Emitido cuando se elimina un chat.</p> <pre><code>wa.event.on(\"chat:deleted\", (cid) =&gt; {\n  console.log(`Chat eliminado: ${cid}`);\n});\n</code></pre> <p>Payload: <code>(cid: string)</code></p>"},{"location":"es/references/events/#eventos-de-mensaje","title":"Eventos de mensaje","text":""},{"location":"es/references/events/#messagecreated","title":"<code>message:created</code>","text":"<p>Emitido cuando se recibe un nuevo mensaje.</p> <pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  console.log(`Nuevo mensaje:`);\n  console.log(`  ID: ${msg.id}`);\n  console.log(`  Chat: ${msg.cid}`);\n  console.log(`  Tipo: ${msg.type}`);\n  console.log(`  Mio: ${msg.me}`);\n  console.log(`  Caption: ${msg.caption}`);\n\n  // Obtener contenido\n  if (msg.type === \"text\") {\n    const text = (await msg.content()).toString();\n    console.log(`  Texto: ${text}`);\n  }\n});\n</code></pre> <p>Payload: <code>Message</code></p> <p>Propiedades disponibles:</p> <ul> <li><code>id</code> - ID del mensaje</li> <li><code>cid</code> - JID del chat</li> <li><code>me</code> - true si es mensaje propio</li> <li><code>type</code> - Tipo de mensaje (text, image, video, audio, location, poll)</li> <li><code>mime</code> - MIME type</li> <li><code>caption</code> - Caption/texto</li> <li><code>status</code> - Estado del mensaje (enum)</li> <li><code>starred</code> - true si esta destacado</li> <li><code>forwarded</code> - true si fue reenviado</li> <li><code>edited</code> - true si fue editado</li> </ul>"},{"location":"es/references/events/#messageupdated","title":"<code>message:updated</code>","text":"<p>Emitido cuando se edita un mensaje.</p> <pre><code>wa.event.on(\"message:updated\", async (msg) =&gt; {\n  console.log(`Mensaje editado: ${msg.id}`);\n  console.log(`  edited: ${msg.edited}`); // true\n\n  if (msg.type === \"text\") {\n    const new_text = (await msg.content()).toString();\n    console.log(`  Nuevo texto: ${new_text}`);\n  }\n});\n</code></pre> <p>Payload: <code>Message</code></p>"},{"location":"es/references/events/#messagereacted","title":"<code>message:reacted</code>","text":"<p>Emitido cuando alguien reacciona a un mensaje.</p> <pre><code>wa.event.on(\"message:reacted\", (cid, mid, emoji) =&gt; {\n  console.log(`Reaccion en mensaje:`);\n  console.log(`  Chat: ${cid}`);\n  console.log(`  Mensaje: ${mid}`);\n  console.log(`  Emoji: ${emoji}`); // \"\" si se quito la reaccion\n});\n</code></pre> <p>Payload: <code>(cid: string, mid: string, emoji: string)</code></p>"},{"location":"es/references/events/#messagedeleted","title":"<code>message:deleted</code>","text":"<p>Emitido cuando se elimina un mensaje.</p> <pre><code>wa.event.on(\"message:deleted\", (cid, mid) =&gt; {\n  console.log(`Mensaje eliminado:`);\n  console.log(`  Chat: ${cid}`);\n  console.log(`  Mensaje: ${mid}`);\n});\n</code></pre> <p>Payload: <code>(cid: string, mid: string)</code></p>"},{"location":"es/references/events/#patrones-de-uso","title":"Patrones de uso","text":""},{"location":"es/references/events/#logger-completo","title":"Logger completo","text":"<pre><code>function setup_logger(wa: WhatsApp) {\n  // Conexion\n  wa.event.on(\"open\", () =&gt; console.log(\"[INFO] Conectado\"));\n  wa.event.on(\"close\", () =&gt; console.log(\"[WARN] Desconectado\"));\n  wa.event.on(\"error\", (e) =&gt; console.error(\"[ERROR]\", e.message));\n\n  // Contactos\n  wa.event.on(\"contact:created\", (c) =&gt;\n    console.log(`[CONTACT:NEW] ${c.name} (${c.phone})`)\n  );\n  wa.event.on(\"contact:updated\", (c) =&gt;\n    console.log(`[CONTACT:UPD] ${c.name}`)\n  );\n\n  // Chats\n  wa.event.on(\"chat:created\", (c) =&gt;\n    console.log(`[CHAT:NEW] ${c.name} (${c.type})`)\n  );\n  wa.event.on(\"chat:updated\", (c) =&gt;\n    console.log(`[CHAT:UPD] ${c.name}`)\n  );\n  wa.event.on(\"chat:pined\", (cid, p) =&gt;\n    console.log(`[CHAT:PIN] ${cid}: ${p ? \"fijado\" : \"desfijado\"}`)\n  );\n  wa.event.on(\"chat:archived\", (cid, a) =&gt;\n    console.log(`[CHAT:ARC] ${cid}: ${a ? \"archivado\" : \"desarchivado\"}`)\n  );\n  wa.event.on(\"chat:muted\", (cid, m) =&gt;\n    console.log(`[CHAT:MUTE] ${cid}: ${m ? \"silenciado\" : \"desilenciado\"}`)\n  );\n  wa.event.on(\"chat:deleted\", (cid) =&gt;\n    console.log(`[CHAT:DEL] ${cid}`)\n  );\n\n  // Mensajes\n  wa.event.on(\"message:created\", (m) =&gt;\n    console.log(`[MSG:NEW] ${m.cid} &lt;- ${m.type}`)\n  );\n  wa.event.on(\"message:updated\", (m) =&gt;\n    console.log(`[MSG:EDIT] ${m.id}`)\n  );\n  wa.event.on(\"message:reacted\", (cid, mid, emoji) =&gt;\n    console.log(`[MSG:REACT] ${mid}: ${emoji}`)\n  );\n  wa.event.on(\"message:deleted\", (cid, mid) =&gt;\n    console.log(`[MSG:DEL] ${mid} from ${cid}`)\n  );\n}\n</code></pre>"},{"location":"es/references/events/#filtrar-por-chat","title":"Filtrar por chat","text":"<pre><code>const MONITORED_CHAT = \"5491112345678@s.whatsapp.net\";\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.cid !== MONITORED_CHAT) return;\n  // Solo procesar mensajes de este chat\n});\n</code></pre>"},{"location":"es/references/events/#filtrar-por-tipo","title":"Filtrar por tipo","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  // Solo imagenes\n  if (msg.type !== \"image\") return;\n\n  const buffer = await msg.content();\n  console.log(`Imagen recibida: ${buffer.length} bytes`);\n});\n</code></pre>"},{"location":"es/references/events/#cola-de-procesamiento","title":"Cola de procesamiento","text":"<pre><code>const queue: Message[] = [];\nlet processing = false;\n\nwa.event.on(\"message:created\", (msg) =&gt; {\n  queue.push(msg);\n  process_queue();\n});\n\nasync function process_queue() {\n  if (processing || queue.length === 0) return;\n\n  processing = true;\n  const msg = queue.shift()!;\n\n  try {\n    await handle_message(msg);\n  } catch (error) {\n    console.error(\"Error procesando mensaje:\", error);\n  }\n\n  processing = false;\n  process_queue();\n}\n\nasync function handle_message(msg: Message) {\n  // Procesar mensaje\n}\n</code></pre>"},{"location":"es/references/events/#estadisticas-en-tiempo-real","title":"Estadisticas en tiempo real","text":"<pre><code>const stats = {\n  messages: 0,\n  text: 0,\n  image: 0,\n  video: 0,\n  audio: 0,\n  location: 0,\n  poll: 0,\n};\n\nwa.event.on(\"message:created\", (msg) =&gt; {\n  stats.messages++;\n  stats[msg.type as keyof typeof stats]++;\n\n  console.log(\"Estadisticas:\", stats);\n});\n</code></pre>"},{"location":"es/references/events/#interfaz-whatsappeventmap","title":"Interfaz WhatsAppEventMap","text":"<pre><code>interface WhatsAppEventMap {\n  // Conexion\n  open: [];\n  close: [];\n  error: [Error];\n\n  // Contactos\n  \"contact:created\": [Contact];\n  \"contact:updated\": [Contact];\n\n  // Chats\n  \"chat:created\": [Chat];\n  \"chat:updated\": [Chat];\n  \"chat:pined\": [cid: string, pined: number | null];\n  \"chat:archived\": [cid: string, archived: boolean];\n  \"chat:muted\": [cid: string, muted: number | null];\n  \"chat:deleted\": [cid: string];\n\n  // Mensajes\n  \"message:created\": [Message];\n  \"message:updated\": [Message];\n  \"message:reacted\": [cid: string, mid: string, emoji: string];\n  \"message:deleted\": [cid: string, mid: string];\n}\n</code></pre>"},{"location":"es/references/message/","title":"Message","text":"<p>Clase para gestionar mensajes de WhatsApp.</p>"},{"location":"es/references/message/#importacion","title":"Importacion","text":"<p>La clase se accede desde la instancia de WhatsApp:</p> <pre><code>const wa = new WhatsApp();\nwa.Message // Clase Message enlazada\n</code></pre>"},{"location":"es/references/message/#propiedades","title":"Propiedades","text":"<p>Propiedades disponibles en instancias de Message:</p> Propiedad Tipo Descripcion <code>id</code> <code>string</code> ID unico del mensaje <code>cid</code> <code>string</code> JID del chat <code>me</code> <code>boolean</code> <code>true</code> si el mensaje es propio <code>type</code> <code>MessageType</code> Tipo: <code>text</code>, <code>image</code>, <code>video</code>, <code>audio</code>, <code>location</code>, <code>poll</code> <code>mime</code> <code>string</code> Tipo MIME del contenido <code>caption</code> <code>string</code> Texto o caption del mensaje <code>status</code> <code>MESSAGE_STATUS</code> Estado del mensaje (enum numerico) <code>starred</code> <code>boolean</code> <code>true</code> si el mensaje esta destacado <code>forwarded</code> <code>boolean</code> <code>true</code> si el mensaje fue reenviado <code>edited</code> <code>boolean</code> <code>true</code> si fue editado"},{"location":"es/references/message/#enum-message_status","title":"Enum MESSAGE_STATUS","text":"<pre><code>enum MESSAGE_STATUS {\n  ERROR = 0,      // Error al enviar\n  PENDING = 1,    // Pendiente de envio\n  SERVER_ACK = 2, // Servidor confirmo recepcion\n  DELIVERED = 3,  // Entregado al destinatario\n  READ = 4,       // Leido por el destinatario\n  PLAYED = 5,     // Reproducido (audio/video)\n}\n</code></pre>"},{"location":"es/references/message/#tipo-messagetype","title":"Tipo MessageType","text":"<pre><code>type MessageType = \"text\" | \"image\" | \"video\" | \"audio\" | \"location\" | \"poll\";\n</code></pre>"},{"location":"es/references/message/#metodos-estaticos","title":"Metodos estaticos","text":""},{"location":"es/references/message/#messagegetcid-mid","title":"<code>Message.get(cid, mid)</code>","text":"<p>Obtiene un mensaje por chat ID y message ID.</p> <pre><code>const msg = await wa.Message.get(\n  \"5491112345678@s.whatsapp.net\",\n  \"MESSAGE_ID\"\n);\n\nif (msg) {\n  console.log(`Tipo: ${msg.type}`);\n  console.log(`Caption: ${msg.caption}`);\n}\n</code></pre>"},{"location":"es/references/message/#messagetextcid-text","title":"<code>Message.text(cid, text)</code>","text":"<p>Envia un mensaje de texto.</p> <pre><code>const msg = await wa.Message.text(\n  \"5491112345678@s.whatsapp.net\",\n  \"Hola mundo!\"\n);\n\nif (msg) {\n  console.log(`Mensaje enviado: ${msg.id}`);\n}\n</code></pre>"},{"location":"es/references/message/#messageimagecid-buffer-caption","title":"<code>Message.image(cid, buffer, caption?)</code>","text":"<p>Envia una imagen.</p> <pre><code>import * as fs from \"fs\";\n\nconst buffer = fs.readFileSync(\"./foto.jpg\");\nconst msg = await wa.Message.image(\n  \"5491112345678@s.whatsapp.net\",\n  buffer,\n  \"Mira esta foto!\"\n);\n</code></pre>"},{"location":"es/references/message/#messagevideocid-buffer-caption","title":"<code>Message.video(cid, buffer, caption?)</code>","text":"<p>Envia un video.</p> <pre><code>const buffer = fs.readFileSync(\"./video.mp4\");\nconst msg = await wa.Message.video(\n  \"5491112345678@s.whatsapp.net\",\n  buffer,\n  \"Video divertido\"\n);\n</code></pre>"},{"location":"es/references/message/#messageaudiocid-buffer-ptt","title":"<code>Message.audio(cid, buffer, ptt?)</code>","text":"<p>Envia un audio. Por defecto como nota de voz (PTT).</p> Parametro Tipo Default Descripcion <code>cid</code> <code>string</code> - ID del chat destino <code>buffer</code> <code>Buffer</code> - Buffer del audio <code>ptt</code> <code>boolean</code> <code>true</code> <code>true</code> para nota de voz, <code>false</code> para audio normal <pre><code>const buffer = fs.readFileSync(\"./audio.ogg\");\n\n// Como nota de voz (default)\nawait wa.Message.audio(\"5491112345678@s.whatsapp.net\", buffer);\n\n// Como audio normal\nawait wa.Message.audio(\"5491112345678@s.whatsapp.net\", buffer, false);\n</code></pre>"},{"location":"es/references/message/#messagelocationcid-opts","title":"<code>Message.location(cid, opts)</code>","text":"<p>Envia una ubicacion.</p> <pre><code>await wa.Message.location(\"5491112345678@s.whatsapp.net\", {\n  lat: -34.6037,\n  lng: -58.3816,\n});\n</code></pre> <p>Interfaz LocationOptions:</p> <pre><code>interface LocationOptions {\n  lat: number;   // Latitud en grados\n  lng: number;   // Longitud en grados\n  live?: boolean; // true para ubicacion en tiempo real\n}\n</code></pre>"},{"location":"es/references/message/#messagepollcid-opts","title":"<code>Message.poll(cid, opts)</code>","text":"<p>Envia una encuesta.</p> <pre><code>await wa.Message.poll(\"5491112345678@s.whatsapp.net\", {\n  content: \"Cual es tu lenguaje favorito?\",\n  options: [\n    { content: \"JavaScript\" },\n    { content: \"TypeScript\" },\n    { content: \"Python\" },\n    { content: \"Go\" },\n  ],\n});\n</code></pre> <p>Interfaz PollOptions:</p> <pre><code>interface PollOptions {\n  content: string;  // Pregunta o titulo de la encuesta\n  options: Array&lt;{ content: string }&gt;; // Opciones de respuesta\n}\n</code></pre>"},{"location":"es/references/message/#messagereactcid-mid-emoji","title":"<code>Message.react(cid, mid, emoji)</code>","text":"<p>Reacciona a un mensaje.</p> <pre><code>// Agregar reaccion\nawait wa.Message.react(\"CHAT_ID\", \"MESSAGE_ID\", \"\u2764\ufe0f\");\n\n// Quitar reaccion (emoji vacio)\nawait wa.Message.react(\"CHAT_ID\", \"MESSAGE_ID\", \"\");\n</code></pre>"},{"location":"es/references/message/#messageremovecid-mid","title":"<code>Message.remove(cid, mid)</code>","text":"<p>Elimina un mensaje para todos.</p> <pre><code>await wa.Message.remove(\"CHAT_ID\", \"MESSAGE_ID\");\n</code></pre>"},{"location":"es/references/message/#messageforwardcid-mid-to_cid","title":"<code>Message.forward(cid, mid, to_cid)</code>","text":"<p>Reenvia un mensaje a otro chat.</p> <pre><code>await wa.Message.forward(\n  \"CHAT_ORIGEN\",\n  \"MESSAGE_ID\",\n  \"CHAT_DESTINO\"\n);\n</code></pre>"},{"location":"es/references/message/#messageeditcid-mid-text","title":"<code>Message.edit(cid, mid, text)</code>","text":"<p>Edita un mensaje de texto (solo mensajes propios).</p> <pre><code>await wa.Message.edit(\"CHAT_ID\", \"MESSAGE_ID\", \"Texto corregido\");\n</code></pre>"},{"location":"es/references/message/#messagewatchcid-mid-handler","title":"<code>Message.watch(cid, mid, handler)</code>","text":"<p>Observa cambios en un mensaje especifico (ediciones, actualizaciones).</p> <pre><code>const unsubscribe = wa.Message.watch(\n  \"CHAT_ID\",\n  \"MESSAGE_ID\",\n  (msg) =&gt; {\n    console.log(`Mensaje actualizado: ${msg.caption}`);\n  }\n);\n\n// Dejar de observar\nunsubscribe();\n</code></pre>"},{"location":"es/references/message/#metodos-de-instancia","title":"Metodos de instancia","text":""},{"location":"es/references/message/#content","title":"<code>content()</code>","text":"<p>Obtiene el contenido del mensaje como Buffer.</p> <p>El contenido varia segun el tipo:</p> Tipo Contenido <code>text</code> Texto como Buffer UTF-8 <code>image</code> Buffer de la imagen <code>video</code> Buffer del video <code>audio</code> Buffer del audio <code>location</code> JSON <code>{ lat, lng }</code> como Buffer <code>poll</code> JSON <code>{ content, options }</code> como Buffer <pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  const buffer = await msg.content();\n\n  if (msg.type === \"text\") {\n    const text = buffer.toString();\n    console.log(`Texto: ${text}`);\n  } else if (msg.type === \"image\") {\n    require(\"fs\").writeFileSync(\"imagen.jpg\", buffer);\n  } else if (msg.type === \"location\") {\n    const { lat, lng } = JSON.parse(buffer.toString());\n    console.log(`Ubicacion: ${lat}, ${lng}`);\n  }\n});\n</code></pre>"},{"location":"es/references/message/#verificar-tipo-de-mensaje","title":"Verificar tipo de mensaje","text":""},{"location":"es/references/message/#usando-propiedad-type","title":"Usando propiedad type","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  switch (msg.type) {\n    case \"text\":\n      const text = (await msg.content()).toString();\n      console.log(`Texto: ${text}`);\n      break;\n    case \"image\":\n      const imgBuffer = await msg.content();\n      console.log(`Imagen: ${imgBuffer.length} bytes`);\n      break;\n    case \"video\":\n      const vidBuffer = await msg.content();\n      console.log(`Video: ${vidBuffer.length} bytes`);\n      break;\n    case \"audio\":\n      const audBuffer = await msg.content();\n      console.log(`Audio: ${audBuffer.length} bytes`);\n      break;\n    case \"location\":\n      const { lat, lng } = JSON.parse((await msg.content()).toString());\n      console.log(`Ubicacion: ${lat}, ${lng}`);\n      break;\n    case \"poll\":\n      const poll = JSON.parse((await msg.content()).toString());\n      console.log(`Encuesta: ${poll.content}`);\n      break;\n  }\n});\n</code></pre>"},{"location":"es/references/message/#ejemplos","title":"Ejemplos","text":""},{"location":"es/references/message/#guardar-todos-los-medios","title":"Guardar todos los medios","text":"<pre><code>import * as fs from \"fs\";\nimport * as path from \"path\";\n\nconst MEDIA_DIR = \"./medios\";\nfs.mkdirSync(MEDIA_DIR, { recursive: true });\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n\n  const timestamp = Date.now();\n  const buffer = await msg.content();\n\n  if (msg.type === \"image\") {\n    const ext = msg.mime.split(\"/\")[1] || \"jpg\";\n    fs.writeFileSync(path.join(MEDIA_DIR, `${timestamp}.${ext}`), buffer);\n  } else if (msg.type === \"video\") {\n    fs.writeFileSync(path.join(MEDIA_DIR, `${timestamp}.mp4`), buffer);\n  } else if (msg.type === \"audio\") {\n    fs.writeFileSync(path.join(MEDIA_DIR, `${timestamp}.ogg`), buffer);\n  }\n});\n</code></pre>"},{"location":"es/references/message/#bot-de-ubicacion","title":"Bot de ubicacion","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"location\") return;\n\n  const { lat, lng } = JSON.parse((await msg.content()).toString());\n\n  await wa.Message.text(\n    msg.cid,\n    `Recibi tu ubicacion:\\n` +\n    `Lat: ${lat}\\n` +\n    `Lng: ${lng}\\n` +\n    `Google Maps: https://maps.google.com/?q=${lat},${lng}`\n  );\n});\n</code></pre>"},{"location":"es/references/message/#bot-de-encuestas","title":"Bot de encuestas","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString();\n\n  // Crear encuesta con comando\n  if (text.startsWith(\"!encuesta \")) {\n    const parts = text.slice(10).split(\"|\").map(s =&gt; s.trim());\n    const [question, ...options] = parts;\n\n    if (options.length &gt;= 2) {\n      await wa.Message.poll(msg.cid, {\n        content: question,\n        options: options.map(opt =&gt; ({ content: opt })),\n      });\n    } else {\n      await wa.Message.text(\n        msg.cid,\n        \"Uso: !encuesta Pregunta | Opcion1 | Opcion2 | ...\"\n      );\n    }\n  }\n});\n</code></pre>"},{"location":"es/references/message/#eco-con-reaccion","title":"Eco con reaccion","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString();\n\n  if (text.startsWith(\"!eco \")) {\n    // Reaccionar al mensaje original\n    await wa.Message.react(msg.cid, msg.id, \"\ud83d\udc4d\");\n\n    // Enviar eco\n    await wa.Message.text(msg.cid, text.slice(5));\n  }\n});\n</code></pre>"},{"location":"es/references/message/#interfaz-imessage","title":"Interfaz IMessage","text":"<pre><code>interface IMessage {\n  raw: WAMessage;  // WAMessage original de Baileys\n  edited: boolean; // true si el mensaje fue editado\n}\n</code></pre>"},{"location":"es/references/message/#notas","title":"Notas","text":"<p>Contenido de mensajes</p> <p>El metodo <code>content()</code> siempre retorna Buffer. Usa <code>.toString()</code> para texto o <code>JSON.parse()</code> para location/poll.</p> <p>Media</p> <p>Para mensajes de media (image, video, audio), el contenido se descarga desde WhatsApp la primera vez y se almacena en cache en el engine.</p> <p>Caption vs Content</p> <ul> <li><code>caption</code> es el texto/descripcion del mensaje (disponible inmediatamente)</li> <li><code>content()</code> es el contenido completo (puede requerir descarga)</li> </ul>"},{"location":"es/references/whatsapp/","title":"WhatsApp","text":"<p>Clase principal que gestiona la conexion, eventos y entidades de WhatsApp.</p>"},{"location":"es/references/whatsapp/#importacion","title":"Importacion","text":"<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\n</code></pre>"},{"location":"es/references/whatsapp/#constructor","title":"Constructor","text":""},{"location":"es/references/whatsapp/#new-whatsappoptions","title":"<code>new WhatsApp(options?)</code>","text":"<p>Crea una nueva instancia de WhatsApp.</p> <p>Parametros:</p> Parametro Tipo Default Descripcion <code>options.engine</code> <code>Engine</code> <code>FileEngine</code> Engine de persistencia <code>options.phone</code> <code>string \\| number</code> <code>undefined</code> Numero para codigo de emparejamiento <p>Ejemplos:</p> <pre><code>// Configuracion minima (usa FileEngine en .baileys/default)\nconst wa = new WhatsApp();\n\n// Con numero de telefono (emparejamiento por codigo)\nconst wa = new WhatsApp({\n  phone: \"5491112345678\",\n});\n\n// Con engine personalizado\nconst wa = new WhatsApp({\n  engine: new FileEngine(\".baileys/mi-bot\"),\n  phone: \"5491112345678\",\n});\n</code></pre>"},{"location":"es/references/whatsapp/#propiedades","title":"Propiedades","text":""},{"location":"es/references/whatsapp/#engine","title":"<code>engine</code>","text":"<pre><code>readonly engine: Engine\n</code></pre> <p>Engine de persistencia activo.</p>"},{"location":"es/references/whatsapp/#socket","title":"<code>socket</code>","text":"<pre><code>get socket(): WASocket | null\n</code></pre> <p>Socket de Baileys. <code>null</code> si no esta conectado.</p>"},{"location":"es/references/whatsapp/#event","title":"<code>event</code>","text":"<pre><code>readonly event: EventEmitter&lt;WhatsAppEventMap&gt;\n</code></pre> <p>EventEmitter tipado para escuchar eventos.</p>"},{"location":"es/references/whatsapp/#chat","title":"<code>Chat</code>","text":"<pre><code>readonly Chat: typeof _Chat\n</code></pre> <p>Clase Chat enlazada a esta instancia.</p>"},{"location":"es/references/whatsapp/#contact","title":"<code>Contact</code>","text":"<pre><code>readonly Contact: typeof _Contact\n</code></pre> <p>Clase Contact enlazada a esta instancia.</p>"},{"location":"es/references/whatsapp/#message","title":"<code>Message</code>","text":"<pre><code>readonly Message: typeof _Message\n</code></pre> <p>Clase Message enlazada a esta instancia.</p>"},{"location":"es/references/whatsapp/#metodos","title":"Metodos","text":""},{"location":"es/references/whatsapp/#paircallback","title":"<code>pair(callback)</code>","text":"<pre><code>pair(callback: (code: string | Buffer) =&gt; void | Promise&lt;void&gt;): Promise&lt;void&gt;\n</code></pre> <p>Conecta a WhatsApp. Muestra QR o codigo de emparejamiento segun configuracion.</p> <p>Parametros:</p> <ul> <li><code>callback</code> - Funcion llamada con el QR (Buffer PNG) o codigo (string de 8 digitos)</li> </ul> <p>Comportamiento:</p> <ol> <li>Si <code>options.phone</code> esta definido, envia codigo de emparejamiento (solo una vez)</li> <li>Si no, genera QR code como imagen PNG (periodicamente hasta escanear)</li> <li>Reintenta conexion automaticamente en caso de desconexion</li> <li>Emite <code>open</code> cuando la conexion es exitosa</li> </ol> <p>Errores fatales (no reintenta):</p> <ul> <li><code>loggedOut</code> (401) - Sesion cerrada desde telefono</li> </ul> <p>Ejemplo:</p> <pre><code>await wa.pair(async (data) =&gt; {\n  if (Buffer.isBuffer(data)) {\n    // QR code - guardar o mostrar\n    require(\"fs\").writeFileSync(\"qr.png\", data);\n    console.log(\"Escanea el QR guardado en qr.png\");\n  } else {\n    // Codigo de 8 digitos\n    console.log(\"Ingresa este codigo en WhatsApp:\", data);\n  }\n});\n</code></pre>"},{"location":"es/references/whatsapp/#eventos","title":"Eventos","text":"<p>Los eventos se escuchan a traves de <code>wa.event</code>:</p> <pre><code>wa.event.on(\"open\", () =&gt; {\n  console.log(\"Conectado\");\n});\n</code></pre>"},{"location":"es/references/whatsapp/#open","title":"<code>open</code>","text":"<p>Emitido cuando la conexion es exitosa.</p> <pre><code>wa.event.on(\"open\", () =&gt; {\n  console.log(\"Conectado a WhatsApp\");\n});\n</code></pre>"},{"location":"es/references/whatsapp/#close","title":"<code>close</code>","text":"<p>Emitido cuando la conexion se cierra (se reconectara automaticamente).</p> <pre><code>wa.event.on(\"close\", () =&gt; {\n  console.log(\"Desconectado de WhatsApp\");\n});\n</code></pre>"},{"location":"es/references/whatsapp/#error","title":"<code>error</code>","text":"<p>Emitido cuando ocurre un error fatal (no se reconectara).</p> <pre><code>wa.event.on(\"error\", (error: Error) =&gt; {\n  console.error(\"Error fatal:\", error.message);\n});\n</code></pre>"},{"location":"es/references/whatsapp/#contactcreated","title":"<code>contact:created</code>","text":"<p>Emitido cuando se crea un nuevo contacto.</p> <pre><code>wa.event.on(\"contact:created\", (contact) =&gt; {\n  console.log(`Nuevo contacto: ${contact.name} (${contact.phone})`);\n});\n</code></pre>"},{"location":"es/references/whatsapp/#contactupdated","title":"<code>contact:updated</code>","text":"<p>Emitido cuando se actualiza un contacto existente.</p> <pre><code>wa.event.on(\"contact:updated\", (contact) =&gt; {\n  console.log(`Contacto actualizado: ${contact.name}`);\n});\n</code></pre>"},{"location":"es/references/whatsapp/#chatcreated","title":"<code>chat:created</code>","text":"<p>Emitido cuando se crea un nuevo chat.</p> <pre><code>wa.event.on(\"chat:created\", (chat) =&gt; {\n  console.log(`Nuevo chat: ${chat.name} (${chat.type})`);\n});\n</code></pre>"},{"location":"es/references/whatsapp/#chatupdated","title":"<code>chat:updated</code>","text":"<p>Emitido cuando se actualiza un chat existente.</p> <pre><code>wa.event.on(\"chat:updated\", (chat) =&gt; {\n  console.log(`Chat actualizado: ${chat.name}`);\n});\n</code></pre>"},{"location":"es/references/whatsapp/#chatpined","title":"<code>chat:pined</code>","text":"<p>Emitido cuando se fija o desfija un chat.</p> <pre><code>wa.event.on(\"chat:pined\", (cid, pined) =&gt; {\n  if (pined) {\n    console.log(`Chat ${cid} fijado`);\n  } else {\n    console.log(`Chat ${cid} desfijado`);\n  }\n});\n</code></pre>"},{"location":"es/references/whatsapp/#chatarchived","title":"<code>chat:archived</code>","text":"<p>Emitido cuando se archiva o desarchiva un chat.</p> <pre><code>wa.event.on(\"chat:archived\", (cid, archived) =&gt; {\n  console.log(`Chat ${cid}: ${archived ? \"archivado\" : \"desarchivado\"}`);\n});\n</code></pre>"},{"location":"es/references/whatsapp/#chatmuted","title":"<code>chat:muted</code>","text":"<p>Emitido cuando se silencia o desilencia un chat.</p> <pre><code>wa.event.on(\"chat:muted\", (cid, muted) =&gt; {\n  if (muted) {\n    console.log(`Chat ${cid} silenciado hasta ${new Date(muted)}`);\n  } else {\n    console.log(`Chat ${cid} desilenciado`);\n  }\n});\n</code></pre>"},{"location":"es/references/whatsapp/#chatdeleted","title":"<code>chat:deleted</code>","text":"<p>Emitido cuando se elimina un chat.</p> <pre><code>wa.event.on(\"chat:deleted\", (cid) =&gt; {\n  console.log(`Chat eliminado: ${cid}`);\n});\n</code></pre>"},{"location":"es/references/whatsapp/#messagecreated","title":"<code>message:created</code>","text":"<p>Emitido cuando se recibe un nuevo mensaje.</p> <pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  console.log(`Nuevo mensaje de tipo ${msg.type}`);\n  console.log(`  Chat: ${msg.cid}`);\n  console.log(`  Mio: ${msg.me}`);\n\n  if (msg.type === \"text\") {\n    const text = (await msg.content()).toString();\n    console.log(`  Texto: ${text}`);\n  }\n});\n</code></pre>"},{"location":"es/references/whatsapp/#messageupdated","title":"<code>message:updated</code>","text":"<p>Emitido cuando se edita un mensaje.</p> <pre><code>wa.event.on(\"message:updated\", async (msg) =&gt; {\n  console.log(`Mensaje editado: ${msg.id}`);\n  if (msg.type === \"text\") {\n    const text = (await msg.content()).toString();\n    console.log(`  Nuevo texto: ${text}`);\n  }\n});\n</code></pre>"},{"location":"es/references/whatsapp/#messagereacted","title":"<code>message:reacted</code>","text":"<p>Emitido cuando alguien reacciona a un mensaje.</p> <pre><code>wa.event.on(\"message:reacted\", (cid, mid, emoji) =&gt; {\n  console.log(`Reaccion ${emoji} en mensaje ${mid} del chat ${cid}`);\n});\n</code></pre>"},{"location":"es/references/whatsapp/#messagedeleted","title":"<code>message:deleted</code>","text":"<p>Emitido cuando se elimina un mensaje.</p> <pre><code>wa.event.on(\"message:deleted\", (cid, mid) =&gt; {\n  console.log(`Mensaje eliminado: ${mid} del chat ${cid}`);\n});\n</code></pre>"},{"location":"es/references/whatsapp/#patrones-comunes","title":"Patrones comunes","text":""},{"location":"es/references/whatsapp/#bot-con-comandos","title":"Bot con comandos","text":"<pre><code>const wa = new WhatsApp();\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString();\n  if (!text.startsWith(\"!\")) return;\n\n  const [cmd, ...args] = text.slice(1).split(\" \");\n\n  if (cmd === \"ping\") {\n    await wa.Message.text(msg.cid, \"pong!\");\n  } else if (cmd === \"hora\") {\n    await wa.Message.text(msg.cid, new Date().toLocaleString());\n  }\n});\n\nawait wa.pair((data) =&gt; {\n  if (Buffer.isBuffer(data)) {\n    require(\"fs\").writeFileSync(\"qr.png\", data);\n  } else {\n    console.log(\"Codigo:\", data);\n  }\n});\n</code></pre>"},{"location":"es/references/whatsapp/#filtrar-por-chat","title":"Filtrar por chat","text":"<pre><code>const ALLOWED_CHATS = [\n  \"5491112345678@s.whatsapp.net\",\n  \"123456789@g.us\",\n];\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (!ALLOWED_CHATS.includes(msg.cid)) return;\n  // Procesar solo mensajes de chats permitidos\n});\n</code></pre>"},{"location":"es/references/whatsapp/#auto-respuesta-cuando-esta-ausente","title":"Auto-respuesta cuando esta ausente","text":"<pre><code>const AWAY_MESSAGE = \"Estoy ausente. Respondere pronto.\";\nconst responded = new Set&lt;string&gt;();\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n\n  // Responder solo una vez por chat\n  if (responded.has(msg.cid)) return;\n  responded.add(msg.cid);\n\n  await wa.Message.text(msg.cid, AWAY_MESSAGE);\n\n  // Limpiar despues de 1 hora\n  setTimeout(() =&gt; responded.delete(msg.cid), 60 * 60 * 1000);\n});\n</code></pre>"},{"location":"es/references/whatsapp/#interfaz-iwhatsapp","title":"Interfaz IWhatsApp","text":"<pre><code>interface IWhatsApp {\n  engine?: Engine;\n  phone?: string | number;\n}\n</code></pre>"},{"location":"es/references/whatsapp/#interfaz-whatsappeventmap","title":"Interfaz WhatsAppEventMap","text":"<pre><code>interface WhatsAppEventMap {\n  open: [];\n  close: [];\n  error: [Error];\n  \"contact:created\": [Contact];\n  \"contact:updated\": [Contact];\n  \"chat:created\": [Chat];\n  \"chat:updated\": [Chat];\n  \"chat:pined\": [cid: string, pined: number | null];\n  \"chat:archived\": [cid: string, archived: boolean];\n  \"chat:muted\": [cid: string, muted: number | null];\n  \"chat:deleted\": [cid: string];\n  \"message:created\": [Message];\n  \"message:updated\": [Message];\n  \"message:reacted\": [cid: string, mid: string, emoji: string];\n  \"message:deleted\": [cid: string, mid: string];\n}\n</code></pre>"}]}