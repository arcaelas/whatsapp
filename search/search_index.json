{"config":{"lang":["es","en"],"separator":"[\\s\\-\\.]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"@arcaelas/whatsapp","text":"<p>Libreria TypeScript para automatizacion de WhatsApp Basada en Baileys | Tipado completo | Engine de persistencia flexible | Facil de usar</p>"},{"location":"#caracteristicas","title":"Caracteristicas","text":"<ul> <li>Conexion simplificada - QR o codigo de emparejamiento en una sola llamada</li> <li>Eventos tipados - TypeScript completo con autocompletado</li> <li>Persistencia flexible - FileEngine por defecto, o implementa tu propio Engine</li> <li>Clases intuitivas - Chat, Contact, Message con metodos estaticos</li> <li>Multiples tipos de mensaje - text, image, video, audio, location, poll</li> <li>Gestion de grupos - Listar miembros, archivar, silenciar, fijar</li> <li>Soporte de encuestas - Crear encuestas con multiples opciones</li> </ul>"},{"location":"#inicio-rapido","title":"Inicio Rapido","text":"<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\n\n// Crear instancia\nconst wa = new WhatsApp({\n  phone: \"5491112345678\", // Opcional: para codigo de emparejamiento\n});\n\n// Escuchar eventos\nwa.event.on(\"open\", () =&gt; console.log(\"Conectado!\"));\nwa.event.on(\"close\", () =&gt; console.log(\"Desconectado\"));\nwa.event.on(\"error\", (err) =&gt; console.error(\"Error:\", err.message));\n\n// Conectar\nawait wa.pair(async (data) =&gt; {\n  if (Buffer.isBuffer(data)) {\n    // QR code como imagen PNG\n    require(\"fs\").writeFileSync(\"qr.png\", data);\n    console.log(\"Escanea el QR en qr.png\");\n  } else {\n    // Codigo de emparejamiento (8 digitos)\n    console.log(\"Codigo:\", data);\n  }\n});\n\n// Escuchar mensajes\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return; // Ignorar mensajes propios\n\n  // Verificar tipo\n  if (msg.type === \"text\") {\n    const text = (await msg.content()).toString();\n    console.log(`Mensaje: ${text}`);\n\n    // Responder\n    if (text.toLowerCase() === \"hola\") {\n      await wa.Message.text(msg.cid, \"Hola! Como estas?\");\n    }\n  }\n});\n</code></pre>"},{"location":"#tipos-de-mensaje","title":"Tipos de Mensaje","text":"<p>La libreria soporta multiples tipos de mensaje:</p> Tipo <code>msg.type</code> Descripcion Texto <code>\"text\"</code> Mensaje de texto plano Imagen <code>\"image\"</code> Imagen con caption opcional Video <code>\"video\"</code> Video con caption opcional Audio <code>\"audio\"</code> Nota de voz o audio Ubicacion <code>\"location\"</code> Coordenadas geograficas Encuesta <code>\"poll\"</code> Encuesta con opciones <pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n\n  if (msg.type === \"image\") {\n    const buffer = await msg.content();\n    console.log(`Imagen recibida: ${buffer.length} bytes`);\n    if (msg.caption) {\n      console.log(`Caption: ${msg.caption}`);\n    }\n  }\n\n  if (msg.type === \"poll\") {\n    const buffer = await msg.content();\n    const poll = JSON.parse(buffer.toString());\n    console.log(`Encuesta: ${poll.content}`);\n    poll.options.forEach((opt: { content: string }, i: number) =&gt; {\n      console.log(`  ${i + 1}. ${opt.content}`);\n    });\n  }\n});\n</code></pre>"},{"location":"#engine-de-persistencia","title":"Engine de Persistencia","text":"<p>Por defecto se usa <code>FileEngine</code>. Puedes implementar tu propio engine:</p> FileEngine (default)Engine personalizado <pre><code>import { WhatsApp, FileEngine } from \"@arcaelas/whatsapp\";\n\nconst wa = new WhatsApp({\n  engine: new FileEngine(\".baileys/mi-bot\"),\n});\n</code></pre> <pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\nimport type { Engine } from \"@arcaelas/whatsapp\";\n\n// Implementa la interfaz Engine\nclass RedisEngine implements Engine {\n  async get(key: string): Promise&lt;string | null&gt; { /* ... */ }\n  async set(key: string, value: string | null): Promise&lt;void&gt; { /* ... */ }\n  async list(prefix: string, offset?: number, limit?: number): Promise&lt;string[]&gt; { /* ... */ }\n}\n\nconst wa = new WhatsApp({\n  engine: new RedisEngine(),\n});\n</code></pre>"},{"location":"#siguiente-paso","title":"Siguiente Paso","text":"<ul> <li> <p> Instalacion</p> <p>Instrucciones detalladas para instalar la libreria</p> <p> Ver guia</p> </li> <li> <p> Primeros Pasos</p> <p>Tutorial paso a paso para crear tu primer bot</p> <p> Comenzar</p> </li> <li> <p> Referencias API</p> <p>Documentacion completa de todas las clases</p> <p> Ver API</p> </li> <li> <p> Ejemplos</p> <p>Ejemplos practicos listos para usar</p> <p> Ver ejemplos</p> </li> </ul> <p>Desarrollado por Arcaelas Insiders</p>"},{"location":"baileys-payloads/","title":"Baileys Event Payloads Reference","text":"<p>Documentaci\u00f3n completa de payloads capturados de Baileys v6.7.18 para todos los tipos de mensaje: - Texto - Mensajes de texto simple y extendido - Im\u00e1genes - Con caption, thumbnails y media keys - Videos - Con streaming sidecar y duraci\u00f3n - Audios - Notas de voz (PTT) y archivos de audio - Ubicaciones - Est\u00e1ticas y en vivo - Encuestas - Creaci\u00f3n y votos (cifrados E2E)</p>"},{"location":"baileys-payloads/#1-mensaje-de-texto-nuevo","title":"1. Mensaje de Texto (nuevo)","text":"<p>Evento: <code>messages.upsert</code> con <code>type: \"notify\"</code></p> <pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC07DE0D18FA8254897A26C90B2FFD98\"\n  },\n  \"messageTimestamp\": 1767366759,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"broadcast\": false,\n  \"message\": {\n    \"extendedTextMessage\": {\n      \"text\": \"Mensaje\",\n      \"previewType\": \"NONE\",\n      \"contextInfo\": {\n        \"expiration\": 7776000,\n        \"ephemeralSettingTimestamp\": \"1752995285\",\n        \"disappearingMode\": {\n          \"initiator\": \"INITIATED_BY_ME\",\n          \"trigger\": \"ACCOUNT_SETTING\",\n          \"initiatedByMe\": true\n        }\n      },\n      \"inviteLinkGroupTypeV2\": \"DEFAULT\"\n    },\n    \"messageContextInfo\": {\n      \"deviceListMetadata\": {\n        \"senderKeyHash\": \"2tnQy4q7mzjMfw==\",\n        \"senderTimestamp\": \"1767289397\",\n        \"recipientKeyHash\": \"fbnE50/78FcqHw==\",\n        \"recipientTimestamp\": \"1767366507\"\n      },\n      \"deviceListMetadataVersion\": 2,\n      \"messageSecret\": \"wZda2AFu1tzmVVGYpMDBdevK4OmwFvyH1tJ30BnmSfA=\"\n    }\n  }\n}\n</code></pre> <p>Campos clave: - <code>key.remoteJid</code> - ID del chat (formato <code>@lid</code> o <code>@s.whatsapp.net</code>) - <code>key.fromMe</code> - Si el mensaje fue enviado por nosotros - <code>key.id</code> - ID \u00fanico del mensaje - <code>pushName</code> - Nombre del remitente - <code>message.extendedTextMessage.text</code> - Contenido del texto</p>"},{"location":"baileys-payloads/#2-edicion-de-mensaje","title":"2. Edici\u00f3n de Mensaje","text":""},{"location":"baileys-payloads/#21-via-messagesupsert-protocolmessage","title":"2.1 Via <code>messages.upsert</code> (protocolMessage)","text":"<pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC28854886802F1895A337C83F0EC211\"\n  },\n  \"messageTimestamp\": 1767366766,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"protocolMessage\": {\n      \"key\": {\n        \"remoteJid\": \"9698623357112@lid\",\n        \"fromMe\": true,\n        \"id\": \"AC07DE0D18FA8254897A26C90B2FFD98\"\n      },\n      \"type\": \"MESSAGE_EDIT\",\n      \"editedMessage\": {\n        \"extendedTextMessage\": {\n          \"text\": \"Editado.\",\n          \"previewType\": \"NONE\",\n          \"contextInfo\": { ... }\n        }\n      },\n      \"timestampMs\": \"1767366766505\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#22-via-messagesupdate","title":"2.2 Via <code>messages.update</code>","text":"<pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC07DE0D18FA8254897A26C90B2FFD98\"\n  },\n  \"update\": {\n    \"message\": {\n      \"editedMessage\": {\n        \"message\": {\n          \"extendedTextMessage\": {\n            \"text\": \"Editado.\",\n            \"previewType\": \"NONE\",\n            \"contextInfo\": { ... }\n          }\n        }\n      }\n    },\n    \"messageTimestamp\": 1767366766\n  }\n}\n</code></pre> <p>Campos clave: - <code>protocolMessage.type</code> = <code>\"MESSAGE_EDIT\"</code> (o <code>14</code> como n\u00famero) - <code>protocolMessage.key.id</code> - ID del mensaje objetivo a editar - <code>protocolMessage.editedMessage</code> - Nuevo contenido del mensaje</p>"},{"location":"baileys-payloads/#3-reaccion","title":"3. Reacci\u00f3n","text":""},{"location":"baileys-payloads/#31-via-messagesupsert-reactionmessage","title":"3.1 Via <code>messages.upsert</code> (reactionMessage)","text":"<pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC4FAE3156F6766A5C19DE9896A728D1\"\n  },\n  \"messageTimestamp\": 1767366771,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"reactionMessage\": {\n      \"key\": {\n        \"remoteJid\": \"140913951141911@lid\",\n        \"fromMe\": false,\n        \"id\": \"AC07DE0D18FA8254897A26C90B2FFD98\"\n      },\n      \"text\": \"\u2764\ufe0f\",\n      \"senderTimestampMs\": \"1767366770998\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#32-via-messagesreaction","title":"3.2 Via <code>messages.reaction</code>","text":"<pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC07DE0D18FA8254897A26C90B2FFD98\"\n  },\n  \"reaction\": {\n    \"key\": {\n      \"remoteJid\": \"140913951141911@lid\",\n      \"fromMe\": false,\n      \"id\": \"AC4FAE3156F6766A5C19DE9896A728D1\"\n    },\n    \"text\": \"\u2764\ufe0f\",\n    \"senderTimestampMs\": { \"low\": 2135212342, \"high\": 411, \"unsigned\": false }\n  }\n}\n</code></pre> <p>Campos clave: - <code>reactionMessage.key.id</code> - ID del mensaje al que se reacciona - <code>reactionMessage.text</code> - Emoji de la reacci\u00f3n (vac\u00edo = quitar reacci\u00f3n)</p>"},{"location":"baileys-payloads/#4-eliminacion-revoke","title":"4. Eliminaci\u00f3n (REVOKE)","text":""},{"location":"baileys-payloads/#41-via-messagesupsert-protocolmessage","title":"4.1 Via <code>messages.upsert</code> (protocolMessage)","text":"<pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC654D7AA789E560FBD9E3EBD8200198\"\n  },\n  \"messageTimestamp\": 1767366775,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"protocolMessage\": {\n      \"key\": {\n        \"remoteJid\": \"9698623357112@lid\",\n        \"fromMe\": true,\n        \"id\": \"AC07DE0D18FA8254897A26C90B2FFD98\"\n      },\n      \"type\": \"REVOKE\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#42-via-messagesupdate","title":"4.2 Via <code>messages.update</code>","text":"<pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC07DE0D18FA8254897A26C90B2FFD98\"\n  },\n  \"update\": {\n    \"message\": null,\n    \"messageStubType\": 1,\n    \"key\": {\n      \"remoteJid\": \"140913951141911@lid\",\n      \"fromMe\": false,\n      \"id\": \"AC654D7AA789E560FBD9E3EBD8200198\"\n    }\n  }\n}\n</code></pre> <p>Campos clave: - <code>protocolMessage.type</code> = <code>\"REVOKE\"</code> (o <code>0</code> como n\u00famero) - <code>protocolMessage.key.id</code> - ID del mensaje a eliminar - En <code>messages.update</code>: <code>message: null</code> y <code>messageStubType: 1</code></p>"},{"location":"baileys-payloads/#5-mensaje-reenviado","title":"5. Mensaje Reenviado","text":"<p>Evento: <code>messages.upsert</code> con <code>type: \"notify\"</code></p> <pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"ACFDDB4A1F65398F52D238A78F4E761A\"\n  },\n  \"messageTimestamp\": 1767366784,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"extendedTextMessage\": {\n      \"text\": \"se volvi\u00f3 a caer :(\",\n      \"previewType\": \"NONE\",\n      \"contextInfo\": {\n        \"forwardingScore\": 1,\n        \"isForwarded\": true,\n        \"expiration\": 7776000,\n        \"ephemeralSettingTimestamp\": \"1752995285\",\n        \"disappearingMode\": { ... }\n      },\n      \"inviteLinkGroupTypeV2\": \"DEFAULT\"\n    }\n  }\n}\n</code></pre> <p>Campos clave: - <code>contextInfo.isForwarded</code> = <code>true</code> - Indica que es reenviado - <code>contextInfo.forwardingScore</code> - Cantidad de veces reenviado (1+)</p>"},{"location":"baileys-payloads/#resumen-de-tipos-de-protocolmessage","title":"Resumen de Tipos de protocolMessage","text":"Tipo Valor Num\u00e9rico Descripci\u00f3n <code>REVOKE</code> 0 Eliminar mensaje <code>EPHEMERAL_SETTING</code> 3 Cambio de mensajes temporales <code>EPHEMERAL_SYNC_RESPONSE</code> 6 Respuesta de sincronizaci\u00f3n <code>HISTORY_SYNC_NOTIFICATION</code> 7 Sincronizaci\u00f3n de historial <code>MESSAGE_EDIT</code> 14 Editar mensaje"},{"location":"baileys-payloads/#imagenes","title":"Im\u00e1genes","text":""},{"location":"baileys-payloads/#1-imagen-nueva","title":"1. Imagen Nueva","text":"<p>Evento: <code>messages.upsert</code> con <code>type: \"notify\"</code></p> <pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC9BE0D81D965A3C240B6ACAA891C6FD\"\n  },\n  \"messageTimestamp\": 1767366982,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"imageMessage\": {\n      \"url\": \"https://mmg.whatsapp.net/o1/v/t24/...\",\n      \"mimetype\": \"image/jpeg\",\n      \"caption\": \"Aqu\u00ed est\u00e1 el caption.\",\n      \"fileSha256\": \"AtQ/iIo7NRdmRP+aADjHBvsydhdvvL/hmnkX6e4OMUw=\",\n      \"fileLength\": \"41161\",\n      \"height\": 340,\n      \"width\": 1146,\n      \"mediaKey\": \"5j575mYpMIn/DWBitep/eVIkdTiES9QJ82C7CxHRH2Y=\",\n      \"fileEncSha256\": \"xOZ8uqbEUswSlBv+nUb7lyIrwl/TlhqVb9bAmyg5sw8=\",\n      \"directPath\": \"/o1/v/t24/f2/m233/...\",\n      \"mediaKeyTimestamp\": \"1767361850\",\n      \"jpegThumbnail\": \"/9j/4AAQSkZJRgABAQAAAQABAAD/...\",\n      \"contextInfo\": {\n        \"expiration\": 7776000,\n        \"disappearingMode\": { ... },\n        \"pairedMediaType\": \"NOT_PAIRED_MEDIA\"\n      }\n    }\n  }\n}\n</code></pre> <p>Campos clave: - <code>imageMessage.url</code> - URL para descargar (temporal) - <code>imageMessage.mediaKey</code> - Clave para descifrar el archivo - <code>imageMessage.directPath</code> - Path directo en CDN - <code>imageMessage.caption</code> - Texto del caption - <code>imageMessage.jpegThumbnail</code> - Miniatura en base64 - <code>imageMessage.mimetype</code> - Tipo MIME - <code>imageMessage.fileLength</code> - Tama\u00f1o en bytes</p>"},{"location":"baileys-payloads/#2-edicion-de-caption-imagen","title":"2. Edici\u00f3n de Caption (Imagen)","text":""},{"location":"baileys-payloads/#via-messagesupsert-protocolmessage","title":"Via <code>messages.upsert</code> (protocolMessage)","text":"<pre><code>{\n  \"message\": {\n    \"protocolMessage\": {\n      \"key\": {\n        \"remoteJid\": \"9698623357112@lid\",\n        \"fromMe\": true,\n        \"id\": \"AC9BE0D81D965A3C240B6ACAA891C6FD\"\n      },\n      \"type\": \"MESSAGE_EDIT\",\n      \"editedMessage\": {\n        \"imageMessage\": {\n          \"caption\": \"Aqu\u00ed est\u00e1 el caption editado.\",\n          \"contextInfo\": { ... }\n        }\n      },\n      \"timestampMs\": \"1767366991341\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#via-messagesupdate","title":"Via <code>messages.update</code>","text":"<pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC9BE0D81D965A3C240B6ACAA891C6FD\"\n  },\n  \"update\": {\n    \"message\": {\n      \"editedMessage\": {\n        \"message\": {\n          \"imageMessage\": {\n            \"caption\": \"Aqu\u00ed est\u00e1 el caption editado.\",\n            \"contextInfo\": { ... }\n          }\n        }\n      }\n    },\n    \"messageTimestamp\": 1767366991\n  }\n}\n</code></pre> <p>Nota: Solo se edita el <code>caption</code>, la imagen permanece igual.</p>"},{"location":"baileys-payloads/#3-reaccion-a-imagen","title":"3. Reacci\u00f3n a Imagen","text":"<p>Mismo formato que texto - usa <code>reactionMessage</code>:</p> <pre><code>{\n  \"message\": {\n    \"reactionMessage\": {\n      \"key\": {\n        \"remoteJid\": \"140913951141911@lid\",\n        \"fromMe\": false,\n        \"id\": \"AC9BE0D81D965A3C240B6ACAA891C6FD\"\n      },\n      \"text\": \"\ud83d\ude02\",\n      \"senderTimestampMs\": \"1767366995121\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#4-eliminacion-de-imagen","title":"4. Eliminaci\u00f3n de Imagen","text":"<p>Mismo formato que texto - usa <code>protocolMessage.type: \"REVOKE\"</code>:</p> <pre><code>{\n  \"message\": {\n    \"protocolMessage\": {\n      \"key\": {\n        \"remoteJid\": \"9698623357112@lid\",\n        \"fromMe\": true,\n        \"id\": \"AC9BE0D81D965A3C240B6ACAA891C6FD\"\n      },\n      \"type\": \"REVOKE\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#5-imagen-reenviada","title":"5. Imagen Reenviada","text":"<pre><code>{\n  \"message\": {\n    \"imageMessage\": {\n      \"url\": \"https://mmg.whatsapp.net/...\",\n      \"mimetype\": \"image/jpeg\",\n      \"fileSha256\": \"...\",\n      \"fileLength\": \"41548\",\n      \"height\": 2048,\n      \"width\": 1536,\n      \"mediaKey\": \"...\",\n      \"jpegThumbnail\": \"...\",\n      \"contextInfo\": {\n        \"forwardingScore\": 1,\n        \"isForwarded\": true,\n        \"expiration\": 7776000,\n        \"pairedMediaType\": \"NOT_PAIRED_MEDIA\"\n      },\n      \"scansSidecar\": \"...\",\n      \"scanLengths\": [5323, 21968, 6636, 7621],\n      \"midQualityFileSha256\": \"...\"\n    }\n  }\n}\n</code></pre> <p>Campos clave: - <code>contextInfo.isForwarded</code> = <code>true</code> - <code>contextInfo.forwardingScore</code> = cantidad de reenv\u00edos - <code>scansSidecar</code> y <code>scanLengths</code> - datos de escaneo de calidad</p>"},{"location":"baileys-payloads/#videos","title":"Videos","text":""},{"location":"baileys-payloads/#1-video-nuevo","title":"1. Video Nuevo","text":"<p>Evento: <code>messages.upsert</code> con <code>type: \"notify\"</code></p> <pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC8D9EBFC03C073E18073726AF79DD53\"\n  },\n  \"messageTimestamp\": 1767367249,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"videoMessage\": {\n      \"url\": \"https://mmg.whatsapp.net/v/t62.7161-24/...\",\n      \"mimetype\": \"video/mp4\",\n      \"fileSha256\": \"UXexcGRALCBhv9oeaJLKmszTizTUxU6bEa5AdhY2syc=\",\n      \"fileLength\": \"3927238\",\n      \"seconds\": 14,\n      \"mediaKey\": \"QMIVrONUp2pdFyJWtHmGyQmtqdmfEBpAJjMrdWjtCGo=\",\n      \"caption\": \"Video de 0:14 y 5.4MB\",\n      \"height\": 1280,\n      \"width\": 720,\n      \"fileEncSha256\": \"w+1YcO3NgNgWrHs/Gz9x0jD3jw1Bi7HSNknsFB8iT6s=\",\n      \"directPath\": \"/v/t62.7161-24/...\",\n      \"mediaKeyTimestamp\": \"1767364373\",\n      \"jpegThumbnail\": \"/9j/4AAQSkZJRgABAQAAAQABAAD/...\",\n      \"contextInfo\": {\n        \"expiration\": 7776000,\n        \"pairedMediaType\": \"SD_VIDEO_PARENT\",\n        \"statusSourceType\": \"VIDEO\"\n      },\n      \"streamingSidecar\": \"b5UxJyraDyJip4GcDCh9SoifW+eArgvRDj5sk2zE...\",\n      \"externalShareFullVideoDurationInSeconds\": 0\n    }\n  }\n}\n</code></pre> <p>Campos clave (adicionales a imagen): - <code>videoMessage.seconds</code> - Duraci\u00f3n en segundos - <code>videoMessage.streamingSidecar</code> - Datos para streaming progresivo - <code>contextInfo.pairedMediaType</code> = <code>\"SD_VIDEO_PARENT\"</code> - Video SD con posible HD - <code>contextInfo.statusSourceType</code> = <code>\"VIDEO\"</code></p>"},{"location":"baileys-payloads/#2-edicion-de-caption-video","title":"2. Edici\u00f3n de Caption (Video)","text":""},{"location":"baileys-payloads/#via-messagesupdate_1","title":"Via <code>messages.update</code>","text":"<pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC8D9EBFC03C073E18073726AF79DD53\"\n  },\n  \"update\": {\n    \"message\": {\n      \"editedMessage\": {\n        \"message\": {\n          \"videoMessage\": {\n            \"caption\": \"Video de 0:14 y 5.4MB editado.\",\n            \"contextInfo\": { ... }\n          }\n        }\n      }\n    },\n    \"messageTimestamp\": 1767367259\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#3-reaccion-a-video","title":"3. Reacci\u00f3n a Video","text":"<p>Mismo formato: <code>reactionMessage.text: \"\u2764\ufe0f\"</code></p>"},{"location":"baileys-payloads/#4-eliminacion-de-video","title":"4. Eliminaci\u00f3n de Video","text":"<p>Mismo formato: <code>protocolMessage.type: \"REVOKE\"</code></p> <pre><code>{\n  \"message\": {\n    \"protocolMessage\": {\n      \"key\": {\n        \"remoteJid\": \"9698623357112@lid\",\n        \"fromMe\": true,\n        \"id\": \"AC8D9EBFC03C073E18073726AF79DD53\"\n      },\n      \"type\": \"REVOKE\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#5-video-reenviado","title":"5. Video Reenviado","text":"<pre><code>{\n  \"message\": {\n    \"videoMessage\": {\n      \"url\": \"https://mmg.whatsapp.net/v/t62.7161-24/...\",\n      \"mimetype\": \"video/mp4\",\n      \"fileSha256\": \"ldamPu0rHgc2YP6RTLIzPDPwtdmxeLWe1MU7xgsWffk=\",\n      \"fileLength\": \"1918799\",\n      \"seconds\": 12,\n      \"mediaKey\": \"mIbYpoPeMVLGk7k/AkgMFmJbs5B1YdJb1pslgPQwGvM=\",\n      \"height\": 832,\n      \"width\": 464,\n      \"jpegThumbnail\": \"...\",\n      \"contextInfo\": {\n        \"forwardingScore\": 1,\n        \"isForwarded\": true,\n        \"expiration\": 7776000,\n        \"pairedMediaType\": \"NOT_PAIRED_MEDIA\"\n      },\n      \"streamingSidecar\": \"...\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#audios","title":"Audios","text":""},{"location":"baileys-payloads/#1-nota-de-voz-ptt","title":"1. Nota de Voz (PTT)","text":"<p>Evento: <code>messages.upsert</code> con <code>type: \"notify\"</code> o <code>\"append\"</code></p> <pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC59EFFAD3590A7D97ECCB92690E904A\"\n  },\n  \"messageTimestamp\": 1767367534,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"audioMessage\": {\n      \"url\": \"https://mmg.whatsapp.net/v/t62.7117-24/...\",\n      \"mimetype\": \"audio/ogg; codecs=opus\",\n      \"fileSha256\": \"EFYFoGCyrMKEZbpeXKdsnfQjcHF2oPF0dYxffk9di+s=\",\n      \"fileLength\": \"10460\",\n      \"seconds\": 4,\n      \"ptt\": true,\n      \"mediaKey\": \"8VKH8PT8AhNkt9SGanQwpInAEX4/VJDRmUYofxRPqgE=\",\n      \"fileEncSha256\": \"3cNnNkhHEUEwWQIRKWbEXQ/xO0WQzEAyd5N/cF6et8c=\",\n      \"directPath\": \"/v/t62.7117-24/...\",\n      \"mediaKeyTimestamp\": \"1767367534\",\n      \"contextInfo\": {\n        \"expiration\": 7776000,\n        \"disappearingMode\": { ... }\n      },\n      \"waveform\": \"AAAAEhITFhgQDAsQESooPk8/Kzw/PTsrJ0tJJBwkLCcrKhgfJigbDzA3UExAQjgyQEM/LT04Mzg5PykWJSESAA==\"\n    }\n  }\n}\n</code></pre> <p>Campos clave: - <code>audioMessage.ptt</code> = <code>true</code> - Push-to-Talk (nota de voz) - <code>audioMessage.seconds</code> - Duraci\u00f3n en segundos - <code>audioMessage.waveform</code> - Forma de onda en base64 para visualizaci\u00f3n - <code>audioMessage.mimetype</code> = <code>\"audio/ogg; codecs=opus\"</code> - Formato t\u00edpico</p>"},{"location":"baileys-payloads/#2-audio-archivo-no-ptt","title":"2. Audio Archivo (No PTT)","text":"<pre><code>{\n  \"message\": {\n    \"audioMessage\": {\n      \"url\": \"https://mmg.whatsapp.net/v/t62.7117-24/...\",\n      \"mimetype\": \"audio/ogg; codecs=opus\",\n      \"fileSha256\": \"frtdS0Pc++S6ywrX5MBURUFoEoaoqiyPeGMBl7pgbSw=\",\n      \"fileLength\": \"90552\",\n      \"seconds\": 38,\n      \"ptt\": false,\n      \"mediaKey\": \"f/2PVHe8caGXqpP7zVBxm8h88vyNXqTK2izyHmc+IKs=\",\n      \"directPath\": \"/v/t62.7117-24/...\",\n      \"contextInfo\": {\n        \"forwardingScore\": 1,\n        \"isForwarded\": true,\n        \"expiration\": 7776000\n      },\n      \"waveform\": \"AFRSSh8GAABYUDkOQlk6NgAtDkY8KzUdTThNKAQlP1NKMkNJWAAzLABOVDFDOkAFUTNONy4wNyBFEwULAFMOAA==\"\n    }\n  }\n}\n</code></pre> <p>Diferencia clave: - <code>audioMessage.ptt</code> = <code>false</code> - Archivo de audio (no nota de voz) - Sin visualizaci\u00f3n especial de \"grabando\"</p>"},{"location":"baileys-payloads/#3-reaccion-a-audio","title":"3. Reacci\u00f3n a Audio","text":"<p>Mismo formato: <code>reactionMessage.text: \"\ud83d\ude02\"</code></p>"},{"location":"baileys-payloads/#4-eliminacion-de-audio","title":"4. Eliminaci\u00f3n de Audio","text":"<p>Mismo formato: <code>protocolMessage.type: \"REVOKE\"</code></p>"},{"location":"baileys-payloads/#5-audio-reenviado","title":"5. Audio Reenviado","text":"<p>El campo <code>contextInfo.isForwarded: true</code> indica reenv\u00edo (ver ejemplo en Audio Archivo arriba).</p>"},{"location":"baileys-payloads/#ubicaciones","title":"Ubicaciones","text":""},{"location":"baileys-payloads/#1-ubicacion-actual","title":"1. Ubicaci\u00f3n Actual","text":"<p>Evento: <code>messages.upsert</code> con <code>type: \"notify\"</code></p> <pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC11AAC400F14FC9E2AA671EEA6C8EB2\"\n  },\n  \"messageTimestamp\": 1767367923,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"locationMessage\": {\n      \"degreesLatitude\": 8.2570825,\n      \"degreesLongitude\": -62.797469,\n      \"contextInfo\": {\n        \"expiration\": 7776000,\n        \"ephemeralSettingTimestamp\": \"1752995285\",\n        \"disappearingMode\": {\n          \"initiator\": \"INITIATED_BY_ME\",\n          \"trigger\": \"ACCOUNT_SETTING\",\n          \"initiatedByMe\": true\n        }\n      }\n    },\n    \"messageContextInfo\": {\n      \"deviceListMetadata\": { ... },\n      \"deviceListMetadataVersion\": 2,\n      \"messageSecret\": \"...\"\n    }\n  }\n}\n</code></pre> <p>Campos clave: - <code>locationMessage.degreesLatitude</code> - Latitud en grados decimales - <code>locationMessage.degreesLongitude</code> - Longitud en grados decimales</p>"},{"location":"baileys-payloads/#2-ubicacion-en-vivo","title":"2. Ubicaci\u00f3n en Vivo","text":"<pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC4E61B2CA235B020F9A1BE28017DF4C\"\n  },\n  \"messageTimestamp\": 1767367935,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"liveLocationMessage\": {\n      \"degreesLatitude\": 8.2570838,\n      \"degreesLongitude\": -62.7974644,\n      \"caption\": \"Caption aqui\",\n      \"sequenceNumber\": \"1767367934423001\",\n      \"contextInfo\": {\n        \"expiration\": 7776000,\n        \"disappearingMode\": { ... }\n      }\n    }\n  }\n}\n</code></pre> <p>Campos clave adicionales: - <code>liveLocationMessage.caption</code> - Texto descriptivo opcional - <code>liveLocationMessage.sequenceNumber</code> - N\u00famero de secuencia para actualizaciones</p>"},{"location":"baileys-payloads/#3-reaccion-a-ubicacion","title":"3. Reacci\u00f3n a Ubicaci\u00f3n","text":"<p>Mismo formato: <code>reactionMessage.text: \"\u2764\ufe0f\"</code></p>"},{"location":"baileys-payloads/#4-eliminacion-de-ubicacion","title":"4. Eliminaci\u00f3n de Ubicaci\u00f3n","text":"<p>Mismo formato: <code>protocolMessage.type: \"REVOKE\"</code></p> <pre><code>{\n  \"message\": {\n    \"protocolMessage\": {\n      \"key\": {\n        \"remoteJid\": \"9698623357112@lid\",\n        \"fromMe\": true,\n        \"id\": \"AC11AAC400F14FC9E2AA671EEA6C8EB2\"\n      },\n      \"type\": \"REVOKE\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#encuestas-polls","title":"Encuestas (Polls)","text":""},{"location":"baileys-payloads/#1-crear-encuesta","title":"1. Crear Encuesta","text":"<p>Evento: <code>messages.upsert</code> con <code>type: \"notify\"</code></p> <pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC1AD49BBFFC4B9257052FB9FC788060\"\n  },\n  \"messageTimestamp\": 1767367967,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"messageContextInfo\": {\n      \"deviceListMetadata\": { ... },\n      \"deviceListMetadataVersion\": 2,\n      \"messageSecret\": \"PRdzIZUGahJ6JTwa2mFOsasy1jjVGzQbaoaR6NAWZBE=\"\n    },\n    \"pollCreationMessageV3\": {\n      \"name\": \"Encuesta\",\n      \"options\": [\n        { \"optionName\": \"Opci\u00f3n a\" },\n        { \"optionName\": \"Opci\u00f3n B\" }\n      ],\n      \"selectableOptionsCount\": 0,\n      \"contextInfo\": {\n        \"expiration\": 7776000,\n        \"disappearingMode\": { ... }\n      }\n    }\n  }\n}\n</code></pre> <p>Campos clave: - <code>pollCreationMessageV3.name</code> - Pregunta de la encuesta - <code>pollCreationMessageV3.options</code> - Array de opciones - <code>pollCreationMessageV3.options[].optionName</code> - Texto de cada opci\u00f3n - <code>pollCreationMessageV3.selectableOptionsCount</code> - Cantidad de opciones seleccionables (0 = todas)</p> <p>Nota: Tambi\u00e9n existe <code>pollCreationMessage</code> y <code>pollCreationMessageV2</code> (versiones anteriores).</p>"},{"location":"baileys-payloads/#2-votar-en-encuesta","title":"2. Votar en Encuesta","text":"<p>Evento: <code>messages.upsert</code> con <code>type: \"notify\"</code></p> <pre><code>{\n  \"key\": {\n    \"remoteJid\": \"140913951141911@lid\",\n    \"fromMe\": false,\n    \"id\": \"AC6710CD95104D348CC3DE9AF8AF642E\"\n  },\n  \"messageTimestamp\": 1767367970,\n  \"pushName\": \"Miguel Alejandro Guevara\",\n  \"message\": {\n    \"messageContextInfo\": {\n      \"deviceListMetadata\": { ... },\n      \"deviceListMetadataVersion\": 2\n    },\n    \"pollUpdateMessage\": {\n      \"pollCreationMessageKey\": {\n        \"remoteJid\": \"140913951141911@lid\",\n        \"fromMe\": false,\n        \"id\": \"AC1AD49BBFFC4B9257052FB9FC788060\"\n      },\n      \"vote\": {\n        \"encPayload\": \"mMqBgjeF/JOksgWLasDRH2iU3cOVjTxjcNyHW8/hWNnRCj9neeO7oJ5Twj1UpfQh4GY=\",\n        \"encIv\": \"JfP8NerkiAgbbM1R\"\n      },\n      \"senderTimestampMs\": \"1767367970421\"\n    }\n  }\n}\n</code></pre> <p>Campos clave: - <code>pollUpdateMessage.pollCreationMessageKey</code> - Referencia a la encuesta original - <code>pollUpdateMessage.vote.encPayload</code> - Voto encriptado (end-to-end) - <code>pollUpdateMessage.vote.encIv</code> - IV para descifrar el voto</p> <p>Nota: Los votos est\u00e1n cifrados E2E. Se necesita <code>messageSecret</code> de la encuesta original para descifrarlos.</p>"},{"location":"baileys-payloads/#3-reaccion-a-encuesta","title":"3. Reacci\u00f3n a Encuesta","text":"<p>Mismo formato: <code>reactionMessage.text: \"\ud83d\ude02\"</code></p> <pre><code>{\n  \"message\": {\n    \"reactionMessage\": {\n      \"key\": {\n        \"remoteJid\": \"140913951141911@lid\",\n        \"fromMe\": false,\n        \"id\": \"AC1AD49BBFFC4B9257052FB9FC788060\"\n      },\n      \"text\": \"\ud83d\ude02\",\n      \"senderTimestampMs\": \"1767367973345\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#4-eliminacion-de-encuesta","title":"4. Eliminaci\u00f3n de Encuesta","text":"<p>Mismo formato: <code>protocolMessage.type: \"REVOKE\"</code></p> <pre><code>{\n  \"message\": {\n    \"protocolMessage\": {\n      \"key\": {\n        \"remoteJid\": \"9698623357112@lid\",\n        \"fromMe\": true,\n        \"id\": \"AC1AD49BBFFC4B9257052FB9FC788060\"\n      },\n      \"type\": \"REVOKE\"\n    }\n  }\n}\n</code></pre>"},{"location":"baileys-payloads/#formatos-de-remotejid","title":"Formatos de remoteJid","text":"Formato Descripci\u00f3n <code>NUMERO@s.whatsapp.net</code> Chat individual (formato antiguo) <code>NUMERO@lid</code> Chat individual (formato nuevo) <code>NUMERO-TIMESTAMP@g.us</code> Grupo <code>status@broadcast</code> Estados/Historias"},{"location":"baileys-payloads/#eventos-de-chat","title":"Eventos de Chat","text":""},{"location":"baileys-payloads/#1-chat-fijado-pin","title":"1. Chat Fijado (Pin)","text":"<p>Evento: <code>chats.update</code></p>"},{"location":"baileys-payloads/#fijar-chat","title":"Fijar chat","text":"<pre><code>[\n  {\n    \"id\": \"140913951141911@lid\",\n    \"pinned\": 1767371367857,\n    \"archived\": false\n  }\n]\n</code></pre>"},{"location":"baileys-payloads/#desfijar-chat","title":"Desfijar chat","text":"<pre><code>[\n  {\n    \"id\": \"140913951141911@lid\",\n    \"pinned\": null\n  }\n]\n</code></pre> <p>Campos clave: - <code>pinned</code> - Timestamp cuando se fij\u00f3 (n\u00famero) o <code>null</code> para desfijar</p>"},{"location":"baileys-payloads/#2-chat-archivado","title":"2. Chat Archivado","text":"<p>Evento: <code>chats.update</code></p>"},{"location":"baileys-payloads/#archivar-chat","title":"Archivar chat","text":"<pre><code>[\n  {\n    \"id\": \"140913951141911@lid\",\n    \"pinned\": null,\n    \"archived\": true\n  }\n]\n</code></pre>"},{"location":"baileys-payloads/#desarchivar-chat","title":"Desarchivar chat","text":"<pre><code>[\n  {\n    \"id\": \"140913951141911@lid\",\n    \"archived\": false\n  }\n]\n</code></pre> <p>Campos clave: - <code>archived</code> - <code>true</code> para archivar, <code>false</code> para desarchivar</p>"},{"location":"baileys-payloads/#3-chat-silenciado-mute","title":"3. Chat Silenciado (Mute)","text":"<p>Evento: <code>chats.update</code></p>"},{"location":"baileys-payloads/#silenciar-chat","title":"Silenciar chat","text":"<pre><code>[\n  {\n    \"id\": \"140913951141911@lid\",\n    \"muteEndTime\": 1767400562932\n  }\n]\n</code></pre>"},{"location":"baileys-payloads/#quitar-silencio","title":"Quitar silencio","text":"<pre><code>[\n  {\n    \"id\": \"140913951141911@lid\",\n    \"muteEndTime\": null\n  }\n]\n</code></pre> <p>Campos clave: - <code>muteEndTime</code> - Timestamp cuando expira el silencio (n\u00famero) o <code>null</code> para quitar silencio</p>"},{"location":"baileys-payloads/#4-chat-eliminado","title":"4. Chat Eliminado","text":"<p>Evento: <code>chats.delete</code></p> <pre><code>[\n  \"140913951141911@lid\"\n]\n</code></pre> <p>Nota: Es un array de IDs de chats eliminados.</p>"},{"location":"baileys-payloads/#5-mensaje-leido","title":"5. Mensaje Le\u00eddo","text":"<p>Evento: <code>messages.update</code></p> <pre><code>[\n  {\n    \"key\": {\n      \"remoteJid\": \"140913951141911@lid\",\n      \"id\": \"AC08701FBF0EEADEB4250A56C0B91BFB\",\n      \"fromMe\": false\n    },\n    \"update\": {\n      \"status\": 4\n    }\n  }\n]\n</code></pre> <p>Valores de status: | Status | Descripci\u00f3n | |--------|-------------| | 1 | PENDING | | 2 | SERVER_ACK | | 3 | DELIVERY_ACK (entregado) | | 4 | READ (le\u00eddo) | | 5 | PLAYED (reproducido - para audio/video) |</p>"},{"location":"baileys-payloads/#6-presencia-escribiendoen-linea","title":"6. Presencia (Escribiendo/En l\u00ednea)","text":"<p>Evento: <code>presence.update</code></p> <pre><code>{\n  \"id\": \"140913951141911@lid\",\n  \"presences\": {\n    \"140913951141911@lid\": {\n      \"lastKnownPresence\": \"composing\"\n    }\n  }\n}\n</code></pre> <p>Valores de lastKnownPresence: | Valor | Descripci\u00f3n | |-------|-------------| | <code>composing</code> | Escribiendo | | <code>recording</code> | Grabando audio | | <code>paused</code> | Dej\u00f3 de escribir | | <code>available</code> | En l\u00ednea | | <code>unavailable</code> | Desconectado |</p>"},{"location":"getting-started/","title":"Primeros Pasos","text":"<p>Este tutorial te guiara paso a paso para crear tu primer bot de WhatsApp.</p>"},{"location":"getting-started/#1-crear-el-proyecto","title":"1. Crear el proyecto","text":"<pre><code>mkdir mi-bot-whatsapp\ncd mi-bot-whatsapp\nnpm init -y\nnpm install @arcaelas/whatsapp typescript tsx\n</code></pre>"},{"location":"getting-started/#2-estructura-basica","title":"2. Estructura basica","text":"<p>Crea el archivo principal:</p> index.ts<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\n\nasync function main() {\n  // Crear instancia de WhatsApp\n  const wa = new WhatsApp();\n\n  // Escuchar eventos antes de conectar\n  wa.event.on(\"open\", () =&gt; console.log(\"Conectado!\"));\n  wa.event.on(\"close\", () =&gt; console.log(\"Desconectado\"));\n  wa.event.on(\"error\", (err) =&gt; console.error(\"Error:\", err.message));\n\n  // Conectar mostrando QR en consola\n  console.log(\"Esperando QR...\");\n  await wa.pair(async (data) =&gt; {\n    if (Buffer.isBuffer(data)) {\n      // Guardar QR como imagen\n      const fs = await import(\"fs\");\n      fs.writeFileSync(\"qr.png\", data);\n      console.log(\"QR guardado en qr.png - Escanea con tu telefono\");\n    } else {\n      // Codigo de 8 digitos (si usas phone)\n      console.log(\"Codigo de emparejamiento:\", data);\n    }\n  });\n\n  console.log(\"Bot iniciado!\");\n}\n\nmain().catch(console.error);\n</code></pre>"},{"location":"getting-started/#3-ejecutar","title":"3. Ejecutar","text":"<pre><code>npx tsx index.ts\n</code></pre> <ol> <li>Aparecera el archivo <code>qr.png</code></li> <li>Abrelo y escanea con WhatsApp &gt; Dispositivos vinculados</li> <li>El bot se conectara automaticamente</li> </ol> <p>Listo!</p> <p>Una vez conectado, la sesion se guarda en <code>.baileys/default/</code> y no necesitaras escanear de nuevo.</p>"},{"location":"getting-started/#4-escuchar-mensajes","title":"4. Escuchar mensajes","text":"<p>Agrega un listener para mensajes entrantes:</p> index.ts<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\n\nasync function main() {\n  const wa = new WhatsApp();\n\n  // Escuchar nuevos mensajes\n  wa.event.on(\"message:created\", async (msg) =&gt; {\n    // Ignorar mensajes propios\n    if (msg.me) return;\n\n    // Solo procesar texto\n    if (msg.type !== \"text\") return;\n\n    // Obtener contenido como texto\n    const content = (await msg.content()).toString();\n    console.log(`[${msg.type}] ${msg.cid}: ${content}`);\n\n    const text = content.toLowerCase();\n\n    if (text === \"hola\") {\n      await wa.Message.text(msg.cid, \"Hola! Soy un bot. Escribe 'ayuda' para ver comandos.\");\n    }\n\n    if (text === \"ayuda\") {\n      await wa.Message.text(\n        msg.cid,\n        \"Comandos disponibles:\\n\" +\n        \"- hola: Saludo\\n\" +\n        \"- hora: Hora actual\\n\" +\n        \"- ping: Test de respuesta\"\n      );\n    }\n\n    if (text === \"hora\") {\n      await wa.Message.text(msg.cid, `Son las ${new Date().toLocaleTimeString()}`);\n    }\n\n    if (text === \"ping\") {\n      await wa.Message.text(msg.cid, \"pong!\");\n    }\n  });\n\n  // Conectar\n  await wa.pair(async (data) =&gt; {\n    if (Buffer.isBuffer(data)) {\n      require(\"fs\").writeFileSync(\"qr.png\", data);\n      console.log(\"Escanea qr.png\");\n    }\n  });\n\n  console.log(\"Bot listo!\");\n}\n\nmain().catch(console.error);\n</code></pre>"},{"location":"getting-started/#5-conexion-con-codigo-de-emparejamiento","title":"5. Conexion con codigo de emparejamiento","text":"<p>Si prefieres no escanear QR, usa el numero de telefono:</p> <pre><code>const wa = new WhatsApp({\n  phone: \"5491112345678\", // Sin + ni espacios\n});\n\nawait wa.pair(async (data) =&gt; {\n  if (typeof data === \"string\") {\n    console.log(\"Ingresa este codigo en tu telefono:\", data);\n    // Ir a WhatsApp &gt; Dispositivos vinculados &gt; Vincular dispositivo\n    // Seleccionar \"Vincular con numero de telefono\"\n  }\n});\n</code></pre>"},{"location":"getting-started/#6-manejar-diferentes-tipos-de-mensaje","title":"6. Manejar diferentes tipos de mensaje","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n\n  const buffer = await msg.content();\n\n  // Mensaje de texto\n  if (msg.type === \"text\") {\n    const text = buffer.toString();\n    console.log(\"Texto:\", text);\n  }\n\n  // Imagen\n  if (msg.type === \"image\") {\n    console.log(`Imagen: ${buffer.length} bytes`);\n    if (msg.caption) {\n      console.log(`Caption: ${msg.caption}`);\n    }\n    // Guardar imagen\n    require(\"fs\").writeFileSync(\"imagen.jpg\", buffer);\n  }\n\n  // Video\n  if (msg.type === \"video\") {\n    console.log(`Video: ${buffer.length} bytes`);\n  }\n\n  // Audio (nota de voz)\n  if (msg.type === \"audio\") {\n    console.log(`Audio: ${buffer.length} bytes`);\n  }\n\n  // Ubicacion\n  if (msg.type === \"location\") {\n    const coords = JSON.parse(buffer.toString());\n    console.log(`Ubicacion: ${coords.lat}, ${coords.lng}`);\n  }\n\n  // Encuesta\n  if (msg.type === \"poll\") {\n    const poll = JSON.parse(buffer.toString());\n    console.log(`Encuesta: ${poll.content}`);\n    poll.options.forEach((opt: { content: string }, i: number) =&gt; {\n      console.log(`  ${i + 1}. ${opt.content}`);\n    });\n  }\n});\n</code></pre>"},{"location":"getting-started/#7-enviar-mensajes","title":"7. Enviar mensajes","text":"<pre><code>const cid = \"5491198765432@s.whatsapp.net\";\n\n// Texto\nawait wa.Message.text(cid, \"Hola!\");\n\n// Texto citando mensaje\nawait wa.Message.text(cid, \"Respuesta\", \"MESSAGE_ID_TO_QUOTE\");\n\n// Imagen con caption\nconst img = require(\"fs\").readFileSync(\"foto.jpg\");\nawait wa.Message.image(cid, img, \"Mira esta foto!\");\n\n// Video\nconst vid = require(\"fs\").readFileSync(\"video.mp4\");\nawait wa.Message.video(cid, vid, \"Video interesante\");\n\n// Audio (nota de voz)\nconst aud = require(\"fs\").readFileSync(\"audio.ogg\");\nawait wa.Message.audio(cid, aud);\n\n// Ubicacion\nawait wa.Message.location(cid, {\n  lat: -34.6037,\n  lng: -58.3816\n});\n\n// Encuesta\nawait wa.Message.poll(cid, {\n  content: \"Cual prefieres?\",\n  options: [\n    { content: \"Opcion A\" },\n    { content: \"Opcion B\" },\n    { content: \"Opcion C\" }\n  ]\n});\n</code></pre>"},{"location":"getting-started/#8-reaccionar-a-mensajes","title":"8. Reaccionar a mensajes","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n  if (msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString().toLowerCase();\n\n  // Reaccionar con emoji\n  if (text.includes(\"gracias\")) {\n    await wa.Message.react(msg.cid, msg.id, \"\u2764\ufe0f\");\n  }\n\n  if (text.includes(\"jaja\")) {\n    await wa.Message.react(msg.cid, msg.id, \"\ud83d\ude02\");\n  }\n\n  // Quitar reaccion\n  // await wa.Message.react(msg.cid, msg.id, \"\");\n});\n</code></pre>"},{"location":"getting-started/#9-marcar-chat-como-leido","title":"9. Marcar chat como leido","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  // Marcar chat como leido\n  await wa.Chat.seen(msg.cid);\n});\n</code></pre>"},{"location":"getting-started/#siguiente-paso","title":"Siguiente paso","text":"<p>Ahora que tienes un bot basico funcionando, explora la documentacion detallada:</p> <ul> <li>Referencia de WhatsApp - Configuracion y eventos</li> <li>Referencia de Chat - Gestion de conversaciones</li> <li>Referencia de Message - Tipos de mensaje</li> <li>Ejemplos avanzados - Patrones recomendados</li> </ul>"},{"location":"installation/","title":"Instalacion","text":""},{"location":"installation/#requisitos","title":"Requisitos","text":"<ul> <li>Node.js 18 o superior</li> <li>npm, yarn o pnpm</li> <li>Cuenta de WhatsApp activa</li> </ul>"},{"location":"installation/#instalacion-del-paquete","title":"Instalacion del paquete","text":"npmyarnpnpm <pre><code>npm install @arcaelas/whatsapp\n</code></pre> <pre><code>yarn add @arcaelas/whatsapp\n</code></pre> <pre><code>pnpm add @arcaelas/whatsapp\n</code></pre>"},{"location":"installation/#configuracion-de-typescript","title":"Configuracion de TypeScript","text":"<p>La libreria esta escrita en TypeScript y proporciona tipos completos. Asegurate de tener una configuracion compatible:</p> tsconfig.json<pre><code>{\n  \"compilerOptions\": {\n    \"target\": \"ES2022\",\n    \"module\": \"commonjs\",\n    \"moduleResolution\": \"node\",\n    \"esModuleInterop\": true,\n    \"strict\": true,\n    \"skipLibCheck\": true\n  }\n}\n</code></pre>"},{"location":"installation/#estructura-de-archivos","title":"Estructura de archivos","text":"<p>Cuando uses <code>FileEngine</code> (default), la libreria crea la siguiente estructura:</p> <pre><code>.baileys/\n  default/                    # o el nombre que especifiques\n    session/\n      {key}/index             # Datos de sesion (creds, keys, etc.)\n    contact/\n      {jid}/index             # Datos de contacto\n    chat/\n      {jid}/\n        index                 # Datos del chat\n        message/\n          index               # Indice \"MID TIMESTAMP\" por linea\n          {mid}/\n            index             # Metadata del mensaje (JSON)\n            content           # Contenido binario (media)\n</code></pre> <p>Normalizacion de IDs</p> <p>Los caracteres <code>@</code> en JIDs se reemplazan por <code>_at_</code> en los nombres de directorios. Ejemplo: <code>5491112345678@s.whatsapp.net</code> \u2192 <code>5491112345678_at_s.whatsapp.net</code></p> <p>Consejo</p> <p>Agrega <code>.baileys/</code> a tu <code>.gitignore</code> para no subir credenciales al repositorio.</p>"},{"location":"installation/#verificar-instalacion","title":"Verificar instalacion","text":"<p>Crea un archivo de prueba:</p> test.ts<pre><code>import { WhatsApp, FileEngine } from \"@arcaelas/whatsapp\";\n\nconst wa = new WhatsApp({\n  engine: new FileEngine(\".baileys/test\"),\n});\n\nconsole.log(\"Instalacion correcta!\");\nconsole.log(\"Clases disponibles:\", {\n  Chat: wa.Chat,\n  Contact: wa.Contact,\n  Message: wa.Message,\n});\n</code></pre> <p>Ejecuta:</p> <pre><code>npx tsx test.ts\n</code></pre> <p>Si ves el mensaje de exito, la instalacion esta completa.</p>"},{"location":"installation/#problemas-comunes","title":"Problemas comunes","text":""},{"location":"installation/#error-cannot-find-module-baileys","title":"Error: Cannot find module 'baileys'","text":"<p>Asegurate de que baileys este instalado como dependencia:</p> <pre><code>npm install baileys\n</code></pre>"},{"location":"installation/#error-libffiso7-not-found-linux","title":"Error: libffi.so.7 not found (Linux)","text":"<p>Instala las dependencias del sistema:</p> <pre><code># Debian/Ubuntu\nsudo apt-get install libffi-dev\n\n# CentOS/RHEL\nsudo yum install libffi-devel\n</code></pre>"},{"location":"installation/#error-enoent-baileysdefault","title":"Error: ENOENT .baileys/default","text":"<p>El directorio se crea automaticamente en la primera conexion. Si persiste, verifica permisos de escritura.</p>"},{"location":"installation/#siguiente-paso","title":"Siguiente paso","text":"<p> Primeros pasos</p>"},{"location":"examples/basic-bot/","title":"Bot Basico","text":"<p>Ejemplo de un bot simple que responde a mensajes.</p>"},{"location":"examples/basic-bot/#codigo-completo","title":"Codigo completo","text":"bot.ts<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\n\nasync function main() {\n  const wa = new WhatsApp();\n\n  // Eventos de conexion\n  wa.event.on(\"open\", () =&gt; console.log(\"Bot conectado!\"));\n  wa.event.on(\"close\", () =&gt; console.log(\"Bot desconectado\"));\n  wa.event.on(\"error\", (err) =&gt; console.error(\"Error:\", err.message));\n\n  // Escuchar mensajes\n  wa.event.on(\"message:created\", async (msg) =&gt; {\n    // Ignorar mensajes propios\n    if (msg.me) return;\n\n    // Solo procesar texto\n    if (msg.type !== \"text\") return;\n\n    const text = (await msg.content()).toString().toLowerCase();\n\n    // Respuestas simples\n    if (text === \"hola\") {\n      await wa.Message.text(msg.cid, \"Hola! Soy un bot. Escribe 'ayuda' para ver opciones.\");\n    }\n\n    if (text === \"ayuda\") {\n      await wa.Message.text(\n        msg.cid,\n        \"Comandos disponibles:\\n\" +\n        \"- hola: Saludo\\n\" +\n        \"- hora: Hora actual\\n\" +\n        \"- fecha: Fecha actual\\n\" +\n        \"- ping: Test de respuesta\"\n      );\n    }\n\n    if (text === \"hora\") {\n      await wa.Message.text(msg.cid, `Son las ${new Date().toLocaleTimeString(\"es-AR\")}`);\n    }\n\n    if (text === \"fecha\") {\n      await wa.Message.text(msg.cid, `Hoy es ${new Date().toLocaleDateString(\"es-AR\", {\n        weekday: \"long\",\n        year: \"numeric\",\n        month: \"long\",\n        day: \"numeric\"\n      })}`);\n    }\n\n    if (text === \"ping\") {\n      const start = Date.now();\n      await wa.Message.text(msg.cid, \"pong!\");\n      console.log(`Latencia: ${Date.now() - start}ms`);\n    }\n  });\n\n  // Conectar\n  console.log(\"Iniciando bot...\");\n  await wa.pair(async (data) =&gt; {\n    if (Buffer.isBuffer(data)) {\n      require(\"fs\").writeFileSync(\"qr.png\", data);\n      console.log(\"Escanea el QR en qr.png\");\n    } else {\n      console.log(\"Codigo de emparejamiento:\", data);\n    }\n  });\n\n  console.log(\"Bot listo para recibir mensajes!\");\n}\n\nmain().catch(console.error);\n</code></pre>"},{"location":"examples/basic-bot/#ejecutar","title":"Ejecutar","text":"<pre><code>npx tsx bot.ts\n</code></pre> <ol> <li>Escanea el QR que aparece en <code>qr.png</code></li> <li>Envia \"hola\" al bot desde otro telefono</li> <li>El bot respondera automaticamente</li> </ol>"},{"location":"examples/basic-bot/#mejoras-opcionales","title":"Mejoras opcionales","text":""},{"location":"examples/basic-bot/#agregar-reacciones","title":"Agregar reacciones","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString().toLowerCase();\n\n  // Reaccionar segun contenido\n  if (text.includes(\"gracias\")) {\n    await wa.Message.react(msg.cid, msg.id, \"\u2764\ufe0f\");\n  } else if (text.includes(\"jaja\")) {\n    await wa.Message.react(msg.cid, msg.id, \"\ud83d\ude02\");\n  }\n});\n</code></pre>"},{"location":"examples/basic-bot/#responder-con-cita","title":"Responder con cita","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString().toLowerCase();\n\n  if (text === \"eco\") {\n    // Responder citando el mensaje original\n    await wa.Message.text(msg.cid, \"Esto es un eco!\");\n  }\n});\n</code></pre>"},{"location":"examples/command-bot/","title":"Bot de Comandos","text":"<p>Bot con sistema de comandos estructurado y modular.</p>"},{"location":"examples/command-bot/#estructura-del-proyecto","title":"Estructura del proyecto","text":"<pre><code>mi-bot/\n  src/\n    commands/\n      index.ts\n      ping.ts\n      ayuda.ts\n      hora.ts\n    index.ts\n  package.json\n  tsconfig.json\n</code></pre>"},{"location":"examples/command-bot/#codigo","title":"Codigo","text":""},{"location":"examples/command-bot/#srccommandsindexts","title":"src/commands/index.ts","text":"<pre><code>import type { WhatsApp } from \"@arcaelas/whatsapp\";\n\n// Tipo para mensaje (inferido de wa.Message)\ntype Message = InstanceType&lt;WhatsApp[\"Message\"]&gt;;\n\nexport interface CommandContext {\n  wa: WhatsApp;\n  msg: Message;\n  cid: string;\n  args: string[];\n  text: string;\n}\n\nexport interface Command {\n  name: string;\n  description: string;\n  aliases?: string[];\n  execute: (ctx: CommandContext) =&gt; Promise&lt;void&gt;;\n}\n\n// Registro de comandos\nexport const commands = new Map&lt;string, Command&gt;();\n\n// Helper para registrar comando\nexport function register_command(cmd: Command) {\n  commands.set(cmd.name, cmd);\n  cmd.aliases?.forEach(alias =&gt; commands.set(alias, cmd));\n}\n\n// Importar y registrar comandos\nimport \"./ping\";\nimport \"./ayuda\";\nimport \"./hora\";\n</code></pre>"},{"location":"examples/command-bot/#srccommandspingts","title":"src/commands/ping.ts","text":"<pre><code>import { register_command } from \"./index\";\n\nregister_command({\n  name: \"ping\",\n  description: \"Verificar latencia del bot\",\n  aliases: [\"p\"],\n  async execute({ wa, cid }) {\n    const start = Date.now();\n    await wa.Message.text(cid, \"pong!\");\n    console.log(`Latencia: ${Date.now() - start}ms`);\n  },\n});\n</code></pre>"},{"location":"examples/command-bot/#srccommandsayudats","title":"src/commands/ayuda.ts","text":"<pre><code>import { commands, register_command } from \"./index\";\n\nregister_command({\n  name: \"ayuda\",\n  description: \"Mostrar lista de comandos\",\n  aliases: [\"help\", \"h\", \"?\"],\n  async execute({ wa, cid }) {\n    const unique_commands = new Map&lt;string, string&gt;();\n\n    commands.forEach((cmd) =&gt; {\n      if (!unique_commands.has(cmd.name)) {\n        unique_commands.set(cmd.name, cmd.description);\n      }\n    });\n\n    let message = \"*Comandos disponibles:*\\n\\n\";\n    unique_commands.forEach((desc, name) =&gt; {\n      message += `!${name} - ${desc}\\n`;\n    });\n\n    await wa.Message.text(cid, message);\n  },\n});\n</code></pre>"},{"location":"examples/command-bot/#srccommandshorats","title":"src/commands/hora.ts","text":"<pre><code>import { register_command } from \"./index\";\n\nregister_command({\n  name: \"hora\",\n  description: \"Mostrar hora actual\",\n  aliases: [\"time\", \"t\"],\n  async execute({ wa, cid }) {\n    const now = new Date();\n    const time = now.toLocaleTimeString(\"es-AR\", {\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n      second: \"2-digit\",\n    });\n    const date = now.toLocaleDateString(\"es-AR\", {\n      weekday: \"long\",\n      day: \"numeric\",\n      month: \"long\",\n      year: \"numeric\",\n    });\n\n    await wa.Message.text(cid, `${time}\\n${date}`);\n  },\n});\n</code></pre>"},{"location":"examples/command-bot/#srcindexts","title":"src/index.ts","text":"<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\nimport { commands, CommandContext } from \"./commands\";\n\nconst PREFIX = \"!\";\n\nasync function main() {\n  const wa = new WhatsApp();\n\n  wa.event.on(\"open\", () =&gt; console.log(\"Bot conectado\"));\n  wa.event.on(\"error\", (e) =&gt; console.error(\"Error:\", e.message));\n\n  wa.event.on(\"message:created\", async (msg) =&gt; {\n    // Ignorar mensajes propios\n    if (msg.me) return;\n\n    // Solo texto\n    if (msg.type !== \"text\") return;\n\n    const text = (await msg.content()).toString();\n\n    // Verificar prefijo\n    if (!text.startsWith(PREFIX)) return;\n\n    // Parsear comando y argumentos\n    const [command_name, ...args] = text.slice(PREFIX.length).split(\" \");\n    const cmd = commands.get(command_name.toLowerCase());\n\n    if (!cmd) {\n      await wa.Message.text(msg.cid, `Comando no encontrado. Escribe ${PREFIX}ayuda`);\n      return;\n    }\n\n    // Ejecutar comando\n    const ctx: CommandContext = {\n      wa,\n      msg,\n      cid: msg.cid,\n      args,\n      text: text.slice(PREFIX.length + command_name.length + 1),\n    };\n\n    try {\n      await cmd.execute(ctx);\n    } catch (error) {\n      console.error(`Error en comando ${cmd.name}:`, error);\n      await wa.Message.text(msg.cid, \"Ocurrio un error ejecutando el comando\");\n    }\n  });\n\n  // Conectar\n  await wa.pair(async (data) =&gt; {\n    if (Buffer.isBuffer(data)) {\n      require(\"fs\").writeFileSync(\"qr.png\", data);\n      console.log(\"Escanea qr.png\");\n    }\n  });\n\n  console.log(\"Bot listo!\");\n}\n\nmain().catch(console.error);\n</code></pre>"},{"location":"examples/command-bot/#agregar-nuevos-comandos","title":"Agregar nuevos comandos","text":""},{"location":"examples/command-bot/#comando-con-argumentos","title":"Comando con argumentos","text":"src/commands/decir.ts<pre><code>import { register_command } from \"./index\";\n\nregister_command({\n  name: \"decir\",\n  description: \"Repetir un mensaje\",\n  aliases: [\"echo\", \"say\"],\n  async execute({ wa, cid, text }) {\n    if (!text.trim()) {\n      await wa.Message.text(cid, \"Uso: !decir &lt;mensaje&gt;\");\n      return;\n    }\n    await wa.Message.text(cid, text);\n  },\n});\n</code></pre>"},{"location":"examples/command-bot/#comando-con-validacion","title":"Comando con validacion","text":"src/commands/dado.ts<pre><code>import { register_command } from \"./index\";\n\nregister_command({\n  name: \"dado\",\n  description: \"Lanzar un dado\",\n  aliases: [\"dice\", \"roll\"],\n  async execute({ wa, cid, args }) {\n    const sides = parseInt(args[0]) || 6;\n\n    if (sides &lt; 2 || sides &gt; 100) {\n      await wa.Message.text(cid, \"El dado debe tener entre 2 y 100 caras\");\n      return;\n    }\n\n    const result = Math.floor(Math.random() * sides) + 1;\n    await wa.Message.text(cid, `Dado de ${sides} caras: ${result}`);\n  },\n});\n</code></pre>"},{"location":"examples/command-bot/#comando-solo-para-grupos","title":"Comando solo para grupos","text":"src/commands/grupo.ts<pre><code>import { register_command } from \"./index\";\n\nregister_command({\n  name: \"grupo\",\n  description: \"Informacion del grupo\",\n  aliases: [\"group\", \"g\"],\n  async execute({ wa, cid }) {\n    // Solo en grupos\n    if (!cid.endsWith(\"@g.us\")) {\n      await wa.Message.text(cid, \"Este comando solo funciona en grupos\");\n      return;\n    }\n\n    const chat = await wa.Chat.get(cid);\n    if (!chat) return;\n\n    const members = await wa.Chat.members(cid, 0, 1000);\n\n    await wa.Message.text(\n      cid,\n      `*${chat.name}*\\n\\n` +\n      `Miembros: ${members.length}`\n    );\n  },\n});\n</code></pre>"},{"location":"examples/command-bot/#ejecutar","title":"Ejecutar","text":"<pre><code>npx tsx src/index.ts\n</code></pre>"},{"location":"examples/command-bot/#uso","title":"Uso","text":"<pre><code>!ping          -&gt; pong!\n!ayuda         -&gt; Lista de comandos\n!hora          -&gt; 14:30:45 - lunes, 1 de enero de 2025\n!decir Hola    -&gt; Hola\n!dado 20       -&gt; Dado de 20 caras: 15\n!grupo         -&gt; Informacion del grupo\n</code></pre>"},{"location":"examples/groups/","title":"Gestion de Grupos","text":"<p>Ejemplos de trabajo con grupos de WhatsApp.</p>"},{"location":"examples/groups/#obtener-informacion-de-grupo","title":"Obtener informacion de grupo","text":"<pre><code>const chat = await wa.Chat.get(\"123456789@g.us\");\n\nif (chat &amp;&amp; chat.type === \"group\") {\n  console.log(`Nombre: ${chat.name}`);\n  console.log(`ID: ${chat.id}`);\n\n  // Miembros\n  const members = await wa.Chat.members(chat.id, 0, 1000);\n  console.log(`Miembros: ${members.length}`);\n\n  for (const member of members) {\n    console.log(`  - ${member.name} (${member.phone})`);\n  }\n}\n</code></pre>"},{"location":"examples/groups/#detectar-grupos-en-eventos","title":"Detectar grupos en eventos","text":"<pre><code>wa.event.on(\"chat:created\", (chat) =&gt; {\n  if (chat.type === \"group\") {\n    console.log(`Grupo creado: ${chat.name}`);\n  }\n});\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  // Verificar si el mensaje es de un grupo\n  const is_group = msg.cid.endsWith(\"@g.us\");\n\n  if (is_group) {\n    console.log(`Mensaje en grupo: ${msg.cid}`);\n  }\n});\n</code></pre>"},{"location":"examples/groups/#enviar-mensajes-a-grupos","title":"Enviar mensajes a grupos","text":"<pre><code>// Enviar texto a un grupo\nawait wa.Message.text(\"123456789@g.us\", \"Hola grupo!\");\n\n// Enviar imagen a un grupo\nimport * as fs from \"fs\";\nconst img = fs.readFileSync(\"foto.jpg\");\nawait wa.Message.image(\"123456789@g.us\", img, \"Foto para el grupo\");\n\n// Crear encuesta en grupo\nawait wa.Message.poll(\"123456789@g.us\", {\n  content: \"Donde nos juntamos?\",\n  options: [\n    { content: \"En mi casa\" },\n    { content: \"En el parque\" },\n    { content: \"En el centro\" }\n  ]\n});\n</code></pre>"},{"location":"examples/groups/#responder-en-grupos","title":"Responder en grupos","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n\n  // Solo procesar mensajes de grupos\n  if (!msg.cid.endsWith(\"@g.us\")) return;\n\n  if (msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString().toLowerCase();\n\n  // Responder\n  if (text.includes(\"hola\")) {\n    await wa.Message.text(msg.cid, \"Hola! Bienvenido al grupo\");\n  }\n});\n</code></pre>"},{"location":"examples/groups/#obtener-miembros-de-un-grupo","title":"Obtener miembros de un grupo","text":"<pre><code>const group_id = \"123456789@g.us\";\nconst members = await wa.Chat.members(group_id, 0, 1000);\n\nconsole.log(`Grupo tiene ${members.length} miembros:`);\nfor (const member of members) {\n  console.log(`  - ${member.name}: ${member.phone}`);\n}\n</code></pre>"},{"location":"examples/groups/#exportar-miembros-a-json","title":"Exportar miembros a JSON","text":"<pre><code>import * as fs from \"fs\";\n\nasync function export_group_members(wa: WhatsApp, group_id: string) {\n  const chat = await wa.Chat.get(group_id);\n  if (!chat || chat.type !== \"group\") {\n    throw new Error(\"Grupo no encontrado\");\n  }\n\n  const members = await wa.Chat.members(group_id, 0, 10000);\n\n  const data = {\n    group: {\n      id: chat.id,\n      name: chat.name,\n    },\n    exported_at: new Date().toISOString(),\n    members: members.map(m =&gt; ({\n      id: m.id,\n      phone: m.phone,\n      name: m.name,\n    })),\n  };\n\n  const filename = `grupo_${chat.name.replace(/[^a-z0-9]/gi, \"_\")}.json`;\n  fs.writeFileSync(filename, JSON.stringify(data, null, 2));\n\n  console.log(`Exportados ${members.length} miembros a ${filename}`);\n}\n</code></pre>"},{"location":"examples/groups/#bot-de-comandos-para-grupos","title":"Bot de comandos para grupos","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"text\") return;\n\n  // Solo en grupos\n  if (!msg.cid.endsWith(\"@g.us\")) return;\n\n  const text = (await msg.content()).toString();\n  if (!text.startsWith(\"!\")) return;\n\n  const [cmd] = text.slice(1).split(\" \");\n\n  switch (cmd.toLowerCase()) {\n    case \"info\":\n      const chat = await wa.Chat.get(msg.cid);\n      if (chat) {\n        const members = await wa.Chat.members(msg.cid, 0, 1000);\n        await wa.Message.text(\n          msg.cid,\n          `*${chat.name}*\\n\\n` +\n          `ID: ${chat.id}\\n` +\n          `Miembros: ${members.length}`\n        );\n      }\n      break;\n\n    case \"miembros\":\n      const group_members = await wa.Chat.members(msg.cid, 0, 50);\n      const list = group_members.map(m =&gt; `- ${m.name}`).join(\"\\n\");\n      await wa.Message.text(msg.cid, `*Miembros:*\\n${list}`);\n      break;\n  }\n});\n</code></pre>"},{"location":"examples/groups/#notas","title":"Notas","text":"<p>JID de grupo</p> <p>Los grupos tienen JID con formato <code>{id}@g.us</code></p> <p>Diferenciacion</p> <p>Usa <code>chat.type === \"group\"</code> o <code>cid.endsWith(\"@g.us\")</code> para detectar grupos</p>"},{"location":"examples/media/","title":"Envio de Media","text":"<p>Ejemplos de envio y recepcion de archivos multimedia.</p>"},{"location":"examples/media/#enviar-imagen","title":"Enviar imagen","text":"<pre><code>import * as fs from \"fs\";\n\n// Desde archivo local\nconst img = fs.readFileSync(\"foto.jpg\");\nawait wa.Message.image(\"5491112345678@s.whatsapp.net\", img, \"Mira esta foto!\");\n\n// Desde URL (descargar primero)\nconst response = await fetch(\"https://example.com/image.jpg\");\nconst buffer = Buffer.from(await response.arrayBuffer());\nawait wa.Message.image(\"5491112345678@s.whatsapp.net\", buffer, \"Imagen de internet\");\n</code></pre>"},{"location":"examples/media/#enviar-video","title":"Enviar video","text":"<pre><code>import * as fs from \"fs\";\n\n// Desde archivo local\nconst video = fs.readFileSync(\"video.mp4\");\nawait wa.Message.video(\"5491112345678@s.whatsapp.net\", video, \"Video interesante\");\n\n// Nota: WhatsApp comprime los videos automaticamente\n// Para mejor calidad, usa videos cortos (&lt;3 min) y 720p\n</code></pre>"},{"location":"examples/media/#enviar-audio","title":"Enviar audio","text":"<pre><code>import * as fs from \"fs\";\n\n// Nota de voz (PTT - Push to Talk) - default\nconst audio = fs.readFileSync(\"audio.ogg\");\nawait wa.Message.audio(\"5491112345678@s.whatsapp.net\", audio);\n\n// Audio normal (sin PTT)\nawait wa.Message.audio(\"5491112345678@s.whatsapp.net\", audio, false);\n\n// Formatos soportados: OGG con codec Opus (preferido), MP3, AAC\n// WhatsApp convierte automaticamente a OGG/Opus\n</code></pre>"},{"location":"examples/media/#enviar-ubicacion","title":"Enviar ubicacion","text":"<pre><code>// Ubicacion estatica\nawait wa.Message.location(\"5491112345678@s.whatsapp.net\", {\n  lat: -34.6037,\n  lng: -58.3816\n});\n</code></pre>"},{"location":"examples/media/#recibir-y-guardar-media","title":"Recibir y guardar media","text":"<pre><code>import * as fs from \"fs\";\nimport * as path from \"path\";\n\nconst MEDIA_DIR = \"./medios\";\nfs.mkdirSync(MEDIA_DIR, { recursive: true });\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n\n  const timestamp = Date.now();\n  const buffer = await msg.content();\n\n  if (buffer.length === 0) return;\n\n  // Imagen\n  if (msg.type === \"image\") {\n    const ext = msg.mime.split(\"/\")[1] || \"jpg\";\n    const filename = `${timestamp}.${ext}`;\n    fs.writeFileSync(path.join(MEDIA_DIR, filename), buffer);\n    console.log(`Imagen guardada: ${filename} (${buffer.length} bytes)`);\n    if (msg.caption) {\n      console.log(`Caption: ${msg.caption}`);\n    }\n  }\n\n  // Video\n  if (msg.type === \"video\") {\n    const filename = `${timestamp}.mp4`;\n    fs.writeFileSync(path.join(MEDIA_DIR, filename), buffer);\n    console.log(`Video guardado: ${filename} (${buffer.length} bytes)`);\n  }\n\n  // Audio\n  if (msg.type === \"audio\") {\n    const filename = `${timestamp}.ogg`;\n    fs.writeFileSync(path.join(MEDIA_DIR, filename), buffer);\n    console.log(`Audio guardado: ${filename} (${buffer.length} bytes)`);\n  }\n});\n</code></pre>"},{"location":"examples/media/#reenviar-media","title":"Reenviar media","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString();\n\n  // Comando para reenviar al ultimo mensaje\n  if (text.startsWith(\"!reenviar \")) {\n    const target_phone = text.slice(10).trim();\n    const target_jid = `${target_phone}@s.whatsapp.net`;\n\n    // Obtener mensaje anterior (el que queremos reenviar)\n    const prev_msg = await wa.Message.get(msg.cid, \"PREVIOUS_MESSAGE_ID\");\n\n    if (prev_msg &amp;&amp; [\"image\", \"video\", \"audio\"].includes(prev_msg.type)) {\n      await wa.Message.forward(msg.cid, prev_msg.id, target_jid);\n      await wa.Message.text(msg.cid, \"Media reenviada!\");\n    }\n  }\n});\n</code></pre>"},{"location":"examples/media/#procesar-imagenes","title":"Procesar imagenes","text":"<pre><code>import sharp from \"sharp\"; // npm install sharp\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"image\") return;\n\n  const buffer = await msg.content();\n  if (buffer.length === 0) return;\n\n  // Obtener metadata\n  const metadata = await sharp(buffer).metadata();\n  console.log(`Imagen: ${metadata.width}x${metadata.height}, ${metadata.format}`);\n\n  // Redimensionar\n  const thumbnail = await sharp(buffer)\n    .resize(100, 100, { fit: \"cover\" })\n    .jpeg({ quality: 80 })\n    .toBuffer();\n\n  // Enviar thumbnail como respuesta\n  await wa.Message.image(msg.cid, thumbnail, \"Thumbnail generado\");\n});\n</code></pre>"},{"location":"examples/media/#transcribir-audio","title":"Transcribir audio","text":"<pre><code>// Ejemplo con Whisper API de OpenAI\nimport OpenAI from \"openai\";\nimport * as fs from \"fs\";\nimport * as path from \"path\";\n\nconst openai = new OpenAI();\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"audio\") return;\n\n  const buffer = await msg.content();\n  if (buffer.length === 0) return;\n\n  // Guardar temporalmente\n  const temp_file = path.join(\"/tmp\", `${Date.now()}.ogg`);\n  fs.writeFileSync(temp_file, buffer);\n\n  try {\n    // Transcribir\n    const transcription = await openai.audio.transcriptions.create({\n      file: fs.createReadStream(temp_file),\n      model: \"whisper-1\",\n      language: \"es\",\n    });\n\n    await wa.Message.text(msg.cid, `Transcripcion:\\n${transcription.text}`);\n  } catch (error) {\n    console.error(\"Error transcribiendo:\", error);\n  } finally {\n    fs.unlinkSync(temp_file);\n  }\n});\n</code></pre>"},{"location":"examples/media/#limites-y-recomendaciones","title":"Limites y recomendaciones","text":"Tipo Limite Recomendacion Imagen 16 MB &lt; 5 MB, JPEG/PNG Video 64 MB &lt; 16 MB, MP4 H.264 Audio 16 MB &lt; 5 MB, OGG Opus <p>Compresion</p> <p>WhatsApp comprime automaticamente los medios. Para mejor calidad, usa formatos optimizados.</p> <p>Timeout</p> <p>La descarga de media puede tardar. Considera usar timeouts y reintentos.</p>"},{"location":"examples/polls/","title":"Encuestas","text":"<p>Ejemplos de creacion y manejo de encuestas.</p>"},{"location":"examples/polls/#crear-encuesta","title":"Crear encuesta","text":"<pre><code>// Encuesta simple\nawait wa.Message.poll(\"123456789@g.us\", {\n  content: \"Cual es tu color favorito?\",\n  options: [\n    { content: \"Rojo\" },\n    { content: \"Azul\" },\n    { content: \"Verde\" },\n    { content: \"Amarillo\" }\n  ]\n});\n</code></pre>"},{"location":"examples/polls/#leer-datos-de-encuesta","title":"Leer datos de encuesta","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.type !== \"poll\") return;\n\n  // El contenido de una encuesta es JSON\n  const buffer = await msg.content();\n  const poll = JSON.parse(buffer.toString()) as {\n    content: string;\n    options: Array&lt;{ content: string }&gt;;\n  };\n\n  console.log(`Encuesta: ${poll.content}`);\n  console.log(\"Opciones:\");\n  poll.options.forEach((opt, i) =&gt; {\n    console.log(`  ${i + 1}. ${opt.content}`);\n  });\n});\n</code></pre>"},{"location":"examples/polls/#bot-de-encuestas","title":"Bot de encuestas","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString();\n\n  // Comando: !encuesta Pregunta | Opcion1 | Opcion2 | ...\n  if (text.startsWith(\"!encuesta \")) {\n    const content = text.slice(10);\n    const parts = content.split(\"|\").map(s =&gt; s.trim());\n\n    if (parts.length &lt; 3) {\n      await wa.Message.text(\n        msg.cid,\n        \"Uso: !encuesta Pregunta | Opcion1 | Opcion2 | ...\\n\\n\" +\n        \"Ejemplo:\\n\" +\n        \"!encuesta Que comemos hoy? | Pizza | Sushi | Hamburguesa\"\n      );\n      return;\n    }\n\n    const [question, ...options] = parts;\n\n    if (options.length &gt; 12) {\n      await wa.Message.text(msg.cid, \"Maximo 12 opciones permitidas\");\n      return;\n    }\n\n    await wa.Message.poll(msg.cid, {\n      content: question,\n      options: options.map(opt =&gt; ({ content: opt }))\n    });\n\n    await wa.Message.text(msg.cid, `Encuesta creada: \"${question}\"`);\n  }\n});\n</code></pre>"},{"location":"examples/polls/#encuesta-con-temporizador","title":"Encuesta con temporizador","text":"<pre><code>async function create_timed_poll(\n  wa: WhatsApp,\n  chat_id: string,\n  question: string,\n  options: string[],\n  duration_minutes: number\n) {\n  // Crear encuesta\n  const poll_msg = await wa.Message.poll(chat_id, {\n    content: question,\n    options: options.map(opt =&gt; ({ content: opt }))\n  });\n\n  if (!poll_msg) return;\n\n  await wa.Message.text(chat_id, `Encuesta activa por ${duration_minutes} minutos`);\n\n  // Esperar duracion\n  await new Promise(r =&gt; setTimeout(r, duration_minutes * 60 * 1000));\n\n  // Anunciar que termino\n  await wa.Message.text(chat_id, `*Encuesta finalizada!*\\n\\nVer resultados en la encuesta.`);\n}\n\n// Uso\nawait create_timed_poll(\n  wa,\n  \"123456789@g.us\",\n  \"Que pelicula vemos?\",\n  [\"Accion\", \"Comedia\", \"Terror\", \"Drama\"],\n  5 // 5 minutos\n);\n</code></pre>"},{"location":"examples/polls/#notas-importantes","title":"Notas importantes","text":"<p>Limite de opciones</p> <p>WhatsApp permite maximo 12 opciones por encuesta.</p> <p>Visibilidad de votos</p> <p>Los votos en WhatsApp son anonimos. Solo puedes ver el conteo total, no quien voto.</p> <p>Encuestas en grupos</p> <p>Las encuestas funcionan mejor en grupos donde hay mas participantes.</p>"},{"location":"examples/s3-bot/","title":"Bot con Engine Personalizado","text":"<p>Bot de produccion usando un engine personalizado para almacenamiento.</p>"},{"location":"examples/s3-bot/#descripcion","title":"Descripcion","text":"<p>Este ejemplo muestra como crear un bot que usa un engine personalizado (Redis, PostgreSQL, S3, etc.) en lugar del FileEngine por defecto.</p>"},{"location":"examples/s3-bot/#ejemplo-redis-engine","title":"Ejemplo: Redis Engine","text":""},{"location":"examples/s3-bot/#crear-el-engine","title":"Crear el engine","text":"RedisEngine.ts<pre><code>import type { Engine } from \"@arcaelas/whatsapp\";\nimport { createClient } from \"redis\";\n\nexport class RedisEngine implements Engine {\n  private client: ReturnType&lt;typeof createClient&gt;;\n\n  constructor(url: string) {\n    this.client = createClient({ url });\n  }\n\n  async connect() {\n    await this.client.connect();\n  }\n\n  async get(key: string): Promise&lt;string | null&gt; {\n    return await this.client.get(key);\n  }\n\n  async set(key: string, value: string | null): Promise&lt;void&gt; {\n    if (value === null) {\n      await this.client.del(key);\n    } else {\n      await this.client.set(key, value);\n    }\n  }\n\n  async list(prefix: string, offset = 0, limit = 50): Promise&lt;string[]&gt; {\n    const keys = await this.client.keys(`${prefix}*`);\n    return keys.slice(offset, offset + limit);\n  }\n}\n</code></pre>"},{"location":"examples/s3-bot/#usar-el-engine","title":"Usar el engine","text":"bot.ts<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\nimport { RedisEngine } from \"./RedisEngine\";\nimport \"dotenv/config\";\n\nasync function main() {\n  // Crear engine Redis\n  const engine = new RedisEngine(process.env.REDIS_URL || \"redis://localhost:6379\");\n  await engine.connect();\n\n  // Crear instancia con engine personalizado\n  const wa = new WhatsApp({ engine });\n\n  // Logging\n  wa.event.on(\"open\", () =&gt; console.log(\"[INFO] Conectado\"));\n  wa.event.on(\"close\", () =&gt; console.log(\"[WARN] Desconectado\"));\n  wa.event.on(\"error\", (e) =&gt; console.error(\"[ERROR]\", e.message));\n\n  // Mensajes\n  wa.event.on(\"message:created\", async (msg) =&gt; {\n    if (msg.me || msg.type !== \"text\") return;\n\n    const text = (await msg.content()).toString();\n    const prefix = process.env.BOT_PREFIX || \"!\";\n\n    if (!text.startsWith(prefix)) return;\n\n    const [cmd] = text.slice(prefix.length).split(\" \");\n\n    switch (cmd.toLowerCase()) {\n      case \"ping\":\n        await wa.Message.text(msg.cid, \"pong!\");\n        break;\n\n      case \"status\":\n        await wa.Message.text(\n          msg.cid,\n          `*Estado del Bot*\\n\\n` +\n          `Engine: Redis\\n` +\n          `Uptime: ${Math.floor(process.uptime() / 60)} minutos`\n        );\n        break;\n\n      case \"ayuda\":\n        await wa.Message.text(\n          msg.cid,\n          `Comandos:\\n` +\n          `${prefix}ping - Test\\n` +\n          `${prefix}status - Estado del bot\\n` +\n          `${prefix}ayuda - Este mensaje`\n        );\n        break;\n    }\n  });\n\n  // Conectar\n  console.log(\"[INFO] Iniciando bot...\");\n  await wa.pair(async (data) =&gt; {\n    if (Buffer.isBuffer(data)) {\n      require(\"fs\").writeFileSync(\"/tmp/qr.png\", data);\n      console.log(\"[INFO] QR guardado en /tmp/qr.png\");\n    } else {\n      console.log(\"[INFO] Codigo:\", data);\n    }\n  });\n\n  console.log(\"[INFO] Bot listo!\");\n\n  // Mantener proceso vivo\n  process.on(\"SIGINT\", () =&gt; {\n    console.log(\"[INFO] Cerrando...\");\n    process.exit(0);\n  });\n}\n\nmain().catch((e) =&gt; {\n  console.error(\"[FATAL]\", e);\n  process.exit(1);\n});\n</code></pre>"},{"location":"examples/s3-bot/#docker","title":"Docker","text":"Dockerfile<pre><code>FROM node:20-alpine\n\nWORKDIR /app\n\nCOPY package*.json ./\nRUN npm ci --only=production\n\nCOPY . .\n\nCMD [\"node\", \"--import\", \"tsx\", \"bot.ts\"]\n</code></pre> docker-compose.yml<pre><code>version: \"3.8\"\n\nservices:\n  redis:\n    image: redis:7-alpine\n    restart: unless-stopped\n\n  bot:\n    build: .\n    restart: unless-stopped\n    depends_on:\n      - redis\n    environment:\n      - REDIS_URL=redis://redis:6379\n      - BOT_PREFIX=!\n    volumes:\n      - /tmp:/tmp  # Para el QR temporal\n</code></pre>"},{"location":"examples/s3-bot/#health-check","title":"Health check","text":"<pre><code>import { createServer } from \"http\";\n\n// Agregar despues de inicializar el bot\nconst server = createServer((req, res) =&gt; {\n  if (req.url === \"/health\") {\n    res.writeHead(200, { \"Content-Type\": \"application/json\" });\n    res.end(JSON.stringify({\n      status: \"ok\",\n      connected: wa.socket !== null,\n      uptime: process.uptime(),\n    }));\n  } else {\n    res.writeHead(404);\n    res.end();\n  }\n});\n\nserver.listen(3000, () =&gt; {\n  console.log(\"[INFO] Health check en http://localhost:3000/health\");\n});\n</code></pre>"},{"location":"examples/s3-bot/#variables-de-entorno","title":"Variables de entorno","text":".env<pre><code>REDIS_URL=redis://localhost:6379\nBOT_PREFIX=!\n</code></pre>"},{"location":"examples/s3-bot/#otros-engines","title":"Otros engines","text":"<p>Consulta la documentacion de Engines para ver ejemplos de PostgreSQL, MongoDB, y otros.</p>"},{"location":"references/chat/","title":"Chat","text":"<p>Clase para gestionar conversaciones de WhatsApp (contactos individuales y grupos).</p>"},{"location":"references/chat/#importacion","title":"Importacion","text":"<p>La clase se accede desde la instancia de WhatsApp:</p> <pre><code>const wa = new WhatsApp();\nwa.Chat // Clase Chat enlazada\n</code></pre>"},{"location":"references/chat/#propiedades","title":"Propiedades","text":"Propiedad Tipo Descripcion <code>id</code> <code>string</code> JID del chat (ej: <code>123@s.whatsapp.net</code> o <code>123@g.us</code>) <code>name</code> <code>string</code> Nombre del chat o grupo <code>type</code> <code>'contact' \\| 'group'</code> Tipo de chat <code>pined</code> <code>number \\| null</code> Timestamp cuando se fijo o <code>null</code> <code>archived</code> <code>boolean</code> <code>true</code> si el chat esta archivado <code>muted</code> <code>number \\| null</code> Timestamp cuando expira el silencio o <code>null</code>"},{"location":"references/chat/#metodos-estaticos","title":"Metodos estaticos","text":""},{"location":"references/chat/#chatgetcid","title":"<code>Chat.get(cid)</code>","text":"<p>Obtiene un chat por su ID. Si no existe pero el contacto si, crea el chat automaticamente.</p> <pre><code>// Chat individual\nconst chat = await wa.Chat.get(\"5491112345678@s.whatsapp.net\");\n\n// Grupo\nconst group = await wa.Chat.get(\"123456789@g.us\");\n\nif (chat) {\n  console.log(`Chat: ${chat.name} (${chat.type})`);\n}\n</code></pre>"},{"location":"references/chat/#chatpincid-value","title":"<code>Chat.pin(cid, value)</code>","text":"<p>Fija o desfija un chat.</p> <pre><code>// Fijar\nawait wa.Chat.pin(\"5491112345678@s.whatsapp.net\", true);\n\n// Desfijar\nawait wa.Chat.pin(\"5491112345678@s.whatsapp.net\", false);\n</code></pre>"},{"location":"references/chat/#chatarchivecid-value","title":"<code>Chat.archive(cid, value)</code>","text":"<p>Archiva o desarchiva un chat.</p> <pre><code>// Archivar\nawait wa.Chat.archive(\"5491112345678@s.whatsapp.net\", true);\n\n// Desarchivar\nawait wa.Chat.archive(\"5491112345678@s.whatsapp.net\", false);\n</code></pre>"},{"location":"references/chat/#chatmutecid-duration","title":"<code>Chat.mute(cid, duration)</code>","text":"<p>Silencia o desilencia un chat.</p> Parametro Tipo Descripcion <code>cid</code> <code>string</code> ID del chat <code>duration</code> <code>number \\| null</code> Duracion en milisegundos o <code>null</code> para desilenciar <pre><code>// Silenciar por 8 horas\nawait wa.Chat.mute(\n  \"5491112345678@s.whatsapp.net\",\n  8 * 60 * 60 * 1000\n);\n\n// Silenciar por 1 semana\nawait wa.Chat.mute(\n  \"5491112345678@s.whatsapp.net\",\n  7 * 24 * 60 * 60 * 1000\n);\n\n// Desilenciar\nawait wa.Chat.mute(\"5491112345678@s.whatsapp.net\", null);\n</code></pre>"},{"location":"references/chat/#chatseencid","title":"<code>Chat.seen(cid)</code>","text":"<p>Marca el ultimo mensaje del chat como leido.</p> <pre><code>await wa.Chat.seen(\"5491112345678@s.whatsapp.net\");\n</code></pre>"},{"location":"references/chat/#chatremovecid","title":"<code>Chat.remove(cid)</code>","text":"<p>Elimina un chat. Si es grupo, sale del grupo antes de eliminar.</p> <pre><code>await wa.Chat.remove(\"5491112345678@s.whatsapp.net\");\n</code></pre>"},{"location":"references/chat/#chatmemberscid-offset-limit","title":"<code>Chat.members(cid, offset, limit)</code>","text":"<p>Obtiene los miembros del chat.</p> <ul> <li>En chats individuales: retorna el contacto</li> <li>En grupos: retorna los participantes del grupo</li> </ul> <pre><code>// Miembros de un grupo\nconst members = await wa.Chat.members(\"123456789@g.us\", 0, 50);\nfor (const member of members) {\n  console.log(`${member.name} (${member.phone})`);\n}\n\n// Miembro de chat individual (retorna el contacto)\nconst contacts = await wa.Chat.members(\"5491112345678@s.whatsapp.net\", 0, 1);\n</code></pre>"},{"location":"references/chat/#eventos-de-chat","title":"Eventos de Chat","text":"<p>Los eventos se escuchan a traves de <code>wa.event</code>:</p>"},{"location":"references/chat/#chatcreated","title":"<code>chat:created</code>","text":"<p>Emitido cuando se crea un nuevo chat.</p> <pre><code>wa.event.on(\"chat:created\", (chat) =&gt; {\n  console.log(`Nuevo chat: ${chat.name} (${chat.type})`);\n});\n</code></pre>"},{"location":"references/chat/#chatupdated","title":"<code>chat:updated</code>","text":"<p>Emitido cuando se actualiza un chat existente.</p> <pre><code>wa.event.on(\"chat:updated\", (chat) =&gt; {\n  console.log(`Chat actualizado: ${chat.name}`);\n});\n</code></pre>"},{"location":"references/chat/#chatpined","title":"<code>chat:pined</code>","text":"<p>Emitido cuando se fija o desfija un chat.</p> <pre><code>wa.event.on(\"chat:pined\", (cid, pined) =&gt; {\n  if (pined) {\n    console.log(`Chat ${cid} fijado`);\n  } else {\n    console.log(`Chat ${cid} desfijado`);\n  }\n});\n</code></pre>"},{"location":"references/chat/#chatarchived","title":"<code>chat:archived</code>","text":"<p>Emitido cuando se archiva o desarchiva un chat.</p> <pre><code>wa.event.on(\"chat:archived\", (cid, archived) =&gt; {\n  console.log(`Chat ${cid}: ${archived ? \"archivado\" : \"desarchivado\"}`);\n});\n</code></pre>"},{"location":"references/chat/#chatmuted","title":"<code>chat:muted</code>","text":"<p>Emitido cuando se silencia o desilencia un chat.</p> <pre><code>wa.event.on(\"chat:muted\", (cid, muted) =&gt; {\n  if (muted) {\n    console.log(`Chat ${cid} silenciado hasta ${new Date(muted)}`);\n  } else {\n    console.log(`Chat ${cid} desilenciado`);\n  }\n});\n</code></pre>"},{"location":"references/chat/#chatdeleted","title":"<code>chat:deleted</code>","text":"<p>Emitido cuando se elimina un chat.</p> <pre><code>wa.event.on(\"chat:deleted\", (cid) =&gt; {\n  console.log(`Chat eliminado: ${cid}`);\n});\n</code></pre>"},{"location":"references/chat/#diferenciar-contactos-de-grupos","title":"Diferenciar contactos de grupos","text":"<pre><code>wa.event.on(\"chat:created\", (chat) =&gt; {\n  if (chat.type === \"group\") {\n    console.log(`Grupo: ${chat.name}`);\n  } else {\n    console.log(`Chat individual: ${chat.name}`);\n  }\n});\n\n// O verificar por JID\nfunction is_group(cid: string): boolean {\n  return cid.endsWith(\"@g.us\");\n}\n</code></pre>"},{"location":"references/chat/#ejemplos","title":"Ejemplos","text":""},{"location":"references/chat/#listar-miembros-de-un-grupo","title":"Listar miembros de un grupo","text":"<pre><code>const group_id = \"123456789@g.us\";\nconst members = await wa.Chat.members(group_id, 0, 1000);\n\nconsole.log(`Grupo tiene ${members.length} miembros:`);\nfor (const member of members) {\n  console.log(`  - ${member.name}`);\n}\n</code></pre>"},{"location":"references/chat/#silenciar-grupos-nuevos-automaticamente","title":"Silenciar grupos nuevos automaticamente","text":"<pre><code>wa.event.on(\"chat:created\", async (chat) =&gt; {\n  if (chat.type === \"group\") {\n    // Silenciar por 1 a\u00f1o (efectivamente indefinido)\n    await wa.Chat.mute(chat.id, 365 * 24 * 60 * 60 * 1000);\n    console.log(`Grupo ${chat.name} silenciado automaticamente`);\n  }\n});\n</code></pre>"},{"location":"references/chat/#archivar-chats-inactivos","title":"Archivar chats inactivos","text":"<pre><code>// Archivar chats que no estan fijados ni silenciados\nasync function archive_inactive(wa: WhatsApp) {\n  const chat = await wa.Chat.get(\"5491112345678@s.whatsapp.net\");\n  if (chat &amp;&amp; !chat.pined &amp;&amp; !chat.archived) {\n    await wa.Chat.archive(chat.id, true);\n  }\n}\n</code></pre>"},{"location":"references/chat/#enviar-mensaje-a-todos-los-miembros-de-un-grupo","title":"Enviar mensaje a todos los miembros de un grupo","text":"<pre><code>async function broadcast_to_members(wa: WhatsApp, group_id: string, text: string) {\n  const members = await wa.Chat.members(group_id, 0, 1000);\n\n  for (const member of members) {\n    // Enviar mensaje individual a cada miembro\n    await wa.Message.text(member.id, text);\n    // Esperar entre mensajes para evitar ban\n    await new Promise(r =&gt; setTimeout(r, 2000));\n  }\n}\n</code></pre>"},{"location":"references/chat/#interfaz-ichat","title":"Interfaz IChat","text":"<pre><code>interface IChat {\n  id: string;\n  name: string;\n  type: \"contact\" | \"group\";\n  pined: number | null;\n  archived: boolean;\n  muted: number | null;\n}\n</code></pre>"},{"location":"references/chat/#notas","title":"Notas","text":"<p>JID de chats</p> <ul> <li>Chats individuales: <code>{numero}@s.whatsapp.net</code> (ej: <code>5491112345678@s.whatsapp.net</code>)</li> <li>Grupos: <code>{id}@g.us</code> (ej: <code>123456789@g.us</code>)</li> <li>Linked IDs (LID): <code>{id}@lid</code> (formato interno de WhatsApp)</li> </ul> <p>Salir de grupos</p> <p>Al llamar <code>Chat.remove()</code> en un grupo, primero se sale del grupo y luego se elimina el chat local.</p> <p>Pined timestamp</p> <p>El campo <code>pined</code> contiene el timestamp de cuando se fijo el chat. Util para ordenar chats fijados por orden de fijacion.</p>"},{"location":"references/contact/","title":"Contact","text":"<p>Clase para gestionar contactos de WhatsApp.</p>"},{"location":"references/contact/#importacion","title":"Importacion","text":"<p>La clase se accede desde la instancia de WhatsApp:</p> <pre><code>const wa = new WhatsApp();\nwa.Contact // Clase Contact enlazada\n</code></pre>"},{"location":"references/contact/#propiedades","title":"Propiedades","text":"Propiedad Tipo Descripcion <code>id</code> <code>string</code> JID del contacto (ej: <code>5491112345678@s.whatsapp.net</code>) <code>me</code> <code>boolean</code> <code>true</code> si es el usuario autenticado <code>name</code> <code>string</code> Nombre del contacto <code>phone</code> <code>string \\| null</code> Numero de telefono <code>photo</code> <code>string \\| null</code> URL de la foto de perfil o <code>null</code>"},{"location":"references/contact/#metodos-estaticos","title":"Metodos estaticos","text":""},{"location":"references/contact/#contactgetuid","title":"<code>Contact.get(uid)</code>","text":"<p>Obtiene un contacto por su ID o numero de telefono. Si no existe en el engine, verifica con WhatsApp (<code>onWhatsApp</code>) y lo crea automaticamente.</p> <pre><code>// Con JID completo\nconst contact = await wa.Contact.get(\"5491112345678@s.whatsapp.net\");\n\n// O solo con numero de telefono\nconst contact2 = await wa.Contact.get(\"5491112345678\");\n\nif (contact) {\n  console.log(`Nombre: ${contact.name}`);\n  console.log(`Telefono: ${contact.phone}`);\n  console.log(`Es yo: ${contact.me}`);\n}\n</code></pre>"},{"location":"references/contact/#contactrenameuid-name","title":"<code>Contact.rename(uid, name)</code>","text":"<p>Cambia el nombre de un contacto (solo local).</p> <pre><code>await wa.Contact.rename(\"5491112345678@s.whatsapp.net\", \"Cliente VIP\");\n</code></pre>"},{"location":"references/contact/#contactpaginateoffset-limit","title":"<code>Contact.paginate(offset, limit)</code>","text":"<p>Obtiene contactos paginados.</p> <pre><code>const contacts = await wa.Contact.paginate(0, 50);\nfor (const contact of contacts) {\n  console.log(`${contact.name}: ${contact.phone}`);\n}\n</code></pre>"},{"location":"references/contact/#metodos-de-instancia","title":"Metodos de instancia","text":""},{"location":"references/contact/#renamename","title":"<code>rename(name)</code>","text":"<p>Cambia el nombre del contacto (solo local).</p> <pre><code>const contact = await wa.Contact.get(\"5491112345678@s.whatsapp.net\");\nif (contact) {\n  await contact.rename(\"Mi mejor amigo\");\n  console.log(contact.name); // \"Mi mejor amigo\"\n}\n</code></pre>"},{"location":"references/contact/#chat","title":"<code>chat()</code>","text":"<p>Obtiene o crea el chat 1-1 con este contacto.</p> <pre><code>const contact = await wa.Contact.get(\"5491112345678@s.whatsapp.net\");\nif (contact) {\n  const chat = await contact.chat();\n  if (chat) {\n    console.log(`Chat: ${chat.name} (${chat.type})`);\n  }\n}\n</code></pre>"},{"location":"references/contact/#eventos-de-contact","title":"Eventos de Contact","text":"<p>Los eventos se escuchan a traves de <code>wa.event</code>:</p>"},{"location":"references/contact/#contactcreated","title":"<code>contact:created</code>","text":"<p>Emitido cuando se crea un nuevo contacto.</p> <pre><code>wa.event.on(\"contact:created\", (contact) =&gt; {\n  console.log(`Nuevo contacto: ${contact.name}`);\n  console.log(`  Telefono: ${contact.phone}`);\n});\n</code></pre>"},{"location":"references/contact/#contactupdated","title":"<code>contact:updated</code>","text":"<p>Emitido cuando se actualiza un contacto existente.</p> <pre><code>wa.event.on(\"contact:updated\", (contact) =&gt; {\n  console.log(`Contacto actualizado: ${contact.name}`);\n});\n</code></pre>"},{"location":"references/contact/#ejemplos","title":"Ejemplos","text":""},{"location":"references/contact/#listar-todos-los-contactos","title":"Listar todos los contactos","text":"<pre><code>let offset = 0;\nconst limit = 50;\nconst all_contacts = [];\n\nwhile (true) {\n  const page = await wa.Contact.paginate(offset, limit);\n  if (page.length === 0) break;\n  all_contacts.push(...page);\n  offset += limit;\n}\n\nconsole.log(`Total de contactos: ${all_contacts.length}`);\n</code></pre>"},{"location":"references/contact/#buscar-contacto-por-nombre","title":"Buscar contacto por nombre","text":"<pre><code>async function find_contact_by_name(wa: WhatsApp, name: string) {\n  let offset = 0;\n  const limit = 50;\n\n  while (true) {\n    const contacts = await wa.Contact.paginate(offset, limit);\n    if (contacts.length === 0) break;\n\n    const found = contacts.find(c =&gt;\n      c.name.toLowerCase().includes(name.toLowerCase())\n    );\n\n    if (found) return found;\n    offset += limit;\n  }\n\n  return null;\n}\n\nconst contact = await find_contact_by_name(wa, \"Juan\");\nif (contact) {\n  await wa.Message.text(contact.id, \"Te encontre!\");\n}\n</code></pre>"},{"location":"references/contact/#mensaje-de-bienvenida-a-nuevos-contactos","title":"Mensaje de bienvenida a nuevos contactos","text":"<pre><code>wa.event.on(\"contact:created\", async (contact) =&gt; {\n  // Evitar enviarse mensaje a si mismo\n  if (contact.me) return;\n\n  await wa.Message.text(\n    contact.id,\n    \"Bienvenido! Soy un bot de asistencia. Escribe !ayuda para ver comandos.\"\n  );\n});\n</code></pre>"},{"location":"references/contact/#enviar-mensaje-desde-contacto","title":"Enviar mensaje desde contacto","text":"<pre><code>const contact = await wa.Contact.get(\"5491112345678@s.whatsapp.net\");\nif (contact) {\n  // Opcion 1: Usando el chat del contacto\n  const chat = await contact.chat();\n  // Enviar al chat...\n\n  // Opcion 2: Directamente con el ID del contacto\n  await wa.Message.text(contact.id, \"Hola desde tu contacto!\");\n}\n</code></pre>"},{"location":"references/contact/#interfaz-icontact","title":"Interfaz IContact","text":"<pre><code>interface IContact {\n  id: string;\n  me: boolean;\n  name: string;\n  phone: string | null;\n  photo: string | null;\n}\n</code></pre>"},{"location":"references/contact/#notas","title":"Notas","text":"<p>JID de contacto</p> <p>El JID (Jabber ID) de un contacto tiene el formato <code>{numero}@s.whatsapp.net</code>. Ejemplo: <code>5491112345678@s.whatsapp.net</code></p> <p>Nombre local</p> <p>El nombre del contacto se almacena localmente en el engine. Los cambios con <code>rename()</code> solo afectan tu instancia, no lo que otros ven.</p> <p>Verificacion de WhatsApp</p> <p><code>Contact.get()</code> verifica con WhatsApp si el numero existe. Si el numero no tiene WhatsApp, retorna <code>null</code>.</p>"},{"location":"references/engines/","title":"Engines de Persistencia","text":"<p>Los engines determinan donde se almacenan la sesion, contactos, chats y mensajes.</p>"},{"location":"references/engines/#importacion","title":"Importacion","text":"<pre><code>import { Engine, FileEngine } from \"@arcaelas/whatsapp\";\n</code></pre>"},{"location":"references/engines/#arquitectura","title":"Arquitectura","text":"<p>El sistema de persistencia usa un patron simple:</p> <pre><code>WhatsApp -&gt; Engine (FileEngine o custom)\n</code></pre> <p>Los engines implementan una interfaz generica de <code>get/set/list</code> para almacenamiento key-value de texto (JSON stringified).</p>"},{"location":"references/engines/#interface-engine","title":"Interface Engine","text":"<p>Define el contrato que deben implementar todos los engines.</p> <pre><code>interface Engine {\n  get(key: string): Promise&lt;string | null&gt;;\n  set(key: string, value: string | null): Promise&lt;void&gt;;\n  list(prefix: string, offset?: number, limit?: number): Promise&lt;string[]&gt;;\n}\n</code></pre>"},{"location":"references/engines/#metodos","title":"Metodos","text":""},{"location":"references/engines/#getkey","title":"<code>get(key)</code>","text":"<p>Obtiene un valor por su key.</p> <pre><code>const data = await engine.get(\"contact/5491112345678@s.whatsapp.net/index\");\nif (data) {\n  const contact = JSON.parse(data);\n  console.log(contact.name);\n}\n</code></pre>"},{"location":"references/engines/#setkey-value","title":"<code>set(key, value)</code>","text":"<p>Guarda o elimina un valor.</p> <pre><code>// Guardar\nawait engine.set(\"contact/123/index\", JSON.stringify({ name: \"John\" }));\n\n// Eliminar (pasar null)\nawait engine.set(\"contact/123/index\", null);\n</code></pre>"},{"location":"references/engines/#listprefix-offset-limit","title":"<code>list(prefix, offset?, limit?)</code>","text":"<p>Lista keys bajo un prefijo, ordenados por mas reciente.</p> <pre><code>// Listar contactos\nconst keys = await engine.list(\"contact/\", 0, 50);\nfor (const key of keys) {\n  const data = await engine.get(key);\n  console.log(key, data);\n}\n</code></pre>"},{"location":"references/engines/#estructura-de-keys","title":"Estructura de keys","text":"<p>Los keys siguen una convencion de paths:</p> Tipo Patron Ejemplo Session <code>session/{key}</code> <code>session/creds</code> Signal keys <code>session/{type}/{id}</code> <code>session/pre-key/1</code> Contact <code>contact/{jid}/index</code> <code>contact/5491112345678@s.whatsapp.net/index</code> Chat <code>chat/{jid}/index</code> <code>chat/5491112345678@s.whatsapp.net/index</code> Message <code>chat/{cid}/message/{mid}/index</code> <code>chat/123@s.whatsapp.net/message/ABC123/index</code> Content <code>chat/{cid}/message/{mid}/content</code> <code>chat/123@s.whatsapp.net/message/ABC123/content</code>"},{"location":"references/engines/#fileengine","title":"FileEngine","text":"<p>Engine de persistencia en sistema de archivos local. Es el engine por defecto.</p>"},{"location":"references/engines/#constructor","title":"Constructor","text":"<pre><code>new FileEngine(basePath?: string)\n</code></pre> Parametro Tipo Default Descripcion <code>basePath</code> <code>string</code> <code>.baileys/default</code> Directorio base"},{"location":"references/engines/#estructura-de-archivos","title":"Estructura de archivos","text":"<pre><code>{basePath}/\n  session/\n    creds              # Credenciales JSON\n    pre-key/\n      1                # Claves de cifrado\n    ...\n  contact/\n    5491112345678_at_s.whatsapp.net/\n      index            # Contacto JSON\n  chat/\n    5491112345678_at_s.whatsapp.net/\n      index            # Chat JSON\n      message/\n        ABC123/\n          index        # Mensaje JSON\n          content      # Contenido (base64 para media)\n</code></pre> <p>Sanitizacion de keys</p> <p>El caracter <code>@</code> se reemplaza por <code>_at_</code> en los nombres de archivos para compatibilidad con sistemas de archivos.</p>"},{"location":"references/engines/#ejemplo","title":"Ejemplo","text":"<pre><code>import { WhatsApp, FileEngine } from \"@arcaelas/whatsapp\";\n\n// Ruta por defecto (.baileys/default)\nconst wa1 = new WhatsApp();\n\n// Ruta personalizada\nconst wa2 = new WhatsApp({\n  engine: new FileEngine(\".baileys/mi-bot\"),\n});\n\n// Multiples instancias con diferentes sesiones\nconst wa_prod = new WhatsApp({\n  engine: new FileEngine(\".baileys/produccion\"),\n});\n\nconst wa_dev = new WhatsApp({\n  engine: new FileEngine(\".baileys/desarrollo\"),\n});\n</code></pre>"},{"location":"references/engines/#notas","title":"Notas","text":"<p>Backup</p> <p>Puedes hacer backup copiando el directorio completo.</p> <p>Permisos</p> <p>Asegurate de tener permisos de escritura en el directorio.</p>"},{"location":"references/engines/#crear-un-engine-personalizado","title":"Crear un Engine personalizado","text":"<p>Puedes crear tu propio engine para usar con Redis, MongoDB, PostgreSQL, etc.</p>"},{"location":"references/engines/#ejemplo-redis-engine","title":"Ejemplo: Redis Engine","text":"<pre><code>import type { Engine } from \"@arcaelas/whatsapp\";\nimport { createClient } from \"redis\";\n\nexport class RedisEngine implements Engine {\n  private client: ReturnType&lt;typeof createClient&gt;;\n\n  constructor(url: string) {\n    this.client = createClient({ url });\n  }\n\n  async connect() {\n    await this.client.connect();\n  }\n\n  async get(key: string): Promise&lt;string | null&gt; {\n    return await this.client.get(key);\n  }\n\n  async set(key: string, value: string | null): Promise&lt;void&gt; {\n    if (value === null) {\n      await this.client.del(key);\n    } else {\n      await this.client.set(key, value);\n    }\n  }\n\n  async list(prefix: string, offset = 0, limit = 50): Promise&lt;string[]&gt; {\n    const keys = await this.client.keys(`${prefix}*`);\n    return keys.slice(offset, offset + limit);\n  }\n}\n</code></pre>"},{"location":"references/engines/#uso","title":"Uso","text":"<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\nimport { RedisEngine } from \"./RedisEngine\";\n\nconst engine = new RedisEngine(\"redis://localhost:6379\");\nawait engine.connect();\n\nconst wa = new WhatsApp({ engine });\n</code></pre>"},{"location":"references/engines/#ejemplo-postgresql-engine","title":"Ejemplo: PostgreSQL Engine","text":"<pre><code>import type { Engine } from \"@arcaelas/whatsapp\";\nimport { Pool } from \"pg\";\n\nexport class PostgresEngine implements Engine {\n  private pool: Pool;\n\n  constructor(connection_string: string) {\n    this.pool = new Pool({ connectionString: connection_string });\n  }\n\n  async get(key: string): Promise&lt;string | null&gt; {\n    const result = await this.pool.query(\n      \"SELECT data FROM storage WHERE key = $1\",\n      [key]\n    );\n    return result.rows[0]?.data ?? null;\n  }\n\n  async set(key: string, value: string | null): Promise&lt;void&gt; {\n    if (value === null) {\n      await this.pool.query(\"DELETE FROM storage WHERE key = $1\", [key]);\n    } else {\n      await this.pool.query(\n        `INSERT INTO storage (key, data, updated_at)\n         VALUES ($1, $2, NOW())\n         ON CONFLICT (key) DO UPDATE SET data = $2, updated_at = NOW()`,\n        [key, value]\n      );\n    }\n  }\n\n  async list(prefix: string, offset = 0, limit = 50): Promise&lt;string[]&gt; {\n    const result = await this.pool.query(\n      `SELECT key FROM storage\n       WHERE key LIKE $1\n       ORDER BY updated_at DESC\n       OFFSET $2 LIMIT $3`,\n      [`${prefix}%`, offset, limit]\n    );\n    return result.rows.map(r =&gt; r.key);\n  }\n}\n</code></pre>"},{"location":"references/engines/#schema-sql","title":"Schema SQL","text":"<pre><code>CREATE TABLE storage (\n  key TEXT PRIMARY KEY,\n  data TEXT NOT NULL,\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n\nCREATE INDEX idx_storage_prefix ON storage (key text_pattern_ops);\nCREATE INDEX idx_storage_updated ON storage (updated_at DESC);\n</code></pre>"},{"location":"references/engines/#ejemplo-memory-engine-para-testing","title":"Ejemplo: Memory Engine (para testing)","text":"<pre><code>import type { Engine } from \"@arcaelas/whatsapp\";\n\nexport class MemoryEngine implements Engine {\n  private store = new Map&lt;string, { data: string; time: number }&gt;();\n\n  async get(key: string): Promise&lt;string | null&gt; {\n    return this.store.get(key)?.data ?? null;\n  }\n\n  async set(key: string, value: string | null): Promise&lt;void&gt; {\n    if (value === null) {\n      this.store.delete(key);\n    } else {\n      this.store.set(key, { data: value, time: Date.now() });\n    }\n  }\n\n  async list(prefix: string, offset = 0, limit = 50): Promise&lt;string[]&gt; {\n    const keys = [...this.store.entries()]\n      .filter(([k]) =&gt; k.startsWith(prefix))\n      .sort((a, b) =&gt; b[1].time - a[1].time)\n      .map(([k]) =&gt; k);\n    return keys.slice(offset, offset + limit);\n  }\n}\n</code></pre> <p>Solo para testing</p> <p>Los datos se pierden al reiniciar. Deberas escanear el QR nuevamente.</p>"},{"location":"references/engines/#comparacion-de-engines","title":"Comparacion de Engines","text":"Caracteristica FileEngine Redis PostgreSQL Memory Persistencia Si Si Si No Escalabilidad Baja Alta Alta N/A Latencia Baja Muy baja Media Muy baja Multi-instancia No Si Si No Ideal para Desarrollo Cache + Prod Produccion Testing"},{"location":"references/engines/#notas_1","title":"Notas","text":"<p>Serializacion</p> <p>Todos los valores se almacenan como texto. Usa <code>JSON.stringify()</code> para objetos y <code>BufferJSON</code> de Baileys para datos binarios.</p> <p>BufferJSON</p> <p>Baileys incluye <code>BufferJSON.replacer</code> y <code>BufferJSON.reviver</code> para serializar/deserializar Buffers como base64 en JSON.</p>"},{"location":"references/events/","title":"Eventos","text":"<p>Referencia completa de todos los eventos emitidos por WhatsApp.</p>"},{"location":"references/events/#escuchar-eventos","title":"Escuchar eventos","text":"<p>WhatsApp expone un EventEmitter tipado a traves de <code>wa.event</code>:</p> <pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\n\nconst wa = new WhatsApp();\n\n// Escuchar evento\nwa.event.on(\"message:created\", (msg) =&gt; {\n  // msg esta tipado correctamente\n});\n\n// Escuchar una sola vez\nwa.event.once(\"open\", () =&gt; {\n  console.log(\"Primera conexion exitosa\");\n});\n\n// Remover listener\nconst handler = (msg) =&gt; console.log(msg);\nwa.event.on(\"message:created\", handler);\nwa.event.off(\"message:created\", handler);\n</code></pre>"},{"location":"references/events/#eventos-de-conexion","title":"Eventos de conexion","text":""},{"location":"references/events/#open","title":"<code>open</code>","text":"<p>Emitido cuando la conexion es exitosa.</p> <pre><code>wa.event.on(\"open\", () =&gt; {\n  console.log(\"Conectado a WhatsApp\");\n  // Aqui puedes empezar a enviar mensajes\n});\n</code></pre> <p>Payload: ninguno</p>"},{"location":"references/events/#close","title":"<code>close</code>","text":"<p>Emitido cuando la conexion se cierra. La reconexion es automatica.</p> <pre><code>wa.event.on(\"close\", () =&gt; {\n  console.log(\"Desconectado, reconectando...\");\n});\n</code></pre> <p>Payload: ninguno</p>"},{"location":"references/events/#error","title":"<code>error</code>","text":"<p>Emitido cuando ocurre un error fatal que no permite reconexion.</p> <pre><code>wa.event.on(\"error\", (error) =&gt; {\n  console.error(\"Error fatal:\", error.message);\n\n  // Error comun:\n  // - \"Logged out\" - Sesion cerrada desde telefono\n});\n</code></pre> <p>Payload: <code>Error</code></p>"},{"location":"references/events/#eventos-de-contacto","title":"Eventos de contacto","text":""},{"location":"references/events/#contactcreated","title":"<code>contact:created</code>","text":"<p>Emitido cuando se crea un nuevo contacto.</p> <pre><code>wa.event.on(\"contact:created\", (contact) =&gt; {\n  console.log(`Nuevo contacto: ${contact.name}`);\n  console.log(`  ID: ${contact.id}`);\n  console.log(`  Telefono: ${contact.phone}`);\n  console.log(`  Es yo: ${contact.me}`);\n});\n</code></pre> <p>Payload: <code>Contact</code></p>"},{"location":"references/events/#contactupdated","title":"<code>contact:updated</code>","text":"<p>Emitido cuando se actualiza un contacto existente.</p> <pre><code>wa.event.on(\"contact:updated\", (contact) =&gt; {\n  console.log(`Contacto actualizado: ${contact.name}`);\n});\n</code></pre> <p>Payload: <code>Contact</code></p>"},{"location":"references/events/#eventos-de-chat","title":"Eventos de chat","text":""},{"location":"references/events/#chatcreated","title":"<code>chat:created</code>","text":"<p>Emitido cuando se crea un nuevo chat.</p> <pre><code>wa.event.on(\"chat:created\", (chat) =&gt; {\n  if (chat.type === \"group\") {\n    console.log(`Nuevo grupo: ${chat.name}`);\n  } else {\n    console.log(`Nuevo chat: ${chat.name}`);\n  }\n});\n</code></pre> <p>Payload: <code>Chat</code></p>"},{"location":"references/events/#chatupdated","title":"<code>chat:updated</code>","text":"<p>Emitido cuando se actualiza un chat existente.</p> <pre><code>wa.event.on(\"chat:updated\", (chat) =&gt; {\n  console.log(`Chat actualizado: ${chat.name}`);\n});\n</code></pre> <p>Payload: <code>Chat</code></p>"},{"location":"references/events/#chatpined","title":"<code>chat:pined</code>","text":"<p>Emitido cuando se fija o desfija un chat.</p> <pre><code>wa.event.on(\"chat:pined\", (cid, pined) =&gt; {\n  if (pined) {\n    console.log(`Chat ${cid} fijado en ${new Date(pined)}`);\n  } else {\n    console.log(`Chat ${cid} desfijado`);\n  }\n});\n</code></pre> <p>Payload: <code>(cid: string, pined: number | null)</code></p>"},{"location":"references/events/#chatarchived","title":"<code>chat:archived</code>","text":"<p>Emitido cuando se archiva o desarchiva un chat.</p> <pre><code>wa.event.on(\"chat:archived\", (cid, archived) =&gt; {\n  console.log(`Chat ${cid}: ${archived ? \"archivado\" : \"desarchivado\"}`);\n});\n</code></pre> <p>Payload: <code>(cid: string, archived: boolean)</code></p>"},{"location":"references/events/#chatmuted","title":"<code>chat:muted</code>","text":"<p>Emitido cuando se silencia o desilencia un chat.</p> <pre><code>wa.event.on(\"chat:muted\", (cid, muted) =&gt; {\n  if (muted) {\n    console.log(`Chat ${cid} silenciado hasta ${new Date(muted)}`);\n  } else {\n    console.log(`Chat ${cid} desilenciado`);\n  }\n});\n</code></pre> <p>Payload: <code>(cid: string, muted: number | null)</code></p>"},{"location":"references/events/#chatdeleted","title":"<code>chat:deleted</code>","text":"<p>Emitido cuando se elimina un chat.</p> <pre><code>wa.event.on(\"chat:deleted\", (cid) =&gt; {\n  console.log(`Chat eliminado: ${cid}`);\n});\n</code></pre> <p>Payload: <code>(cid: string)</code></p>"},{"location":"references/events/#eventos-de-mensaje","title":"Eventos de mensaje","text":""},{"location":"references/events/#messagecreated","title":"<code>message:created</code>","text":"<p>Emitido cuando se recibe un nuevo mensaje.</p> <pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  console.log(`Nuevo mensaje:`);\n  console.log(`  ID: ${msg.id}`);\n  console.log(`  Chat: ${msg.cid}`);\n  console.log(`  Tipo: ${msg.type}`);\n  console.log(`  Mio: ${msg.me}`);\n  console.log(`  Caption: ${msg.caption}`);\n\n  // Obtener contenido\n  if (msg.type === \"text\") {\n    const text = (await msg.content()).toString();\n    console.log(`  Texto: ${text}`);\n  }\n});\n</code></pre> <p>Payload: <code>Message</code></p> <p>Propiedades disponibles:</p> <ul> <li><code>id</code> - ID del mensaje</li> <li><code>cid</code> - JID del chat</li> <li><code>me</code> - true si es mensaje propio</li> <li><code>type</code> - Tipo de mensaje (text, image, video, audio, location, poll)</li> <li><code>mime</code> - MIME type</li> <li><code>caption</code> - Caption/texto</li> <li><code>status</code> - Estado del mensaje (enum)</li> <li><code>starred</code> - true si esta destacado</li> <li><code>forwarded</code> - true si fue reenviado</li> <li><code>edited</code> - true si fue editado</li> </ul>"},{"location":"references/events/#messageupdated","title":"<code>message:updated</code>","text":"<p>Emitido cuando se edita un mensaje.</p> <pre><code>wa.event.on(\"message:updated\", async (msg) =&gt; {\n  console.log(`Mensaje editado: ${msg.id}`);\n  console.log(`  edited: ${msg.edited}`); // true\n\n  if (msg.type === \"text\") {\n    const new_text = (await msg.content()).toString();\n    console.log(`  Nuevo texto: ${new_text}`);\n  }\n});\n</code></pre> <p>Payload: <code>Message</code></p>"},{"location":"references/events/#messagereacted","title":"<code>message:reacted</code>","text":"<p>Emitido cuando alguien reacciona a un mensaje.</p> <pre><code>wa.event.on(\"message:reacted\", (cid, mid, emoji) =&gt; {\n  console.log(`Reaccion en mensaje:`);\n  console.log(`  Chat: ${cid}`);\n  console.log(`  Mensaje: ${mid}`);\n  console.log(`  Emoji: ${emoji}`); // \"\" si se quito la reaccion\n});\n</code></pre> <p>Payload: <code>(cid: string, mid: string, emoji: string)</code></p>"},{"location":"references/events/#messagedeleted","title":"<code>message:deleted</code>","text":"<p>Emitido cuando se elimina un mensaje.</p> <pre><code>wa.event.on(\"message:deleted\", (cid, mid) =&gt; {\n  console.log(`Mensaje eliminado:`);\n  console.log(`  Chat: ${cid}`);\n  console.log(`  Mensaje: ${mid}`);\n});\n</code></pre> <p>Payload: <code>(cid: string, mid: string)</code></p>"},{"location":"references/events/#patrones-de-uso","title":"Patrones de uso","text":""},{"location":"references/events/#logger-completo","title":"Logger completo","text":"<pre><code>function setup_logger(wa: WhatsApp) {\n  // Conexion\n  wa.event.on(\"open\", () =&gt; console.log(\"[INFO] Conectado\"));\n  wa.event.on(\"close\", () =&gt; console.log(\"[WARN] Desconectado\"));\n  wa.event.on(\"error\", (e) =&gt; console.error(\"[ERROR]\", e.message));\n\n  // Contactos\n  wa.event.on(\"contact:created\", (c) =&gt;\n    console.log(`[CONTACT:NEW] ${c.name} (${c.phone})`)\n  );\n  wa.event.on(\"contact:updated\", (c) =&gt;\n    console.log(`[CONTACT:UPD] ${c.name}`)\n  );\n\n  // Chats\n  wa.event.on(\"chat:created\", (c) =&gt;\n    console.log(`[CHAT:NEW] ${c.name} (${c.type})`)\n  );\n  wa.event.on(\"chat:updated\", (c) =&gt;\n    console.log(`[CHAT:UPD] ${c.name}`)\n  );\n  wa.event.on(\"chat:pined\", (cid, p) =&gt;\n    console.log(`[CHAT:PIN] ${cid}: ${p ? \"fijado\" : \"desfijado\"}`)\n  );\n  wa.event.on(\"chat:archived\", (cid, a) =&gt;\n    console.log(`[CHAT:ARC] ${cid}: ${a ? \"archivado\" : \"desarchivado\"}`)\n  );\n  wa.event.on(\"chat:muted\", (cid, m) =&gt;\n    console.log(`[CHAT:MUTE] ${cid}: ${m ? \"silenciado\" : \"desilenciado\"}`)\n  );\n  wa.event.on(\"chat:deleted\", (cid) =&gt;\n    console.log(`[CHAT:DEL] ${cid}`)\n  );\n\n  // Mensajes\n  wa.event.on(\"message:created\", (m) =&gt;\n    console.log(`[MSG:NEW] ${m.cid} &lt;- ${m.type}`)\n  );\n  wa.event.on(\"message:updated\", (m) =&gt;\n    console.log(`[MSG:EDIT] ${m.id}`)\n  );\n  wa.event.on(\"message:reacted\", (cid, mid, emoji) =&gt;\n    console.log(`[MSG:REACT] ${mid}: ${emoji}`)\n  );\n  wa.event.on(\"message:deleted\", (cid, mid) =&gt;\n    console.log(`[MSG:DEL] ${mid} from ${cid}`)\n  );\n}\n</code></pre>"},{"location":"references/events/#filtrar-por-chat","title":"Filtrar por chat","text":"<pre><code>const MONITORED_CHAT = \"5491112345678@s.whatsapp.net\";\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.cid !== MONITORED_CHAT) return;\n  // Solo procesar mensajes de este chat\n});\n</code></pre>"},{"location":"references/events/#filtrar-por-tipo","title":"Filtrar por tipo","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  // Solo imagenes\n  if (msg.type !== \"image\") return;\n\n  const buffer = await msg.content();\n  console.log(`Imagen recibida: ${buffer.length} bytes`);\n});\n</code></pre>"},{"location":"references/events/#cola-de-procesamiento","title":"Cola de procesamiento","text":"<pre><code>const queue: Message[] = [];\nlet processing = false;\n\nwa.event.on(\"message:created\", (msg) =&gt; {\n  queue.push(msg);\n  process_queue();\n});\n\nasync function process_queue() {\n  if (processing || queue.length === 0) return;\n\n  processing = true;\n  const msg = queue.shift()!;\n\n  try {\n    await handle_message(msg);\n  } catch (error) {\n    console.error(\"Error procesando mensaje:\", error);\n  }\n\n  processing = false;\n  process_queue();\n}\n\nasync function handle_message(msg: Message) {\n  // Procesar mensaje\n}\n</code></pre>"},{"location":"references/events/#estadisticas-en-tiempo-real","title":"Estadisticas en tiempo real","text":"<pre><code>const stats = {\n  messages: 0,\n  text: 0,\n  image: 0,\n  video: 0,\n  audio: 0,\n  location: 0,\n  poll: 0,\n};\n\nwa.event.on(\"message:created\", (msg) =&gt; {\n  stats.messages++;\n  stats[msg.type as keyof typeof stats]++;\n\n  console.log(\"Estadisticas:\", stats);\n});\n</code></pre>"},{"location":"references/events/#interfaz-whatsappeventmap","title":"Interfaz WhatsAppEventMap","text":"<pre><code>interface WhatsAppEventMap {\n  // Conexion\n  open: [];\n  close: [];\n  error: [Error];\n\n  // Contactos\n  \"contact:created\": [Contact];\n  \"contact:updated\": [Contact];\n\n  // Chats\n  \"chat:created\": [Chat];\n  \"chat:updated\": [Chat];\n  \"chat:pined\": [cid: string, pined: number | null];\n  \"chat:archived\": [cid: string, archived: boolean];\n  \"chat:muted\": [cid: string, muted: number | null];\n  \"chat:deleted\": [cid: string];\n\n  // Mensajes\n  \"message:created\": [Message];\n  \"message:updated\": [Message];\n  \"message:reacted\": [cid: string, mid: string, emoji: string];\n  \"message:deleted\": [cid: string, mid: string];\n}\n</code></pre>"},{"location":"references/message/","title":"Message","text":"<p>Clase para gestionar mensajes de WhatsApp.</p>"},{"location":"references/message/#importacion","title":"Importacion","text":"<p>La clase se accede desde la instancia de WhatsApp:</p> <pre><code>const wa = new WhatsApp();\nwa.Message // Clase Message enlazada\n</code></pre>"},{"location":"references/message/#propiedades","title":"Propiedades","text":"<p>Propiedades disponibles en instancias de Message:</p> Propiedad Tipo Descripcion <code>id</code> <code>string</code> ID unico del mensaje <code>cid</code> <code>string</code> JID del chat <code>me</code> <code>boolean</code> <code>true</code> si el mensaje es propio <code>type</code> <code>MessageType</code> Tipo: <code>text</code>, <code>image</code>, <code>video</code>, <code>audio</code>, <code>location</code>, <code>poll</code> <code>mime</code> <code>string</code> Tipo MIME del contenido <code>caption</code> <code>string</code> Texto o caption del mensaje <code>status</code> <code>MESSAGE_STATUS</code> Estado del mensaje (enum numerico) <code>starred</code> <code>boolean</code> <code>true</code> si el mensaje esta destacado <code>forwarded</code> <code>boolean</code> <code>true</code> si el mensaje fue reenviado <code>edited</code> <code>boolean</code> <code>true</code> si fue editado"},{"location":"references/message/#enum-message_status","title":"Enum MESSAGE_STATUS","text":"<pre><code>enum MESSAGE_STATUS {\n  PENDING = 0,    // Pendiente de envio\n  SERVER_ACK = 1, // Servidor recibio el mensaje\n  DELIVERED = 2,  // Entregado al destinatario\n  READ = 3,       // Leido por el destinatario\n  PLAYED = 4,     // Reproducido (audio/video)\n}\n</code></pre>"},{"location":"references/message/#tipo-messagetype","title":"Tipo MessageType","text":"<pre><code>type MessageType = \"text\" | \"image\" | \"video\" | \"audio\" | \"location\" | \"poll\";\n</code></pre>"},{"location":"references/message/#metodos-estaticos","title":"Metodos estaticos","text":""},{"location":"references/message/#messagegetcid-mid","title":"<code>Message.get(cid, mid)</code>","text":"<p>Obtiene un mensaje por chat ID y message ID.</p> <pre><code>const msg = await wa.Message.get(\n  \"5491112345678@s.whatsapp.net\",\n  \"MESSAGE_ID\"\n);\n\nif (msg) {\n  console.log(`Tipo: ${msg.type}`);\n  console.log(`Caption: ${msg.caption}`);\n}\n</code></pre>"},{"location":"references/message/#messagetextcid-text","title":"<code>Message.text(cid, text)</code>","text":"<p>Envia un mensaje de texto.</p> <pre><code>const msg = await wa.Message.text(\n  \"5491112345678@s.whatsapp.net\",\n  \"Hola mundo!\"\n);\n\nif (msg) {\n  console.log(`Mensaje enviado: ${msg.id}`);\n}\n</code></pre>"},{"location":"references/message/#messageimagecid-buffer-caption","title":"<code>Message.image(cid, buffer, caption?)</code>","text":"<p>Envia una imagen.</p> <pre><code>import * as fs from \"fs\";\n\nconst buffer = fs.readFileSync(\"./foto.jpg\");\nconst msg = await wa.Message.image(\n  \"5491112345678@s.whatsapp.net\",\n  buffer,\n  \"Mira esta foto!\"\n);\n</code></pre>"},{"location":"references/message/#messagevideocid-buffer-caption","title":"<code>Message.video(cid, buffer, caption?)</code>","text":"<p>Envia un video.</p> <pre><code>const buffer = fs.readFileSync(\"./video.mp4\");\nconst msg = await wa.Message.video(\n  \"5491112345678@s.whatsapp.net\",\n  buffer,\n  \"Video divertido\"\n);\n</code></pre>"},{"location":"references/message/#messageaudiocid-buffer-ptt","title":"<code>Message.audio(cid, buffer, ptt?)</code>","text":"<p>Envia un audio. Por defecto como nota de voz (PTT).</p> Parametro Tipo Default Descripcion <code>cid</code> <code>string</code> - ID del chat destino <code>buffer</code> <code>Buffer</code> - Buffer del audio <code>ptt</code> <code>boolean</code> <code>true</code> <code>true</code> para nota de voz, <code>false</code> para audio normal <pre><code>const buffer = fs.readFileSync(\"./audio.ogg\");\n\n// Como nota de voz (default)\nawait wa.Message.audio(\"5491112345678@s.whatsapp.net\", buffer);\n\n// Como audio normal\nawait wa.Message.audio(\"5491112345678@s.whatsapp.net\", buffer, false);\n</code></pre>"},{"location":"references/message/#messagelocationcid-opts","title":"<code>Message.location(cid, opts)</code>","text":"<p>Envia una ubicacion.</p> <pre><code>await wa.Message.location(\"5491112345678@s.whatsapp.net\", {\n  lat: -34.6037,\n  lng: -58.3816,\n});\n</code></pre> <p>Interfaz LocationOptions:</p> <pre><code>interface LocationOptions {\n  lat: number;   // Latitud en grados\n  lng: number;   // Longitud en grados\n  live?: boolean; // true para ubicacion en tiempo real\n}\n</code></pre>"},{"location":"references/message/#messagepollcid-opts","title":"<code>Message.poll(cid, opts)</code>","text":"<p>Envia una encuesta.</p> <pre><code>await wa.Message.poll(\"5491112345678@s.whatsapp.net\", {\n  content: \"Cual es tu lenguaje favorito?\",\n  options: [\n    { content: \"JavaScript\" },\n    { content: \"TypeScript\" },\n    { content: \"Python\" },\n    { content: \"Go\" },\n  ],\n});\n</code></pre> <p>Interfaz PollOptions:</p> <pre><code>interface PollOptions {\n  content: string;  // Pregunta o titulo de la encuesta\n  options: Array&lt;{ content: string }&gt;; // Opciones de respuesta\n}\n</code></pre>"},{"location":"references/message/#messagereactcid-mid-emoji","title":"<code>Message.react(cid, mid, emoji)</code>","text":"<p>Reacciona a un mensaje.</p> <pre><code>// Agregar reaccion\nawait wa.Message.react(\"CHAT_ID\", \"MESSAGE_ID\", \"\u2764\ufe0f\");\n\n// Quitar reaccion (emoji vacio)\nawait wa.Message.react(\"CHAT_ID\", \"MESSAGE_ID\", \"\");\n</code></pre>"},{"location":"references/message/#messageremovecid-mid","title":"<code>Message.remove(cid, mid)</code>","text":"<p>Elimina un mensaje para todos.</p> <pre><code>await wa.Message.remove(\"CHAT_ID\", \"MESSAGE_ID\");\n</code></pre>"},{"location":"references/message/#messageforwardcid-mid-to_cid","title":"<code>Message.forward(cid, mid, to_cid)</code>","text":"<p>Reenvia un mensaje a otro chat.</p> <pre><code>await wa.Message.forward(\n  \"CHAT_ORIGEN\",\n  \"MESSAGE_ID\",\n  \"CHAT_DESTINO\"\n);\n</code></pre>"},{"location":"references/message/#messageeditcid-mid-text","title":"<code>Message.edit(cid, mid, text)</code>","text":"<p>Edita un mensaje de texto (solo mensajes propios).</p> <pre><code>await wa.Message.edit(\"CHAT_ID\", \"MESSAGE_ID\", \"Texto corregido\");\n</code></pre>"},{"location":"references/message/#messagewatchcid-mid-handler","title":"<code>Message.watch(cid, mid, handler)</code>","text":"<p>Observa cambios en un mensaje especifico (ediciones, actualizaciones).</p> <pre><code>const unsubscribe = wa.Message.watch(\n  \"CHAT_ID\",\n  \"MESSAGE_ID\",\n  (msg) =&gt; {\n    console.log(`Mensaje actualizado: ${msg.caption}`);\n  }\n);\n\n// Dejar de observar\nunsubscribe();\n</code></pre>"},{"location":"references/message/#metodos-de-instancia","title":"Metodos de instancia","text":""},{"location":"references/message/#content","title":"<code>content()</code>","text":"<p>Obtiene el contenido del mensaje como Buffer.</p> <p>El contenido varia segun el tipo:</p> Tipo Contenido <code>text</code> Texto como Buffer UTF-8 <code>image</code> Buffer de la imagen <code>video</code> Buffer del video <code>audio</code> Buffer del audio <code>location</code> JSON <code>{ lat, lng }</code> como Buffer <code>poll</code> JSON <code>{ content, options }</code> como Buffer <pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  const buffer = await msg.content();\n\n  if (msg.type === \"text\") {\n    const text = buffer.toString();\n    console.log(`Texto: ${text}`);\n  } else if (msg.type === \"image\") {\n    require(\"fs\").writeFileSync(\"imagen.jpg\", buffer);\n  } else if (msg.type === \"location\") {\n    const { lat, lng } = JSON.parse(buffer.toString());\n    console.log(`Ubicacion: ${lat}, ${lng}`);\n  }\n});\n</code></pre>"},{"location":"references/message/#verificar-tipo-de-mensaje","title":"Verificar tipo de mensaje","text":""},{"location":"references/message/#usando-propiedad-type","title":"Usando propiedad type","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  switch (msg.type) {\n    case \"text\":\n      const text = (await msg.content()).toString();\n      console.log(`Texto: ${text}`);\n      break;\n    case \"image\":\n      const imgBuffer = await msg.content();\n      console.log(`Imagen: ${imgBuffer.length} bytes`);\n      break;\n    case \"video\":\n      const vidBuffer = await msg.content();\n      console.log(`Video: ${vidBuffer.length} bytes`);\n      break;\n    case \"audio\":\n      const audBuffer = await msg.content();\n      console.log(`Audio: ${audBuffer.length} bytes`);\n      break;\n    case \"location\":\n      const { lat, lng } = JSON.parse((await msg.content()).toString());\n      console.log(`Ubicacion: ${lat}, ${lng}`);\n      break;\n    case \"poll\":\n      const poll = JSON.parse((await msg.content()).toString());\n      console.log(`Encuesta: ${poll.content}`);\n      break;\n  }\n});\n</code></pre>"},{"location":"references/message/#ejemplos","title":"Ejemplos","text":""},{"location":"references/message/#guardar-todos-los-medios","title":"Guardar todos los medios","text":"<pre><code>import * as fs from \"fs\";\nimport * as path from \"path\";\n\nconst MEDIA_DIR = \"./medios\";\nfs.mkdirSync(MEDIA_DIR, { recursive: true });\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n\n  const timestamp = Date.now();\n  const buffer = await msg.content();\n\n  if (msg.type === \"image\") {\n    const ext = msg.mime.split(\"/\")[1] || \"jpg\";\n    fs.writeFileSync(path.join(MEDIA_DIR, `${timestamp}.${ext}`), buffer);\n  } else if (msg.type === \"video\") {\n    fs.writeFileSync(path.join(MEDIA_DIR, `${timestamp}.mp4`), buffer);\n  } else if (msg.type === \"audio\") {\n    fs.writeFileSync(path.join(MEDIA_DIR, `${timestamp}.ogg`), buffer);\n  }\n});\n</code></pre>"},{"location":"references/message/#bot-de-ubicacion","title":"Bot de ubicacion","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"location\") return;\n\n  const { lat, lng } = JSON.parse((await msg.content()).toString());\n\n  await wa.Message.text(\n    msg.cid,\n    `Recibi tu ubicacion:\\n` +\n    `Lat: ${lat}\\n` +\n    `Lng: ${lng}\\n` +\n    `Google Maps: https://maps.google.com/?q=${lat},${lng}`\n  );\n});\n</code></pre>"},{"location":"references/message/#bot-de-encuestas","title":"Bot de encuestas","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString();\n\n  // Crear encuesta con comando\n  if (text.startsWith(\"!encuesta \")) {\n    const parts = text.slice(10).split(\"|\").map(s =&gt; s.trim());\n    const [question, ...options] = parts;\n\n    if (options.length &gt;= 2) {\n      await wa.Message.poll(msg.cid, {\n        content: question,\n        options: options.map(opt =&gt; ({ content: opt })),\n      });\n    } else {\n      await wa.Message.text(\n        msg.cid,\n        \"Uso: !encuesta Pregunta | Opcion1 | Opcion2 | ...\"\n      );\n    }\n  }\n});\n</code></pre>"},{"location":"references/message/#eco-con-reaccion","title":"Eco con reaccion","text":"<pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString();\n\n  if (text.startsWith(\"!eco \")) {\n    // Reaccionar al mensaje original\n    await wa.Message.react(msg.cid, msg.id, \"\ud83d\udc4d\");\n\n    // Enviar eco\n    await wa.Message.text(msg.cid, text.slice(5));\n  }\n});\n</code></pre>"},{"location":"references/message/#interfaz-imessage","title":"Interfaz IMessage","text":"<pre><code>interface IMessage {\n  raw: WAMessage;  // WAMessage original de Baileys\n  edited: boolean; // true si el mensaje fue editado\n}\n</code></pre>"},{"location":"references/message/#notas","title":"Notas","text":"<p>Contenido de mensajes</p> <p>El metodo <code>content()</code> siempre retorna Buffer. Usa <code>.toString()</code> para texto o <code>JSON.parse()</code> para location/poll.</p> <p>Media</p> <p>Para mensajes de media (image, video, audio), el contenido se descarga desde WhatsApp la primera vez y se almacena en cache en el engine.</p> <p>Caption vs Content</p> <ul> <li><code>caption</code> es el texto/descripcion del mensaje (disponible inmediatamente)</li> <li><code>content()</code> es el contenido completo (puede requerir descarga)</li> </ul>"},{"location":"references/whatsapp/","title":"WhatsApp","text":"<p>Clase principal que gestiona la conexion, eventos y entidades de WhatsApp.</p>"},{"location":"references/whatsapp/#importacion","title":"Importacion","text":"<pre><code>import { WhatsApp } from \"@arcaelas/whatsapp\";\n</code></pre>"},{"location":"references/whatsapp/#constructor","title":"Constructor","text":""},{"location":"references/whatsapp/#new-whatsappoptions","title":"<code>new WhatsApp(options?)</code>","text":"<p>Crea una nueva instancia de WhatsApp.</p> <p>Parametros:</p> Parametro Tipo Default Descripcion <code>options.engine</code> <code>Engine</code> <code>FileEngine</code> Engine de persistencia <code>options.phone</code> <code>string \\| number</code> <code>undefined</code> Numero para codigo de emparejamiento <p>Ejemplos:</p> <pre><code>// Configuracion minima (usa FileEngine en .baileys/default)\nconst wa = new WhatsApp();\n\n// Con numero de telefono (emparejamiento por codigo)\nconst wa = new WhatsApp({\n  phone: \"5491112345678\",\n});\n\n// Con engine personalizado\nconst wa = new WhatsApp({\n  engine: new FileEngine(\".baileys/mi-bot\"),\n  phone: \"5491112345678\",\n});\n</code></pre>"},{"location":"references/whatsapp/#propiedades","title":"Propiedades","text":""},{"location":"references/whatsapp/#engine","title":"<code>engine</code>","text":"<pre><code>readonly engine: Engine\n</code></pre> <p>Engine de persistencia activo.</p>"},{"location":"references/whatsapp/#socket","title":"<code>socket</code>","text":"<pre><code>get socket(): WASocket | null\n</code></pre> <p>Socket de Baileys. <code>null</code> si no esta conectado.</p>"},{"location":"references/whatsapp/#event","title":"<code>event</code>","text":"<pre><code>readonly event: EventEmitter&lt;WhatsAppEventMap&gt;\n</code></pre> <p>EventEmitter tipado para escuchar eventos.</p>"},{"location":"references/whatsapp/#chat","title":"<code>Chat</code>","text":"<pre><code>readonly Chat: typeof _Chat\n</code></pre> <p>Clase Chat enlazada a esta instancia.</p>"},{"location":"references/whatsapp/#contact","title":"<code>Contact</code>","text":"<pre><code>readonly Contact: typeof _Contact\n</code></pre> <p>Clase Contact enlazada a esta instancia.</p>"},{"location":"references/whatsapp/#message","title":"<code>Message</code>","text":"<pre><code>readonly Message: typeof _Message\n</code></pre> <p>Clase Message enlazada a esta instancia.</p>"},{"location":"references/whatsapp/#metodos","title":"Metodos","text":""},{"location":"references/whatsapp/#paircallback","title":"<code>pair(callback)</code>","text":"<pre><code>pair(callback: (code: string | Buffer) =&gt; void | Promise&lt;void&gt;): Promise&lt;void&gt;\n</code></pre> <p>Conecta a WhatsApp. Muestra QR o codigo de emparejamiento segun configuracion.</p> <p>Parametros:</p> <ul> <li><code>callback</code> - Funcion llamada con el QR (Buffer PNG) o codigo (string de 8 digitos)</li> </ul> <p>Comportamiento:</p> <ol> <li>Si <code>options.phone</code> esta definido, envia codigo de emparejamiento (solo una vez)</li> <li>Si no, genera QR code como imagen PNG (periodicamente hasta escanear)</li> <li>Reintenta conexion automaticamente en caso de desconexion</li> <li>Emite <code>open</code> cuando la conexion es exitosa</li> </ol> <p>Errores fatales (no reintenta):</p> <ul> <li><code>loggedOut</code> (401) - Sesion cerrada desde telefono</li> </ul> <p>Ejemplo:</p> <pre><code>await wa.pair(async (data) =&gt; {\n  if (Buffer.isBuffer(data)) {\n    // QR code - guardar o mostrar\n    require(\"fs\").writeFileSync(\"qr.png\", data);\n    console.log(\"Escanea el QR guardado en qr.png\");\n  } else {\n    // Codigo de 8 digitos\n    console.log(\"Ingresa este codigo en WhatsApp:\", data);\n  }\n});\n</code></pre>"},{"location":"references/whatsapp/#eventos","title":"Eventos","text":"<p>Los eventos se escuchan a traves de <code>wa.event</code>:</p> <pre><code>wa.event.on(\"open\", () =&gt; {\n  console.log(\"Conectado\");\n});\n</code></pre>"},{"location":"references/whatsapp/#open","title":"<code>open</code>","text":"<p>Emitido cuando la conexion es exitosa.</p> <pre><code>wa.event.on(\"open\", () =&gt; {\n  console.log(\"Conectado a WhatsApp\");\n});\n</code></pre>"},{"location":"references/whatsapp/#close","title":"<code>close</code>","text":"<p>Emitido cuando la conexion se cierra (se reconectara automaticamente).</p> <pre><code>wa.event.on(\"close\", () =&gt; {\n  console.log(\"Desconectado de WhatsApp\");\n});\n</code></pre>"},{"location":"references/whatsapp/#error","title":"<code>error</code>","text":"<p>Emitido cuando ocurre un error fatal (no se reconectara).</p> <pre><code>wa.event.on(\"error\", (error: Error) =&gt; {\n  console.error(\"Error fatal:\", error.message);\n});\n</code></pre>"},{"location":"references/whatsapp/#contactcreated","title":"<code>contact:created</code>","text":"<p>Emitido cuando se crea un nuevo contacto.</p> <pre><code>wa.event.on(\"contact:created\", (contact) =&gt; {\n  console.log(`Nuevo contacto: ${contact.name} (${contact.phone})`);\n});\n</code></pre>"},{"location":"references/whatsapp/#contactupdated","title":"<code>contact:updated</code>","text":"<p>Emitido cuando se actualiza un contacto existente.</p> <pre><code>wa.event.on(\"contact:updated\", (contact) =&gt; {\n  console.log(`Contacto actualizado: ${contact.name}`);\n});\n</code></pre>"},{"location":"references/whatsapp/#chatcreated","title":"<code>chat:created</code>","text":"<p>Emitido cuando se crea un nuevo chat.</p> <pre><code>wa.event.on(\"chat:created\", (chat) =&gt; {\n  console.log(`Nuevo chat: ${chat.name} (${chat.type})`);\n});\n</code></pre>"},{"location":"references/whatsapp/#chatupdated","title":"<code>chat:updated</code>","text":"<p>Emitido cuando se actualiza un chat existente.</p> <pre><code>wa.event.on(\"chat:updated\", (chat) =&gt; {\n  console.log(`Chat actualizado: ${chat.name}`);\n});\n</code></pre>"},{"location":"references/whatsapp/#chatpined","title":"<code>chat:pined</code>","text":"<p>Emitido cuando se fija o desfija un chat.</p> <pre><code>wa.event.on(\"chat:pined\", (cid, pined) =&gt; {\n  if (pined) {\n    console.log(`Chat ${cid} fijado`);\n  } else {\n    console.log(`Chat ${cid} desfijado`);\n  }\n});\n</code></pre>"},{"location":"references/whatsapp/#chatarchived","title":"<code>chat:archived</code>","text":"<p>Emitido cuando se archiva o desarchiva un chat.</p> <pre><code>wa.event.on(\"chat:archived\", (cid, archived) =&gt; {\n  console.log(`Chat ${cid}: ${archived ? \"archivado\" : \"desarchivado\"}`);\n});\n</code></pre>"},{"location":"references/whatsapp/#chatmuted","title":"<code>chat:muted</code>","text":"<p>Emitido cuando se silencia o desilencia un chat.</p> <pre><code>wa.event.on(\"chat:muted\", (cid, muted) =&gt; {\n  if (muted) {\n    console.log(`Chat ${cid} silenciado hasta ${new Date(muted)}`);\n  } else {\n    console.log(`Chat ${cid} desilenciado`);\n  }\n});\n</code></pre>"},{"location":"references/whatsapp/#chatdeleted","title":"<code>chat:deleted</code>","text":"<p>Emitido cuando se elimina un chat.</p> <pre><code>wa.event.on(\"chat:deleted\", (cid) =&gt; {\n  console.log(`Chat eliminado: ${cid}`);\n});\n</code></pre>"},{"location":"references/whatsapp/#messagecreated","title":"<code>message:created</code>","text":"<p>Emitido cuando se recibe un nuevo mensaje.</p> <pre><code>wa.event.on(\"message:created\", async (msg) =&gt; {\n  console.log(`Nuevo mensaje de tipo ${msg.type}`);\n  console.log(`  Chat: ${msg.cid}`);\n  console.log(`  Mio: ${msg.me}`);\n\n  if (msg.type === \"text\") {\n    const text = (await msg.content()).toString();\n    console.log(`  Texto: ${text}`);\n  }\n});\n</code></pre>"},{"location":"references/whatsapp/#messageupdated","title":"<code>message:updated</code>","text":"<p>Emitido cuando se edita un mensaje.</p> <pre><code>wa.event.on(\"message:updated\", async (msg) =&gt; {\n  console.log(`Mensaje editado: ${msg.id}`);\n  if (msg.type === \"text\") {\n    const text = (await msg.content()).toString();\n    console.log(`  Nuevo texto: ${text}`);\n  }\n});\n</code></pre>"},{"location":"references/whatsapp/#messagereacted","title":"<code>message:reacted</code>","text":"<p>Emitido cuando alguien reacciona a un mensaje.</p> <pre><code>wa.event.on(\"message:reacted\", (cid, mid, emoji) =&gt; {\n  console.log(`Reaccion ${emoji} en mensaje ${mid} del chat ${cid}`);\n});\n</code></pre>"},{"location":"references/whatsapp/#messagedeleted","title":"<code>message:deleted</code>","text":"<p>Emitido cuando se elimina un mensaje.</p> <pre><code>wa.event.on(\"message:deleted\", (cid, mid) =&gt; {\n  console.log(`Mensaje eliminado: ${mid} del chat ${cid}`);\n});\n</code></pre>"},{"location":"references/whatsapp/#patrones-comunes","title":"Patrones comunes","text":""},{"location":"references/whatsapp/#bot-con-comandos","title":"Bot con comandos","text":"<pre><code>const wa = new WhatsApp();\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me || msg.type !== \"text\") return;\n\n  const text = (await msg.content()).toString();\n  if (!text.startsWith(\"!\")) return;\n\n  const [cmd, ...args] = text.slice(1).split(\" \");\n\n  if (cmd === \"ping\") {\n    await wa.Message.text(msg.cid, \"pong!\");\n  } else if (cmd === \"hora\") {\n    await wa.Message.text(msg.cid, new Date().toLocaleString());\n  }\n});\n\nawait wa.pair((data) =&gt; {\n  if (Buffer.isBuffer(data)) {\n    require(\"fs\").writeFileSync(\"qr.png\", data);\n  } else {\n    console.log(\"Codigo:\", data);\n  }\n});\n</code></pre>"},{"location":"references/whatsapp/#filtrar-por-chat","title":"Filtrar por chat","text":"<pre><code>const ALLOWED_CHATS = [\n  \"5491112345678@s.whatsapp.net\",\n  \"123456789@g.us\",\n];\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (!ALLOWED_CHATS.includes(msg.cid)) return;\n  // Procesar solo mensajes de chats permitidos\n});\n</code></pre>"},{"location":"references/whatsapp/#auto-respuesta-cuando-esta-ausente","title":"Auto-respuesta cuando esta ausente","text":"<pre><code>const AWAY_MESSAGE = \"Estoy ausente. Respondere pronto.\";\nconst responded = new Set&lt;string&gt;();\n\nwa.event.on(\"message:created\", async (msg) =&gt; {\n  if (msg.me) return;\n\n  // Responder solo una vez por chat\n  if (responded.has(msg.cid)) return;\n  responded.add(msg.cid);\n\n  await wa.Message.text(msg.cid, AWAY_MESSAGE);\n\n  // Limpiar despues de 1 hora\n  setTimeout(() =&gt; responded.delete(msg.cid), 60 * 60 * 1000);\n});\n</code></pre>"},{"location":"references/whatsapp/#interfaz-iwhatsapp","title":"Interfaz IWhatsApp","text":"<pre><code>interface IWhatsApp {\n  engine?: Engine;\n  phone?: string | number;\n}\n</code></pre>"},{"location":"references/whatsapp/#interfaz-whatsappeventmap","title":"Interfaz WhatsAppEventMap","text":"<pre><code>interface WhatsAppEventMap {\n  open: [];\n  close: [];\n  error: [Error];\n  \"contact:created\": [Contact];\n  \"contact:updated\": [Contact];\n  \"chat:created\": [Chat];\n  \"chat:updated\": [Chat];\n  \"chat:pined\": [cid: string, pined: number | null];\n  \"chat:archived\": [cid: string, archived: boolean];\n  \"chat:muted\": [cid: string, muted: number | null];\n  \"chat:deleted\": [cid: string];\n  \"message:created\": [Message];\n  \"message:updated\": [Message];\n  \"message:reacted\": [cid: string, mid: string, emoji: string];\n  \"message:deleted\": [cid: string, mid: string];\n}\n</code></pre>"}]}